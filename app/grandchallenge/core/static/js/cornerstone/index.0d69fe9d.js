(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();var nc;(function(t){t.CACHE_SIZE_EXCEEDED="CACHE_SIZE_EXCEEDED",t.IMAGE_LOAD_ERROR="IMAGE_LOAD_ERROR",t.CAMERA_MODIFIED="CORNERSTONE_CAMERA_MODIFIED",t.VOI_MODIFIED="CORNERSTONE_VOI_MODIFIED",t.ELEMENT_DISABLED="CORNERSTONE_ELEMENT_DISABLED",t.ELEMENT_ENABLED="CORNERSTONE_ELEMENT_ENABLED",t.IMAGE_RENDERED="CORNERSTONE_IMAGE_RENDERED",t.IMAGE_VOLUME_MODIFIED="CORNERSTONE_IMAGE_VOLUME_MODIFIED",t.IMAGE_LOADED="CORNERSTONE_IMAGE_LOADED",t.IMAGE_LOAD_FAILED="CORNERSTONE_IMAGE_LOAD_FAILED",t.VOLUME_LOADED="CORNERSTONE_VOLUME_LOADED",t.VOLUME_LOADED_FAILED="CORNERSTONE_VOLUME_LOADED_FAILED",t.IMAGE_CACHE_IMAGE_ADDED="CORNERSTONE_IMAGE_CACHE_IMAGE_ADDED",t.IMAGE_CACHE_IMAGE_REMOVED="CORNERSTONE_IMAGE_CACHE_IMAGE_REMOVED",t.VOLUME_CACHE_VOLUME_ADDED="CORNERSTONE_VOLUME_CACHE_VOLUME_ADDED",t.VOLUME_CACHE_VOLUME_REMOVED="CORNERSTONE_VOLUME_CACHE_VOLUME_REMOVED",t.STACK_NEW_IMAGE="CORNERSTONE_STACK_NEW_IMAGE",t.VOLUME_NEW_IMAGE="CORNERSTONE_VOLUME_NEW_IMAGE",t.PRE_STACK_NEW_IMAGE="CORNERSTONE_PRE_STACK_NEW_IMAGE",t.IMAGE_SPACING_CALIBRATED="CORNERSTONE_IMAGE_SPACING_CALIBRATED",t.IMAGE_LOAD_PROGRESS="CORNERSTONE_IMAGE_LOAD_PROGRESS",t.STACK_VIEWPORT_NEW_STACK="CORNERSTONE_STACK_VIEWPORT_NEW_STACK",t.STACK_VIEWPORT_SCROLL="CORNERSTONE_STACK_VIEWPORT_SCROLL"})(nc||(nc={}));const q=nc;var rc;(function(t){t.Interaction="interaction",t.Thumbnail="thumbnail",t.Prefetch="prefetch"})(rc||(rc={}));const qt=rc;var ac;(function(t){t.STACK="stack",t.ORTHOGRAPHIC="orthographic",t.PERSPECTIVE="perspective"})(ac||(ac={}));const It=ac;var ic;(function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t[t.FAST_LINEAR=2]="FAST_LINEAR"})(ic||(ic={}));const oc=ic;var O0={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4},w5={OFF:0,NORMALIZED:1,RAW:2},M0={BlendMode:O0,FilterMode:w5},sc;(function(t){t[t.COMPOSITE=0]="COMPOSITE",t[t.MAXIMUM_INTENSITY_BLEND=1]="MAXIMUM_INTENSITY_BLEND",t[t.MINIMUM_INTENSITY_BLEND=2]="MINIMUM_INTENSITY_BLEND",t[t.AVERAGE_INTENSITY_BLEND=3]="AVERAGE_INTENSITY_BLEND"})(sc||(sc={}));const S5=sc;var cc;(function(t){t.AXIAL="axial",t.CORONAL="coronal",t.SAGITTAL="sagittal",t.ACQUISITION="acquisition"})(cc||(cc={}));const R0=cc,D0=Object.freeze(Object.defineProperty({__proto__:null,Events:q,BlendModes:S5,InterpolationType:oc,RequestType:qt,ViewportType:It,OrientationAxis:R0},Symbol.toStringTag,{value:"Module"})),E5={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}},Of=E5,V0={MINIMUM_SLAB_THICKNESS:.05,MAXIMUM_RAY_DISTANCE:1e6};Object.freeze(V0);const cn=V0,pa={},x5={get:t=>pa[t],set:t=>{const e=t.id;pa[e]=t},delete:t=>delete pa[t],getAll:()=>Object.keys(pa).map(n=>pa[n])},Ba=x5;class O5{constructor(){this.listeners={}}reset(){this.listeners={}}addEventListener(e,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].indexOf(n)===-1&&this.listeners[e].push(n)}removeEventListener(e,n){if(!this.listeners[e])return;const r=this.listeners[e],a=r.length;for(let i=0;i<a;i++)if(r[i]===n){r.splice(i,1);return}}dispatchEvent(e){if(!this.listeners[e.type])return;const n=this.listeners[e.type].slice(),r=n.length;for(let a=0;a<r;a++)n[a].call(this,e);return!e.defaultPrevented}}const M5=new O5,ee=M5;function Hi(t){const e=t.getSize();for(let n=0;n<e;n++){const r=[];t.getNodeValue(n,r),r[1]=1-r[1],r[2]=1-r[2],r[3]=1-r[3],t.setNodeValue(n,r)}}function R5(t,e){const n=t.getSize();for(let r=0;r<n;r++){const a=[];t.getNodeValue(r,a),a[1]=a[1]*e,a[2]=a[2]*e,a[3]=a[3]*e,t.setNodeValue(r,a)}}function Y(t=ee,e,n=null){if(!e)throw new Error("Event type was not defined");const r=new CustomEvent(e,{detail:n,cancelable:!0});return t.dispatchEvent(r)}function ea(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}function L0(t){let e=t[0],n=t[0],r;const a=t.length;for(let i=1;i<a;i++)r=t[i],e=Math.min(e,r),n=Math.max(n,r);return{min:e,max:n}}const D5=Symbol("LastRuntimeId"),V5={},L5=4294967295,N5="-";function N0(t,e,n){return F5(t!==null&&typeof t=="object"?t:V5,D5,(typeof n=="number"&&n>0?n:L5)>>>0).join(typeof e=="string"?e:N5)}function F5(t,e,n){let r=t[e];r instanceof Array||(r=[0],Object.defineProperty(t,e,{value:r}));for(let a=!0,i=0;a&&i<r.length;++i){let o=r[i]|0;o<n?(a=!1,o=o+1):(o=0,i+1===r.length&&r.push(0)),r[i]=o}return r}function Xt(t){const e=t.indexOf(":");return t.substring(e+1)}const ci={},_5={add:(t,e)=>{const n=Xt(t);ci[n]||(ci[n]={}),ci[n]=e},get:(t,e)=>{if(t==="calibratedPixelSpacing"){const n=Xt(e);return ci[n]}}},b5=_5;function uc(t,e,n=1e-5){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(Math.abs(t[r]-e[r])>n)return!1;return!0}function k5(t,e,n=1e-5){return Math.abs(t[0]+e[0])<n&&Math.abs(t[1]+e[1])<n&&Math.abs(t[2]+e[2])<n}function U5(t){if(!window.crossOriginIsolated)throw new Error("Your page is NOT cross-origin isolated, see https://developer.mozilla.org/en-US/docs/Web/API/crossOriginIsolated");if(window.SharedArrayBuffer===void 0)throw new Error("SharedArrayBuffer is NOT supported in your browser see https://developer.chrome.com/blog/enabling-shared-array-buffer/");const e=new SharedArrayBuffer(t);return new Uint8Array(e)}function B5(t){if(!window.crossOriginIsolated)throw new Error("Your page is NOT cross-origin isolated, see https://developer.mozilla.org/en-US/docs/Web/API/crossOriginIsolated");if(window.SharedArrayBuffer===void 0)throw new Error("SharedArrayBuffer is NOT supported in your browser see https://developer.chrome.com/blog/enabling-shared-array-buffer/");const e=new SharedArrayBuffer(t*4);return new Float32Array(e)}var we=1e-6,Ae=typeof Float32Array<"u"?Float32Array:Array,Mf=Math.random,G5=Math.PI/180;function A5(t){return t*G5}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function F0(){var t=new Ae(9);return Ae!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function wo(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function I5(t){var e=new Ae(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function P5(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Ca(t,e,n,r,a,i,o,s,c){var u=new Ae(9);return u[0]=t,u[1]=e,u[2]=n,u[3]=r,u[4]=a,u[5]=i,u[6]=o,u[7]=s,u[8]=c,u}function W5(t,e,n,r,a,i,o,s,c,u){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=i,t[5]=o,t[6]=s,t[7]=c,t[8]=u,t}function Jt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function _0(t,e){if(t===e){var n=e[1],r=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function So(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],c=e[6],u=e[7],g=e[8],f=g*o-s*u,l=-g*i+s*c,v=u*i-o*c,p=n*f+r*l+a*v;return p?(p=1/p,t[0]=f*p,t[1]=(-g*r+a*u)*p,t[2]=(s*r-a*o)*p,t[3]=l*p,t[4]=(g*n-a*c)*p,t[5]=(-s*n+a*i)*p,t[6]=v*p,t[7]=(-u*n+r*c)*p,t[8]=(o*n-r*i)*p,t):null}function z5(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],c=e[6],u=e[7],g=e[8];return t[0]=o*g-s*u,t[1]=a*u-r*g,t[2]=r*s-a*o,t[3]=s*c-i*g,t[4]=n*g-a*c,t[5]=a*i-n*s,t[6]=i*u-o*c,t[7]=r*c-n*u,t[8]=n*o-r*i,t}function Yn(t){var e=t[0],n=t[1],r=t[2],a=t[3],i=t[4],o=t[5],s=t[6],c=t[7],u=t[8];return e*(u*i-o*c)+n*(-u*a+o*s)+r*(c*a-i*s)}function In(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],c=e[5],u=e[6],g=e[7],f=e[8],l=n[0],v=n[1],p=n[2],d=n[3],h=n[4],T=n[5],C=n[6],m=n[7],y=n[8];return t[0]=l*r+v*o+p*u,t[1]=l*a+v*s+p*g,t[2]=l*i+v*c+p*f,t[3]=d*r+h*o+T*u,t[4]=d*a+h*s+T*g,t[5]=d*i+h*c+T*f,t[6]=C*r+m*o+y*u,t[7]=C*a+m*s+y*g,t[8]=C*i+m*c+y*f,t}function $5(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],c=e[5],u=e[6],g=e[7],f=e[8],l=n[0],v=n[1];return t[0]=r,t[1]=a,t[2]=i,t[3]=o,t[4]=s,t[5]=c,t[6]=l*r+v*o+u,t[7]=l*a+v*s+g,t[8]=l*i+v*c+f,t}function j5(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],c=e[5],u=e[6],g=e[7],f=e[8],l=Math.sin(n),v=Math.cos(n);return t[0]=v*r+l*o,t[1]=v*a+l*s,t[2]=v*i+l*c,t[3]=v*o-l*r,t[4]=v*s-l*a,t[5]=v*c-l*i,t[6]=u,t[7]=g,t[8]=f,t}function H5(t,e,n){var r=n[0],a=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function K5(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function q5(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function X5(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Y5(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Z5(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=n+n,s=r+r,c=a+a,u=n*o,g=r*o,f=r*s,l=a*o,v=a*s,p=a*c,d=i*o,h=i*s,T=i*c;return t[0]=1-f-p,t[3]=g-T,t[6]=l+h,t[1]=g+T,t[4]=1-u-p,t[7]=v-d,t[2]=l-h,t[5]=v+d,t[8]=1-u-f,t}function J5(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],c=e[6],u=e[7],g=e[8],f=e[9],l=e[10],v=e[11],p=e[12],d=e[13],h=e[14],T=e[15],C=n*s-r*o,m=n*c-a*o,y=n*u-i*o,w=r*c-a*s,S=r*u-i*s,O=a*u-i*c,M=g*d-f*p,R=g*h-l*p,D=g*T-v*p,L=f*h-l*d,N=f*T-v*d,U=l*T-v*h,b=C*U-m*N+y*L+w*D-S*R+O*M;return b?(b=1/b,t[0]=(s*U-c*N+u*L)*b,t[1]=(c*D-o*U-u*R)*b,t[2]=(o*N-s*D+u*M)*b,t[3]=(a*N-r*U-i*L)*b,t[4]=(n*U-a*D+i*R)*b,t[5]=(r*D-n*N-i*M)*b,t[6]=(d*O-h*S+T*w)*b,t[7]=(h*y-p*O-T*m)*b,t[8]=(p*S-d*y+T*C)*b,t):null}function Q5(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function eT(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function tT(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function nT(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function b0(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function rT(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function aT(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function iT(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function oT(t,e){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],s=t[5],c=t[6],u=t[7],g=t[8],f=e[0],l=e[1],v=e[2],p=e[3],d=e[4],h=e[5],T=e[6],C=e[7],m=e[8];return Math.abs(n-f)<=we*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-l)<=we*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-v)<=we*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(i-p)<=we*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-d)<=we*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-h)<=we*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(c-T)<=we*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(u-C)<=we*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(g-m)<=we*Math.max(1,Math.abs(g),Math.abs(m))}var sT=In,cT=b0;const uT=Object.freeze(Object.defineProperty({__proto__:null,create:F0,fromMat4:wo,clone:I5,copy:P5,fromValues:Ca,set:W5,identity:Jt,transpose:_0,invert:So,adjoint:z5,determinant:Yn,multiply:In,translate:$5,rotate:j5,scale:H5,fromTranslation:K5,fromRotation:q5,fromScaling:X5,fromMat2d:Y5,fromQuat:Z5,normalFromMat4:J5,projection:Q5,str:eT,frob:tT,add:nT,subtract:b0,multiplyScalar:rT,multiplyScalarAndAdd:aT,exactEquals:iT,equals:oT,mul:sT,sub:cT},Symbol.toStringTag,{value:"Module"}));function ta(){var t=new Ae(16);return Ae!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function fT(t){var e=new Ae(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ke(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function gT(t,e,n,r,a,i,o,s,c,u,g,f,l,v,p,d){var h=new Ae(16);return h[0]=t,h[1]=e,h[2]=n,h[3]=r,h[4]=a,h[5]=i,h[6]=o,h[7]=s,h[8]=c,h[9]=u,h[10]=g,h[11]=f,h[12]=l,h[13]=v,h[14]=p,h[15]=d,h}function lT(t,e,n,r,a,i,o,s,c,u,g,f,l,v,p,d,h){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=i,t[5]=o,t[6]=s,t[7]=c,t[8]=u,t[9]=g,t[10]=f,t[11]=l,t[12]=v,t[13]=p,t[14]=d,t[15]=h,t}function ie(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Oe(t,e){if(t===e){var n=e[1],r=e[2],a=e[3],i=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=i,t[11]=e[14],t[12]=a,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function ct(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],c=e[6],u=e[7],g=e[8],f=e[9],l=e[10],v=e[11],p=e[12],d=e[13],h=e[14],T=e[15],C=n*s-r*o,m=n*c-a*o,y=n*u-i*o,w=r*c-a*s,S=r*u-i*s,O=a*u-i*c,M=g*d-f*p,R=g*h-l*p,D=g*T-v*p,L=f*h-l*d,N=f*T-v*d,U=l*T-v*h,b=C*U-m*N+y*L+w*D-S*R+O*M;return b?(b=1/b,t[0]=(s*U-c*N+u*L)*b,t[1]=(a*N-r*U-i*L)*b,t[2]=(d*O-h*S+T*w)*b,t[3]=(l*S-f*O-v*w)*b,t[4]=(c*D-o*U-u*R)*b,t[5]=(n*U-a*D+i*R)*b,t[6]=(h*y-p*O-T*m)*b,t[7]=(g*O-l*y+v*m)*b,t[8]=(o*N-s*D+u*M)*b,t[9]=(r*D-n*N-i*M)*b,t[10]=(p*S-d*y+T*C)*b,t[11]=(f*y-g*S-v*C)*b,t[12]=(s*R-o*L-c*M)*b,t[13]=(n*L-r*R+a*M)*b,t[14]=(d*m-p*w-h*C)*b,t[15]=(g*w-f*m+l*C)*b,t):null}function vT(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],c=e[6],u=e[7],g=e[8],f=e[9],l=e[10],v=e[11],p=e[12],d=e[13],h=e[14],T=e[15];return t[0]=s*(l*T-v*h)-f*(c*T-u*h)+d*(c*v-u*l),t[1]=-(r*(l*T-v*h)-f*(a*T-i*h)+d*(a*v-i*l)),t[2]=r*(c*T-u*h)-s*(a*T-i*h)+d*(a*u-i*c),t[3]=-(r*(c*v-u*l)-s*(a*v-i*l)+f*(a*u-i*c)),t[4]=-(o*(l*T-v*h)-g*(c*T-u*h)+p*(c*v-u*l)),t[5]=n*(l*T-v*h)-g*(a*T-i*h)+p*(a*v-i*l),t[6]=-(n*(c*T-u*h)-o*(a*T-i*h)+p*(a*u-i*c)),t[7]=n*(c*v-u*l)-o*(a*v-i*l)+g*(a*u-i*c),t[8]=o*(f*T-v*d)-g*(s*T-u*d)+p*(s*v-u*f),t[9]=-(n*(f*T-v*d)-g*(r*T-i*d)+p*(r*v-i*f)),t[10]=n*(s*T-u*d)-o*(r*T-i*d)+p*(r*u-i*s),t[11]=-(n*(s*v-u*f)-o*(r*v-i*f)+g*(r*u-i*s)),t[12]=-(o*(f*h-l*d)-g*(s*h-c*d)+p*(s*l-c*f)),t[13]=n*(f*h-l*d)-g*(r*h-a*d)+p*(r*l-a*f),t[14]=-(n*(s*h-c*d)-o*(r*h-a*d)+p*(r*c-a*s)),t[15]=n*(s*l-c*f)-o*(r*l-a*f)+g*(r*c-a*s),t}function pT(t){var e=t[0],n=t[1],r=t[2],a=t[3],i=t[4],o=t[5],s=t[6],c=t[7],u=t[8],g=t[9],f=t[10],l=t[11],v=t[12],p=t[13],d=t[14],h=t[15],T=e*o-n*i,C=e*s-r*i,m=e*c-a*i,y=n*s-r*o,w=n*c-a*o,S=r*c-a*s,O=u*p-g*v,M=u*d-f*v,R=u*h-l*v,D=g*d-f*p,L=g*h-l*p,N=f*h-l*d;return T*N-C*L+m*D+y*R-w*M+S*O}function Me(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],c=e[5],u=e[6],g=e[7],f=e[8],l=e[9],v=e[10],p=e[11],d=e[12],h=e[13],T=e[14],C=e[15],m=n[0],y=n[1],w=n[2],S=n[3];return t[0]=m*r+y*s+w*f+S*d,t[1]=m*a+y*c+w*l+S*h,t[2]=m*i+y*u+w*v+S*T,t[3]=m*o+y*g+w*p+S*C,m=n[4],y=n[5],w=n[6],S=n[7],t[4]=m*r+y*s+w*f+S*d,t[5]=m*a+y*c+w*l+S*h,t[6]=m*i+y*u+w*v+S*T,t[7]=m*o+y*g+w*p+S*C,m=n[8],y=n[9],w=n[10],S=n[11],t[8]=m*r+y*s+w*f+S*d,t[9]=m*a+y*c+w*l+S*h,t[10]=m*i+y*u+w*v+S*T,t[11]=m*o+y*g+w*p+S*C,m=n[12],y=n[13],w=n[14],S=n[15],t[12]=m*r+y*s+w*f+S*d,t[13]=m*a+y*c+w*l+S*h,t[14]=m*i+y*u+w*v+S*T,t[15]=m*o+y*g+w*p+S*C,t}function je(t,e,n){var r=n[0],a=n[1],i=n[2],o,s,c,u,g,f,l,v,p,d,h,T;return e===t?(t[12]=e[0]*r+e[4]*a+e[8]*i+e[12],t[13]=e[1]*r+e[5]*a+e[9]*i+e[13],t[14]=e[2]*r+e[6]*a+e[10]*i+e[14],t[15]=e[3]*r+e[7]*a+e[11]*i+e[15]):(o=e[0],s=e[1],c=e[2],u=e[3],g=e[4],f=e[5],l=e[6],v=e[7],p=e[8],d=e[9],h=e[10],T=e[11],t[0]=o,t[1]=s,t[2]=c,t[3]=u,t[4]=g,t[5]=f,t[6]=l,t[7]=v,t[8]=p,t[9]=d,t[10]=h,t[11]=T,t[12]=o*r+g*a+p*i+e[12],t[13]=s*r+f*a+d*i+e[13],t[14]=c*r+l*a+h*i+e[14],t[15]=u*r+v*a+T*i+e[15]),t}function Pn(t,e,n){var r=n[0],a=n[1],i=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Bt(t,e,n,r){var a=r[0],i=r[1],o=r[2],s=Math.hypot(a,i,o),c,u,g,f,l,v,p,d,h,T,C,m,y,w,S,O,M,R,D,L,N,U,b,G;return s<we?null:(s=1/s,a*=s,i*=s,o*=s,c=Math.sin(n),u=Math.cos(n),g=1-u,f=e[0],l=e[1],v=e[2],p=e[3],d=e[4],h=e[5],T=e[6],C=e[7],m=e[8],y=e[9],w=e[10],S=e[11],O=a*a*g+u,M=i*a*g+o*c,R=o*a*g-i*c,D=a*i*g-o*c,L=i*i*g+u,N=o*i*g+a*c,U=a*o*g+i*c,b=i*o*g-a*c,G=o*o*g+u,t[0]=f*O+d*M+m*R,t[1]=l*O+h*M+y*R,t[2]=v*O+T*M+w*R,t[3]=p*O+C*M+S*R,t[4]=f*D+d*L+m*N,t[5]=l*D+h*L+y*N,t[6]=v*D+T*L+w*N,t[7]=p*D+C*L+S*N,t[8]=f*U+d*b+m*G,t[9]=l*U+h*b+y*G,t[10]=v*U+T*b+w*G,t[11]=p*U+C*b+S*G,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Zc(t,e,n){var r=Math.sin(n),a=Math.cos(n),i=e[4],o=e[5],s=e[6],c=e[7],u=e[8],g=e[9],f=e[10],l=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*a+u*r,t[5]=o*a+g*r,t[6]=s*a+f*r,t[7]=c*a+l*r,t[8]=u*a-i*r,t[9]=g*a-o*r,t[10]=f*a-s*r,t[11]=l*a-c*r,t}function Jc(t,e,n){var r=Math.sin(n),a=Math.cos(n),i=e[0],o=e[1],s=e[2],c=e[3],u=e[8],g=e[9],f=e[10],l=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*a-u*r,t[1]=o*a-g*r,t[2]=s*a-f*r,t[3]=c*a-l*r,t[8]=i*r+u*a,t[9]=o*r+g*a,t[10]=s*r+f*a,t[11]=c*r+l*a,t}function Qc(t,e,n){var r=Math.sin(n),a=Math.cos(n),i=e[0],o=e[1],s=e[2],c=e[3],u=e[4],g=e[5],f=e[6],l=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*a+u*r,t[1]=o*a+g*r,t[2]=s*a+f*r,t[3]=c*a+l*r,t[4]=u*a-i*r,t[5]=g*a-o*r,t[6]=f*a-s*r,t[7]=l*a-c*r,t}function k0(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function U0(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function eu(t,e,n){var r=n[0],a=n[1],i=n[2],o=Math.hypot(r,a,i),s,c,u;return o<we?null:(o=1/o,r*=o,a*=o,i*=o,s=Math.sin(e),c=Math.cos(e),u=1-c,t[0]=r*r*u+c,t[1]=a*r*u+i*s,t[2]=i*r*u-a*s,t[3]=0,t[4]=r*a*u-i*s,t[5]=a*a*u+c,t[6]=i*a*u+r*s,t[7]=0,t[8]=r*i*u+a*s,t[9]=a*i*u-r*s,t[10]=i*i*u+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function hT(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function dT(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function yT(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function B0(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=r+r,c=a+a,u=i+i,g=r*s,f=r*c,l=r*u,v=a*c,p=a*u,d=i*u,h=o*s,T=o*c,C=o*u;return t[0]=1-(v+d),t[1]=f+C,t[2]=l-T,t[3]=0,t[4]=f-C,t[5]=1-(g+d),t[6]=p+h,t[7]=0,t[8]=l+T,t[9]=p-h,t[10]=1-(g+v),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function TT(t,e){var n=new Ae(3),r=-e[0],a=-e[1],i=-e[2],o=e[3],s=e[4],c=e[5],u=e[6],g=e[7],f=r*r+a*a+i*i+o*o;return f>0?(n[0]=(s*o+g*r+c*i-u*a)*2/f,n[1]=(c*o+g*a+u*r-s*i)*2/f,n[2]=(u*o+g*i+s*a-c*r)*2/f):(n[0]=(s*o+g*r+c*i-u*a)*2,n[1]=(c*o+g*a+u*r-s*i)*2,n[2]=(u*o+g*i+s*a-c*r)*2),B0(t,e,n),t}function mT(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function G0(t,e){var n=e[0],r=e[1],a=e[2],i=e[4],o=e[5],s=e[6],c=e[8],u=e[9],g=e[10];return t[0]=Math.hypot(n,r,a),t[1]=Math.hypot(i,o,s),t[2]=Math.hypot(c,u,g),t}function A0(t,e){var n=new Ae(3);G0(n,e);var r=1/n[0],a=1/n[1],i=1/n[2],o=e[0]*r,s=e[1]*a,c=e[2]*i,u=e[4]*r,g=e[5]*a,f=e[6]*i,l=e[8]*r,v=e[9]*a,p=e[10]*i,d=o+g+p,h=0;return d>0?(h=Math.sqrt(d+1)*2,t[3]=.25*h,t[0]=(f-v)/h,t[1]=(l-c)/h,t[2]=(s-u)/h):o>g&&o>p?(h=Math.sqrt(1+o-g-p)*2,t[3]=(f-v)/h,t[0]=.25*h,t[1]=(s+u)/h,t[2]=(l+c)/h):g>p?(h=Math.sqrt(1+g-o-p)*2,t[3]=(l-c)/h,t[0]=(s+u)/h,t[1]=.25*h,t[2]=(f+v)/h):(h=Math.sqrt(1+p-o-g)*2,t[3]=(s-u)/h,t[0]=(l+c)/h,t[1]=(f+v)/h,t[2]=.25*h),t}function I0(t,e,n,r){var a=e[0],i=e[1],o=e[2],s=e[3],c=a+a,u=i+i,g=o+o,f=a*c,l=a*u,v=a*g,p=i*u,d=i*g,h=o*g,T=s*c,C=s*u,m=s*g,y=r[0],w=r[1],S=r[2];return t[0]=(1-(p+h))*y,t[1]=(l+m)*y,t[2]=(v-C)*y,t[3]=0,t[4]=(l-m)*w,t[5]=(1-(f+h))*w,t[6]=(d+T)*w,t[7]=0,t[8]=(v+C)*S,t[9]=(d-T)*S,t[10]=(1-(f+p))*S,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function CT(t,e,n,r,a){var i=e[0],o=e[1],s=e[2],c=e[3],u=i+i,g=o+o,f=s+s,l=i*u,v=i*g,p=i*f,d=o*g,h=o*f,T=s*f,C=c*u,m=c*g,y=c*f,w=r[0],S=r[1],O=r[2],M=a[0],R=a[1],D=a[2],L=(1-(d+T))*w,N=(v+y)*w,U=(p-m)*w,b=(v-y)*S,G=(1-(l+T))*S,P=(h+C)*S,z=(p+m)*O,F=(h-C)*O,V=(1-(l+d))*O;return t[0]=L,t[1]=N,t[2]=U,t[3]=0,t[4]=b,t[5]=G,t[6]=P,t[7]=0,t[8]=z,t[9]=F,t[10]=V,t[11]=0,t[12]=n[0]+M-(L*M+b*R+z*D),t[13]=n[1]+R-(N*M+G*R+F*D),t[14]=n[2]+D-(U*M+P*R+V*D),t[15]=1,t}function tu(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=n+n,s=r+r,c=a+a,u=n*o,g=r*o,f=r*s,l=a*o,v=a*s,p=a*c,d=i*o,h=i*s,T=i*c;return t[0]=1-f-p,t[1]=g+T,t[2]=l-h,t[3]=0,t[4]=g-T,t[5]=1-u-p,t[6]=v+d,t[7]=0,t[8]=l+h,t[9]=v-d,t[10]=1-u-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function wT(t,e,n,r,a,i,o){var s=1/(n-e),c=1/(a-r),u=1/(i-o);return t[0]=i*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i*2*c,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(a+r)*c,t[10]=(o+i)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*i*2*u,t[15]=0,t}function P0(t,e,n,r,a){var i=1/Math.tan(e/2),o;return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(o=1/(r-a),t[10]=(a+r)*o,t[14]=2*a*r*o):(t[10]=-1,t[14]=-2*r),t}var ST=P0;function ET(t,e,n,r,a){var i=1/Math.tan(e/2),o;return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(o=1/(r-a),t[10]=a*o,t[14]=a*r*o):(t[10]=-1,t[14]=-r),t}function xT(t,e,n,r){var a=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),c=2/(o+s),u=2/(a+i);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((o-s)*c*.5),t[9]=(a-i)*u*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function W0(t,e,n,r,a,i,o){var s=1/(e-n),c=1/(r-a),u=1/(i-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*s,t[13]=(a+r)*c,t[14]=(o+i)*u,t[15]=1,t}var nu=W0;function OT(t,e,n,r,a,i,o){var s=1/(e-n),c=1/(r-a),u=1/(i-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(e+n)*s,t[13]=(a+r)*c,t[14]=i*u,t[15]=1,t}function z0(t,e,n,r){var a,i,o,s,c,u,g,f,l,v,p=e[0],d=e[1],h=e[2],T=r[0],C=r[1],m=r[2],y=n[0],w=n[1],S=n[2];return Math.abs(p-y)<we&&Math.abs(d-w)<we&&Math.abs(h-S)<we?ie(t):(g=p-y,f=d-w,l=h-S,v=1/Math.hypot(g,f,l),g*=v,f*=v,l*=v,a=C*l-m*f,i=m*g-T*l,o=T*f-C*g,v=Math.hypot(a,i,o),v?(v=1/v,a*=v,i*=v,o*=v):(a=0,i=0,o=0),s=f*o-l*i,c=l*a-g*o,u=g*i-f*a,v=Math.hypot(s,c,u),v?(v=1/v,s*=v,c*=v,u*=v):(s=0,c=0,u=0),t[0]=a,t[1]=s,t[2]=g,t[3]=0,t[4]=i,t[5]=c,t[6]=f,t[7]=0,t[8]=o,t[9]=u,t[10]=l,t[11]=0,t[12]=-(a*p+i*d+o*h),t[13]=-(s*p+c*d+u*h),t[14]=-(g*p+f*d+l*h),t[15]=1,t)}function MT(t,e,n,r){var a=e[0],i=e[1],o=e[2],s=r[0],c=r[1],u=r[2],g=a-n[0],f=i-n[1],l=o-n[2],v=g*g+f*f+l*l;v>0&&(v=1/Math.sqrt(v),g*=v,f*=v,l*=v);var p=c*l-u*f,d=u*g-s*l,h=s*f-c*g;return v=p*p+d*d+h*h,v>0&&(v=1/Math.sqrt(v),p*=v,d*=v,h*=v),t[0]=p,t[1]=d,t[2]=h,t[3]=0,t[4]=f*h-l*d,t[5]=l*p-g*h,t[6]=g*d-f*p,t[7]=0,t[8]=g,t[9]=f,t[10]=l,t[11]=0,t[12]=a,t[13]=i,t[14]=o,t[15]=1,t}function RT(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function DT(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function VT(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function $0(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function LT(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function NT(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function FT(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function _T(t,e){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],s=t[5],c=t[6],u=t[7],g=t[8],f=t[9],l=t[10],v=t[11],p=t[12],d=t[13],h=t[14],T=t[15],C=e[0],m=e[1],y=e[2],w=e[3],S=e[4],O=e[5],M=e[6],R=e[7],D=e[8],L=e[9],N=e[10],U=e[11],b=e[12],G=e[13],P=e[14],z=e[15];return Math.abs(n-C)<=we*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(r-m)<=we*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(a-y)<=we*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(i-w)<=we*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(o-S)<=we*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-O)<=we*Math.max(1,Math.abs(s),Math.abs(O))&&Math.abs(c-M)<=we*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(u-R)<=we*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(g-D)<=we*Math.max(1,Math.abs(g),Math.abs(D))&&Math.abs(f-L)<=we*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(l-N)<=we*Math.max(1,Math.abs(l),Math.abs(N))&&Math.abs(v-U)<=we*Math.max(1,Math.abs(v),Math.abs(U))&&Math.abs(p-b)<=we*Math.max(1,Math.abs(p),Math.abs(b))&&Math.abs(d-G)<=we*Math.max(1,Math.abs(d),Math.abs(G))&&Math.abs(h-P)<=we*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(T-z)<=we*Math.max(1,Math.abs(T),Math.abs(z))}var bT=Me,kT=$0;const Rf=Object.freeze(Object.defineProperty({__proto__:null,create:ta,clone:fT,copy:Ke,fromValues:gT,set:lT,identity:ie,transpose:Oe,invert:ct,adjoint:vT,determinant:pT,multiply:Me,translate:je,scale:Pn,rotate:Bt,rotateX:Zc,rotateY:Jc,rotateZ:Qc,fromTranslation:k0,fromScaling:U0,fromRotation:eu,fromXRotation:hT,fromYRotation:dT,fromZRotation:yT,fromRotationTranslation:B0,fromQuat2:TT,getTranslation:mT,getScaling:G0,getRotation:A0,fromRotationTranslationScale:I0,fromRotationTranslationScaleOrigin:CT,fromQuat:tu,frustum:wT,perspectiveNO:P0,perspective:ST,perspectiveZO:ET,perspectiveFromFieldOfView:xT,orthoNO:W0,ortho:nu,orthoZO:OT,lookAt:z0,targetTo:MT,str:RT,frob:DT,add:VT,subtract:$0,multiplyScalar:LT,multiplyScalarAndAdd:NT,exactEquals:FT,equals:_T,mul:bT,sub:kT},Symbol.toStringTag,{value:"Module"}));function Ue(){var t=new Ae(3);return Ae!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function UT(t){var e=new Ae(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function vn(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function or(t,e,n){var r=new Ae(3);return r[0]=t,r[1]=e,r[2]=n,r}function BT(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function te(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function j0(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Kt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function H0(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Eo(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function GT(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function AT(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function IT(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function PT(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function WT(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function xo(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Lt(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function Oo(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return Math.hypot(n,r,a)}function K0(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return n*n+r*r+a*a}function q0(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function zT(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function X0(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Nt(t,e){var n=e[0],r=e[1],a=e[2],i=n*n+r*r+a*a;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function ut(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function pn(t,e,n){var r=e[0],a=e[1],i=e[2],o=n[0],s=n[1],c=n[2];return t[0]=a*c-i*s,t[1]=i*o-r*c,t[2]=r*s-a*o,t}function $T(t,e,n,r){var a=e[0],i=e[1],o=e[2];return t[0]=a+r*(n[0]-a),t[1]=i+r*(n[1]-i),t[2]=o+r*(n[2]-o),t}function jT(t,e,n,r,a,i){var o=i*i,s=o*(2*i-3)+1,c=o*(i-2)+i,u=o*(i-1),g=o*(3-2*i);return t[0]=e[0]*s+n[0]*c+r[0]*u+a[0]*g,t[1]=e[1]*s+n[1]*c+r[1]*u+a[1]*g,t[2]=e[2]*s+n[2]*c+r[2]*u+a[2]*g,t}function HT(t,e,n,r,a,i){var o=1-i,s=o*o,c=i*i,u=s*o,g=3*i*s,f=3*c*o,l=c*i;return t[0]=e[0]*u+n[0]*g+r[0]*f+a[0]*l,t[1]=e[1]*u+n[1]*g+r[1]*f+a[1]*l,t[2]=e[2]*u+n[2]*g+r[2]*f+a[2]*l,t}function KT(t,e){e=e||1;var n=Mf()*2*Math.PI,r=Mf()*2-1,a=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*a,t[1]=Math.sin(n)*a,t[2]=r*e,t}function ue(t,e,n){var r=e[0],a=e[1],i=e[2],o=n[3]*r+n[7]*a+n[11]*i+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*a+n[8]*i+n[12])/o,t[1]=(n[1]*r+n[5]*a+n[9]*i+n[13])/o,t[2]=(n[2]*r+n[6]*a+n[10]*i+n[14])/o,t}function $r(t,e,n){var r=e[0],a=e[1],i=e[2];return t[0]=r*n[0]+a*n[3]+i*n[6],t[1]=r*n[1]+a*n[4]+i*n[7],t[2]=r*n[2]+a*n[5]+i*n[8],t}function qT(t,e,n){var r=n[0],a=n[1],i=n[2],o=n[3],s=e[0],c=e[1],u=e[2],g=a*u-i*c,f=i*s-r*u,l=r*c-a*s,v=a*l-i*f,p=i*g-r*l,d=r*f-a*g,h=o*2;return g*=h,f*=h,l*=h,v*=2,p*=2,d*=2,t[0]=s+g+v,t[1]=c+f+p,t[2]=u+l+d,t}function XT(t,e,n,r){var a=[],i=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],i[0]=a[0],i[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),i[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function YT(t,e,n,r){var a=[],i=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],i[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),i[1]=a[1],i[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function ZT(t,e,n,r){var a=[],i=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],i[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),i[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),i[2]=a[2],t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function JT(t,e){var n=t[0],r=t[1],a=t[2],i=e[0],o=e[1],s=e[2],c=Math.sqrt(n*n+r*r+a*a),u=Math.sqrt(i*i+o*o+s*s),g=c*u,f=g&&ut(t,e)/g;return Math.acos(Math.min(Math.max(f,-1),1))}function QT(t){return t[0]=0,t[1]=0,t[2]=0,t}function em(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function fc(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function gc(t,e){var n=t[0],r=t[1],a=t[2],i=e[0],o=e[1],s=e[2];return Math.abs(n-i)<=we*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=we*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(a-s)<=we*Math.max(1,Math.abs(a),Math.abs(s))}var na=Kt,tm=H0,nm=Eo,rm=Oo,am=K0,ru=vn,im=q0,om=function(){var t=Ue();return function(e,n,r,a,i,o){var s,c;for(n||(n=3),r||(r=0),a?c=Math.min(a*n+r,e.length):c=e.length,s=r;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],i(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}();const sm=Object.freeze(Object.defineProperty({__proto__:null,create:Ue,clone:UT,length:vn,fromValues:or,copy:BT,set:te,add:j0,subtract:Kt,multiply:H0,divide:Eo,ceil:GT,floor:AT,min:IT,max:PT,round:WT,scale:xo,scaleAndAdd:Lt,distance:Oo,squaredDistance:K0,squaredLength:q0,negate:zT,inverse:X0,normalize:Nt,dot:ut,cross:pn,lerp:$T,hermite:jT,bezier:HT,random:KT,transformMat4:ue,transformMat3:$r,transformQuat:qT,rotateX:XT,rotateY:YT,rotateZ:ZT,angle:JT,zero:QT,str:em,exactEquals:fc,equals:gc,sub:na,mul:tm,div:nm,dist:rm,sqrDist:am,len:ru,sqrLen:im,forEach:om},Symbol.toStringTag,{value:"Module"}));function cm(){var t=new Ae(4);return Ae!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function um(t,e,n,r){var a=new Ae(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a}function Df(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function fm(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=n*n+r*r+a*a+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=a*o,t[3]=i*o,t}function rr(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3];return t[0]=n[0]*r+n[4]*a+n[8]*i+n[12]*o,t[1]=n[1]*r+n[5]*a+n[9]*i+n[13]*o,t[2]=n[2]*r+n[6]*a+n[10]*i+n[14]*o,t[3]=n[3]*r+n[7]*a+n[11]*i+n[15]*o,t}(function(){var t=cm();return function(e,n,r,a,i,o){var s,c;for(n||(n=4),r||(r=0),a?c=Math.min(a*n+r,e.length):c=e.length,s=r;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],i(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}})();function ur(){var t=new Ae(4);return Ae!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function au(t,e,n){n=n*.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function gm(t,e){var n=Math.acos(e[3])*2,r=Math.sin(n/2);return r>we?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function Vf(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=n[0],c=n[1],u=n[2],g=n[3];return t[0]=r*g+o*s+a*u-i*c,t[1]=a*g+o*c+i*s-r*u,t[2]=i*g+o*u+r*c-a*s,t[3]=o*g-r*s-a*c-i*u,t}function fs(t,e,n,r){var a=e[0],i=e[1],o=e[2],s=e[3],c=n[0],u=n[1],g=n[2],f=n[3],l,v,p,d,h;return v=a*c+i*u+o*g+s*f,v<0&&(v=-v,c=-c,u=-u,g=-g,f=-f),1-v>we?(l=Math.acos(v),p=Math.sin(l),d=Math.sin((1-r)*l)/p,h=Math.sin(r*l)/p):(d=1-r,h=r),t[0]=d*a+h*c,t[1]=d*i+h*u,t[2]=d*o+h*g,t[3]=d*s+h*f,t}function lm(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function vm(t,e){var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[a*3+a]&&(a=2);var i=(a+1)%3,o=(a+2)%3;r=Math.sqrt(e[a*3+a]-e[i*3+i]-e[o*3+o]+1),t[a]=.5*r,r=.5/r,t[3]=(e[i*3+o]-e[o*3+i])*r,t[i]=(e[i*3+a]+e[a*3+i])*r,t[o]=(e[o*3+a]+e[a*3+o])*r}return t}var Lf=um,Y0=fm;(function(){var t=Ue(),e=or(1,0,0),n=or(0,1,0);return function(r,a,i){var o=ut(a,i);return o<-.999999?(pn(t,e,a),ru(t)<1e-6&&pn(t,n,a),Nt(t,t),au(r,t,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(pn(t,a,i),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+o,Y0(r,r))}})();(function(){var t=ur(),e=ur();return function(n,r,a,i,o,s){return fs(t,r,o,s),fs(e,a,i,s),fs(n,t,e,2*s*(1-s)),n}})();(function(){var t=F0();return function(e,n,r,a){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=a[0],t[4]=a[1],t[7]=a[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],Y0(e,vm(e,t))}})();function Ki(){var t=new Ae(2);return Ae!=Float32Array&&(t[0]=0,t[1]=0),t}function Nf(t,e){var n=new Ae(2);return n[0]=t,n[1]=e,n}function lc(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}(function(){var t=Ki();return function(e,n,r,a,i,o){var s,c;for(n||(n=2),r||(r=0),a?c=Math.min(a*n+r,e.length):c=e.length,s=r;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],i(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}})();const Ff=[];function He(t,e){for(let n=0;n<Ff.length;n++){const r=Ff[n].provider(t,e);if(r!==void 0)return r}}function qi(t,e){const{direction:n,spacing:r}=t,a=n.slice(0,3),i=n.slice(3,6),o=n.slice(6,9),s=[ut(a,e),ut(i,e),ut(o,e)],c=Ue();return te(c,s[0]*r[0],s[1]*r[1],s[2]*r[2]),vn(c)}function pm(t,e,n,r){if(!t)return;const{direction:a,imageIds:i}=t;if(!i||!i.length)return;const o=a.slice(6,9),s=ut(o,n);if(Math.abs(s)<.99)return;const u=qi(t,n)/2;let g;for(let f=0;f<i.length;f++){const l=i[f],{imagePositionPatient:v}=He("imagePlaneModule",l),p=Ue();na(p,e,v);const d=ut(p,n);Math.abs(d)<u&&(g=l)}return g}const hm=1073741824;class dm{constructor(){this.setMaxCacheSize=e=>{if(!e||typeof e!="number"){const n=`New max cacheSize ${this._maxCacheSize} should be defined and should be a number.`;throw new Error(n)}this._maxCacheSize=e},this.isCacheable=e=>{const n=this.getBytesAvailable(),r=this._imageCacheSize;return n+r>e},this.getMaxCacheSize=()=>this._maxCacheSize,this.getCacheSize=()=>this._imageCacheSize+this._volumeCacheSize,this._decacheImage=e=>{const{imageLoadObject:n}=this._imageCache.get(e);n.cancelFn&&n.cancelFn(),n.decache&&n.decache(),this._imageCache.delete(e)},this._decacheVolume=e=>{const n=this._volumeCache.get(e),{volumeLoadObject:r}=n;r.cancelFn&&r.cancelFn(),r.decache&&r.decache(),this._volumeCache.delete(e)},this.purgeCache=()=>{const e=this._imageCache.keys();for(;;){const{value:n,done:r}=e.next();if(r)break;this.removeImageLoadObject(n),Y(ee,q.IMAGE_CACHE_IMAGE_REMOVED,{imageId:n})}this.purgeVolumeCache()},this.purgeVolumeCache=()=>{const e=this._volumeCache.keys();for(;;){const{value:n,done:r}=e.next();if(r)break;this.removeVolumeLoadObject(n),Y(ee,q.VOLUME_CACHE_VOLUME_REMOVED,{volumeId:n})}},this.getVolumeLoadObject=e=>{if(e===void 0)throw new Error("getVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(e);if(n!==void 0)return n.timeStamp=Date.now(),n.volumeLoadObject},this.getVolume=e=>{if(e===void 0)throw new Error("getVolume: volumeId must not be undefined");const n=this._volumeCache.get(e);if(n!==void 0)return n.timeStamp=Date.now(),n.volume},this.removeImageLoadObject=e=>{if(e===void 0)throw new Error("removeImageLoadObject: imageId must not be undefined");const n=this._imageCache.get(e);if(n===void 0)throw new Error("removeImageLoadObject: imageId was not present in imageCache");this._incrementImageCacheSize(-n.sizeInBytes);const r={imageId:e};Y(ee,q.IMAGE_CACHE_IMAGE_REMOVED,r),this._decacheImage(e)},this.removeVolumeLoadObject=e=>{if(e===void 0)throw new Error("removeVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(e);if(n===void 0)throw new Error("removeVolumeLoadObject: volumeId was not present in volumeCache");this._incrementVolumeCacheSize(-n.sizeInBytes);const r={volume:n,volumeId:e};Y(ee,q.VOLUME_CACHE_VOLUME_REMOVED,r),this._decacheVolume(e)},this._incrementImageCacheSize=e=>{this._imageCacheSize+=e},this._incrementVolumeCacheSize=e=>{this._volumeCacheSize+=e},this._imageCache=new Map,this._volumeCache=new Map,this._imageCacheSize=0,this._volumeCacheSize=0,this._maxCacheSize=hm}getBytesAvailable(){return this.getMaxCacheSize()-this.getCacheSize()}decacheIfNecessaryUntilBytesAvailable(e,n){let r=this.getBytesAvailable();if(r>=e)return r;let a=Array.from(this._imageCache.values());function i(c,u){return c.timeStamp>u.timeStamp?1:c.timeStamp<u.timeStamp?-1:0}a.sort(i);let o=a.map(c=>c.imageId),s=o;n&&(s=o.filter(c=>!n.includes(c)));for(const c of s)if(this.removeImageLoadObject(c),Y(ee,q.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),r=this.getBytesAvailable(),r>=e)return r;a=Array.from(this._imageCache.values()),o=a.map(c=>c.imageId);for(const c of o)if(this.removeImageLoadObject(c),Y(ee,q.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),r=this.getBytesAvailable(),r>=e)return r}putImageLoadObject(e,n){if(e===void 0)throw new Error("putImageLoadObject: imageId must not be undefined");if(n.promise===void 0)throw new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");if(this._imageCache.has(e))throw new Error("putImageLoadObject: imageId already in cache");if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putImageLoadObject: imageLoadObject.cancel must be a function");const r={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._imageCache.set(e,r),n.promise.then(a=>{if(!this._imageCache.get(e)){console.warn("The image was purged from the cache before it completed loading.");return}if(a.sizeInBytes===void 0)throw new Error("putImageLoadObject: image.sizeInBytes must not be undefined");if(a.sizeInBytes.toFixed===void 0)throw new Error("putImageLoadObject: image.sizeInBytes is not a number");if(!this.isCacheable(a.sizeInBytes))throw new Error(q.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(a.sizeInBytes),r.loaded=!0,r.image=a,r.sizeInBytes=a.sizeInBytes,this._incrementImageCacheSize(r.sizeInBytes);const i={image:r};Y(ee,q.IMAGE_CACHE_IMAGE_ADDED,i),r.sharedCacheKey=a.sharedCacheKey}).catch(a=>{throw this._imageCache.delete(e),a})}getImageLoadObject(e){if(e===void 0)throw new Error("getImageLoadObject: imageId must not be undefined");const n=this._imageCache.get(e);if(n!==void 0)return n.timeStamp=Date.now(),n.imageLoadObject}isImageIdCached(e){const n=this._imageCache.get(e);return n?n.loaded:!1}getVolumeContainingImageId(e){const n=Array.from(this._volumeCache.keys()),r=Xt(e);for(const a of n){const i=this._volumeCache.get(a);if(!i.volume)return;let{imageIds:o}=i.volume;if(!o||o.length===0)continue;o=o.map(c=>Xt(c));const s=o.indexOf(r);if(s>-1)return{volume:i.volume,imageIdIndex:s}}}getCachedImageBasedOnImageURI(e){const n=Xt(e),a=Array.from(this._imageCache.keys()).find(i=>Xt(i)===n);if(!!a)return this._imageCache.get(a)}putVolumeLoadObject(e,n){if(e===void 0)throw new Error("putVolumeLoadObject: volumeId must not be undefined");if(n.promise===void 0)throw new Error("putVolumeLoadObject: volumeLoadObject.promise must not be undefined");if(this._volumeCache.has(e))throw new Error(`putVolumeLoadObject: volumeId:${e} already in cache`);if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putVolumeLoadObject: volumeLoadObject.cancel must be a function");const r={loaded:!1,volumeId:e,volumeLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._volumeCache.set(e,r),n.promise.then(a=>{if(!this._volumeCache.get(e)){console.warn("The image was purged from the cache before it completed loading.");return}if(a.sizeInBytes===void 0)throw new Error("putVolumeLoadObject: volume.sizeInBytes must not be undefined");if(a.sizeInBytes.toFixed===void 0)throw new Error("putVolumeLoadObject: volume.sizeInBytes is not a number");this.decacheIfNecessaryUntilBytesAvailable(a.sizeInBytes,a.imageIds),r.volume=a,r.sizeInBytes=a.sizeInBytes,this._incrementVolumeCacheSize(r.sizeInBytes);const i={volume:r};Y(ee,q.VOLUME_CACHE_VOLUME_ADDED,i)}).catch(a=>{throw this._volumeCache.delete(e),a})}}const ym=new dm,be=ym;function iu(t,e,n){const{viewPlaneNormal:r}=e,a=t.getActors();if(!a||!a.length)return{spacingInNormalDirection:null,imageVolume:null};const i=a.length,o=a.map(c=>be.getVolume(c.uid));if(n){const c=o.find(g=>g.volumeId===n),u=qi(c,r);return{imageVolume:c,spacingInNormalDirection:u}}const s={spacingInNormalDirection:1/0,imageVolume:null};for(let c=0;c<i;c++){const u=o[c];if(!u)continue;const g=qi(u,r);g<s.spacingInNormalDirection&&(s.spacingInNormalDirection=g,s.imageVolume=u)}return s}function Z0(t){const e=t.getMapper().getInputData(),n=e.extentToBounds(e.getExtent());return[[n[0],n[2],n[4]],[n[0],n[2],n[5]],[n[0],n[3],n[4]],[n[0],n[3],n[5]],[n[1],n[2],n[4]],[n[1],n[2],n[5]],[n[1],n[3],n[4]],[n[1],n[3],n[5]]]}function Tm(t,e){return!(t[0]<0||t[0]>=e[0]||t[1]<0||t[1]>=e[1]||t[2]<0||t[2]>=e[2])}function wn(t){return Ba.get(t)}function ra(){return Ba.getAll()}function mm(t,e){let n;e?n=[wn(e)]:n=ra();const r=[];return n.forEach(a=>{const i=t.getActors(),o=a.getVolumeViewports();for(const s of o){const c=s.getActors();if(c.length!==i.length)continue;i.every(({uid:g})=>c.find(f=>g===f.uid))&&r.push(s)}}),r}function Mo(t,e){let n;e?n=[wn(e)]:n=ra();const r=[];return n.forEach(a=>{const o=a.getVolumeViewports().filter(s=>s.hasVolumeId(t));r.push(...o)}),r}function J0(t,e){return t.worldToIndex(e).map(Math.round)}class Q0{constructor(e){this.numRequests={interaction:0,thumbnail:0,prefetch:0},this.id=e||ea(),this.requestPool={interaction:{0:[]},thumbnail:{0:[]},prefetch:{0:[]}},this.grabDelay=5,this.awake=!1,this.numRequests={interaction:0,thumbnail:0,prefetch:0},this.maxNumRequests={interaction:6,thumbnail:6,prefetch:5}}destroy(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}addRequest(e,n,r,a=0){const i={requestFn:e,type:n,additionalDetails:r};this.requestPool[n][a]===void 0&&(this.requestPool[n][a]=[]),this.requestPool[n][a].push(i),this.awake?n===qt.Interaction&&this.startGrabbing():(this.awake=!0,this.startGrabbing())}filterRequests(e){Object.keys(this.requestPool).forEach(n=>{const r=this.requestPool[n];Object.keys(r).forEach(a=>{r[a]=r[a].filter(i=>e(i))})})}clearRequestStack(e){if(!this.requestPool[e])throw new Error(`No category for the type ${e} found`);this.requestPool[e]={0:[]}}sendRequests(e){const n=this.maxNumRequests[e]-this.numRequests[e];for(let r=0;r<n;r++){const a=this.getNextRequest(e);if(a===null)return!1;a&&(this.numRequests[e]++,this.awake=!0,a.requestFn().finally(()=>{this.numRequests[e]--,this.startAgain()}))}return!0}getNextRequest(e){const n=this.getSortedPriorityGroups(e);for(const r of n)if(this.requestPool[e][r].length)return this.requestPool[e][r].shift();return null}startGrabbing(){const e=this.sendRequests(qt.Interaction),n=this.sendRequests(qt.Thumbnail),r=this.sendRequests(qt.Prefetch);!e&&!n&&!r&&(this.awake=!1)}startAgain(){!this.awake||(this.grabDelay!==void 0?this.timeoutHandle=window.setTimeout(()=>{this.startGrabbing()},this.grabDelay):this.startGrabbing())}getSortedPriorityGroups(e){return Object.keys(this.requestPool[e]).map(Number).filter(r=>this.requestPool[e][r].length).sort()}getRequestPool(){return this.requestPool}}new Q0;const ou=new Q0("imageLoadPool");ou.maxNumRequests={interaction:1e3,thumbnail:1e3,prefetch:1e3};ou.grabDelay=0;const Ga=ou,Cm={};function wm(t,e){const n=t.indexOf(":"),r=t.substring(0,n),a=Cm[r];if(a==null)throw new Error("loadImageFromImageLoader: no image loader for imageId");const i=a(t,e);return i.promise.then(function(o){Y(ee,q.IMAGE_LOADED,{image:o})},function(o){const s={imageId:t,error:o};Y(ee,q.IMAGE_LOAD_FAILED,s)}),i}function ev(t,e){let n=be.getImageLoadObject(t);if(n!==void 0)return n;const r=be.getVolumeContainingImageId(t);if(r&&r.volume.loadStatus.loaded){const{volume:i,imageIdIndex:o}=r;return n=i.convertToCornerstoneImage(t,o),n}const a=be.getCachedImageBasedOnImageURI(t);return a?(n=a.imageLoadObject,n):(n=wm(t,e),n)}function Sm(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadImage: parameter imageId must not be undefined");return ev(t,e).promise}function Xi(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const n=ev(t,e);return be.getImageLoadObject(t)||be.putImageLoadObject(t,n).catch(r=>{console.warn(r)}),n.promise}const Em={viewport:{}};function xm(){return{tlhc:{x:1,y:1},brhc:{x:1,y:1},rowPixelSpacing:1,columnPixelSpacing:1,presentationSizeMode:"NONE"}}function Om(){const t=xm();return Object.assign({},{scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:t},Em.viewport)}function La(t,e){if(t==null)throw new Error(e)}function Mm(t){return!(t==null||t===0||t===180)}function tv(t,e=null){return La(t,"getImageSize: parameter image must not be undefined"),La(t.width,"getImageSize: parameter image must have width"),La(t.height,"getImageSize: parameter image must have height"),Mm(e)?{height:t.width,width:t.height}:{width:t.width,height:t.height}}function su(t,e,n=null){La(t,"getImageScale: parameter canvas must not be undefined"),La(e,"getImageScale: parameter image must not be undefined");const r=tv(e,n),a=e.rowPixelSpacing||1,i=e.columnPixelSpacing||1;let o=1,s=1;a<i?s=i/a:o=a/i;const c=t.height/r.height/o,u=t.width/r.width/s;return{verticalScale:c,horizontalScale:u,scaleFactor:Math.min(u,c)}}function nv(t,e,n,r){if(t===void 0)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(e===void 0)return Om();const a=su(t,e,0).scaleFactor;let i;return n==="PT"&&e.isPreScaled?i={windowWidth:5,windowCenter:2.5}:e.windowWidth!==void 0&&e.windowCenter!==void 0&&(i={windowWidth:Array.isArray(e.windowWidth)?e.windowWidth[0]:e.windowWidth,windowCenter:Array.isArray(e.windowCenter)?e.windowCenter[0]:e.windowCenter}),{scale:a,translation:{x:0,y:0},voi:i,invert:e.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:e.modalityLUT,modality:n,voiLUT:e.voiLUT,colormap:r!==void 0?r:e.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:e.rowPixelSpacing===void 0?1:e.rowPixelSpacing,columnPixelSpacing:e.columnPixelSpacing===void 0?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}}}class Ro{constructor(){this.reset()}getMatrix(){return this.m}reset(){this.m=[1,0,0,1,0,0]}clone(){const e=new Ro;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}multiply(e){const n=this.m[0]*e[0]+this.m[2]*e[1],r=this.m[1]*e[0]+this.m[3]*e[1],a=this.m[0]*e[2]+this.m[2]*e[3],i=this.m[1]*e[2]+this.m[3]*e[3],o=this.m[0]*e[4]+this.m[2]*e[5]+this.m[4],s=this.m[1]*e[4]+this.m[3]*e[5]+this.m[5];this.m[0]=n,this.m[1]=r,this.m[2]=a,this.m[3]=i,this.m[4]=o,this.m[5]=s}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),n=this.m[3]*e,r=-this.m[1]*e,a=-this.m[2]*e,i=this.m[0]*e,o=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=n,this.m[1]=r,this.m[2]=a,this.m[3]=i,this.m[4]=o,this.m[5]=s}rotate(e){const n=Math.cos(e),r=Math.sin(e),a=this.m[0]*n+this.m[2]*r,i=this.m[1]*n+this.m[3]*r,o=this.m[0]*-r+this.m[2]*n,s=this.m[1]*-r+this.m[3]*n;this.m[0]=a,this.m[1]=i,this.m[2]=o,this.m[3]=s}translate(e,n){this.m[4]+=this.m[0]*e+this.m[2]*n,this.m[5]+=this.m[1]*e+this.m[3]*n}scale(e,n){this.m[0]*=e,this.m[1]*=e,this.m[2]*=n,this.m[3]*=n}transformPoint(e){const n=e[0],r=e[1];return[n*this.m[0]+r*this.m[2]+this.m[4],n*this.m[1]+r*this.m[3]+this.m[5]]}}function Aa(t,e){const n=new Ro;if(!t.viewport.displayedArea)return n;n.translate(t.canvas.width/2,t.canvas.height/2);const r=t.viewport.rotation;r!==0&&n.rotate(r*Math.PI/180);let a=t.viewport.scale,i=t.viewport.scale;const o=t.viewport.displayedArea.brhc.x-(t.viewport.displayedArea.tlhc.x-1),s=t.viewport.displayedArea.brhc.y-(t.viewport.displayedArea.tlhc.y-1);if(t.viewport.displayedArea.presentationSizeMode==="NONE")t.image.rowPixelSpacing<t.image.columnPixelSpacing?a*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(i*=t.image.rowPixelSpacing/t.image.columnPixelSpacing);else if(a=t.viewport.displayedArea.columnPixelSpacing,i=t.viewport.displayedArea.rowPixelSpacing,t.viewport.displayedArea.presentationSizeMode==="SCALE TO FIT"){const c=t.canvas.height/(s*i),u=t.canvas.width/(o*a);a=i=Math.min(u,c),t.viewport.displayedArea.rowPixelSpacing<t.viewport.displayedArea.columnPixelSpacing?a*=t.viewport.displayedArea.columnPixelSpacing/t.viewport.displayedArea.rowPixelSpacing:t.viewport.displayedArea.columnPixelSpacing<t.viewport.displayedArea.rowPixelSpacing&&(i*=t.viewport.displayedArea.rowPixelSpacing/t.viewport.displayedArea.columnPixelSpacing)}return n.scale(a,i),r!==0&&n.rotate(-r*Math.PI/180),n.translate(t.viewport.translation.x,t.viewport.translation.y),r!==0&&n.rotate(r*Math.PI/180),e!==void 0&&n.scale(e,e),t.viewport.hflip&&n.scale(-1,1),t.viewport.vflip&&n.scale(1,-1),n.translate(-o/2,-s/2),n}function fe(){return window.performance?performance.now():Date.now()}function Rm(t,e){return function(n){return((n-e)/t+.5)*255}}function Dm(t){const n=Math.max(...t.lut).toString(2).length-8,r=t.lut[0]>>n,a=t.lut[t.lut.length-1]>>n,i=t.firstValueMapped+t.lut.length-1;return function(o){return o<t.firstValueMapped?r:o>=i?a:t.lut[o-t.firstValueMapped]>>n}}function rv(t,e,n){return n?Dm(n):Rm(t,e)}function Vm(t,e,n,r,a){const i=t.maxPixelValue,o=t.minPixelValue,s=Math.min(o,0);if(t.cachedLut===void 0){const g=i-s+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(g)}const c=t.cachedLut.lutArray,u=rv(Array.isArray(e)?e[0]:e,Array.isArray(n)?n[0]:n,a);if(r===!0)for(let g=o;g<=i;g++)c[g+-s]=255-u(g);else for(let g=o;g<=i;g++)c[g+-s]=u(g);return c}function Lm(t,e,n){let r=fe();const a=t.getPixelData();t.stats.lastGetPixelDataTime=fe()-r;const i=t.minPixelValue;let o=0,s=0;const c=a.length;if(r=fe(),i<0)for(;s<c;)n[o++]=e[a[s++]+-i],n[o++]=e[a[s++]+-i],n[o]=e[a[s]+-i],s+=2,o+=2;else for(;s<c;)n[o++]=e[a[s++]],n[o++]=e[a[s++]],n[o]=e[a[s]],s+=2,o+=2;t.stats.lastStoredPixelDataToCanvasImageDataTime=fe()-r}function Nm(t,e,n){let r=fe();const a=t.getPixelData();t.stats.lastGetPixelDataTime=fe()-r;const i=t.minPixelValue;let o=0,s=0;const c=a.length;if(r=fe(),i<0)for(;s<c;)n[o++]=e[a[s++]+-i],n[o++]=e[a[s++]+-i],n[o++]=e[a[s++]+-i],n[o++]=a[s++];else for(;s<c;)n[o++]=e[a[s++]],n[o++]=e[a[s++]],n[o++]=e[a[s++]],n[o++]=a[s++];t.stats.lastStoredPixelDataToCanvasImageDataTime=fe()-r}function cu(t,e,n){if(t===void 0)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(e===void 0)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");const a=Aa(t,n).getMatrix();e.setTransform(a[0],a[1],a[2],a[3],a[4],a[5])}function uu(t,e){const n=t.renderingTools.lastRenderedImageId,r=t.renderingTools.lastRenderedViewport;return e.imageId!==n||!r||r.windowCenter!==t.viewport.voi.windowCenter||r.windowWidth!==t.viewport.voi.windowWidth||r.invert!==t.viewport.invert||r.rotation!==t.viewport.rotation||r.hflip!==t.viewport.hflip||r.vflip!==t.viewport.vflip||r.modalityLUT!==t.viewport.modalityLUT||r.voiLUT!==t.viewport.voiLUT||r.colormap!==t.viewport.colormap}function Yi(t,e){const n=t.renderingTools.renderCanvas;n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.fillStyle="white",r.fillRect(0,0,n.width,n.height);const a=r.getImageData(0,0,e.width,e.height);t.renderingTools.renderCanvasContext=r,t.renderingTools.renderCanvasData=a}function fu(t){const e=t.image.imageId,n=t.viewport,r=t.image.color;return t.renderingTools.lastRenderedImageId=e,t.renderingTools.lastRenderedIsColor=r,t.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},t.renderingTools}function Fm(t,e){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&t.cachedLut.invert===e.invert||(Vm(t,e.voi.windowWidth,e.voi.windowCenter,e.invert),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert),t.cachedLut.lutArray}function _m(t,e,n){const r=t.renderingTools.lastRenderedIsColor===!0;(!t.renderingTools.renderCanvas||!r)&&(t.renderingTools.renderCanvas=document.createElement("canvas"));const a=t.renderingTools.renderCanvas;if(t.viewport.voi.windowWidth===255&&t.viewport.voi.windowCenter===128&&t.viewport.invert===!1&&e.getCanvas&&e.getCanvas())return e.getCanvas();if(uu(t,e)===!1&&n!==!0)return a;(a.width!==e.width||a.height!==e.height)&&Yi(t,e);let i=fe();const o=Fm(e,t.viewport);e.stats=e.stats||{},e.stats.lastLutGenerateTime=fe()-i;const s=t.renderingTools.renderCanvasData,c=t.renderingTools.renderCanvasContext;return e.rgba?Nm(e,o,s.data):Lm(e,o,s.data),i=fe(),c.putImageData(s,0,0),e.stats.lastPutImageDataTime=fe()-i,a}function bm(t,e){if(t===void 0)throw new Error("renderColorImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("renderColorImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,cu(t,r);const a=_m(t,n,e),i=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-i,c=t.viewport.displayedArea.brhc.y-o;r.drawImage(a,i,o,s,c,0,0,s,c),t.renderingTools=fu(t)}function km(t,e,n){let r=fe();const a=t.getPixelData();t.stats.lastGetPixelDataTime=fe()-r;const i=a.length,o=t.minPixelValue;let s=3,c=0;if(r=fe(),a instanceof Int16Array)if(o<0)for(;c<i;)n[s]=e[a[c++]+-o],s+=4;else for(;c<i;)n[s]=e[a[c++]],s+=4;else if(a instanceof Uint16Array)for(;c<i;)n[s]=e[a[c++]],s+=4;else if(o<0)for(;c<i;)n[s]=e[a[c++]+-o],s+=4;else for(;c<i;)n[s]=e[a[c++]],s+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=fe()-r}function Um(t,e,n){let r=fe();const a=t.getPixelData();t.stats.lastGetPixelDataTime=fe()-r;const i=a.length;let o=3,s=0;for(r=fe();s<i;)n[o]=e(a[s++]),o+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=fe()-r}function Bm(t,e,n){let r=fe();const a=t.getPixelData();t.stats.lastGetPixelDataTime=fe()-r;const i=a.length,o=t.minPixelValue;let s=0,c=0,u;if(r=fe(),a instanceof Int16Array)if(o<0)for(;c<i;)u=e[a[c++]+-o],n[s++]=u,n[s++]=u,n[s++]=u,n[s++]=255;else for(;c<i;)u=e[a[c++]],n[s++]=u,n[s++]=u,n[s++]=u,n[s++]=255;else if(a instanceof Uint16Array)for(;c<i;)u=e[a[c++]],n[s++]=u,n[s++]=u,n[s++]=u,n[s++]=255;else if(o<0)for(;c<i;)u=e[a[c++]+-o],n[s++]=u,n[s++]=u,n[s++]=u,n[s++]=255;else for(;c<i;)u=e[a[c++]],n[s++]=u,n[s++]=u,n[s++]=u,n[s++]=255;t.stats.lastStoredPixelDataToCanvasImageDataTime=fe()-r}function Gm(t,e){if(Am(t))return;const n=e.maxPixelValue*e.slope+e.intercept,r=e.minPixelValue*e.slope+e.intercept,a=n-r,i=(n+r)/2;t.voi===void 0?t.voi={windowWidth:a,windowCenter:i}:(t.voi.windowWidth=a,t.voi.windowCenter=i)}function Am(t){return t.voiLUT&&t.voiLUT.lut&&t.voiLUT.lut.length>0||t.voi.windowWidth!==void 0&&t.voi.windowCenter!==void 0}function _f(t,e){return!t&&!e?!0:!t||!e?!1:t.id===e.id}function Im(t,e){return n=>n*t+e}function Pm(t){const e=t.lut[0],n=t.lut[t.lut.length-1],r=t.firstValueMapped+t.lut.length;return a=>a<t.firstValueMapped?e:a>=r?n:t.lut[a]}function Wm(t,e,n){return n?Pm(n):Im(t,e)}function zm(t,e,n,r,a,i){const o=t.maxPixelValue,s=t.minPixelValue,c=Math.min(s,0);if(t.cachedLut===void 0){const l=o-c+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(l)}const u=t.cachedLut.lutArray,g=Wm(t.slope,t.intercept,a),f=rv(e,n,i);if(t.isPreScaled)if(r===!0)for(let l=s;l<=o;l++)u[l+-c]=255-f(l);else for(let l=s;l<=o;l++)u[l+-c]=f(l);else if(r===!0)for(let l=s;l<=o;l++)u[l+-c]=255-f(g(l));else for(let l=s;l<=o;l++)u[l+-c]=f(g(l));return u}function av(t,e,n){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&_f(t.cachedLut.modalityLUT,e.modalityLUT)&&_f(t.cachedLut.voiLUT,e.voiLUT)&&t.cachedLut.invert===e.invert&&n!==!0||(Gm(e,t),zm(t,e.voi.windowWidth,e.voi.windowCenter,e.invert,e.modalityLUT,e.voiLUT),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert,t.cachedLut.voiLUT=e.voiLUT,t.cachedLut.modalityLUT=e.modalityLUT),t.cachedLut.lutArray}function $m(t,e,n,r=!0){const a=t.renderingTools.lastRenderedIsColor===!0;(!t.renderingTools.renderCanvas||a)&&(t.renderingTools.renderCanvas=document.createElement("canvas"),Yi(t,e));const i=t.renderingTools.renderCanvas;if(uu(t,e)===!1&&n!==!0)return i;(i.width!==e.width||i.height!==e.height)&&Yi(t,e),e.stats=e.stats||{};const o=t.renderingTools.renderCanvasData,s=t.renderingTools.renderCanvasContext;let c=fe();e.stats.lastLutGenerateTime=fe()-c;const{viewport:u}=t;if(u.modality==="PT"&&e.isPreScaled){const{windowWidth:g,windowCenter:f}=u.voi,l=f-g/2,p=f+g/2-l,d=255/p;let h;u.invert?h=T=>255-(T-l)*d:h=T=>(T-l)*d,Um(e,h,o.data)}else{const g=av(e,u,n);r?km(e,g,o.data):Bm(e,g,o.data)}return c=fe(),s.putImageData(o,0,0),e.stats.lastPutImageDataTime=fe()-c,i}function jm(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,cu(t,r);const a=$m(t,n,e),i=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-i,c=t.viewport.displayedArea.brhc.y-o;r.drawImage(a,i,o,s,c,0,0,s,c),t.renderingTools=fu(t)}const vc=0,pc=1,Hm=2;function Km(t,e,n){if(t>1)throw new Error("HSVToRGB expects hue < 1");const r=[];if(e===0)return r[0]=n,r[1]=n,r[2]=n,r;const a=Math.floor(t*6),i=6*t-a,o=n*(1-e),s=n*(1-e*i),c=n*(1-e*(1-i));switch(a){case 0:case 6:r[0]=n,r[1]=c,r[2]=o;break;case 1:r[0]=s,r[1]=n,r[2]=o;break;case 2:r[0]=o,r[1]=n,r[2]=c;break;case 3:r[0]=o,r[1]=s,r[2]=n;break;case 4:r[0]=c,r[1]=o,r[2]=n;break;case 5:r[0]=n,r[1]=o,r[2]=s;break}return r}function qm(t,e){let n;return t<e.Range[0]?n=e.MaxIndex+vc+1.5:t>e.Range[1]?n=e.MaxIndex+pc+1.5:n=(t+e.Shift)*e.Scale,Math.floor(n)}class Xm{constructor(){this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}setNumberOfTableValues(e){this.NumberOfColors=e}setRamp(e){this.Ramp=e}setTableRange(e,n){this.TableRange[0]=e,this.TableRange[1]=n}setHueRange(e,n){this.HueRange[0]=e,this.HueRange[1]=n}setSaturationRange(e,n){this.SaturationRange[0]=e,this.SaturationRange[1]=n}setValueRange(e,n){this.ValueRange[0]=e,this.ValueRange[1]=n}setRange(e,n){this.InputRange[0]=e,this.InputRange[1]=n}setAlphaRange(e,n){this.AlphaRange[0]=e,this.AlphaRange[1]=n}getColor(e){return this.mapValue(e)}build(e){if(this.Table.length>1&&!e)return;this.Table=[];const n=this.NumberOfColors-1;let r,a,i,o;n?(r=(this.HueRange[1]-this.HueRange[0])/n,a=(this.SaturationRange[1]-this.SaturationRange[0])/n,i=(this.ValueRange[1]-this.ValueRange[0])/n,o=(this.AlphaRange[1]-this.AlphaRange[0])/n):r=a=i=o=0;for(let s=0;s<=n;s++){const c=this.HueRange[0]+s*r,u=this.SaturationRange[0]+s*a,g=this.ValueRange[0]+s*i,f=this.AlphaRange[0]+s*o,l=Km(c,u,g),v=[0,0,0,0];switch(this.Ramp){case"scurve":v[0]=Math.floor(127.5*(1+Math.cos((1-l[0])*Math.PI))),v[1]=Math.floor(127.5*(1+Math.cos((1-l[1])*Math.PI))),v[2]=Math.floor(127.5*(1+Math.cos((1-l[2])*Math.PI))),v[3]=Math.floor(f*255);break;case"linear":v[0]=Math.floor(l[0]*255+.5),v[1]=Math.floor(l[1]*255+.5),v[2]=Math.floor(l[2]*255+.5),v[3]=Math.floor(f*255+.5);break;case"sqrt":v[0]=Math.floor(Math.sqrt(l[0])*255+.5),v[1]=Math.floor(Math.sqrt(l[1])*255+.5),v[2]=Math.floor(Math.sqrt(l[2])*255+.5),v[3]=Math.floor(Math.sqrt(f)*255+.5);break;default:throw new Error(`Invalid Ramp value (${this.Ramp})`)}this.Table.push(v)}this.buildSpecialColors()}buildSpecialColors(){const e=this.NumberOfColors,n=e+vc,r=e+pc,a=e+Hm;this.UseBelowRangeColor||e===0?this.Table[n]=this.BelowRangeColor:this.Table[n]=this.Table[0],this.UseAboveRangeColor||e===0?this.Table[r]=this.AboveRangeColor:this.Table[r]=this.Table[e-1],this.Table[a]=this.NaNColor}mapValue(e){const n=this.getIndex(e);if(n<0)return this.NaNColor;if(n===0){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(n===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[n]}getIndex(e){const n={Range:[],MaxIndex:this.NumberOfColors-1,Shift:-this.TableRange[0],Scale:1};if(this.TableRange[1]<=this.TableRange[0]?n.Scale=Number.MAX_VALUE:n.Scale=n.MaxIndex/(this.TableRange[1]-this.TableRange[0]),n.Range[0]=this.TableRange[0],n.Range[1]=this.TableRange[1],isNaN(e))return-1;let r=qm(e,n);return r===this.NumberOfColors+vc?r=0:r===this.NumberOfColors+pc&&(r=this.NumberOfColors-1),r}setTableValue(e,n){if(arguments.length===5&&(n=Array.prototype.slice.call(arguments,1)),e<0)throw new Error(`Can't set the table value for negative index (${e})`);e>=this.NumberOfColors&&new Error(`Index ${e} is greater than the number of colors ${this.NumberOfColors}`),this.Table[e]=n,(e===0||e===this.NumberOfColors-1)&&this.buildSpecialColors()}}const gu=Xm,bf=[0,0,0,0];function Ym(t,e,n){n=n===null?100:n;const r=(e-t)/(n-1),a=[];for(;n-- >0;)a.push(t),t+=r;return a[a.length-1]=e,a}function Zm(t,e){let n=0,r=t.length-1;for(;n<=r;){const a=n+Math.floor((r-n)/2),i=t[a];if(i===e)return a;e<i?r=a-1:n=a+1}return n}function Jm(t,e){let n;const r=[],a=e.length;for(t.sort(function(i,o){return i-o}),n=0;n<a;n++)r[n]=Zm(t,e[n]);return r}function gs(t,e,n){let r;const a=[],i=[],o=[],s=[];for(n=n===null?1:n,r=0;r<e.length;r++){const g=e[r];a.push((t-1)*g[0]),i.push(g[1]),o.push(g[1])}const c=Ym(0,1,t);for(r=0;r<t;r++)c[r]=(t-1)*Math.pow(c[r],n);const u=Jm(a,c);for(r=1;r<t-1;r++){const g=u[r],f=(c[r]-a[g-1])/(a[g]-a[g-1]),l=i[g]-o[g-1];s[r]=f*l+o[g-1]}return s[0]=o[0],s[t-1]=i[e.length-1],s}function Qm(t,e,n){let r;const a=[];e=e===null?256:e,n=n===null?1:n;const i=gs(e,t.red,n),o=gs(e,t.green,n),s=gs(e,t.blue,n);for(r=0;r<e;r++){const c=Math.round(i[r]*255),u=Math.round(o[r]*255),g=Math.round(s[r]*255),f=[c,u,g,255];a.push(f)}return a}function iv(t,e){let n=Of[t];return n||(n=Of[t]=e||{name:"",colors:[]}),!n.colors&&n.segmentedData&&(n.colors=Qm(n.segmentedData,n.numColors,n.gamma)),{getId(){return t},getColorSchemeName(){return n.name},setColorSchemeName(a){n.name=a},getNumberOfColors(){return n.colors.length},setNumberOfColors(a){for(;n.colors.length<a;)n.colors.push(bf);n.colors.length=a},getColor(a){return this.isValidIndex(a)?n.colors[a]:bf},getColorRepeating(a){const i=n.colors.length;return a=i?a%i:0,this.getColor(a)},setColor(a,i){this.isValidIndex(a)&&(n.colors[a]=i)},addColor(a){n.colors.push(a)},insertColor(a,i){this.isValidIndex(a)&&n.colors.splice(a,1,i)},removeColor(a){this.isValidIndex(a)&&n.colors.splice(a,1)},clearColors(){n.colors=[]},buildLookupTable(a){if(!a)return;const i=n.colors.length;a.setNumberOfTableValues(i);for(let o=0;o<i;o++)a.setTableValue(o,n.colors[o])},createLookupTable(){const a=new gu;return this.buildLookupTable(a),a},isValidIndex(a){return a>=0&&a<n.colors.length}}}function eC(t,e,n,r){let a=fe();const i=t.getPixelData();t.stats.lastGetPixelDataTime=fe()-a;const o=i.length,s=t.minPixelValue;let c=0,u=0,g,f,l;if(a=fe(),n instanceof gu?l=n.Table:l=n,s<0)for(;u<o;)g=e[i[u++]+-s],f=l[g],r[c++]=f[0],r[c++]=f[1],r[c++]=f[2],r[c++]=f[3];else for(;u<o;)g=e[i[u++]],f=l[g],r[c++]=f[0],r[c++]=f[1],r[c++]=f[2],r[c++]=f[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=fe()-a}function tC(t,e,n,r){let a=fe();const i=t.getPixelData();t.stats.lastGetPixelDataTime=fe()-a;const o=i.length,s=t.minPixelValue;let c=0,u=0,g,f,l;if(a=fe(),n instanceof gu?l=n.Table:l=n,s<0)for(;u<o;)g=e(i[u++]+-s),f=l[g],r[c++]=f[0],r[c++]=f[1],r[c++]=f[2],r[c++]=f[3];else for(;u<o;)g=e(i[u++]),f=l[g],r[c++]=f[0],r[c++]=f[1],r[c++]=f[2],r[c++]=f[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=fe()-a}function kf(t,e,n){return Math.max(e,Math.min(n,t))}function nC(t,e,n){t.renderingTools.renderCanvas||(t.renderingTools.renderCanvas=document.createElement("canvas"));const r=t.renderingTools.renderCanvas;let a=t.viewport.colormap||t.options.colormap;if(t.options&&t.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),a&&typeof a=="string"&&(a=iv(a)),!a)throw new Error("renderPseudoColorImage: colormap not found.");const i=a.getId();if(uu(t,e)===!1&&n!==!0&&t.renderingTools.colormapId===i)return r;(r.width!==e.width||r.height!==e.height)&&Yi(t,e);let o=fe();(!t.renderingTools.colorLUT||n||t.renderingTools.colormapId!==i)&&(a.setNumberOfColors(256),t.renderingTools.colorLUT=a.createLookupTable(),t.renderingTools.colormapId=i);const s=t.renderingTools.renderCanvasData,c=t.renderingTools.renderCanvasContext,{viewport:u}=t,g=t.renderingTools.colorLUT;if(u.modality==="PT"){const{windowWidth:f,windowCenter:l}=u.voi,v=l-f/2,d=l+f/2-v,h=255/d;let T;u.invert?T=C=>kf(Math.floor(255-(C-v)*h),0,255):T=C=>kf(Math.floor((C-v)*h),0,255),tC(e,T,g,s.data)}else{const f=av(e,t.viewport,n);e.stats=e.stats||{},e.stats.lastLutGenerateTime=fe()-o,eC(e,f,g,s.data)}return o=fe(),c.putImageData(s,0,0),e.stats.lastPutImageDataTime=fe()-o,r}function rC(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,cu(t,r);const a=nC(t,n,e),i=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-i,c=t.viewport.displayedArea.brhc.y-o;r.drawImage(a,i,o,s,c,0,0,s,c),t.renderingTools=fu(t)}function ov(t,e){const n=t.image;if(!t.canvas||!t.image)return;const r=fe();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},n){let i=n.render;i||(t.viewport.colormap?i=rC:n.color?i=bm:i=jm),i(t,e)}const a=fe()-r;n.stats.lastRenderTime=a,t.invalid=!1,t.needsRedraw=!1}function sv(t,e,n){const r=nv(t,e,n),a={canvas:t,viewport:r,image:e,renderingTools:{}};a.transform=Aa(a),ov(a,!0)}function aC(t,e,n=qt.Thumbnail,r=-5){return new Promise((a,i)=>{function o(g,f){var v;const{modality:l}=He("generalSeriesModule",f)||{};g.isPreScaled=g.isPreScaled||((v=g.preScale)==null?void 0:v.scaled),sv(t,g,l),a(f)}function s(g,f){console.error(g,f),i(g)}function c(g,f,l){return Xi(g,l).then(v=>{o.call(this,v,g)},v=>{s.call(this,v,g)})}const u={targetBuffer:{type:"Float32Array",offset:null,length:null},preScale:{enabled:!0},requestType:n};Ga.addRequest(c.bind(null,e,null,u),n,{imageId:e},r)})}function iC(t,e){const n=He("imagePlaneModule",t);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:r,columnPixelSpacing:a,rowCosines:i,rowPixelSpacing:o,imagePositionPatient:s,rows:c,columns:u}=n,g=Ue();Lt(g,s,r,-a/2),Lt(g,g,i,-o/2);const f=Ue();na(f,e,g);const l=ut(f,i),v=ut(f,r),p=[l/o,v/a];if(p[0]<0||p[0]>=u||p[1]<0||p[1]>=c)throw new Error(`The image coordinates are outside of the image, imageCoords: ${p}`);return p}function oC(t,e){const n=He("imagePlaneModule",t);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:r,columnPixelSpacing:a,rowCosines:i,rowPixelSpacing:o,imagePositionPatient:s}=n,c=Ue();return Lt(c,s,i,o*(e[0]-.5)),Lt(c,c,r,a*(e[1]-.5)),Array.from(c)}function hc(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function sC(t){if(Array.isArray(t))return hc(t)}function cC(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function cv(t,e){if(!!t){if(typeof t=="string")return hc(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return hc(t,e)}}function uC(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ne(t){return sC(t)||cC(t)||cv(t)||uC()}function Do(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Uf(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Vo(t,e,n){return e&&Uf(t.prototype,e),n&&Uf(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function fC(t){if(Array.isArray(t))return t}function gC(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],a=!0,i=!1,o,s;try{for(n=n.call(t);!(a=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));a=!0);}catch(c){i=!0,s=c}finally{try{!a&&n.return!=null&&n.return()}finally{if(i)throw s}}return r}}function lC(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dt(t,e){return fC(t)||gC(t,e)||cv(t,e)||lC()}var qe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function uv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function vC(t){var e=t.default;if(typeof e=="function"){var n=function(){return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}),n}var fv={exports:{}};(function(t){(function(e,n,r){function a(c){var u=this,g=s();u.next=function(){var f=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=f-(u.c=f|0)},u.c=1,u.s0=g(" "),u.s1=g(" "),u.s2=g(" "),u.s0-=g(c),u.s0<0&&(u.s0+=1),u.s1-=g(c),u.s1<0&&(u.s1+=1),u.s2-=g(c),u.s2<0&&(u.s2+=1),g=null}function i(c,u){return u.c=c.c,u.s0=c.s0,u.s1=c.s1,u.s2=c.s2,u}function o(c,u){var g=new a(c),f=u&&u.state,l=g.next;return l.int32=function(){return g.next()*4294967296|0},l.double=function(){return l()+(l()*2097152|0)*11102230246251565e-32},l.quick=l,f&&(typeof f=="object"&&i(f,g),l.state=function(){return i(g,{})}),l}function s(){var c=4022871197,u=function(g){g=String(g);for(var f=0;f<g.length;f++){c+=g.charCodeAt(f);var l=.02519603282416938*c;c=l>>>0,l-=c,l*=c,c=l>>>0,l-=c,c+=l*4294967296}return(c>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(qe,t,!1)})(fv);var gv={exports:{}};(function(t){(function(e,n,r){function a(s){var c=this,u="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var f=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^f^f>>>8},s===(s|0)?c.x=s:u+=s;for(var g=0;g<u.length+64;g++)c.x^=u.charCodeAt(g)|0,c.next()}function i(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c}function o(s,c){var u=new a(s),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,v=(u.next()>>>0)/4294967296,p=(l+v)/(1<<21);while(p===0);return p},f.int32=u.next,f.quick=f,g&&(typeof g=="object"&&i(g,u),f.state=function(){return i(u,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(qe,t,!1)})(gv);var lv={exports:{}};(function(t){(function(e,n,r){function a(s){var c=this,u="";c.next=function(){var f=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(f^f<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,s===(s|0)?c.x=s:u+=s;for(var g=0;g<u.length+64;g++)c.x^=u.charCodeAt(g)|0,g==u.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function i(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c.v=s.v,c.d=s.d,c}function o(s,c){var u=new a(s),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,v=(u.next()>>>0)/4294967296,p=(l+v)/(1<<21);while(p===0);return p},f.int32=u.next,f.quick=f,g&&(typeof g=="object"&&i(g,u),f.state=function(){return i(u,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(qe,t,!1)})(lv);var vv={exports:{}};(function(t){(function(e,n,r){function a(s){var c=this;c.next=function(){var g=c.x,f=c.i,l,v;return l=g[f],l^=l>>>7,v=l^l<<24,l=g[f+1&7],v^=l^l>>>10,l=g[f+3&7],v^=l^l>>>3,l=g[f+4&7],v^=l^l<<7,l=g[f+7&7],l=l^l<<13,v^=l^l<<9,g[f]=v,c.i=f+1&7,v};function u(g,f){var l,v=[];if(f===(f|0))v[0]=f;else for(f=""+f,l=0;l<f.length;++l)v[l&7]=v[l&7]<<15^f.charCodeAt(l)+v[l+1&7]<<13;for(;v.length<8;)v.push(0);for(l=0;l<8&&v[l]===0;++l);for(l==8?v[7]=-1:v[l],g.x=v,g.i=0,l=256;l>0;--l)g.next()}u(c,s)}function i(s,c){return c.x=s.x.slice(),c.i=s.i,c}function o(s,c){s==null&&(s=+new Date);var u=new a(s),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,v=(u.next()>>>0)/4294967296,p=(l+v)/(1<<21);while(p===0);return p},f.int32=u.next,f.quick=f,g&&(g.x&&i(g,u),f.state=function(){return i(u,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(qe,t,!1)})(vv);var pv={exports:{}};(function(t){(function(e,n,r){function a(s){var c=this;c.next=function(){var g=c.w,f=c.X,l=c.i,v,p;return c.w=g=g+1640531527|0,p=f[l+34&127],v=f[l=l+1&127],p^=p<<13,v^=v<<17,p^=p>>>15,v^=v>>>12,p=f[l]=p^v,c.i=l,p+(g^g>>>16)|0};function u(g,f){var l,v,p,d,h,T=[],C=128;for(f===(f|0)?(v=f,f=null):(f=f+"\0",v=0,C=Math.max(C,f.length)),p=0,d=-32;d<C;++d)f&&(v^=f.charCodeAt((d+32)%f.length)),d===0&&(h=v),v^=v<<10,v^=v>>>15,v^=v<<4,v^=v>>>13,d>=0&&(h=h+1640531527|0,l=T[d&127]^=v+h,p=l==0?p+1:0);for(p>=128&&(T[(f&&f.length||0)&127]=-1),p=127,d=4*128;d>0;--d)v=T[p+34&127],l=T[p=p+1&127],v^=v<<13,l^=l<<17,v^=v>>>15,l^=l>>>12,T[p]=v^l;g.w=h,g.X=T,g.i=p}u(c,s)}function i(s,c){return c.i=s.i,c.w=s.w,c.X=s.X.slice(),c}function o(s,c){s==null&&(s=+new Date);var u=new a(s),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,v=(u.next()>>>0)/4294967296,p=(l+v)/(1<<21);while(p===0);return p},f.int32=u.next,f.quick=f,g&&(g.X&&i(g,u),f.state=function(){return i(u,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(qe,t,!1)})(pv);var hv={exports:{}};(function(t){(function(e,n,r){function a(s){var c=this,u="";c.next=function(){var f=c.b,l=c.c,v=c.d,p=c.a;return f=f<<25^f>>>7^l,l=l-v|0,v=v<<24^v>>>8^p,p=p-f|0,c.b=f=f<<20^f>>>12^l,c.c=l=l-v|0,c.d=v<<16^l>>>16^p,c.a=p-f|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,s===Math.floor(s)?(c.a=s/4294967296|0,c.b=s|0):u+=s;for(var g=0;g<u.length+20;g++)c.b^=u.charCodeAt(g)|0,c.next()}function i(s,c){return c.a=s.a,c.b=s.b,c.c=s.c,c.d=s.d,c}function o(s,c){var u=new a(s),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,v=(u.next()>>>0)/4294967296,p=(l+v)/(1<<21);while(p===0);return p},f.int32=u.next,f.quick=f,g&&(typeof g=="object"&&i(g,u),f.state=function(){return i(u,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(qe,t,!1)})(hv);var dv={exports:{}};const pC={},hC=Object.freeze(Object.defineProperty({__proto__:null,default:pC},Symbol.toStringTag,{value:"Module"})),dC=vC(hC);(function(t){(function(e,n,r){var a=256,i=6,o=52,s="random",c=r.pow(a,i),u=r.pow(2,o),g=u*2,f=a-1,l;function v(y,w,S){var O=[];w=w==!0?{entropy:!0}:w||{};var M=T(h(w.entropy?[y,m(n)]:y==null?C():y,3),O),R=new p(O),D=function(){for(var L=R.g(i),N=c,U=0;L<u;)L=(L+U)*a,N*=a,U=R.g(1);for(;L>=g;)L/=2,N/=2,U>>>=1;return(L+U)/N};return D.int32=function(){return R.g(4)|0},D.quick=function(){return R.g(4)/4294967296},D.double=D,T(m(R.S),n),(w.pass||S||function(L,N,U,b){return b&&(b.S&&d(b,R),L.state=function(){return d(R,{})}),U?(r[s]=L,N):L})(D,M,"global"in w?w.global:this==r,w.state)}function p(y){var w,S=y.length,O=this,M=0,R=O.i=O.j=0,D=O.S=[];for(S||(y=[S++]);M<a;)D[M]=M++;for(M=0;M<a;M++)D[M]=D[R=f&R+y[M%S]+(w=D[M])],D[R]=w;(O.g=function(L){for(var N,U=0,b=O.i,G=O.j,P=O.S;L--;)N=P[b=f&b+1],U=U*a+P[f&(P[b]=P[G=f&G+N])+(P[G]=N)];return O.i=b,O.j=G,U})(a)}function d(y,w){return w.i=y.i,w.j=y.j,w.S=y.S.slice(),w}function h(y,w){var S=[],O=typeof y,M;if(w&&O=="object")for(M in y)try{S.push(h(y[M],w-1))}catch{}return S.length?S:O=="string"?y:y+"\0"}function T(y,w){for(var S=y+"",O,M=0;M<S.length;)w[f&M]=f&(O^=w[f&M]*19)+S.charCodeAt(M++);return m(w)}function C(){try{var y;return l&&(y=l.randomBytes)?y=y(a):(y=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(y)),m(y)}catch{var w=e.navigator,S=w&&w.plugins;return[+new Date,e,S,e.screen,m(n)]}}function m(y){return String.fromCharCode.apply(0,y)}if(T(r.random(),n),t.exports){t.exports=v;try{l=dC}catch{}}else r["seed"+s]=v})(typeof self<"u"?self:qe,[],Math)})(dv);var yC=fv.exports,TC=gv.exports,mC=lv.exports,CC=vv.exports,wC=pv.exports,SC=hv.exports,pr=dv.exports;pr.alea=yC;pr.xor128=TC;pr.xorwow=mC;pr.xorshift7=CC;pr.xor4096=wC;pr.tychei=SC;var EC=pr;function fr(t){return fr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fr(t)}function Te(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ia(t,e){return Ia=Object.setPrototypeOf||function(r,a){return r.__proto__=a,r},Ia(t,e)}function xC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Na(t,e,n){return xC()?Na=Reflect.construct:Na=function(a,i,o){var s=[null];s.push.apply(s,i);var c=Function.bind.apply(a,s),u=new c;return o&&Ia(u,o.prototype),u},Na.apply(null,arguments)}var Bf=Object.prototype.toString,yv=function(e){var n=Bf.call(e),r=n==="[object Arguments]";return r||(r=n!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Bf.call(e.callee)==="[object Function]"),r},ls,Gf;function OC(){if(Gf)return ls;Gf=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=yv,a=Object.prototype.propertyIsEnumerable,i=!a.call({toString:null},"toString"),o=a.call(function(){},"prototype"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(l){var v=l.constructor;return v&&v.prototype===l},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},g=function(){if(typeof window>"u")return!1;for(var l in window)try{if(!u["$"+l]&&e.call(window,l)&&window[l]!==null&&typeof window[l]=="object")try{c(window[l])}catch{return!0}}catch{return!0}return!1}(),f=function(l){if(typeof window>"u"||!g)return c(l);try{return c(l)}catch{return!1}};t=function(v){var p=v!==null&&typeof v=="object",d=n.call(v)==="[object Function]",h=r(v),T=p&&n.call(v)==="[object String]",C=[];if(!p&&!d&&!h)throw new TypeError("Object.keys called on a non-object");var m=o&&d;if(T&&v.length>0&&!e.call(v,0))for(var y=0;y<v.length;++y)C.push(String(y));if(h&&v.length>0)for(var w=0;w<v.length;++w)C.push(String(w));else for(var S in v)!(m&&S==="prototype")&&e.call(v,S)&&C.push(String(S));if(i)for(var O=f(v),M=0;M<s.length;++M)!(O&&s[M]==="constructor")&&e.call(v,s[M])&&C.push(s[M]);return C}}return ls=t,ls}var MC=Array.prototype.slice,RC=yv,Af=Object.keys,Fi=Af?function(e){return Af(e)}:OC(),If=Object.keys;Fi.shim=function(){if(Object.keys){var e=function(){var n=Object.keys(arguments);return n&&n.length===arguments.length}(1,2);e||(Object.keys=function(r){return RC(r)?If(MC.call(r)):If(r)})}else Object.keys=Fi;return Object.keys||Fi};var DC=Fi,VC=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},n=Symbol("test"),r=Object(n);if(typeof n=="string"||Object.prototype.toString.call(n)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var a=42;e[n]=a;for(n in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var i=Object.getOwnPropertySymbols(e);if(i.length!==1||i[0]!==n||!Object.prototype.propertyIsEnumerable.call(e,n))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(e,n);if(o.value!==a||o.enumerable!==!0)return!1}return!0},Pf=typeof Symbol<"u"&&Symbol,LC=VC,NC=function(){return typeof Pf!="function"||typeof Symbol!="function"||typeof Pf("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:LC()},FC="Function.prototype.bind called on incompatible ",vs=Array.prototype.slice,_C=Object.prototype.toString,bC="[object Function]",kC=function(e){var n=this;if(typeof n!="function"||_C.call(n)!==bC)throw new TypeError(FC+n);for(var r=vs.call(arguments,1),a,i=function(){if(this instanceof a){var g=n.apply(this,r.concat(vs.call(arguments)));return Object(g)===g?g:this}else return n.apply(e,r.concat(vs.call(arguments)))},o=Math.max(0,n.length-r.length),s=[],c=0;c<o;c++)s.push("$"+c);if(a=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this,arguments); }")(i),n.prototype){var u=function(){};u.prototype=n.prototype,a.prototype=new u,u.prototype=null}return a},UC=kC,Tv=Function.prototype.bind||UC,BC=Tv,GC=BC.call(Function.call,Object.prototype.hasOwnProperty),Se,Xr=SyntaxError,mv=Function,jr=TypeError,ps=function(t){try{return mv('"use strict"; return ('+t+").constructor;")()}catch{}},sr=Object.getOwnPropertyDescriptor;if(sr)try{sr({},"")}catch{sr=null}var hs=function(){throw new jr},AC=sr?function(){try{return arguments.callee,hs}catch{try{return sr(arguments,"callee").get}catch{return hs}}}():hs,Er=NC(),Nn=Object.getPrototypeOf||function(t){return t.__proto__},Gr={},IC=typeof Uint8Array>"u"?Se:Nn(Uint8Array),Hr={"%AggregateError%":typeof AggregateError>"u"?Se:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Se:ArrayBuffer,"%ArrayIteratorPrototype%":Er?Nn([][Symbol.iterator]()):Se,"%AsyncFromSyncIteratorPrototype%":Se,"%AsyncFunction%":Gr,"%AsyncGenerator%":Gr,"%AsyncGeneratorFunction%":Gr,"%AsyncIteratorPrototype%":Gr,"%Atomics%":typeof Atomics>"u"?Se:Atomics,"%BigInt%":typeof BigInt>"u"?Se:BigInt,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Se:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?Se:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Se:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Se:FinalizationRegistry,"%Function%":mv,"%GeneratorFunction%":Gr,"%Int8Array%":typeof Int8Array>"u"?Se:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Se:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Se:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Er?Nn(Nn([][Symbol.iterator]())):Se,"%JSON%":typeof JSON=="object"?JSON:Se,"%Map%":typeof Map>"u"?Se:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Er?Se:Nn(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Se:Promise,"%Proxy%":typeof Proxy>"u"?Se:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?Se:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Se:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Er?Se:Nn(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Se:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Er?Nn(""[Symbol.iterator]()):Se,"%Symbol%":Er?Symbol:Se,"%SyntaxError%":Xr,"%ThrowTypeError%":AC,"%TypedArray%":IC,"%TypeError%":jr,"%Uint8Array%":typeof Uint8Array>"u"?Se:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Se:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Se:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Se:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?Se:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Se:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Se:WeakSet},PC=function t(e){var n;if(e==="%AsyncFunction%")n=ps("async function () {}");else if(e==="%GeneratorFunction%")n=ps("function* () {}");else if(e==="%AsyncGeneratorFunction%")n=ps("async function* () {}");else if(e==="%AsyncGenerator%"){var r=t("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var a=t("%AsyncGenerator%");a&&(n=Nn(a.prototype))}return Hr[e]=n,n},Wf={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},qa=Tv,Zi=GC,WC=qa.call(Function.call,Array.prototype.concat),zC=qa.call(Function.apply,Array.prototype.splice),zf=qa.call(Function.call,String.prototype.replace),Ji=qa.call(Function.call,String.prototype.slice),$C=qa.call(Function.call,RegExp.prototype.exec),jC=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,HC=/\\(\\)?/g,KC=function(e){var n=Ji(e,0,1),r=Ji(e,-1);if(n==="%"&&r!=="%")throw new Xr("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&n!=="%")throw new Xr("invalid intrinsic syntax, expected opening `%`");var a=[];return zf(e,jC,function(i,o,s,c){a[a.length]=s?zf(c,HC,"$1"):o||i}),a},qC=function(e,n){var r=e,a;if(Zi(Wf,r)&&(a=Wf[r],r="%"+a[0]+"%"),Zi(Hr,r)){var i=Hr[r];if(i===Gr&&(i=PC(r)),typeof i>"u"&&!n)throw new jr("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:a,name:r,value:i}}throw new Xr("intrinsic "+e+" does not exist!")},XC=function(e,n){if(typeof e!="string"||e.length===0)throw new jr("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof n!="boolean")throw new jr('"allowMissing" argument must be a boolean');if($C(/^%?[^%]*%?$/,e)===null)throw new Xr("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=KC(e),a=r.length>0?r[0]:"",i=qC("%"+a+"%",n),o=i.name,s=i.value,c=!1,u=i.alias;u&&(a=u[0],zC(r,WC([0,1],u)));for(var g=1,f=!0;g<r.length;g+=1){var l=r[g],v=Ji(l,0,1),p=Ji(l,-1);if((v==='"'||v==="'"||v==="`"||p==='"'||p==="'"||p==="`")&&v!==p)throw new Xr("property names with quotes must have matching quotes");if((l==="constructor"||!f)&&(c=!0),a+="."+l,o="%"+a+"%",Zi(Hr,o))s=Hr[o];else if(s!=null){if(!(l in s)){if(!n)throw new jr("base intrinsic for "+e+" exists, but the property is not available.");return}if(sr&&g+1>=r.length){var d=sr(s,l);f=!!d,f&&"get"in d&&!("originalValue"in d.get)?s=d.get:s=s[l]}else f=Zi(s,l),s=s[l];f&&!c&&(Hr[o]=s)}}return s},YC=XC,dc=YC("%Object.defineProperty%",!0),yc=function(){if(dc)try{return dc({},"a",{value:1}),!0}catch{return!1}return!1};yc.hasArrayLengthDefineBug=function(){if(!yc())return null;try{return dc([],"length",{value:1}).length!==1}catch{return!0}};var ZC=yc,JC=DC,QC=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",ew=Object.prototype.toString,tw=Array.prototype.concat,Cv=Object.defineProperty,nw=function(t){return typeof t=="function"&&ew.call(t)==="[object Function]"},rw=ZC(),wv=Cv&&rw,aw=function(t,e,n,r){e in t&&(!nw(r)||!r())||(wv?Cv(t,e,{configurable:!0,enumerable:!1,value:n,writable:!0}):t[e]=n)},Sv=function(t,e){var n=arguments.length>2?arguments[2]:{},r=JC(e);QC&&(r=tw.call(r,Object.getOwnPropertySymbols(e)));for(var a=0;a<r.length;a+=1)aw(t,r[a],e[r[a]],n[r[a]])};Sv.supportsDescriptors=!!wv;var Ev=Sv,Fa={exports:{}};typeof self<"u"?Fa.exports=self:typeof window<"u"?Fa.exports=window:Fa.exports=Function("return this")();var iw=Fa.exports,xv=function(){return typeof qe!="object"||!qe||qe.Math!==Math||qe.Array!==Array?iw:qe},ow=Ev,sw=xv,cw=function(){var e=sw();if(ow.supportsDescriptors){var n=Object.getOwnPropertyDescriptor(e,"globalThis");(!n||n.configurable&&(n.enumerable||!n.writable||globalThis!==e))&&Object.defineProperty(e,"globalThis",{configurable:!0,enumerable:!1,value:e,writable:!0})}else(typeof globalThis!="object"||globalThis!==e)&&(e.globalThis=e);return e},uw=Ev,fw=Fa.exports,Ov=xv,gw=cw,lw=Ov(),Mv=function(){return lw};uw(Mv,{getPolyfill:Ov,implementation:fw,shim:gw});var vw=Mv;function $f(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function pw(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$f(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$f(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var At=vw(),Rv={vtkObject:function(){return null}};function Pt(t){if(t==null||t.isA)return t;if(!t.vtkClass)return At.console&&At.console.error&&At.console.error("Invalid VTK object"),null;var e=Rv[t.vtkClass];if(!e)return At.console&&At.console.error&&At.console.error("No vtk class found for Object of type ".concat(t.vtkClass)),null;var n=pw({},t);Object.keys(n).forEach(function(a){n[a]&&fr(n[a])==="object"&&n[a].vtkClass&&(n[a]=Pt(n[a]))});var r=e(n);return r&&r.modified&&r.modified(),r}function hw(t,e){Rv[t]=e}Pt.register=hw;function gr(t){return gr=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},gr(t)}function dw(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=gr(t),t!==null););return t}function _i(){return typeof Reflect<"u"&&Reflect.get?_i=Reflect.get:_i=function(e,n,r){var a=dw(e,n);if(!!a){var i=Object.getOwnPropertyDescriptor(a,n);return i.get?i.get.call(arguments.length<3?e:r):i.value}},_i.apply(this,arguments)}function yw(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ia(t,e)}function Tw(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function mw(t,e){if(e&&(fr(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Tw(t)}function Cw(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function Tc(t){var e=typeof Map=="function"?new Map:void 0;return Tc=function(r){if(r===null||!Cw(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(r))return e.get(r);e.set(r,a)}function a(){return Na(r,arguments,gr(this).constructor)}return a.prototype=Object.create(r.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),Ia(a,r)},Tc(t)}function ww(t){var e=Sw();return function(){var r=gr(t),a;if(e){var i=gr(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return mw(this,a)}}function Sw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ds=function(t){yw(n,t);var e=ww(n);function n(){return Do(this,n),e.apply(this,arguments)}return Vo(n,[{key:"push",value:function(){for(var a=this,i,o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];var u=s.filter(function(g){return!a.includes(g)});return(i=_i(gr(n.prototype),"push",this)).call.apply(i,[this].concat(Ne(u)))}}]),n}(Tc(Array));function jf(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function mc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?jf(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):jf(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Cc=0,Ew=Symbol("void");function xw(){return Cc}var Dv={};function er(){}var Ow=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];Ow.forEach(function(t){Dv[t]=er});At.console=console.hasOwnProperty("log")?console:Dv;var St={debug:er,error:At.console.error||er,info:At.console.info||er,log:At.console.log||er,warn:At.console.warn||er};function Mw(t,e){St[t]&&(St[t]=e||er)}function Rw(){St.log.apply(St,arguments)}function Dw(){St.info.apply(St,arguments)}function Wn(){St.debug.apply(St,arguments)}function re(){St.error.apply(St,arguments)}function Xa(){St.warn.apply(St,arguments)}var Hf={};function Vw(t){Hf[t]||(St.error(t),Hf[t]=!0)}var Ft=Object.create(null);Ft.Float32Array=Float32Array;Ft.Float64Array=Float64Array;Ft.Uint8Array=Uint8Array;Ft.Int8Array=Int8Array;Ft.Uint16Array=Uint16Array;Ft.Int16Array=Int16Array;Ft.Uint32Array=Uint32Array;Ft.Int32Array=Int32Array;Ft.Uint8ClampedArray=Uint8ClampedArray;function Lo(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Na(Ft[t]||Float64Array,n)}function Vv(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return(e=Ft[t]||Float64Array).from.apply(e,r)}function lu(t){return t.charAt(0).toUpperCase()+t.slice(1)}function ft(t){return lu(t[0]==="_"?t.slice(1):t)}function Lw(t){return t.charAt(0).toLowerCase()+t.slice(1)}function Nw(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3,r=["TB","GB","MB","KB"],a=Number(t),i="B";a>n;)a/=n,i=r.pop();return"".concat(a.toFixed(e)," ").concat(i)}function Fw(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ",n=[],r=t;r>1e3;)n.push("000".concat(r%1e3).slice(-3)),r=Math.floor(r/1e3);return r>0&&n.push(r),n.reverse(),n.join(e)}function Lv(t){Object.keys(t).forEach(function(e){Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function _w(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return!1}function bw(t,e){return Object.keys(t).find(function(n){return t[n]===e})}function Nv(t){return t&&t.isA?t.getState():t}function Fv(t){setTimeout(t,0)}function kw(t,e){var n=performance.now();t.finally(function(){var r=performance.now()-n;e(r)})}function Ge(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Lv(e);var n=[];Number.isInteger(e.mtime)||(e.mtime=++Cc),"classHierarchy"in e?e.classHierarchy instanceof ds||(e.classHierarchy=ds.from(e.classHierarchy)):e.classHierarchy=new ds("vtkObject");function r(i){n[i]=null}function a(i){function o(){r(i)}return Object.freeze({unsubscribe:o})}return t.isDeleted=function(){return!!e.deleted},t.modified=function(i){if(e.deleted){re("instance deleted - cannot call any method");return}i&&i<t.getMTime()||(e.mtime=++Cc,n.forEach(function(o){return o&&o(t)}))},t.onModified=function(i){if(e.deleted)return re("instance deleted - cannot call any method"),null;var o=n.length;return n.push(i),a(o)},t.getMTime=function(){return e.mtime},t.isA=function(i){for(var o=e.classHierarchy.length;o--;)if(e.classHierarchy[o]===i)return!0;return!1},t.getClassName=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-i]},t.set=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=!1;return Object.keys(i).forEach(function(u){var g=s?null:t["set".concat(lu(u))];g&&Array.isArray(i[u])&&g.length>1?c=g.apply(void 0,Ne(i[u]))||c:g?c=g(i[u])||c:(["mtime"].indexOf(u)===-1&&!o&&Xa("Warning: Set value to model directly ".concat(u,", ").concat(i[u])),c=e[u]!==i[u]||c,e[u]=i[u])}),c},t.get=function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];if(!o.length)return e;var c={};return o.forEach(function(u){c[u]=e[u]}),c},t.getReferenceByName=function(i){return e[i]},t.delete=function(){Object.keys(e).forEach(function(i){return delete e[i]}),n.forEach(function(i,o){return r(o)}),e.deleted=!0},t.getState=function(){if(e.deleted)return null;var i=mc(mc({},e),{},{vtkClass:t.getClassName()});Object.keys(i).forEach(function(s){i[s]===null||i[s]===void 0||s[0]==="_"?delete i[s]:i[s].isA?i[s]=i[s].getState():Array.isArray(i[s])&&(i[s]=i[s].map(Nv))});var o={};return Object.keys(i).sort().forEach(function(s){o[s]=i[s]}),o.mtime&&delete o.mtime,o},t.shallowCopy=function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(i.getClassName()!==t.getClassName())throw new Error("Cannot ShallowCopy ".concat(i.getClassName()," into ").concat(t.getClassName()));var s=i.get(),c=Object.keys(e).sort(),u=Object.keys(s).sort();u.forEach(function(g){var f=c.indexOf(g);f===-1?o&&Wn("add ".concat(g," in shallowCopy")):c.splice(f,1),e[g]=s[g]}),c.length&&o&&Wn("Untouched keys: ".concat(c.join(", "))),t.modified()},t.toJSON=function(){return t.getState()},t}function Et(t,e,n){n.forEach(function(r){fr(r)==="object"?t["get".concat(ft(r.name))]=function(){return e[r.name]}:t["get".concat(ft(r))]=function(){return e[r]}})}var Uw={enum:function(e,n,r){return function(a){if(typeof a=="string"){if(r.enum[a]!==void 0)return n[r.name]!==r.enum[a]?(n[r.name]=r.enum[a],e.modified(),!0):!1;throw re("Set Enum with invalid argument ".concat(r,", ").concat(a)),new RangeError("Set Enum with invalid string argument")}if(typeof a=="number"){if(n[r.name]!==a){if(Object.keys(r.enum).map(function(i){return r.enum[i]}).indexOf(a)!==-1)return n[r.name]=a,e.modified(),!0;throw re("Set Enum outside numeric range ".concat(r,", ").concat(a)),new RangeError("Set Enum outside numeric range")}return!1}throw re("Set Enum with invalid argument (String/Number) ".concat(r,", ").concat(a)),new TypeError("Set Enum with invalid argument (String/Number)")}}};function Kf(t){if(fr(t)==="object"){var e=Uw[t.type];if(e)return function(n,r){return e(n,r,t)};throw re("No setter for field ".concat(t)),new TypeError("No setter for field")}return function(r,a){return function(o){return a.deleted?(re("instance deleted - cannot call any method"),!1):a[t]!==o?(a[t]=o,r.modified(),!0):!1}}}function No(t,e,n){n.forEach(function(r){fr(r)==="object"?t["set".concat(ft(r.name))]=Kf(r)(t,e):t["set".concat(ft(r))]=Kf(r)(t,e)})}function at(t,e,n){Et(t,e,n),No(t,e,n)}function Ya(t,e,n){n.forEach(function(r){t["get".concat(ft(r))]=function(){return e[r]?[].concat(e[r]):e[r]},t["get".concat(ft(r),"ByReference")]=function(){return e[r]}})}function _v(t,e,n,r){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;n.forEach(function(i){if(e[i]&&r&&e[i].length!==r)throw new RangeError("Invalid initial number of values for array (".concat(i,")"));t["set".concat(ft(i))]=function(){if(e.deleted)return re("instance deleted - cannot call any method"),!1;for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];var u=s,g,f=!1;if(u.length===1&&(u[0]==null||u[0].length>=0)&&(u=u[0],f=!0),u==null)g=e[i]!==u;else{if(r&&u.length!==r)if(u.length<r&&a!==void 0)for(u=Array.from(u),f=!1;u.length<r;)u.push(a);else throw new RangeError("Invalid number of values for array setter (".concat(i,")"));g=e[i]==null||e[i].some(function(l,v){return l!==u[v]})||e[i].length!==u.length,g&&f&&(u=Array.from(u))}return g&&(e[i]=u,t.modified()),g},t["set".concat(ft(i),"From")]=function(o){var s=e[i];o.forEach(function(c,u){s[u]=c})}})}function bv(t,e,n,r){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;Ya(t,e,n),_v(t,e,n,r,a)}function vu(t,e,n){for(var r=0;r<n.length;r++){var a=n[r];e[a]!==void 0&&(e["_".concat(a)]=e[a],delete e[a])}}function Bw(t,e,n,r){e.inputData?e.inputData=e.inputData.map(Pt):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(Pt):e.inputConnection=[],e.output?e.output=e.output.map(Pt):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(Pt):e.inputArrayToProcess=[],e.numberOfInputs=n;function a(p){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){re("instance deleted - cannot call any method");return}if(d>=e.numberOfInputs){re("algorithm ".concat(t.getClassName()," only has ").concat(e.numberOfInputs," input ports. To add more input ports, use addInputData()"));return}(e.inputData[d]!==p||e.inputConnection[d])&&(e.inputData[d]=p,e.inputConnection[d]=null,t.modified&&t.modified())}function i(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[p]&&(e.inputData[p]=e.inputConnection[p]()),e.inputData[p]}function o(p){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){re("instance deleted - cannot call any method");return}if(d>=e.numberOfInputs){var h="algorithm ".concat(t.getClassName()," only has ");h+="".concat(e.numberOfInputs),h+=" input ports. To add more input ports, use addInputConnection()",re(h);return}e.inputData[d]=null,e.inputConnection[d]=p}function s(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[p]}function c(){for(var p=e.numberOfInputs;p&&!e.inputData[p-1]&&!e.inputConnection[p-1];)p--;return p===e.numberOfInputs&&e.numberOfInputs++,p}function u(p){if(e.deleted){re("instance deleted - cannot call any method");return}o(p,c())}function g(p){if(e.deleted){re("instance deleted - cannot call any method");return}a(p,c())}function f(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(re("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[p])}t.shouldUpdate=function(){for(var p=t.getMTime(),d=1/0,h=r;h--;){if(!e.output[h]||e.output[h].isDeleted())return!0;var T=e.output[h].getMTime();if(T<p)return!0;T<d&&(d=T)}for(h=e.numberOfInputs;h--;){var C,m;if((C=e.inputConnection[h])!==null&&C!==void 0&&C.filter.shouldUpdate()||((m=t.getInputData(h))===null||m===void 0?void 0:m.getMTime())>d)return!0}return!1};function l(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,d=function(){return f(p)};return d.filter=t,d}if(e.numberOfInputs){for(var v=e.numberOfInputs;v--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=a,t.setInputConnection=o,t.addInputData=g,t.addInputConnection=u,t.getInputData=i,t.getInputConnection=s}r&&(t.getOutputData=f,t.getOutputPort=l),t.update=function(){var p=[];if(e.numberOfInputs)for(var d=0;d<e.numberOfInputs;)p[d]=t.getInputData(d),d++;t.shouldUpdate()&&t.requestData&&t.requestData(p,e.output)},t.getNumberOfInputPorts=function(){return e.numberOfInputs},t.getNumberOfOutputPorts=function(){return r||e.output.length},t.getInputArrayToProcess=function(p){var d=e.inputArrayToProcess[p],h=e.inputData[p];return d&&h?h["get".concat(d.fieldAssociation)]().getArray(d.arrayName):null},t.setInputArrayToProcess=function(p,d,h){for(var T=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";e.inputArrayToProcess.length<p;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[p]={arrayName:d,fieldAssociation:h,attributeType:T}}}var kv=Symbol("Event abort");function Gw(t,e,n){var r=[],a=t.delete,i=1;function o(u){for(var g=0;g<r.length;++g){var f=dt(r[g],1),l=f[0];if(l===u){r.splice(g,1);return}}}function s(u){function g(){o(u)}return Object.freeze({unsubscribe:g})}function c(){var u=arguments;if(e.deleted){re("instance deleted - cannot call any method");return}for(var g=r.slice(),f=function(d){var h=dt(g[d],3),T=h[1],C=h[2];if(!T)return"continue";if(C<0)setTimeout(function(){return T.apply(t,u)},1-C);else{var m=T.apply(t,u);if(m===kv)return"break"}},l=0;l<g.length;++l){var v=f(l);if(v!=="continue"&&v==="break")break}}t["invoke".concat(ft(n))]=c,t["on".concat(ft(n))]=function(u){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!u.apply)return console.error("Invalid callback for event ".concat(n)),null;if(e.deleted)return re("instance deleted - cannot call any method"),null;var f=i++;return r.push([f,u,g]),r.sort(function(l,v){return v[2]-l[2]}),s(f)},t.delete=function(){a(),r.forEach(function(u){var g=dt(u,1),f=g[0];return o(f)})}}function ke(t,e){var n=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i={},o={};return t(o,i,a),Object.freeze(o)};return e&&Pt.register(e,n),n}function Uv(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e.filter(function(o){return!!o}).map(function(o){return o.apply(void 0,a)})}}function Bv(t){return t&&t.isA&&t.isA("vtkObject")}function wc(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(Bv(t)){if(r.indexOf(t)>=0)return n;r.push(t);var a=e(t);a!==void 0&&n.push(a);var i=t.get();Object.keys(i).forEach(function(o){var s=i[o];Array.isArray(s)?s.forEach(function(c){wc(c,e,n,r)}):wc(s,e,n,r)})}return n}function Aw(t,e,n){var r=this,a,i=function(){for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];var g=r,f=function(){a=null,n||t.apply(g,c)},l=n&&!a;clearTimeout(a),a=setTimeout(f,e),l&&t.apply(g,c)};return i.cancel=function(){return clearTimeout(a)},i}function Iw(t,e){var n=!1,r=null;function a(){n=!1,r!==null&&(i.apply(void 0,Ne(r)),r=null)}function i(){for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];if(n){r=s;return}n=!0,t.apply(void 0,s),setTimeout(a,e)}return i}function Gv(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},n),t.setKey=function(r,a){e.keystore[r]=a},t.getKey=function(r){return e.keystore[r]},t.getAllKeys=function(){return Object.keys(e.keystore)},t.deleteKey=function(r){return delete e.keystore[r]},t.clearKeystore=function(){return t.getAllKeys().forEach(function(r){return delete e.keystore[r]})}}var Pw=1,ui="__root__";function Ww(t,e){Gv(t,e);var n=t.delete;e.proxyId="".concat(Pw++),e.ui=JSON.parse(JSON.stringify(e.ui||[])),Et(t,e,["proxyId","proxyGroup","proxyName"]),at(t,e,["proxyManager"]);var r={},a={};function i(u,g){a[g]||(a[g]=[]);for(var f=a[g],l=0;l<u.length;l++)f.push(u[l].name),r[u[l].name]=u[l],u[l].children&&u[l].children.length&&i(u[l].children,u[l].name)}i(e.ui,ui),t.updateUI=function(u){e.ui=JSON.parse(JSON.stringify(u||[])),Object.keys(r).forEach(function(g){return delete r[g]}),Object.keys(a).forEach(function(g){return delete a[g]}),i(e.ui,ui),t.modified()};function o(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ui;return a[u]}t.updateProxyProperty=function(u,g){var f=r[u];f?Object.assign(f,g):r[u]=mc({},g)},t.activate=function(){if(e.proxyManager){var u="setActive".concat(ft(t.getProxyGroup().slice(0,-1)));e.proxyManager[u]&&e.proxyManager[u](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=function(u,g){g in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[g]=[]),e.propertyLinkSubscribers[g].push(u)},t.gcPropertyLinks=function(u){for(var g=e.propertyLinkSubscribers[u]||[];g.length;)g.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(u){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[u])return e.propertyLinkMap[u];var f=null,l=[],v=0,p=!1;function d(y){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(p)return null;var S=[],O=null;for(v=l.length;v--;){var M=l[v];M.instance===y?O=M:S.push(M)}if(!O)return null;var R=O.instance["get".concat(ft(O.propertyName))]();if(!_w(R,f)||w){for(f=R,p=!0;S.length;){var D=S.pop();D.instance.set(Te({},D.propertyName,f))}p=!1}return e.propertyLinkMap[u].persistent&&(e.propertyLinkMap[u].value=R),R}function h(y,w){var S=[];for(v=l.length;v--;){var O=l[v];O.instance===y&&(O.propertyName===w||w===void 0)&&(O.subscription.unsubscribe(),S.push(v))}for(;S.length;)l.splice(S.pop(),1)}function T(y,w){var S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,O=y.onModified(d),M=l[0];return l.push({instance:y,propertyName:w,subscription:O}),S&&(e.propertyLinkMap[u].persistent&&e.propertyLinkMap[u].value!==void 0?y.set(Te({},w,e.propertyLinkMap[u].value)):M&&d(M.instance,!0)),{unsubscribe:function(){return h(y,w)}}}function C(){for(;l.length;)l.pop().subscription.unsubscribe()}var m={bind:T,unbind:h,unsubscribe:C,persistent:g};return e.propertyLinkMap[u]=m,m};function s(){for(var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ui,g=[],f=e.proxyId,l=o(u)||[],v=0;v<l.length;v++){var p=l[v],d=t["get".concat(ft(p))],h=d?d():void 0,T={id:f,name:p,value:h},C=s(p);C.length&&(T.children=C),g.push(T)}return g}t.listPropertyNames=function(){return s().map(function(u){return u.name})},t.getPropertyByName=function(u){return s().find(function(g){return g.name===u})},t.getPropertyDomainByName=function(u){return(r[u]||{}).domain},t.getProxySection=function(){return{id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:s()}},t.delete=function(){for(var u=Object.keys(e.propertyLinkMap),g=u.length;g--;)e.propertyLinkMap[u[g]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),n()},t.getState=function(){return null};function c(){if(e.links)for(var u=0;u<e.links.length;u++){var g=e.links[u],f=g.link,l=g.property,v=g.persistent,p=g.updateOnBind,d=g.type;if(d==="application"){var h=e.proxyManager.getPropertyLink(f,v);t.registerPropertyLinkForGC(h,"application"),h.bind(t,l,p)}}}Fv(c)}function zw(t,e,n){for(var r=t.delete,a=[],i=Object.keys(n),o=i.length;o--;){var s=i[o],c=n[s],u=c.modelKey,g=c.property,f=c.modified,l=f===void 0?!0:f,v=ft(g),p=ft(s);t["get".concat(p)]=e[u]["get".concat(v)],t["set".concat(p)]=e[u]["set".concat(v)],l&&a.push(e[u].onModified(t.modified))}t.delete=function(){for(;a.length;)a.pop().unsubscribe();r()}}function $w(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function a(c){for(var u=Object.keys(c),g=u.length;g--;){var f=u[g];e[f].set(c[f])}}for(var i=Object.keys(r),o=i.length,s=function(){var u=i[o];e[u]=r[u];var g=n[u];t["set".concat(ft(u))]=function(f){if(f!==e[u]){e[u]=f;var l=g[f];a(l),t.modified()}}};o--;)s();i.length&&Et(t,e,i)}var qf=10,Xf=40,Yf=800;function jw(t){var e=0,n=0,r=0,a=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*qf,a=n*qf,"deltaY"in t&&(a=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||a)&&t.deltaMode&&(t.deltaMode===1?(r*=Xf,a*=Xf):(r*=Yf,a*=Yf)),r&&!e&&(e=r<1?-1:1),a&&!n&&(n=a<1?-1:1),{spinX:e,spinY:n,pixelX:r,pixelY:a}}var E={algo:Bw,capitalize:lu,chain:Uv,debounce:Aw,enumToString:bw,event:Gw,EVENT_ABORT:kv,formatBytesToProperUnit:Nw,formatNumbersWithThousandSeparator:Fw,get:Et,getArray:Ya,getCurrentGlobalMTime:xw,getStateArrayMapFunc:Nv,isVtkObject:Bv,keystore:Gv,measurePromiseExecution:kw,moveToProtected:vu,newInstance:ke,newTypedArray:Lo,newTypedArrayFrom:Vv,normalizeWheel:jw,obj:Ge,proxy:Ww,proxyPropertyMapping:zw,proxyPropertyState:$w,safeArrays:Lv,set:No,setArray:_v,setGet:at,setGetArray:bv,setImmediate:Fv,setLoggerFunction:Mw,throttle:Iw,traverseInstanceTree:wc,TYPED_ARRAYS:Ft,uncapitalize:Lw,VOID:Ew,vtkDebugMacro:Wn,vtkErrorMacro:re,vtkInfoMacro:Dw,vtkLogMacro:Rw,vtkOnceErrorMacro:Vw,vtkWarningMacro:Xa},Av=E.vtkErrorMacro,Yr=E.vtkWarningMacro,Iv=0,Zf=20,pu=1e-12;function Za(t){return function(){return Av("vtkMath::".concat(t," - NOT IMPLEMENTED"))}}function gn(t,e){for(var n=0;n<3;n++){var r=t[n];t[n]=e[n],e[n]=r}}function pe(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3;return Array(t).fill(0)}var Hw=function(){return Math.PI};function We(t){return t/180*Math.PI}function Qi(t){return t*180/Math.PI}var Kw=Math.round,Pv=Math.floor,qw=Math.ceil,Wv=Math.min,zv=Math.max;function Xw(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0,a=e,i=t.length;a<i;a+=n)t[a]<r&&(r=t[a]);return r}function Yw(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=-1/0,a=e,i=t.length;a<i;a+=n)r<t[a]&&(r=t[a]);return r}function Zw(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0,a=-1/0,i=e,o=t.length;i<o;i+=n)t[i]<r&&(r=t[i]),a<t[i]&&(a=t[i]);return[r,a]}var Jw=Za("ceilLog2"),Qw=Za("factorial");function Fn(t){for(var e=1;e<t;)e*=2;return e}function wa(t){return t===Fn(t)}function eS(t,e){for(var n=1,r=1;r<=e;++r)n*=(t-r+1)/r;return Math.floor(n)}function tS(t,e){if(t<e)return 0;for(var n=pe(e),r=0;r<e;++r)n[r]=r;return n}function nS(t,e,n){for(var r=0,a=e-1;a>=0;--a)if(n[a]<t-e+a){for(var i=n[a]+1;a<e;)n[a++]=i++;r=1;break}return r}function rS(t){EC("".concat(t),{global:!0}),Iv=t}function aS(){return Iv}function iS(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=e-t;return t+n*Math.random()}var oS=Za("gaussian");function eo(t,e,n){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function hn(t,e,n){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function $v(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function jv(t,e){return t[0]*=e,t[1]*=e,t}function Sc(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function sS(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r}function ce(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function cS(t,e,n){for(var r=0;r<3;r++)for(var a=0;a<3;a++)n[r][a]=t[r]*e[a]}function Qt(t,e,n){var r=t[1]*e[2]-t[2]*e[1],a=t[2]*e[0]-t[0]*e[2],i=t[0]*e[1]-t[1]*e[0];return n[0]=r,n[1]=a,n[2]=i,n}function Bn(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{for(var n=0,r=0;r<e;r++)n+=t[r]*t[r];return Math.sqrt(n)}}}function lr(t){var e=Bn(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function uS(t,e,n,r){var a=t[0]*t[0],i=t[1]*t[1],o=t[2]*t[2],s=Math.sqrt(a+i+o),c,u,g;a>i&&a>o?(c=0,u=1,g=2):i>o?(c=1,u=2,g=0):(c=2,u=0,g=1);var f=t[c]/s,l=t[u]/s,v=t[g]/s,p=Math.sqrt(f*f+v*v);if(r!==0){var d=Math.sin(r),h=Math.cos(r);e&&(e[c]=(v*h-f*l*d)/p,e[u]=d*p,e[g]=(-(f*h)-l*v*d)/p),n&&(n[c]=(-(v*d)-f*l*h)/p,n[u]=h*p,n[g]=(f*d-l*v*h)/p)}else e&&(e[c]=v/p,e[u]=0,e[g]=-f/p),n&&(n[c]=-f*l/p,n[u]=p,n[g]=-l*v/p)}function fS(t,e,n){var r=ce(e,e);if(r===0)return n[0]=0,n[1]=0,n[2]=0,!1;for(var a=ce(t,e)/r,i=0;i<3;i++)n[i]=e[i];return $v(n,a),!0}function Ec(t,e){return t[0]*e[0]+t[1]*e[1]}function gS(t,e,n){var r=Ec(e,e);if(r===0)return n[0]=0,n[1]=0,!1;for(var a=Ec(t,e)/r,i=0;i<2;i++)n[i]=e[i];return jv(n,a),!0}function Ht(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function lS(t,e){var n=[0,0,0];return Qt(t,e,n),Math.atan2(Bn(n),ce(t,e))}function vS(t,e,n){var r=Math.abs(t-n);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(-Math.pow(r,2)/(2*e))}function pS(t,e,n){var r=Math.abs(t-n);return Math.exp(-Math.pow(r,2)/(2*e))}function hS(t,e,n){for(var r=0;r<2;r++)for(var a=0;a<2;a++)n[r][a]=t[r]*e[a]}function Hv(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function dS(t){var e=Hv(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function Be(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function yS(t,e){for(var n,r,a,i=[0,0,0],o=0;o<3;o++)a=Math.abs(t[o][0]),(r=Math.abs(t[o][1]))>a&&(a=r),(r=Math.abs(t[o][2]))>a&&(a=r),i[o]=1/a;a=i[0]*Math.abs(t[0][0]),n=0,(r=i[1]*Math.abs(t[1][0]))>=a&&(a=r,n=1),(r=i[2]*Math.abs(t[2][0]))>=a&&(n=2),n!==0&&(gn(t[n],t[0]),i[n]=i[0]),e[0]=n,t[1][0]/=t[0][0],t[2][0]/=t[0][0],t[1][1]-=t[1][0]*t[0][1],t[2][1]-=t[2][0]*t[0][1],a=i[1]*Math.abs(t[1][1]),n=1,(r=i[2]*Math.abs(t[2][1]))>=a&&(n=2,gn(t[2],t[1]),i[2]=i[1]),e[1]=n,t[2][1]/=t[1][1],t[1][2]-=t[1][0]*t[0][2],t[2][2]-=t[2][0]*t[0][2]+t[2][1]*t[1][2],e[2]=2}function TS(t,e,n){var r=n[e[0]];n[e[0]]=n[0],n[0]=r,r=n[e[1]],n[e[1]]=n[1],n[1]=r-t[1][0]*n[0],r=n[e[2]],n[e[2]]=n[2],n[2]=r-t[2][0]*n[0]-t[2][1]*n[1],n[2]/=t[2][2],n[1]=(n[1]-t[1][2]*n[2])/t[1][1],n[0]=(n[0]-t[0][1]*n[1]-t[0][2]*n[2])/t[0][0]}function mS(t,e,n){var r=t[0][0],a=t[0][1],i=t[0][2],o=t[1][0],s=t[1][1],c=t[1][2],u=t[2][0],g=t[2][1],f=t[2][2],l=+Be(s,g,c,f),v=-Be(o,u,c,f),p=+Be(o,u,s,g),d=-Be(a,g,i,f),h=+Be(r,u,i,f),T=-Be(r,u,a,g),C=+Be(a,s,i,c),m=-Be(r,o,i,c),y=+Be(r,o,a,s),w=r*l+a*v+i*p,S=l*e[0]+d*e[1]+C*e[2],O=v*e[0]+h*e[1]+m*e[2],M=p*e[0]+T*e[1]+y*e[2];n[0]=S/w,n[1]=O/w,n[2]=M/w}function Sa(t,e,n){var r=t[0][0]*e[0]+t[0][1]*e[1]+t[0][2]*e[2],a=t[1][0]*e[0]+t[1][1]*e[1]+t[1][2]*e[2],i=t[2][0]*e[0]+t[2][1]*e[1]+t[2][2]*e[2];n[0]=r,n[1]=a,n[2]=i}function xc(t,e,n){for(var r=[[0,0,0],[0,0,0],[0,0,0]],a=0;a<3;a++)r[0][a]=t[0][0]*e[0][a]+t[0][1]*e[1][a]+t[0][2]*e[2][a],r[1][a]=t[1][0]*e[0][a]+t[1][1]*e[1][a]+t[1][2]*e[2][a],r[2][a]=t[2][0]*e[0][a]+t[2][1]*e[1][a]+t[2][2]*e[2][a];for(var i=0;i<3;i++)n[i][0]=r[i][0],n[i][1]=r[i][1],n[i][2]=r[i][2]}function CS(t,e,n,r,a,i,o){r!==a&&Av("Number of columns of A must match number of rows of B.");for(var s=0;s<n;s++)for(var c=0;c<i;c++){o[s][c]=0;for(var u=0;u<r;u++)o[s][c]+=t[s][u]*e[u][c]}}function Kr(t,e){var n;n=t[1][0],e[1][0]=t[0][1],e[0][1]=n,n=t[2][0],e[2][0]=t[0][2],e[0][2]=n,n=t[2][1],e[2][1]=t[1][2],e[1][2]=n,e[0][0]=t[0][0],e[1][1]=t[1][1],e[2][2]=t[2][2]}function wS(t,e){var n=t[0][0],r=t[0][1],a=t[0][2],i=t[1][0],o=t[1][1],s=t[1][2],c=t[2][0],u=t[2][1],g=t[2][2],f=+Be(o,u,s,g),l=-Be(i,c,s,g),v=+Be(i,c,o,u),p=-Be(r,u,a,g),d=+Be(n,c,a,g),h=-Be(n,c,r,u),T=+Be(r,o,a,s),C=-Be(n,i,a,s),m=+Be(n,i,r,o),y=n*f+r*l+a*v;e[0][0]=f/y,e[1][0]=l/y,e[2][0]=v/y,e[0][1]=p/y,e[1][1]=d/y,e[2][1]=h/y,e[0][2]=T/y,e[1][2]=C/y,e[2][2]=m/y}function Kv(t){for(var e=0;e<3;e++)t[e][0]=t[e][1]=t[e][2]=0,t[e][e]=1}function Fo(t){return t[0][0]*t[1][1]*t[2][2]+t[1][0]*t[2][1]*t[0][2]+t[2][0]*t[0][1]*t[1][2]-t[0][0]*t[2][1]*t[1][2]-t[1][0]*t[0][1]*t[2][2]-t[2][0]*t[1][1]*t[0][2]}function qv(t,e){var n=t[0]*t[0],r=t[0]*t[1],a=t[0]*t[2],i=t[0]*t[3],o=t[1]*t[1],s=t[2]*t[2],c=t[3]*t[3],u=t[1]*t[2],g=t[1]*t[3],f=t[2]*t[3],l=o+s+c,v=1/(n+l),p=(n-l)*v;v*=2,e[0][0]=o*v+p,e[1][0]=(u+i)*v,e[2][0]=(g-a)*v,e[0][1]=(u-i)*v,e[1][1]=s*v+p,e[2][1]=(f+r)*v,e[0][2]=(g+a)*v,e[1][2]=(f-r)*v,e[2][2]=c*v+p}function Xv(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e-6;if(t.length!==e.length)return!1;function r(a,i){return Math.abs(a-e[i])<=n}return t.every(r)}var Yv=Xv;function bi(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!"".concat(t).includes("e"))return+"".concat(Math.round("".concat(t,"e+").concat(e)),"e-").concat(e);var n="".concat(t).split("e"),r="";return+n[1]+e>0&&(r="+"),+"".concat(Math.round("".concat(+n[0],"e").concat(r).concat(+n[1]+e)),"e-").concat(e)}function Oc(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=bi(t[0],n),e[1]=bi(t[1],n),e[2]=bi(t[2],n),e}function Ja(t,e,n,r){var a,i,o,s,c,u,g,f,l,v,p,d,h,T,C,m,y=pe(e),w=pe(e),S=function(R,D,L,N,U){T=R[D][L],h=R[N][U],R[D][L]=T-d*(h+T*v),R[N][U]=h+d*(T-h*v)};for(c=0;c<e;c++){for(s=0;s<e;s++)r[c][s]=0;r[c][c]=1}for(c=0;c<e;c++)y[c]=n[c]=t[c][c],w[c]=0;for(a=0;a<Zf;a++){for(p=0,c=0;c<e-1;c++)for(s=c+1;s<e;s++)p+=Math.abs(t[c][s]);if(p===0)break;for(a<3?g=.2*p/(e*e):g=0,c=0;c<e-1;c++)for(s=c+1;s<e;s++)if(T=100*Math.abs(t[c][s]),a>3&&Math.abs(n[c])+T===Math.abs(n[c])&&Math.abs(n[s])+T===Math.abs(n[s]))t[c][s]=0;else if(Math.abs(t[c][s])>g){for(h=n[s]-n[c],Math.abs(h)+T===Math.abs(h)?l=t[c][s]/h:(f=.5*h/t[c][s],l=1/(Math.abs(f)+Math.sqrt(1+f*f)),f<0&&(l=-l)),C=1/Math.sqrt(1+l*l),d=l*C,v=d/(1+C),h=l*t[c][s],w[c]-=h,w[s]+=h,n[c]-=h,n[s]+=h,t[c][s]=0,i=0;i<=c-1;i++)S(t,i,c,i,s);for(i=c+1;i<=s-1;i++)S(t,c,i,i,s);for(i=s+1;i<e;i++)S(t,c,i,s,i);for(i=0;i<e;i++)S(r,i,c,i,s)}for(c=0;c<e;c++)y[c]+=w[c],n[c]=y[c],w[c]=0}if(a>=Zf)return Yr("vtkMath::Jacobi: Error extracting eigenfunctions"),0;for(i=0;i<e-1;i++){for(o=i,m=n[o],a=i+1;a<e;a++)(n[a]>=m||Math.abs(n[a]-m)<pu)&&(o=a,m=n[o]);if(o!==i)for(n[o]=n[i],n[i]=m,a=0;a<e;a++)m=r[a][i],r[a][i]=r[a][o],r[a][o]=m}var O=(e>>1)+(e&1);for(i=0;i<e;i++){for(u=0,a=0;a<e;a++)r[a][i]>=0&&u++;if(u<O)for(a=0;a<e;a++)r[a][i]*=-1}return 1}function Zv(t,e){var n=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];n[0][0]=t[0][0]+t[1][1]+t[2][2],n[1][1]=t[0][0]-t[1][1]-t[2][2],n[2][2]=-t[0][0]+t[1][1]-t[2][2],n[3][3]=-t[0][0]-t[1][1]+t[2][2],n[0][1]=n[1][0]=t[2][1]-t[1][2],n[0][2]=n[2][0]=t[0][2]-t[2][0],n[0][3]=n[3][0]=t[1][0]-t[0][1],n[1][2]=n[2][1]=t[1][0]+t[0][1],n[1][3]=n[3][1]=t[0][2]+t[2][0],n[2][3]=n[3][2]=t[2][1]+t[1][2];for(var r=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],a=[0,0,0,0],i=[0,0,0,0],o=[0,0,0,0],s=0;s<4;s++)i[s]=n[s],o[s]=r[s];Ja(i,4,a,o),e[0]=r[0][0],e[1]=r[1][0],e[2]=r[2][0],e[3]=r[3][0]}function SS(t,e,n){var r=t[0]*e[0],a=t[0]*e[1],i=t[0]*e[2],o=t[0]*e[3],s=t[1]*e[0],c=t[1]*e[1],u=t[1]*e[2],g=t[1]*e[3],f=t[2]*e[0],l=t[2]*e[1],v=t[2]*e[2],p=t[2]*e[3],d=t[3]*e[0],h=t[3]*e[1],T=t[3]*e[2],C=t[3]*e[3];n[0]=r-c-v-C,n[1]=a+s+p-T,n[2]=i-g+f+h,n[3]=o+u-l+d}function Jv(t,e){for(var n=0;n<3;n++)e[0][n]=t[0][n],e[1][n]=t[1][n],e[2][n]=t[2][n];for(var r=pe(3),a=pe(3),i,o=0;o<3;o++){var s=Math.abs(e[o][0]),c=Math.abs(e[o][1]),u=Math.abs(e[o][2]);i=c>s?c:s,i=u>i?u:i,r[o]=1,i!==0&&(r[o]/=i)}var g=Math.abs(e[0][0])*r[0],f=Math.abs(e[1][0])*r[1],l=Math.abs(e[2][0])*r[2];a[0]=0,i=g,f>=i&&(i=f,a[0]=1),l>=i&&(a[0]=2),a[0]!==0&&(gn(e[a[0]],e[0]),r[a[0]]=r[0]);var v=Math.abs(e[1][1])*r[1],p=Math.abs(e[2][1])*r[2];a[1]=1,i=v,p>=i&&(a[1]=2,gn(e[2],e[1])),a[2]=2;var d=0;if(Fo(e)<0){d=1;for(var h=0;h<3;h++)e[0][h]=-e[0][h],e[1][h]=-e[1][h],e[2][h]=-e[2][h]}var T=pe(4);if(Zv(e,T),qv(T,e),d)for(var C=0;C<3;C++)e[0][C]=-e[0][C],e[1][C]=-e[1][C],e[2][C]=-e[2][C];a[1]!==1&&gn(e[a[1]],e[1]),a[0]!==0&&gn(e[a[0]],e[0])}function Qv(t,e,n){var r,a,i,o,s,c,u=[pe(3),pe(3),pe(3)],g=pe(3),f=pe(3);for(r=0;r<3;r++)u[r][0]=t[r][0],u[r][1]=t[r][1],u[r][2]=t[r][2],g[r]=u[r],f[r]=n[r];if(Ja(g,3,e,f),e[0]===e[1]&&e[0]===e[2]){Kv(n);return}for(Kr(n,n),r=0;r<3;r++)if(e[(r+1)%3]===e[(r+2)%3]){for(c=Math.abs(n[r][0]),o=0,a=1;a<3;a++)c<(s=Math.abs(n[r][a]))&&(c=s,o=a);o!==r&&(s=e[o],e[o]=e[r],e[r]=s,gn(n[r],n[o])),n[o][o]<0&&(n[o][0]=-n[o][0],n[o][1]=-n[o][1],n[o][2]=-n[o][2]),a=(o+1)%3,i=(o+2)%3,n[a][0]=0,n[a][1]=0,n[a][2]=0,n[a][a]=1,Qt(n[o],n[a],n[i]),lr(n[i]),Qt(n[i],n[o],n[a]),Kr(n,n);return}for(c=Math.abs(n[0][0]),o=0,r=1;r<3;r++)c<(s=Math.abs(n[r][0]))&&(c=s,o=r);for(o!==0&&(s=e[o],e[o]=e[0],e[0]=s,gn(n[o],n[0])),Math.abs(n[1][1])<Math.abs(n[2][1])&&(s=e[2],e[2]=e[1],e[1]=s,gn(n[2],n[1])),r=0;r<2;r++)n[r][r]<0&&(n[r][0]=-n[r][0],n[r][1]=-n[r][1],n[r][2]=-n[r][2]);Fo(n)<0&&(n[2][0]=-n[2][0],n[2][1]=-n[2][1],n[2][2]=-n[2][2]),Kr(n,n)}function ES(t,e,n,r){var a,i=[pe(3),pe(3),pe(3)];for(a=0;a<3;a++)i[0][a]=t[0][a],i[1][a]=t[1][a],i[2][a]=t[2][a];var o=Fo(i);if(o<0)for(a=0;a<3;a++)i[0][a]=-i[0][a],i[1][a]=-i[1][a],i[2][a]=-i[2][a];Jv(i,e),Kr(i,i),xc(i,e,r),Qv(r,n,r),xc(e,r,e),Kr(r,r),o<0&&(n[0]=-n[0],n[1]=-n[1],n[2]=-n[2])}function hu(t,e,n){var r,a,i,o,s=0,c,u,g,f=pe(n);for(r=0;r<n;r++){for(o=0,a=0;a<n;a++)(g=Math.abs(t[r][a]))>o&&(o=g);if(o===0)return Yr("Unable to factor linear system"),0;f[r]=1/o}for(a=0;a<n;a++){for(r=0;r<a;r++){for(c=t[r][a],i=0;i<r;i++)c-=t[r][i]*t[i][a];t[r][a]=c}for(o=0,r=a;r<n;r++){for(c=t[r][a],i=0;i<a;i++)c-=t[r][i]*t[i][a];t[r][a]=c,(u=f[r]*Math.abs(c))>=o&&(o=u,s=r)}if(a!==s){for(i=0;i<n;i++)u=t[s][i],t[s][i]=t[a][i],t[a][i]=u;f[s]=f[a]}if(e[a]=s,Math.abs(t[a][a])<=pu)return Yr("Unable to factor linear system"),0;if(a!==n-1)for(u=1/t[a][a],r=a+1;r<n;r++)t[r][a]*=u}return 1}function du(t,e,n,r){var a,i,o,s,c;for(o=-1,a=0;a<r;a++){if(s=e[a],c=n[s],n[s]=n[a],o>=0)for(i=o;i<=a-1;i++)c-=t[a][i]*n[i];else c!==0&&(o=a);n[a]=c}for(a=r-1;a>=0;a--){for(c=n[a],i=a+1;i<r;i++)c-=t[a][i]*n[i];n[a]=c/t[a][a]}}function ep(t,e,n){if(n===2){var r=pe(2),a=Be(t[0][0],t[0][1],t[1][0],t[1][1]);return a===0?0:(r[0]=(t[1][1]*e[0]-t[0][1]*e[1])/a,r[1]=(-(t[1][0]*e[0])+t[0][0]*e[1])/a,e[0]=r[0],e[1]=r[1],1)}if(n===1)return t[0][0]===0?0:(e[0]/=t[0][0],1);var i=pe(n);return hu(t,i,n)===0?0:(du(t,i,e,n),1)}function tp(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,i=r||pe(n),o=a||pe(n);if(hu(t,i,n)===0)return 0;for(var s=0;s<n;s++){for(var c=0;c<n;c++)o[c]=0;o[s]=1,du(t,i,o,n);for(var u=0;u<n;u++)e[u][s]=o[u]}return 1}function xS(t,e){for(var n=+Number.MAX_VALUE,r=-Number.MAX_VALUE,a=0;a<e;a++)for(var i=a;i<e;i++)Math.abs(t[a][i])>zv&&(r=Math.abs(t[a][i]));for(var o=0;o<e;o++)Math.abs(t[o][o])<Wv&&(n=Math.abs(t[o][o]));return n===0?Number.MAX_VALUE:r/n}function OS(t,e,n){return Ja(t,3,e,n)}function Mc(t,e,n,r){if(t<n)return Yr("Insufficient number of samples. Underdetermined."),0;var a,i,o,s=pe(n),c=pe(n),u=pe(n);for(a=0;a<n;a++)for(u[a]=pe(n),s[a]=pe(n),i=0;i<n;i++)s[a][i]=0;for(o=0;o<t;o++)for(a=0;a<n;a++)for(i=a;i<n;i++)s[a][i]+=e[o][a]*e[o][i];for(a=0;a<n;a++)for(i=0;i<a;i++)s[a][i]=s[i][a];for(Ja(s,n,c,u),a=0;a<n;a++)r[a][0]=u[a][n-1];return 1}function MS(t,e,n,r,a,i){var o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!0;if(t<n||t<a)return Yr("Insufficient number of samples. Underdetermined."),0;var s=pe(a),c=1,u,g=0,f,l,v,p=0;if(o){for(l=0;l<a;l++)s[l]=1;for(f=0;f<t;f++)for(l=0;l<a;l++)Math.abs(r[f][l])>pu&&(c=0,s[l]=0);if(c&&a===1)return Yr("Detected homogeneous system (Y=0), calling SolveHomogeneousLeastSquares()"),Mc(t,e,n,i);if(c)p=1;else for(l=0;l<a;l++)s[l]&&(p=1)}if(p){for(u=pe(n),l=0;l<n;l++)u[l]=[0];g=Mc(t,e,n,u)}var d=pe(n),h=pe(n),T=pe(n);for(f=0;f<n;f++){for(d[f]=pe(n),h[f]=pe(n),l=0;l<n;l++)d[f][l]=0,h[f][l]=0;for(T[f]=pe(a),l=0;l<a;l++)T[f][l]=0}for(v=0;v<t;v++)for(f=0;f<n;f++){for(l=f;l<n;l++)d[f][l]+=e[v][f]*e[v][l];for(l=0;l<a;l++)T[f][l]+=e[v][f]*r[v][l]}for(f=0;f<n;f++)for(l=0;l<f;l++)d[f][l]=d[l][f];var C=tp(d,h,n);if(C)for(f=0;f<n;f++)for(l=0;l<a;l++)for(i[f][l]=0,v=0;v<n;v++)i[f][l]+=h[f][v]*T[v][l];if(p){for(l=0;l<a;l++)if(s[l])for(f=0;f<n;f++)i[f][l]=u[f][0]}return p?g&&C:C}function RS(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,.5,1];switch(t.length){case 3:return e[0]=parseInt(t[0],16)*17/255,e[1]=parseInt(t[1],16)*17/255,e[2]=parseInt(t[2],16)*17/255,e;case 4:return e[0]=parseInt(t[1],16)*17/255,e[1]=parseInt(t[2],16)*17/255,e[2]=parseInt(t[3],16)*17/255,e;case 6:return e[0]=parseInt(t.substr(0,2),16)/255,e[1]=parseInt(t.substr(2,2),16)/255,e[2]=parseInt(t.substr(4,2),16)/255,e;case 7:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e;case 9:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e[3]=parseInt(t.substr(7,2),16)/255,e;default:return e}}function Ea(t,e){var n,r,a=dt(t,3),i=a[0],o=a[1],s=a[2],c=1/3,u=1/6,g=2/3,f=i,l=i;o>f?f=o:o<l&&(l=o),s>f?f=s:s<l&&(l=s);var v=f;v>0?r=(f-l)/f:r=0,r>0?(i===f?n=u*(o-s)/(f-l):o===f?n=c+u*(s-i)/(f-l):n=g+u*(i-o)/(f-l),n<0&&(n+=1)):n=0,e[0]=n,e[1]=r,e[2]=v}function tr(t,e){var n=dt(t,3),r=n[0],a=n[1],i=n[2],o=1/3,s=1/6,c=2/3,u=5/6,g,f,l;r>s&&r<=o?(f=1,g=(o-r)/s,l=0):r>o&&r<=.5?(f=1,l=(r-o)/s,g=0):r>.5&&r<=c?(l=1,f=(c-r)/s,g=0):r>c&&r<=u?(l=1,g=(r-c)/s,f=0):r>u&&r<=1?(g=1,l=(1-r)/s,f=0):(g=1,f=r/s,l=0),g=a*g+(1-a),f=a*f+(1-a),l=a*l+(1-a),g*=i,f*=i,l*=i,e[0]=g,e[1]=f,e[2]=l}function np(t,e){var n=dt(t,3),r=n[0],a=n[1],i=n[2],o=(r+16)/116,s=a/500+o,c=o-i/200;Math.pow(o,3)>.008856?o=Math.pow(o,3):o=(o-16/116)/7.787,Math.pow(s,3)>.008856?s=Math.pow(s,3):s=(s-16/116)/7.787,Math.pow(c,3)>.008856?c=Math.pow(c,3):c=(c-16/116)/7.787;var u=.9505,g=1,f=1.089;e[0]=u*s,e[1]=g*o,e[2]=f*c}function rp(t,e){var n=dt(t,3),r=n[0],a=n[1],i=n[2],o=.9505,s=1,c=1.089,u=r/o,g=a/s,f=i/c;u>.008856?u=Math.pow(u,1/3):u=7.787*u+16/116,g>.008856?g=Math.pow(g,1/3):g=7.787*g+16/116,f>.008856?f=Math.pow(f,1/3):f=7.787*f+16/116,e[0]=116*g-16,e[1]=500*(u-g),e[2]=200*(g-f)}function ap(t,e){var n=dt(t,3),r=n[0],a=n[1],i=n[2],o=r*3.2406+a*-1.5372+i*-.4986,s=r*-.9689+a*1.8758+i*.0415,c=r*.0557+a*-.204+i*1.057;o>.0031308?o=1.055*Math.pow(o,1/2.4)-.055:o*=12.92,s>.0031308?s=1.055*Math.pow(s,1/2.4)-.055:s*=12.92,c>.0031308?c=1.055*Math.pow(c,1/2.4)-.055:c*=12.92;var u=o;u<s&&(u=s),u<c&&(u=c),u>1&&(o/=u,s/=u,c/=u),o<0&&(o=0),s<0&&(s=0),c<0&&(c=0),e[0]=o,e[1]=s,e[2]=c}function ip(t,e){var n=dt(t,3),r=n[0],a=n[1],i=n[2];r>.04045?r=Math.pow((r+.055)/1.055,2.4):r/=12.92,a>.04045?a=Math.pow((a+.055)/1.055,2.4):a/=12.92,i>.04045?i=Math.pow((i+.055)/1.055,2.4):i/=12.92,e[0]=r*.4124+a*.3576+i*.1805,e[1]=r*.2126+a*.7152+i*.0722,e[2]=r*.0193+a*.1192+i*.9505}function ar(t,e){var n=[0,0,0];ip(t,n),rp(n,e)}function to(t,e){var n=[0,0,0];np(t,n),ap(n,e)}function hr(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function ki(t){return!(t[1]-t[0]<0)}function Rc(t,e,n){return n[0]=Math.min(t[0],e[0]),n[1]=Math.max(t[0],e[0]),n[2]=Math.min(t[1],e[1]),n[3]=Math.max(t[1],e[1]),n[4]=Math.min(t[2],e[2]),n[5]=Math.max(t[2],e[2]),n}function Yt(t,e,n){return t<e?e:t>n?n:t}function Dc(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return r[0]=Yt(t[0],e[0],n[0]),r[1]=Yt(t[1],e[1],n[1]),r[2]=Yt(t[2],e[2],n[2]),r}function DS(t,e){var n=0;return e[0]!==e[1]&&(t<e[0]?n=e[0]:t>e[1]?n=e[1]:n=t,n=(n-e[0])/(e[1]-e[0])),n}var VS=Za("GetScalarTypeFittingRange"),LS=Za("GetAdjustedScalarRange");function NS(t,e){if(!t||!e)return 0;for(var n=0;n<6;n+=2)if(t[n]<e[n]||t[n]>e[n+1]||t[n+1]<e[n]||t[n+1]>e[n+1])return 0;return 1}function FS(t,e,n){if(!t||!e)return 0;for(var r=0;r<6;r+=2)if(t[r]+n[r/2]<e[r]||t[r]-n[r/2]>e[r+1]||t[r+1]+n[r/2]<e[r]||t[r+1]-n[r/2]>e[r+1])return 0;return 1}function _S(t,e,n){if(!t||!e||!n)return 0;for(var r=0;r<3;r++)if(t[r]+n[r]<e[2*r]||t[r]-n[r]>e[2*r+1])return 0;return 1}function bS(t,e,n,r){for(var a=pe(3),i=pe(3),o=pe(3),s=pe(3),c=pe(3),u=pe(3),g=0;g<3;++g)a[g]=t[g]-e[g],i[g]=e[g]-n[g],o[g]=n[g]-t[g],s[g]=-a[g],c[g]=-i[g],u[g]=-o[g];var f=Bn(s),l=Bn(c),v=Bn(o),p=pe(3);Qt(a,i,p);for(var d=Bn(p),h=f*l*v/(2*d),T=2*d*d,C=l*l*ce(a,u)/T,m=v*v*ce(s,i)/T,y=f*f*ce(o,c)/T,w=0;w<3;++w)r[w]=C*t[w]+m*e[w]+y*n[w];return h}var kS=1/0,US=-1/0,op=function(e){return!Number.isFinite(e)},BS=Number.isFinite,Vc=Number.isNaN,no=Vc;function Zr(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function GS(t){for(var e=-1,n=-1,r=0;r<t.length;r++){var a=Math.abs(t[r]);a>e&&(n=r,e=a)}return n}function sp(t){var e=Math.floor(t*255);return e>15?e.toString(16):"0".concat(e.toString(16))}function AS(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#";return"".concat(e).concat(t.map(sp).join(""))}function fi(t){return Math.round(t*255)}function IS(t){return t.length===3?"rgb(".concat(t.map(fi).join(", "),")"):"rgba(".concat(fi(t[0]||0),", ").concat(fi(t[1]||0),", ").concat(fi(t[2]||0),", ").concat(t[3]||0,")")}var Pr={Pi:Hw,radiansFromDegrees:We,degreesFromRadians:Qi,round:Kw,floor:Pv,ceil:qw,ceilLog2:Jw,min:Wv,max:zv,arrayMin:Xw,arrayMax:Yw,arrayRange:Zw,isPowerOfTwo:wa,nearestPowerOfTwo:Fn,factorial:Qw,binomial:eS,beginCombination:tS,nextCombination:nS,randomSeed:rS,getSeed:aS,random:iS,gaussian:oS,add:eo,subtract:hn,multiplyScalar:$v,multiplyScalar2D:jv,multiplyAccumulate:Sc,multiplyAccumulate2D:sS,dot:ce,outer:cS,cross:Qt,norm:Bn,normalize:lr,perpendiculars:uS,projectVector:fS,projectVector2D:gS,distance2BetweenPoints:Ht,angleBetweenVectors:lS,gaussianAmplitude:vS,gaussianWeight:pS,dot2D:Ec,outer2D:hS,norm2D:Hv,normalize2D:dS,determinant2x2:Be,LUFactor3x3:yS,LUSolve3x3:TS,linearSolve3x3:mS,multiply3x3_vect3:Sa,multiply3x3_mat3:xc,multiplyMatrix:CS,transpose3x3:Kr,invert3x3:wS,identity3x3:Kv,determinant3x3:Fo,quaternionToMatrix3x3:qv,areEquals:Xv,areMatricesEqual:Yv,roundNumber:bi,roundVector:Oc,matrix3x3ToQuaternion:Zv,multiplyQuaternion:SS,orthogonalize3x3:Jv,diagonalize3x3:Qv,singularValueDecomposition3x3:ES,solveLinearSystem:ep,invertMatrix:tp,luFactorLinearSystem:hu,luSolveLinearSystem:du,estimateMatrixCondition:xS,jacobi:OS,jacobiN:Ja,solveHomogeneousLeastSquares:Mc,solveLeastSquares:MS,hex2float:RS,rgb2hsv:Ea,hsv2rgb:tr,lab2xyz:np,xyz2lab:rp,xyz2rgb:ap,rgb2xyz:ip,rgb2lab:ar,lab2rgb:to,uninitializeBounds:hr,areBoundsInitialized:ki,computeBoundsFromPoints:Rc,clampValue:Yt,clampVector:Dc,clampAndNormalizeValue:DS,getScalarTypeFittingRange:VS,getAdjustedScalarRange:LS,extentIsWithinOtherExtent:NS,boundsIsWithinOtherBounds:FS,pointIsWithinBounds:_S,solve3PointCircle:bS,inf:kS,negInf:US,isInf:op,isNan:Vc,isNaN:Vc,isFinite:BS,createUninitializedBounds:Zr,getMajorAxisIndex:GS,floatToHex2:sp,floatRGB2HexCode:AS,float2CssRGBA:IS},PS=function(e){return e},WS=ie(new Float64Array(16)),Jf=1e-6,cp=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;Do(this,t),this.matrix=ie(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?A5:PS}return Vo(t,[{key:"rotateFromDirections",value:function(n,r){var a=new Float64Array(3),i=new Float64Array(3),o=new Float64Array(16);te(a,n[0],n[1],n[2]),te(i,r[0],r[1],r[2]),Nt(a,a),Nt(i,i);var s=ut(a,i);return s>=1?this:(pn(this.tmp,a,i),vn(this.tmp)<Jf&&(pn(this.tmp,[1,0,0],n),vn(this.tmp)<Jf&&pn(this.tmp,[0,1,0],n)),eu(o,Math.acos(s),this.tmp),Me(this.matrix,this.matrix,o),this)}},{key:"rotate",value:function(n,r){return te.apply(sm,[this.tmp].concat(Ne(r))),Nt(this.tmp,this.tmp),Bt(this.matrix,this.matrix,this.angleConv(n),this.tmp),this}},{key:"rotateX",value:function(n){return Zc(this.matrix,this.matrix,this.angleConv(n)),this}},{key:"rotateY",value:function(n){return Jc(this.matrix,this.matrix,this.angleConv(n)),this}},{key:"rotateZ",value:function(n){return Qc(this.matrix,this.matrix,this.angleConv(n)),this}},{key:"translate",value:function(n,r,a){return te(this.tmp,n,r,a),je(this.matrix,this.matrix,this.tmp),this}},{key:"scale",value:function(n,r,a){return te(this.tmp,n,r,a),Pn(this.matrix,this.matrix,this.tmp),this}},{key:"multiply",value:function(n){return Me(this.matrix,this.matrix,n),this}},{key:"identity",value:function(){return ie(this.matrix),this}},{key:"apply",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(Yv(WS,this.matrix))return this;for(var i=a===-1?n.length:r+a*3,o=r;o<i;o+=3)te(this.tmp,n[o],n[o+1],n[o+2]),ue(this.tmp,this.tmp,this.matrix),n[o]=this.tmp[0],n[o+1]=this.tmp[1],n[o+2]=this.tmp[2];return this}},{key:"getMatrix",value:function(){return this.matrix}},{key:"setMatrix",value:function(n){return!!n&&n.length===16&&Ke(this.matrix,n),this}}]),t}();function zS(){return new cp(!0)}function $S(){return new cp(!1)}var Zn={buildFromDegree:zS,buildFromRadian:$S};function yu(t,e,n){const r=Z0(t),a=Zn.buildFromDegree().identity().rotateFromDirections(e,[1,0,0]);r.forEach(u=>a.apply(u));const i=[...n];a.apply(i);const o=i[0];let s=1/0,c=-1/0;for(let u=0;u<8;u++){const g=r[u][0];g>c&&(c=g),g<s&&(s=g)}return{min:s,max:c,current:o,actor:t,viewPlaneNormal:e,focalPoint:n}}function up(t,e,n,r,a,i){const{min:o,max:s,current:c}=n,u=Ue();na(u,e,t);const g=Math.round((s-o)/a),l=(c-o)/(s-o)*g;let v=Math.round(l),p=[t[0]-r[0]*l*a,t[1]-r[1]*l*a,t[2]-r[2]*l*a];v+=i,v>g?v=g:v<0&&(v=0);const d=v*a;p=[p[0]+r[0]*d,p[1]+r[1]*d,p[2]+r[2]*d];const h=[p[0]+u[0],p[1]+u[1],p[2]+u[2]];return{newFocalPoint:p,newPosition:h}}function fp(t){const e=t.getCamera(),{spacingInNormalDirection:n,imageVolume:r}=iu(t,e);if(!r)return;const{viewPlaneNormal:a,focalPoint:i}=e,o=t.getActor(r.volumeId);o||console.warn("No actor found for with actorUID of",r.volumeId);const s=o.actor,c=yu(s,a,i),{min:u,max:g,current:f}=c,l=Math.round((g-u)/n)+1;let v=(f-u)/(g-u)*l;return v=Math.floor(v),v>l-1?v=l-1:v<0&&(v=0),{numberOfSlices:l,imageIndex:v}}function ir(t){return!!(t.isA("vtkVolume")||t.isA("vtkImageSlice"))}function gp(t,e){let n;e?n=[wn(e)]:n=ra();const r=[];return n.forEach(a=>{const o=a.getStackViewports().filter(u=>u.hasImageURI(t)),c=a.getVolumeViewports().filter(u=>u.hasImageURI(t));r.push(...o,...c)}),r}function lp(t,e,n){const[r,a,i]=t,[o,s,c]=e,[u,g,f,l]=n,v=o-r,p=s-a,d=c-i,h=-1*(u*r+g*a+f*i-l)/(u*v+g*p+f*d),T=v*h+r,C=p*h+a,m=d*h+i;return[T,C,m]}function jS(t,e){const[n,r,a]=t,i=n*e[0]+r*e[1]+a*e[2];return[n,r,a,i]}function HS(t,e,n){const[r,a,i,o]=t,[s,c,u,g]=e,[f,l,v,p]=n,d=Ca(r,s,f,a,c,l,i,u,v),h=Ca(o,g,p,a,c,l,i,u,v),T=Ca(r,s,f,o,g,p,i,u,v),C=Ca(r,s,f,a,c,l,o,g,p),m=Yn(h)/Yn(d),y=Yn(T)/Yn(d),w=Yn(C)/Yn(d);return[m,y,w]}const KS=Object.freeze(Object.defineProperty({__proto__:null,linePlaneIntersection:lp,planeEquation:jS,threePlaneIntersection:HS},Symbol.toStringTag,{value:"Module"}));function ro(t,e){const n=Math.abs(t-e),r=t+n/2;return{windowWidth:n,windowCenter:r}}function Pa(t,e){const n=e-t/2,r=e+t/2;return{lower:n,upper:r}}const qS=Object.freeze(Object.defineProperty({__proto__:null,toWindowLevel:ro,toLowHighRange:Pa},Symbol.toStringTag,{value:"Module"})),XS=Object.freeze(Object.defineProperty({__proto__:null,invertRgbTransferFunction:Hi,scaleRgbTransferFunction:R5,triggerEvent:Y,imageIdToURI:Xt,calibratedPixelSpacingMetadataProvider:b5,uuidv4:ea,planar:KS,getMinMax:L0,getRuntimeId:N0,isEqual:uc,isOpposite:k5,createFloat32SharedArray:B5,createUint8SharedArray:U5,windowLevel:qS,getClosestImageId:pm,getSpacingInNormalDirection:qi,getTargetVolumeAndSpacingInNormalDir:iu,getVolumeActorCorners:Z0,indexWithinDimensions:Tm,getVolumeViewportsContainingSameVolumes:mm,getViewportsWithVolumeId:Mo,transformWorldToIndex:J0,loadImageToCanvas:aC,renderToCanvas:sv,worldToImageCoords:iC,imageToWorldCoords:oC,getSliceRange:yu,snapFocalPointToSlice:up,getImageSliceDataForVolumeViewport:fp,isImageActor:ir,getViewportsWithImageURI:gp},Symbol.toStringTag,{value:"Module"}));function Qf(t,e,n,r,a,i,o){try{var s=t[i](o),c=s.value}catch(u){n(u);return}s.done?e(c):Promise.resolve(c).then(r,a)}function qr(t){return function(){var e=this,n=arguments;return new Promise(function(r,a){var i=t.apply(e,n);function o(c){Qf(i,r,a,o,s,"next",c)}function s(c){Qf(i,r,a,o,s,"throw",c)}o(void 0)})}}var vp={exports:{}},pp={exports:{}};(function(t){var e=function(n){var r=Object.prototype,a=r.hasOwnProperty,i,o=typeof Symbol=="function"?Symbol:{},s=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function g(F,V,B){return Object.defineProperty(F,V,{value:B,enumerable:!0,configurable:!0,writable:!0}),F[V]}try{g({},"")}catch{g=function(V,B,W){return V[B]=W}}function f(F,V,B,W){var I=V&&V.prototype instanceof C?V:C,$=Object.create(I.prototype),Q=new G(W||[]);return $._invoke=L(F,B,Q),$}n.wrap=f;function l(F,V,B){try{return{type:"normal",arg:F.call(V,B)}}catch(W){return{type:"throw",arg:W}}}var v="suspendedStart",p="suspendedYield",d="executing",h="completed",T={};function C(){}function m(){}function y(){}var w={};g(w,s,function(){return this});var S=Object.getPrototypeOf,O=S&&S(S(P([])));O&&O!==r&&a.call(O,s)&&(w=O);var M=y.prototype=C.prototype=Object.create(w);m.prototype=y,g(M,"constructor",y),g(y,"constructor",m),m.displayName=g(y,u,"GeneratorFunction");function R(F){["next","throw","return"].forEach(function(V){g(F,V,function(B){return this._invoke(V,B)})})}n.isGeneratorFunction=function(F){var V=typeof F=="function"&&F.constructor;return V?V===m||(V.displayName||V.name)==="GeneratorFunction":!1},n.mark=function(F){return Object.setPrototypeOf?Object.setPrototypeOf(F,y):(F.__proto__=y,g(F,u,"GeneratorFunction")),F.prototype=Object.create(M),F},n.awrap=function(F){return{__await:F}};function D(F,V){function B($,Q,H,he){var j=l(F[$],F,Q);if(j.type==="throw")he(j.arg);else{var Ee=j.arg,de=Ee.value;return de&&typeof de=="object"&&a.call(de,"__await")?V.resolve(de.__await).then(function(oe){B("next",oe,H,he)},function(oe){B("throw",oe,H,he)}):V.resolve(de).then(function(oe){Ee.value=oe,H(Ee)},function(oe){return B("throw",oe,H,he)})}}var W;function I($,Q){function H(){return new V(function(he,j){B($,Q,he,j)})}return W=W?W.then(H,H):H()}this._invoke=I}R(D.prototype),g(D.prototype,c,function(){return this}),n.AsyncIterator=D,n.async=function(F,V,B,W,I){I===void 0&&(I=Promise);var $=new D(f(F,V,B,W),I);return n.isGeneratorFunction(V)?$:$.next().then(function(Q){return Q.done?Q.value:$.next()})};function L(F,V,B){var W=v;return function($,Q){if(W===d)throw new Error("Generator is already running");if(W===h){if($==="throw")throw Q;return z()}for(B.method=$,B.arg=Q;;){var H=B.delegate;if(H){var he=N(H,B);if(he){if(he===T)continue;return he}}if(B.method==="next")B.sent=B._sent=B.arg;else if(B.method==="throw"){if(W===v)throw W=h,B.arg;B.dispatchException(B.arg)}else B.method==="return"&&B.abrupt("return",B.arg);W=d;var j=l(F,V,B);if(j.type==="normal"){if(W=B.done?h:p,j.arg===T)continue;return{value:j.arg,done:B.done}}else j.type==="throw"&&(W=h,B.method="throw",B.arg=j.arg)}}}function N(F,V){var B=F.iterator[V.method];if(B===i){if(V.delegate=null,V.method==="throw"){if(F.iterator.return&&(V.method="return",V.arg=i,N(F,V),V.method==="throw"))return T;V.method="throw",V.arg=new TypeError("The iterator does not provide a 'throw' method")}return T}var W=l(B,F.iterator,V.arg);if(W.type==="throw")return V.method="throw",V.arg=W.arg,V.delegate=null,T;var I=W.arg;if(!I)return V.method="throw",V.arg=new TypeError("iterator result is not an object"),V.delegate=null,T;if(I.done)V[F.resultName]=I.value,V.next=F.nextLoc,V.method!=="return"&&(V.method="next",V.arg=i);else return I;return V.delegate=null,T}R(M),g(M,u,"Generator"),g(M,s,function(){return this}),g(M,"toString",function(){return"[object Generator]"});function U(F){var V={tryLoc:F[0]};1 in F&&(V.catchLoc=F[1]),2 in F&&(V.finallyLoc=F[2],V.afterLoc=F[3]),this.tryEntries.push(V)}function b(F){var V=F.completion||{};V.type="normal",delete V.arg,F.completion=V}function G(F){this.tryEntries=[{tryLoc:"root"}],F.forEach(U,this),this.reset(!0)}n.keys=function(F){var V=[];for(var B in F)V.push(B);return V.reverse(),function W(){for(;V.length;){var I=V.pop();if(I in F)return W.value=I,W.done=!1,W}return W.done=!0,W}};function P(F){if(F){var V=F[s];if(V)return V.call(F);if(typeof F.next=="function")return F;if(!isNaN(F.length)){var B=-1,W=function I(){for(;++B<F.length;)if(a.call(F,B))return I.value=F[B],I.done=!1,I;return I.value=i,I.done=!0,I};return W.next=W}}return{next:z}}n.values=P;function z(){return{value:i,done:!0}}return G.prototype={constructor:G,reset:function(F){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(b),!F)for(var V in this)V.charAt(0)==="t"&&a.call(this,V)&&!isNaN(+V.slice(1))&&(this[V]=i)},stop:function(){this.done=!0;var F=this.tryEntries[0],V=F.completion;if(V.type==="throw")throw V.arg;return this.rval},dispatchException:function(F){if(this.done)throw F;var V=this;function B(he,j){return $.type="throw",$.arg=F,V.next=he,j&&(V.method="next",V.arg=i),!!j}for(var W=this.tryEntries.length-1;W>=0;--W){var I=this.tryEntries[W],$=I.completion;if(I.tryLoc==="root")return B("end");if(I.tryLoc<=this.prev){var Q=a.call(I,"catchLoc"),H=a.call(I,"finallyLoc");if(Q&&H){if(this.prev<I.catchLoc)return B(I.catchLoc,!0);if(this.prev<I.finallyLoc)return B(I.finallyLoc)}else if(Q){if(this.prev<I.catchLoc)return B(I.catchLoc,!0)}else if(H){if(this.prev<I.finallyLoc)return B(I.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(F,V){for(var B=this.tryEntries.length-1;B>=0;--B){var W=this.tryEntries[B];if(W.tryLoc<=this.prev&&a.call(W,"finallyLoc")&&this.prev<W.finallyLoc){var I=W;break}}I&&(F==="break"||F==="continue")&&I.tryLoc<=V&&V<=I.finallyLoc&&(I=null);var $=I?I.completion:{};return $.type=F,$.arg=V,I?(this.method="next",this.next=I.finallyLoc,T):this.complete($)},complete:function(F,V){if(F.type==="throw")throw F.arg;return F.type==="break"||F.type==="continue"?this.next=F.arg:F.type==="return"?(this.rval=this.arg=F.arg,this.method="return",this.next="end"):F.type==="normal"&&V&&(this.next=V),T},finish:function(F){for(var V=this.tryEntries.length-1;V>=0;--V){var B=this.tryEntries[V];if(B.finallyLoc===F)return this.complete(B.completion,B.afterLoc),b(B),T}},catch:function(F){for(var V=this.tryEntries.length-1;V>=0;--V){var B=this.tryEntries[V];if(B.tryLoc===F){var W=B.completion;if(W.type==="throw"){var I=W.arg;b(B)}return I}}throw new Error("illegal catch attempt")},delegateYield:function(F,V,B){return this.delegate={iterator:P(F),resultName:V,nextLoc:B},this.method==="next"&&(this.arg=i),T}},n}(t.exports);try{regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})(pp);(function(t){t.exports=pp.exports})(vp);const Dt=uv(vp.exports);var YS={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Xe={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},ZS=Xe.FLOAT,hp={DefaultDataType:ZS,DataTypeByteSize:YS,VtkDataTypes:Xe},JS=navigator.gpu?"WebGPU":"WebGL",ao=Object.create(null);function dp(t,e){ao[t]=e}function QS(){return Object.keys(ao)}function yp(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ao[t]&&ao[t](e)}function eE(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=function(n){t.hasRenderer(n)||(n.setRenderWindow(t),e.renderers.push(n),t.modified())},t.removeRenderer=function(n){e.renderers=e.renderers.filter(function(r){return r!==n}),t.modified()},t.hasRenderer=function(n){return e.renderers.indexOf(n)!==-1},t.newAPISpecificView=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return yp(n||e.defaultViewAPI,r)},t.addView=function(n){t.hasView(n)||(n.setRenderable(t),e.views.push(n),t.modified())},t.removeView=function(n){e.views=e.views.filter(function(r){return r!==n}),t.modified()},t.hasView=function(n){return e.views.indexOf(n)!==-1},t.preRender=function(){e.renderers.forEach(function(n){n.isActiveCameraCreated()||n.resetCamera()})},t.render=function(){t.preRender(),e.interactor?e.interactor.render():e.views.forEach(function(n){return n.traverseAllPasses()})},t.getStatistics=function(){var n={propCount:0,invisiblePropCount:0};return e.renderers.forEach(function(r){var a=r.getViewProps();a.forEach(function(i){if(i.getVisibility()){n.propCount+=1;var o=i.getMapper&&i.getMapper();if(o&&o.getPrimitiveCount){var s=o.getPrimitiveCount();Object.keys(s).forEach(function(c){n[c]||(n[c]=0),n[c]+=s[c]})}}else n.invisiblePropCount+=1})}),n.str=Object.keys(n).map(function(r){return"".concat(r,": ").concat(n[r])}).join(`
`),n},t.captureImages=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return E.setImmediate(t.render),e.views.map(function(a){return a.captureNextImage?a.captureNextImage(n,r):void 0}).filter(function(a){return!!a})}}var tE={defaultViewAPI:JS,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1};function Tp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tE,n),E.obj(t,e),E.setGet(t,e,["interactor","numberOfLayers","views","defaultViewAPI"]),E.get(t,e,["neverRendered"]),E.getArray(t,e,["renderers"]),E.event(t,e,"completion"),eE(t,e)}var nE=E.newInstance(Tp,"vtkRenderWindow"),rE={newInstance:nE,extend:Tp,registerViewConstructor:dp,listViewAPIs:QS,newAPISpecificView:yp},Wa={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},xe={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5},Tu={Wrap:Wa,Filter:xe},mp=new Float32Array(1),aE=new Int32Array(mp.buffer);function iE(t){mp[0]=t;var e=aE[0],n=e>>16&32768,r=e>>12&2047,a=e>>23&255;return a<103?n:a>142?(n|=31744,n|=(a===255?0:1)&&e&8388607,n):a<113?(r|=2048,n|=(r>>114-a)+(r>>113-a&1),n):(n|=a-112<<10|r>>1,n+=r&1,n)}function oE(t){var e=(t&32768)>>15,n=(t&31744)>>10,r=t&1023;return n===0?(e?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):n===31?r?NaN:(e?-1:1)*(1/0):(e?-1:1)*Math.pow(2,n-15)*(1+r/Math.pow(2,10))}var xr={fromHalf:oE,toHalf:iE};function eg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function io(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?eg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):eg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var sE=hp.DefaultDataType,cE=[];function Lc(t,e,n){var r=t.length,a,i,o,s;if(r===0)return{min:Number.MAX_VALUE,max:-Number.MAX_VALUE};for(a=t[e],i=a,s=e;s<r;s+=n)o=t[s],o<a?a=o:o>i&&(i=o);return{min:a,max:i}}function uE(){var t=Number.MAX_VALUE,e=-Number.MAX_VALUE,n=0,r=0;return{add:function(i){t>i&&(t=i),e<i&&(e=i),n++,r+=i},get:function(){return{min:t,max:e,count:n,sum:r,mean:r/n}},getRange:function(){return{min:t,max:e}}}}function Cp(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&n>1){for(var r=t.length,a=r/n,i=new Float64Array(a),o=0,s=0;o<a;++o){for(var c,u=s+n;s<u;++s)i[o]+=t[s]*t[s];c=o,i[c]=Math.pow(i[c],.5)}return Lc(i,0,1)}return Lc(t,e<0?0:e,n)}function tg(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=t||[];n.length<=e;)n.push(null);return n}function mu(t){return Object.prototype.toString.call(t).slice(8,-1)}function fE(t){for(var e=t.getNumberOfComponents(),n=0,r=0;r<t.getNumberOfTuples();++r){var a=Bn(t.getTuple(r),e);a>n&&(n=a)}return n}var gE={computeRange:Cp,createRangeHelper:uE,fastComputeRange:Lc,getDataType:mu,getMaxNorm:fE};function lE(t,e){e.classHierarchy.push("vtkDataArray");function n(){e.ranges=null,t.modified()}t.getElementComponentSize=function(){return e.values.BYTES_PER_ELEMENT},t.getComponent=function(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[r*e.numberOfComponents+a]},t.setComponent=function(r,a,i){i!==e.values[r*e.numberOfComponents+a]&&(e.values[r*e.numberOfComponents+a]=i,n())},t.getData=function(){return e.values},t.getRange=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,a=r<0?e.numberOfComponents:r,i=null;return e.ranges||(e.ranges=tg(e.ranges,e.numberOfComponents)),i=e.ranges[a],i?(e.rangeTuple[0]=i.min,e.rangeTuple[1]=i.max,e.rangeTuple):(i=Cp(e.values,r,e.numberOfComponents),e.ranges[a]=i,e.rangeTuple[0]=i.min,e.rangeTuple[1]=i.max,e.rangeTuple)},t.setRange=function(r,a){e.ranges||(e.ranges=tg(e.ranges,e.numberOfComponents));var i={min:r.min,max:r.max};return e.ranges[a]=i,e.rangeTuple[0]=i.min,e.rangeTuple[1]=i.max,e.rangeTuple},t.setTuple=function(r,a){for(var i=r*e.numberOfComponents,o=0;o<e.numberOfComponents;o++)e.values[i+o]=a[o]},t.getTuple=function(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:cE,i=e.numberOfComponents||1;a.length!==i&&(a.length=i);var o=r*i;if(i===1)a[0]=e.values[o];else if(i===2)a[0]=e.values[o],a[1]=e.values[o+1];else if(i===3)a[0]=e.values[o],a[1]=e.values[o+1],a[2]=e.values[o+2];else if(i===4)a[0]=e.values[o],a[1]=e.values[o+1],a[2]=e.values[o+2],a[3]=e.values[o+3];else for(var s=0;s<i;s++)a[s]=e.values[o+s];return a},t.getTupleLocation=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;return r*e.numberOfComponents},t.getNumberOfComponents=function(){return e.numberOfComponents},t.getNumberOfValues=function(){return e.values.length},t.getNumberOfTuples=function(){return e.values.length/e.numberOfComponents},t.getDataType=function(){return e.dataType},t.newClone=function(){return Sp({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents})},t.getName=function(){return e.name||(t.modified(),e.name="vtkDataArray".concat(t.getMTime())),e.name},t.setData=function(r,a){e.values=r,e.size=r.length,e.dataType=mu(r),a&&(e.numberOfComponents=a),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),n()},t.getState=function(){if(e.deleted)return null;var r=io(io({},e),{},{vtkClass:t.getClassName()});r.values=Array.from(r.values),delete r.buffer,Object.keys(r).forEach(function(i){r[i]||delete r[i]});var a={};return Object.keys(r).sort().forEach(function(i){a[i]=r[i]}),a.mtime&&delete a.mtime,a}}var vE={name:"",numberOfComponents:1,size:0,dataType:sE,rangeTuple:[0,0]};function wp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,vE,n),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");e.values?Array.isArray(e.values)&&(e.values=Vv(e.dataType,e.values)):e.values=Lo(e.dataType,e.size),e.values&&(e.size=e.values.length,e.dataType=mu(e.values)),Ge(t,e),No(t,e,["name","numberOfComponents"]),lE(t,e)}var Sp=ke(wp,"vtkDataArray"),Ve=io(io({newInstance:Sp,extend:wp},gE),hp),pE=E.vtkErrorMacro,hE=["Build","Render"];function dE(t,e){e.classHierarchy.push("vtkViewNode"),t.build=function(n){},t.render=function(n){},t.traverse=function(n){var r=n.getTraverseOperation(),a=t[r];if(a){a(n);return}t.apply(n,!0);for(var i=0;i<e.children.length;i++)e.children[i].traverse(n);t.apply(n,!1)},t.apply=function(n,r){var a=t[n.getOperation()];a&&a(r,n)},t.getViewNodeFor=function(n){if(e.renderable===n)return t;for(var r=0;r<e.children.length;++r){var a=e.children[r],i=a.getViewNodeFor(n);if(i)return i}},t.getFirstAncestorOfType=function(n){return e._parent?e._parent.isA(n)?e._parent:e._parent.getFirstAncestorOfType(n):null},t.addMissingNode=function(n){if(!!n){var r=e._renderableChildMap.get(n);if(r!==void 0)r.setVisited(!0);else{var a=t.createViewNode(n);a&&(a.setParent(t),a.setVisited(!0),e._renderableChildMap.set(n,a),e.children.push(a))}}},t.addMissingNodes=function(n){if(!(!n||!n.length))for(var r=0;r<n.length;++r){var a=n[r],i=e._renderableChildMap.get(a);if(i!==void 0)i.setVisited(!0);else{var o=t.createViewNode(a);o&&(o.setParent(t),o.setVisited(!0),e._renderableChildMap.set(a,o),e.children.push(o))}}},t.addMissingChildren=function(n){if(!(!n||!n.length))for(var r=0;r<n.length;++r){var a=n[r],i=e.children.indexOf(a);i===-1&&(a.setParent(t),e.children.push(a)),a.setVisited(!0)}},t.prepareNodes=function(){for(var n=0;n<e.children.length;++n)e.children[n].setVisited(!1)},t.setVisited=function(n){e.visited=n},t.removeUnusedNodes=function(){for(var n=null,r=0;r<e.children.length;++r){var a=e.children[r],i=a.getVisited();if(i)a.setVisited(!1);else{var o=a.getRenderable();o&&e._renderableChildMap.delete(o),n||(n=[]),n.push(a)}}n&&(e.children=e.children.filter(function(s){return!n.includes(s)}))},t.createViewNode=function(n){if(!e.myFactory)return pE("Cannot create view nodes without my own factory"),null;var r=e.myFactory.createNode(n);return r&&r.setRenderable(n),r}}var yE={renderable:null,myFactory:null,children:[],visited:!1};function Ep(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yE,n),E.obj(t,e),E.event(t,e,"event"),e._renderableChildMap=new Map,E.get(t,e,["visited"]),E.setGet(t,e,["_parent","renderable","myFactory"]),E.getArray(t,e,["children"]),E.moveToProtected(t,e,["parent"]),dE(t,e)}var TE=E.newInstance(Ep,"vtkViewNode"),Qe={newInstance:TE,extend:Ep,PASS_TYPES:hE};function mE(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=function(n){if(n.isDeleted())return null;for(var r=0,a=n.getClassName(r++),i=!1,o=Object.keys(e.overrides);a&&!i;)o.indexOf(a)!==-1?i=!0:a=n.getClassName(r++);if(!i)return null;var s=e.overrides[a]();return s.setMyFactory(t),s},t.registerOverride=function(n,r){e.overrides[n]=r}}var CE={};function xp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CE,n),E.obj(t,e),mE(t,e)}var wE=E.newInstance(xp,"vtkViewNodeFactory"),Cu={newInstance:wE,extend:xp},Op=Object.create(null);function yt(t,e){Op[t]=e}function SE(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}var EE={};function Mp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,EE,n),e.overrides=Op,Cu.extend(t,e,n),SE(t,e)}var xE=E.newInstance(Mp,"vtkOpenGLViewNodeFactory"),OE={newInstance:xE,extend:Mp};function ng(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function ME(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ng(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ng(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var un=Tu.Wrap,it=Tu.Filter,Le=Ve.VtkDataTypes,ys=Wn,Or=re,RE=Xa;function DE(t,e){var n=this;e.classHierarchy.push("vtkOpenGLTexture"),t.render=function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(c?e._openGLRenderWindow=c:(e.openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e.openGLRenderer.getParent()),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(it.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(it.LINEAR),t.setMagnificationFilter(it.LINEAR)):(t.setMinificationFilter(it.NEAREST),t.setMagnificationFilter(it.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(un.REPEAT),t.setWrapS(un.REPEAT),t.setWrapT(un.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(it.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(it.LINEAR_MIPMAP_LINEAR));var u=e.renderable.getCanvas();t.create2DFromRaw(u.width,u.height,4,Le.UNSIGNED_CHAR,u,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){var g=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(it.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw(g.width,g.height,4,Le.UNSIGNED_CHAR,g.data,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}var f=e.renderable.getInputData(0);if(f&&f.getPointData().getScalars()){for(var l=f.getExtent(),v=f.getPointData().getScalars(),p=[],d=0;d<e.renderable.getNumberOfInputPorts();++d){var h=e.renderable.getInputData(d),T=h?h.getPointData().getScalars().getData():null;T&&p.push(T)}e.renderable.getInterpolate()&&v.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(it.LINEAR_MIPMAP_LINEAR)),p.length%6===0?t.createCubeFromRaw(l[1]-l[0]+1,l[3]-l[2]+1,v.getNumberOfComponents(),v.getDataType(),p):t.create2DFromRaw(l[1]-l[0]+1,l[3]-l[2]+1,v.getNumberOfComponents(),v.getDataType(),v.getData()),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()},t.destroyTexture=function(){t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=function(){e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=function(){return e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1},t.activate=function(){e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=function(){e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=function(c){c&&e.handle&&(c.activateTexture(t),c.deactivateTexture(t),e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(c),e.shaderProgram=null)},t.bind=function(){e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=function(){var c=!1;if(e.context&&e.handle){var u=0;switch(e.target){case e.context.TEXTURE_2D:u=e.context.TEXTURE_BINDING_2D;break;default:RE("impossible case");break}var g=e.context.getIntegerv(u);c=g===e.handle}return c},t.sendParameters=function(){e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=function(c,u){return e.internalFormat||(e.internalFormat=t.getDefaultInternalFormat(c,u)),e.internalFormat||ys("Unable to find suitable internal format for T=".concat(c," NC= ").concat(u)),e.internalFormat},t.getDefaultInternalFormat=function(c,u){var g=0;return g=e._openGLRenderWindow.getDefaultTextureInternalFormat(c,u,!1),g||(g=n._openGLRenderWindow.getDefaultTextureInternalFormat(c,u,!0),g||(ys("Unsupported internal texture type!"),ys("Unable to find suitable internal format for T=".concat(c," NC= ").concat(u))),g)},t.setInternalFormat=function(c){c!==e.internalFormat&&(e.internalFormat=c,t.modified())},t.getFormat=function(c,u){return e.format=t.getDefaultFormat(c,u),e.format},t.getDefaultFormat=function(c,u){if(e._openGLRenderWindow.getWebgl2())switch(u){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(u){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=function(){e.format=0,e.internalFormat=0,e.openGLDataType=0},t.getDefaultDataType=function(c){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e._openGLRenderWindow.getWebgl2())switch(c){case Le.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(u&&Le.SHORT):return e.context.HALF_FLOAT;case(u&&Le.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case Le.FLOAT:case Le.VOID:default:return e.context.FLOAT}switch(c){case Le.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case Le.FLOAT:case Le.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{var g=e.context.getExtension("OES_texture_half_float");if(g&&e.context.getExtension("OES_texture_half_float_linear"))return g.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(c){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return e.openGLDataType||(e.openGLDataType=t.getDefaultDataType(c,u)),e.openGLDataType},t.getShiftAndScale=function(){var c=0,u=1;switch(e.openGLDataType){case e.context.BYTE:u=127.5,c=u-128;break;case e.context.UNSIGNED_BYTE:u=255,c=0;break;case e.context.SHORT:u=32767.5,c=u-32768;break;case e.context.UNSIGNED_SHORT:u=65536,c=0;break;case e.context.INT:u=21474836475e-1,c=u-2147483648;break;case e.context.UNSIGNED_INT:u=4294967295,c=0;break;case e.context.FLOAT:}return{shift:c,scale:u}},t.getOpenGLFilterMode=function(c){switch(c){case it.NEAREST:return e.context.NEAREST;case it.LINEAR:return e.context.LINEAR;case it.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case it.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case it.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case it.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=function(c){switch(c){case un.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case un.REPEAT:return e.context.REPEAT;case un.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}};function r(c,u){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,f=[],l=e.width*e.height*e.components;if(g&&(l*=e.depth),c!==Le.FLOAT&&e.openGLDataType===e.context.FLOAT)for(var v=0;v<u.length;v++)if(u[v]){var p=u[v].length>l?u[v].subarray(0,l):u[v];f.push(new Float32Array(p))}else f.push(null);if(c!==Le.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(var d=0;d<u.length;d++)if(u[d]){var h=u[d].length>l?u[d].subarray(0,l):u[d];f.push(new Uint8Array(h))}else f.push(null);var T=e.context.getExtension("OES_texture_half_float"),C=e._openGLRenderWindow.getWebgl2()?e.openGLDataType===e.context.HALF_FLOAT:T&&e.openGLDataType===T.HALF_FLOAT_OES;if(C)for(var m=0;m<u.length;m++)if(u[m]){for(var y=new Uint16Array(l),w=0;w<l;w++)y[w]=xr.toHalf(u[m][w]);f.push(y)}else f.push(null);if(f.length===0)for(var S=0;S<u.length;S++)f.push(u[S]);return f}function a(c){if(e._openGLRenderWindow.getWebgl2())return c;var u=[],g=e.width,f=e.height,l=e.components;if(c&&(!wa(g)||!wa(f)))for(var v=e.context.getExtension("OES_texture_half_float"),p=Fn(g),d=Fn(f),h=p*d*e.components,T=0;T<c.length;T++)if(c[T]!==null){var C=null,m=f/d,y=g/p,w=!1;e.openGLDataType===e.context.FLOAT?C=new Float32Array(h):v&&e.openGLDataType===v.HALF_FLOAT_OES?(C=new Uint16Array(h),w=!0):C=new Uint8Array(h);for(var S=0;S<d;S++){var O=S*p*l,M=S*m,R=Math.floor(M),D=Math.ceil(M);D>=f&&(D=f-1);var L=M-R,N=1-L;R=R*g*l,D=D*g*l;for(var U=0;U<p;U++){var b=U*l,G=U*y,P=Math.floor(G),z=Math.ceil(G);z>=g&&(z=g-1);var F=G-P;P*=l,z*=l;for(var V=0;V<l;V++)w?C[O+b+V]=xr.toHalf(xr.fromHalf(c[T][R+P+V])*N*(1-F)+xr.fromHalf(c[T][R+z+V])*N*F+xr.fromHalf(c[T][D+P+V])*L*(1-F)+xr.fromHalf(c[T][D+z+V])*L*F):C[O+b+V]=c[T][R+P+V]*N*(1-F)+c[T][R+z+V]*N*F+c[T][D+P+V]*L*(1-F)+c[T][D+z+V]*L*F}}u.push(C),e.width=p,e.height=d}else u.push(null);if(u.length===0)for(var B=0;B<c.length;B++)u.push(c[B]);return u}t.create2DFromRaw=function(c,u,g,f,l){var v=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(t.getOpenGLDataType(f),t.getInternalFormat(f,g),t.getFormat(f,g),!e.internalFormat||!e.format||!e.openGLDataType)return Or("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=g,e.width=c,e.height=u,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();var p=[l],d=r(f,p),h=a(d);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,v),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,h[0]),e.generateMipmap&&e.context.generateMipmap(e.target),v&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),t.deactivate(),!0},t.createCubeFromRaw=function(c,u,g,f,l){if(t.getOpenGLDataType(f),t.getInternalFormat(f,g),t.getFormat(f,g),!e.internalFormat||!e.format||!e.openGLDataType)return Or("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=g,e.width=c,e.height=u,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=l.length/6-1,t.createTexture(),t.bind();for(var v=r(f,l),p=a(v),d=[],h=e.width,T=e.height,C=0;C<p.length;C++){C%6===0&&C!==0&&(h/=2,T/=2),d[C]=Lo(f,T*h*e.components);for(var m=0;m<T;++m){var y=m*h*e.components,w=(T-m-1)*h*e.components;d[C].set(p[C].slice(w,w+h*e.components),y)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1);for(var S=0;S<6;S++)for(var O=0,M=e.width,R=e.height;M>=1&&R>=1;){var D=null;O<=e.maxLevel&&(D=d[6*O+S]),e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+S,O,e.internalFormat,M,R,0,e.format,e.openGLDataType,D),O++,M/=2,R/=2}return t.deactivate(),!0},t.createDepthFromRaw=function(c,u,g,f){return t.getOpenGLDataType(g),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?g===Le.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(Or("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=c,e.height=u,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,f),e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0)},t.create2DFromImage=function(c){if(t.getOpenGLDataType(Le.UNSIGNED_CHAR),t.getInternalFormat(Le.UNSIGNED_CHAR,4),t.getFormat(Le.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return Or("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.width=c.width,e.height=c.height,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1);var u=!wa(c.width)||!wa(c.height),g=document.createElement("canvas");g.width=u?Fn(c.width):c.width,g.height=u?Fn(c.height):c.height;var f=g.getContext("2d");f.translate(0,g.height),f.scale(1,-1),f.drawImage(c,0,0,c.width,c.height,0,0,g.width,g.height);var l=g;return e.context.texImage2D(e.target,0,e.internalFormat,e.format,e.openGLDataType,l),e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0};function i(c,u,g){for(var f=[],l=[],v=0;v<c;++v)f[v]=g[v],l[v]=g[v];for(var p=0,d=0;d<u;++d)for(var h=0;h<c;++h)g[p]<f[h]&&(f[h]=g[p]),g[p]>l[h]&&(l[h]=g[p]),p++;for(var T=[],C=[],m=0;m<c;++m)f[m]===l[m]&&(l[m]=f[m]+1),T[m]=f[m],C[m]=l[m]-f[m];return{scale:C,offset:T}}function o(c,u){for(var g=0;g<c.length;g++){var f=c[g],l=u[g]+f;if(f<-2048||f>2048||l<-2048||l>2048)return!1}return!0}function s(c,u,g,f){var l=!0;t.getOpenGLDataType(c,l);var v=e.context.getExtension("OES_texture_half_float"),p=e._openGLRenderWindow.getWebgl2()?e.openGLDataType===e.context.HALF_FLOAT:v&&e.openGLDataType===v.HALF_FLOAT_OES;return!(!p||!o(u,g)&&!f)}t.create3DFromRaw=function(c,u,g,f,l,v){var p=!0;if(t.getOpenGLDataType(l,p),t.getInternalFormat(l,f),t.getFormat(l,f),!e.internalFormat||!e.format||!e.openGLDataType)return Or("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=f,e.width=c,e.height=u,e.depth=g,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();var d=[v],h=!0,T=r(l,d,h),C=a(T);return e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,C[0]),e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0},t.create3DFilterableFromRaw=function(c,u,g,f,l,v){for(var p=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1,d=c*u*g,h=[],T=[],C=0;C<f;++C)h[C]=0,T[C]=1;e.volumeInfo={scale:T,offset:h,width:c,height:u,depth:g};var m=i(f,d,v),y=m.offset,w=m.scale;e.volumeInfo.dataComputedScale=w,e.volumeInfo.dataComputedOffset=y;var S=s(l,y,w,p);if(e._openGLRenderWindow.getWebgl2()){if(l===Le.FLOAT||S&&(l===Le.SHORT||l===Le.UNSIGNED_SHORT))return t.create3DFromRaw(c,u,g,f,l,v);if(l===Le.UNSIGNED_CHAR){for(var O=0;O<f;++O)e.volumeInfo.scale[O]=255;return t.create3DFromRaw(c,u,g,f,l,v)}var M=new Float32Array(d*f);e.volumeInfo.offset=y,e.volumeInfo.scale=w;for(var R=0,D=w.map(function(et){return 1/et}),L=0;L<d;L++)for(var N=0;N<f;N++)M[R]=(v[R]-y[N])*D[N],R++;return t.create3DFromRaw(c,u,g,f,Le.FLOAT,M)}var U=i(f,d,v),b=function(tt,Ie,gt,_t,zt){tt[Ie]=gt},G=Le.UNSIGNED_CHAR;if(l===Le.UNSIGNED_CHAR)for(var P=0;P<f;++P)U.offset[P]=0,U.scale[P]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(G=Le.FLOAT,b=function(tt,Ie,gt,_t,zt){tt[Ie]=(gt-_t)/zt}):(G=Le.UNSIGNED_CHAR,b=function(tt,Ie,gt,_t,zt){tt[Ie]=255*(gt-_t)/zt});if(t.getOpenGLDataType(G),t.getInternalFormat(G,f),t.getFormat(G,f),!e.internalFormat||!e.format||!e.openGLDataType)return Or("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=f,e.depth=1,e.numberOfDimensions=2;var z=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);z>4096&&(G===Le.FLOAT||f>=3)&&(z=4096);var F=1,V=1;d>z*z&&(F=Math.ceil(Math.sqrt(d/(z*z))),V=F);var B=Math.sqrt(d)/F;B=Fn(B);var W=Math.floor(B*F/c),I=Math.ceil(g/W),$=Fn(u*I/V);e.width=B,e.height=$,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=W,e.volumeInfo.yreps=I,e.volumeInfo.xstride=F,e.volumeInfo.ystride=V,e.volumeInfo.offset=U.offset,e.volumeInfo.scale=U.scale;var Q,H=B*$*f;G===Le.FLOAT?Q=new Float32Array(H):Q=new Uint8Array(H);for(var he=0,j=Math.floor(c/F),Ee=Math.floor(u/V),de=0;de<I;de++)for(var oe=Math.min(W,g-de*W),Z=f*(e.width-oe*Math.floor(c/F)),se=0;se<Ee;se++){for(var X=0;X<oe;X++)for(var ae=f*((de*W+X)*c*u+V*se*c),ge=0;ge<j;ge++)for(var J=0;J<f;J++)b(Q,he,v[ae+F*ge*f+J],U.offset[J],U.scale[J]),he++;he+=Z}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,Q),t.deactivate(),!0},t.setOpenGLRenderWindow=function(c){e._openGLRenderWindow!==c&&(t.releaseGraphicsResources(),e._openGLRenderWindow=c,e.context=null,c&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=function(c){return c&&c.isCurrent()?c.getIntegerv(c.MAX_TEXTURE_SIZE):-1}}var VE={_openGLRenderWindow:null,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:un.CLAMP_TO_EDGE,wrapT:un.CLAMP_TO_EDGE,wrapR:un.CLAMP_TO_EDGE,minificationFilter:it.NEAREST,magnificationFilter:it.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1};function Rp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VE,n),Qe.extend(t,e,n),e.sendParametersTime={},Ge(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},Ge(e.textureBuildTime,{mtime:0}),No(t,e,["format","openGLDataType"]),at(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap"]),Et(t,e,["width","height","volumeInfo","components","handle","target"]),DE(t,e)}var Dp=ke(Rp,"vtkOpenGLTexture"),st=ME({newInstance:Dp,extend:Rp},Tu);yt("vtkTexture",Dp);function LE(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=function(){return e.context.FRAMEBUFFER},t.saveCurrentBindingsAndBuffers=function(n){var r=typeof n<"u"?n:t.getBothMode();t.saveCurrentBindings(r),t.saveCurrentBuffers(r)},t.saveCurrentBindings=function(n){if(!e.context){re("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}var r=e.context;e.previousDrawBinding=r.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=function(n){},t.restorePreviousBindingsAndBuffers=function(n){var r=typeof n<"u"?n:t.getBothMode();t.restorePreviousBindings(r),t.restorePreviousBuffers(r)},t.restorePreviousBindings=function(n){if(!e.context){re("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}var r=e.context;r.bindFramebuffer(r.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=function(n){},t.bind=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=n;r===null&&(r=e.context.FRAMEBUFFER),e.context.bindFramebuffer(r,e.glFramebuffer);for(var a=0;a<e.colorBuffers.length;a++)e.colorBuffers[a].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=function(n,r){if(!e.context){re("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=n,e.glFramebuffer.height=r},t.setColorBuffer=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=e.context;if(!a){re("you must set the OpenGLRenderWindow before calling setColorBuffer");return}var i=a.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())i+=r;else{re("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[r]=n,a.framebufferTexture2D(a.FRAMEBUFFER,i,a.TEXTURE_2D,n.getHandle(),0)},t.removeColorBuffer=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=e.context;if(!r){re("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}var a=r.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())a+=n;else{re("Using multiple framebuffer attachments requires WebGL 2");return}r.framebufferTexture2D(r.FRAMEBUFFER,a,r.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(n,1)},t.setDepthBuffer=function(n){if(!e.context){re("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){var r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,n.getHandle(),0)}else re("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=function(){if(!e.context){re("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){var n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,null,0)}else re("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=function(){return e.glFramebuffer},t.setOpenGLRenderWindow=function(n){e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=function(){e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=function(){var n=[0,0];return e.glFramebuffer!==null&&(n[0]=e.glFramebuffer.width,n[1]=e.glFramebuffer.height),n},t.populateFramebuffer=function(){if(!e.context){re("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();var n=e.context,r=st.newInstance();r.setOpenGLRenderWindow(e._openGLRenderWindow),r.setMinificationFilter(xe.LINEAR),r.setMagnificationFilter(xe.LINEAR),r.create2DFromRaw(e.glFramebuffer.width,e.glFramebuffer.height,4,Xe.UNSIGNED_CHAR,null),t.setColorBuffer(r),e.depthTexture=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,e.depthTexture),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e.depthTexture)},t.getColorTexture=function(){return e.colorBuffers[0]}}var NE={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function Vp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NE,n),Ge(t,e),e.colorBuffers&&re("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],Ya(t,e,["colorBuffers"]),LE(t,e)}var FE=ke(Vp,"vtkFramebuffer"),_o={newInstance:FE,extend:Vp};function _E(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=function(){return e.currentOperation},t.setCurrentOperation=function(n){e.currentOperation=n,e.currentTraverseOperation="traverse".concat(E.capitalize(e.currentOperation))},t.getTraverseOperation=function(){return e.currentTraverseOperation},t.traverse=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e.currentParent=r,e.preDelegateOperations.forEach(function(a){t.setCurrentOperation(a),n.traverse(t)}),e.delegates.forEach(function(a){a.traverse(n,t)}),e.postDelegateOperations.forEach(function(a){t.setCurrentOperation(a),n.traverse(t)}))}}var bE={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function Lp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bE,n),E.obj(t,e),E.get(t,e,["currentOperation"]),E.setGet(t,e,["delegates","currentParent","preDelegateOperations","postDelegateOperations"]),_E(t,e)}var kE=E.newInstance(Lp,"vtkRenderPass"),wu={newInstance:kE,extend:Lp},dn={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2},Np={ObjectType:dn};function rg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function ag(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?rg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Ui=Np.ObjectType,UE={};function BE(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function n(s){switch(s){case Ui.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case Ui.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case Ui.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}var r=null,a=null,i=!0,o="";t.getType=function(){return r},t.setType=function(s){r=s},t.getHandle=function(){return a},t.isReady=function(){return i===!1},t.generateBuffer=function(s){var c=n(s);return a===null&&(a=e.context.createBuffer(),r=s),n(r)===c},t.upload=function(s,c){var u=t.generateBuffer(c);return u?(e.context.bindBuffer(n(r),a),e.context.bufferData(n(r),s,e.context.STATIC_DRAW),i=!1,!0):(o="Trying to upload array buffer to incompatible buffer.",!1)},t.bind=function(){return a?(e.context.bindBuffer(n(r),a),!0):!1},t.release=function(){return a?(e.context.bindBuffer(n(r),null),!0):!1},t.releaseGraphicsResources=function(){a!==null&&(e.context.bindBuffer(n(r),null),e.context.deleteBuffer(a),a=null)},t.setOpenGLRenderWindow=function(s){e._openGLRenderWindow!==s&&(t.releaseGraphicsResources(),e._openGLRenderWindow=s,e.context=null,s&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=function(){return o}}var GE={objectType:Ui.ARRAY_BUFFER,context:null};function Fp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GE,n),E.obj(t,e),E.get(t,e,["_openGLRenderWindow"]),E.moveToProtected(t,e,["openGLRenderWindow"]),BE(t,e)}var AE=E.newInstance(Fp),ln=ag(ag({newInstance:AE,extend:Fp},UE),Np),_p={FLAT:0,GOURAUD:1,PHONG:2},Zt={POINTS:0,WIREFRAME:1,SURFACE:2},IE=_p,Su={Shading:_p,Representation:Zt,Interpolation:IE},ig=E.vtkErrorMacro;function PE(t,e){var n=new Float64Array(3);X0(n,e);var r=new Float64Array(16);return I0(r,ur(),t,n),r}function WE(t,e){return t===null||e===null?!1:!(fc(t,[0,0,0])&&fc(e,[1,1,1]))}function zE(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(dn.ARRAY_BUFFER),t.createVBO=function(n,r,a,i){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!n.getData()||!n.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];var s=i.points.getData(),c=null,u=null,g=null,f=i.colors?i.colors.getNumberOfComponents():0,l=i.tcoords?i.tcoords.getNumberOfComponents():0;i.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,c=i.normals.getData()),i.customAttributes&&i.customAttributes.forEach(function(se){se&&(e.customData.push({data:se.getData(),offset:4*e.blockSize,components:se.getNumberOfComponents(),name:se.getName()}),e.blockSize+=se.getNumberOfComponents())}),i.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=l,e.blockSize+=l,u=i.tcoords.getData()),i.colors?(e.colorComponents=i.colors.getNumberOfComponents(),e.colorOffset=0,g=i.colors.getData(),e.colorBO||(e.colorBO=ln.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;var v=0,p=0,d=0,h=0,T=0,C=0,m,y={anythingToPoints:function(X,ae,ge){for(var J=0;J<X;++J)m(ae[ge+J])},linesToWireframe:function(X,ae,ge){for(var J=0;J<X-1;++J)m(ae[ge+J]),m(ae[ge+J+1])},polysToWireframe:function(X,ae,ge){if(X>2)for(var J=0;J<X;++J)m(ae[ge+J]),m(ae[ge+(J+1)%X])},stripsToWireframe:function(X,ae,ge){if(X>2){for(var J=0;J<X-1;++J)m(ae[ge+J]),m(ae[ge+J+1]);for(var et=0;et<X-2;et++)m(ae[ge+et]),m(ae[ge+et+2])}},polysToSurface:function(X,ae,ge){for(var J=0;J<X-2;J++)m(ae[ge+0]),m(ae[ge+J+1]),m(ae[ge+J+2])},stripsToSurface:function(X,ae,ge){for(var J=0;J<X-2;J++)m(ae[ge+J]),m(ae[ge+J+1+J%2]),m(ae[ge+J+1+(J+1)%2])}},w={anythingToPoints:function(X,ae){return X},linesToWireframe:function(X,ae){return X>1?(X-1)*2:0},polysToWireframe:function(X,ae){return X>2?X*2:0},stripsToWireframe:function(X,ae){return X>2?X*4-6:0},polysToSurface:function(X,ae){return X>2?(X-2)*3:0},stripsToSurface:function(X,ae,ge){return X>2?(X-2)*3:0}},S=null,O=null;a===Zt.POINTS||r==="verts"?(S=y.anythingToPoints,O=w.anythingToPoints):a===Zt.WIREFRAME||r==="lines"?(S=y["".concat(r,"ToWireframe")],O=w["".concat(r,"ToWireframe")]):(S=y["".concat(r,"ToSurface")],O=w["".concat(r,"ToSurface")]);for(var M=n.getData(),R=M.length,D=0,L=0;L<R;)D+=O(M[L],M),L+=M[L]+1;var N=null,U=new Float32Array(D*e.blockSize);g&&(N=new Uint8Array(D*4));for(var b=0,G=0,P=0,z=0,F=0;F<3;++F){var V=i.points.getRange(F),B=V[1]-V[0];P+=B*B;var W=.5*(V[1]+V[0]);z+=W*W}var I=P>0&&(Math.abs(z)/P>1e6||Math.abs(Math.log10(P))>3||P===0&&z>1e6);if(I){for(var $=new Float64Array(3),Q=new Float64Array(3),H=0;H<3;++H){var he=i.points.getRange(H),j=he[1]-he[0];$[H]=.5*(he[1]+he[0]),Q[H]=j>0?1/j:1}t.setCoordShiftAndScale($,Q)}else e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null);if(o)if(!o.points&&!o.cells)o.points=new Int32Array(D),o.cells=new Int32Array(D);else{var Ee=new Int32Array(D+o.points.length);Ee.set(o.points),o.points=Ee;var de=new Int32Array(D+o.points.length);de.set(o.cells),o.cells=de}var oe=i.vertexOffset;m=function(X){if(o&&(o.points[oe]=X,o.cells[oe]=C),++oe,v=X*3,e.coordShiftAndScaleEnabled?(U[b++]=(s[v++]-e.coordShift[0])*e.coordScale[0],U[b++]=(s[v++]-e.coordShift[1])*e.coordScale[1],U[b++]=(s[v++]-e.coordShift[2])*e.coordScale[2]):(U[b++]=s[v++],U[b++]=s[v++],U[b++]=s[v++]),c!==null&&(i.haveCellNormals?p=(C+i.cellOffset)*3:p=X*3,U[b++]=c[p++],U[b++]=c[p++],U[b++]=c[p++]),e.customData.forEach(function(ge){T=X*ge.components;for(var J=0;J<ge.components;++J)U[b++]=ge.data[T++]}),u!==null){d=X*l;for(var ae=0;ae<l;++ae)U[b++]=u[d++]}g!==null&&(i.haveCellScalars?h=(C+i.cellOffset)*f:h=X*f,N[G++]=g[h++],N[G++]=g[h++],N[G++]=g[h++],N[G++]=f===4?g[h++]:255)};for(var Z=0;Z<R;)S(M[Z],M,Z+1),Z+=M[Z]+1,C++;return e.elementCount=D,t.upload(U,dn.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(N,dn.ARRAY_BUFFER)),C},t.setCoordShiftAndScale=function(n,r){if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){ig("Wrong type for coordShift, expected vec3 or null");return}if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){ig("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||n===null||!gc(n,e.coordShift))&&(e.coordShift=n),(e.coordScale===null||r===null||!gc(r,e.coordScale))&&(e.coordScale=r),e.coordShiftAndScaleEnabled=WE(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=PE(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}var $E={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function bp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$E,n),ln.extend(t,e,n),E.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),E.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),zE(t,e)}var jE=E.newInstance(bp),HE={newInstance:jE,extend:bp},KE=E.vtkErrorMacro;function qE(t,e){e.classHierarchy.push("vtkShader"),t.compile=function(){var n=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":n=e.context.FRAGMENT_SHADER;break;case"Vertex":default:n=e.context.VERTEX_SHADER;break}e.handle=e.context.createShader(n),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle);var r=e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS);if(!r){var a=e.context.getShaderInfoLog(e.handle);return KE("Error compiling shader '".concat(e.source,"': ").concat(a)),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=function(){e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}var XE={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function kp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XE,n),E.obj(t,e),E.setGet(t,e,["shaderType","source","error","handle","context"]),qE(t,e)}var YE=E.newInstance(kp,"vtkShader"),Ts={newInstance:YE,extend:kp},$t=E.vtkErrorMacro;function ZE(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=Array.isArray(n)?n.join(`
`):n,i=!1;t.search(e)!==-1&&(i=!0);var o="";r&&(o="g");var s=new RegExp(e,o),c=t.replace(s,a);return{replace:i,result:c}}function JE(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=function(){return e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?($t(e.error),0):t.link()?(t.setCompiled(!0),1):($t("Links failed: ".concat(e.error)),0):($t(e.fragmentShader.getSource().split(`
`).map(function(n,r){return"".concat(r,": ").concat(n)}).join(`
`)),$t(e.fragmentShader.getError()),0):($t(e.vertexShader.getSource().split(`
`).map(function(n,r){return"".concat(r,": ").concat(n)}).join(`
`)),$t(e.vertexShader.getError()),0)},t.cleanup=function(){e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0)},t.bind=function(){return!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0)},t.isBound=function(){return!!e.bound},t.release=function(){e.context.useProgram(null),t.setBound(!1)},t.setContext=function(n){e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.link=function(){if(e.inked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;e.uniformLocs={},e.context.linkProgram(e.handle);var n=e.context.getProgramParameter(e.handle,e.context.LINK_STATUS);if(!n){var r=e.context.getProgramInfoLog(e.handle);return $t("Error linking shader ".concat(r)),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=function(n,r){var a=t.findUniform(n);if(a===-1)return e.error="Could not set uniform ".concat(n," . No such uniform."),!1;var i=new Float32Array(r);return e.context.uniformMatrix4fv(a,!1,i),!0},t.setUniformMatrix3x3=function(n,r){var a=t.findUniform(n);if(a===-1)return e.error="Could not set uniform ".concat(n," . No such uniform."),!1;var i=new Float32Array(r);return e.context.uniformMatrix3fv(a,!1,i),!0},t.setUniformf=function(n,r){var a=t.findUniform(n);return a===-1?(e.error="Could not set uniform ".concat(n," . No such uniform."),!1):(e.context.uniform1f(a,r),!0)},t.setUniformfv=function(n,r){var a=t.findUniform(n);return a===-1?(e.error="Could not set uniform ".concat(n," . No such uniform."),!1):(e.context.uniform1fv(a,r),!0)},t.setUniformi=function(n,r){var a=t.findUniform(n);return a===-1?(e.error="Could not set uniform ".concat(n," . No such uniform."),!1):(e.context.uniform1i(a,r),!0)},t.setUniformiv=function(n,r){var a=t.findUniform(n);return a===-1?(e.error="Could not set uniform ".concat(n," . No such uniform."),!1):(e.context.uniform1iv(a,r),!0)},t.setUniform2f=function(n,r,a){var i=t.findUniform(n);if(i===-1)return e.error="Could not set uniform ".concat(n," . No such uniform."),!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(i,r,a),!0},t.setUniform2fv=function(n,r){var a=t.findUniform(n);return a===-1?(e.error="Could not set uniform ".concat(n," . No such uniform."),!1):(e.context.uniform2fv(a,r),!0)},t.setUniform2i=function(n,r,a){var i=t.findUniform(n);if(i===-1)return e.error="Could not set uniform ".concat(n," . No such uniform."),!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(i,r,a),!0},t.setUniform2iv=function(n,r){var a=t.findUniform(n);return a===-1?(e.error="Could not set uniform ".concat(n," . No such uniform."),!1):(e.context.uniform2iv(a,r),!0)},t.setUniform3f=function(n,r,a,i){var o=t.findUniform(n);if(o===-1)return e.error="Could not set uniform ".concat(n," . No such uniform."),!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(o,r,a,i),!0},t.setUniform3fArray=function(n,r){var a=t.findUniform(n);if(a===-1)return e.error="Could not set uniform ".concat(n," . No such uniform."),!1;if(!Array.isArray(r)||r.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(a,r[0],r[1],r[2]),!0},t.setUniform3fv=function(n,r){var a=t.findUniform(n);return a===-1?(e.error="Could not set uniform ".concat(n," . No such uniform."),!1):(e.context.uniform3fv(a,r),!0)},t.setUniform3i=function(n){var r=t.findUniform(n);if(r===-1)return e.error="Could not set uniform ".concat(n," . No such uniform."),!1;for(var a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];var s=i;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(r,s[0],s[1],s[2]),!0},t.setUniform3iv=function(n,r){var a=t.findUniform(n);return a===-1?(e.error="Could not set uniform ".concat(n," . No such uniform."),!1):(e.context.uniform3iv(a,r),!0)},t.setUniform4f=function(n){var r=t.findUniform(n);if(r===-1)return e.error="Could not set uniform ".concat(n," . No such uniform."),!1;for(var a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];var s=i;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(r,s[0],s[1],s[2],s[3]),!0},t.setUniform4fv=function(n,r){var a=t.findUniform(n);return a===-1?(e.error="Could not set uniform ".concat(n," . No such uniform."),!1):(e.context.uniform4fv(a,r),!0)},t.setUniform4i=function(n){var r=t.findUniform(n);if(r===-1)return e.error="Could not set uniform ".concat(n," . No such uniform."),!1;for(var a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];var s=i;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(r,s[0],s[1],s[2],s[3]),!0},t.setUniform4iv=function(n,r){var a=t.findUniform(n);return a===-1?(e.error="Could not set uniform ".concat(n," . No such uniform."),!1):(e.context.uniform4iv(a,r),!0)},t.findUniform=function(n){if(!n||!e.linked)return-1;var r=e.uniformLocs[n];return r!==void 0?r:(r=e.context.getUniformLocation(e.handle,n),r===null?(e.error="Uniform ".concat(n," not found in current shader program."),e.uniformLocs[n]=-1,-1):(e.uniformLocs[n]=r,r))},t.isUniformUsed=function(n){if(!n)return!1;var r=e.uniformLocs[n];return r!==void 0?r!==null:e.linked?(r=e.context.getUniformLocation(e.handle,n),e.uniformLocs[n]=r,r!==null):($t("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=function(n){if(!n)return!1;var r=Object.keys(e.attributeLocs).indexOf(n);return r!==-1?!0:e.linked?(r=e.context.getAttribLocation(e.handle,n),r===-1?!1:(e.attributeLocs[n]=r,!0)):($t("attempt to find uniform when the shader program is not linked"),!1)},t.attachShader=function(n){if(n.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){var r=e.context.createProgram();if(r===0)return e.error="Could not create shader program.",!1;e.handle=r,e.linked=!1}return n.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.comntext.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=n.getHandle()),n.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=n.getHandle()),e.context.attachShader(e.handle,n.getHandle()),t.setLinked(!1),!0},t.detachShader=function(n){if(n.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),n.getShaderType()){case"Vertex":return e.vertexShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=function(n){e.context=n,e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.setLastCameraMTime=function(n){e.lastCameraMTime=n}}var QE={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function Up(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QE,n),e.attributesLocs={},e.uniformLocs={},e.vertexShader=Ts.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=Ts.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=Ts.newInstance(),e.geometryShader.setShaderType("Geometry"),E.obj(t,e),E.get(t,e,["lastCameraMTime"]),E.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),JE(t,e)}var ex=E.newInstance(Up,"vtkShaderProgram"),_={newInstance:ex,extend:Up,substitute:ZE};function tx(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=function(){},t.initialize=function(){e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=function(){return e.handleVAO!==0||e.supported===!1},t.bind=function(){if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady())for(var n=e.context,r=0;r<e.buffers.length;++r){var a=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,a.buffer);for(var i=0;i<a.attributes.length;++i)for(var o=a.attributes[i],s=o.isMatrix?o.size:1,c=0;c<s;++c)n.enableVertexAttribArray(o.index+c),n.vertexAttribPointer(o.index+c,o.size,o.type,o.normalize,o.stride,o.offset+o.stride*c/o.size),o.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(o.index+c,1):n.vertexAttribDivisor(o.index+c,1))}},t.release=function(){if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady())for(var n=e.context,r=0;r<e.buffers.length;++r){var a=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,a.buffer);for(var i=0;i<a.attributes.length;++i)for(var o=a.attributes[i],s=o.isMatrix?o.size:1,c=0;c<s;++c)n.enableVertexAttribArray(o.index+c),n.vertexAttribPointer(o.index+c,o.size,o.type,o.normalize,o.stride,o.offset+o.stride*c/o.size),o.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(o.index+c,0):n.vertexAttribDivisor(o.index+c,0)),n.disableVertexAttribArray(o.index+c)}},t.shaderProgramChanged=function(){t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=function(){t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=function(n,r,a,i,o,s,c,u){return t.addAttributeArrayWithDivisor(n,r,a,i,o,s,c,u,0,!1)},t.addAttributeArrayWithDivisor=function(n,r,a,i,o,s,c,u,g,f){if(!n||!n.isBound()||r.getHandle()===0||r.getType()!==dn.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=n.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==n.getHandle()))return!1;var l=e.context,v={};if(v.name=a,v.index=l.getAttribLocation(e.handleProgram,a),v.offset=i,v.stride=o,v.type=s,v.size=c,v.normalize=u,v.isMatrix=f,v.divisor=g,v.Index===-1)return!1;if(r.bind(),l.enableVertexAttribArray(v.index),l.vertexAttribPointer(v.index,v.size,v.type,v.normalize,v.stride,v.offset),g>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(v.index,1):l.vertexAttribDivisor(v.index,1)),v.buffer=r.getHandle(),!e.supported){for(var p=!1,d=0;d<e.buffers.length;++d){var h=e.buffers[d];if(h.buffer===v.buffer){p=!0;for(var T=!1,C=0;C<h.attributes.length;++C){var m=h.attributes[C];m.name===a&&(T=!0,h.attributes[C]=v)}T||h.attributes.push(v)}}p||e.buffers.push({buffer:v.buffer,attributes:[v]})}return!0},t.addAttributeMatrixWithDivisor=function(n,r,a,i,o,s,c,u,g){var f=t.addAttributeArrayWithDivisor(n,r,a,i,o,s,c,u,g,!0);if(!f)return f;for(var l=e.context,v=l.getAttribLocation(e.handleProgram,a),p=1;p<c;p++)l.enableVertexAttribArray(v+p),l.vertexAttribPointer(v+p,c,s,u,o,i+o*p/c),g>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(v+p,1):l.vertexAttribDivisor(v+p,1));return!0},t.removeAttributeArray=function(n){if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(var r=0;r<e.buffers.length;++r)for(var a=e.buffers[r],i=0;i<a.attributes.length;++i){var o=a.attributes[i];if(o.name===n)return a.attributes.splice(i,1),a.attributes.length||e.buffers.splice(r,1),!0}return!0},t.setOpenGLRenderWindow=function(n){e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}var nx={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function Bp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nx,n),e.buffers=[],E.obj(t,e),E.get(t,e,["supported"]),E.setGet(t,e,["forceEmulation"]),tx(t,e)}var rx=E.newInstance(Bp,"vtkOpenGLVertexArrayObject"),Eu={newInstance:rx,extend:Bp},Vn={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function ax(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=function(n){e.context=n.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(n),e.CABO.setOpenGLRenderWindow(n)},t.releaseGraphicsResources=function(n){e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=function(n,r,a,i){if(e.CABO.getElementCount()){var o=t.getOpenGLMode(a),s=t.haveWideLines(n,r),c=e.context,u=c.getParameter(c.DEPTH_WRITEMASK);e.pointPicking&&c.depthMask(!1);var g=o===c.LINES;g&&s?(t.updateShaders(n,r,i),c.drawArraysInstanced(o,0,e.CABO.getElementCount(),2*Math.ceil(r.getProperty().getLineWidth()))):(c.lineWidth(r.getProperty().getLineWidth()),t.updateShaders(n,r,i),c.drawArrays(o,0,e.CABO.getElementCount()),c.lineWidth(1));var f=(o===c.POINTS?1:0)||(o===c.LINES?2:3);return e.pointPicking&&c.depthMask(u),e.CABO.getElementCount()/f}return 0},t.getOpenGLMode=function(n){if(e.pointPicking)return e.context.POINTS;var r=e.primitiveType;return n===Zt.POINTS||r===Vn.Points?e.context.POINTS:n===Zt.WIREFRAME||r===Vn.Lines||r===Vn.TrisEdges||r===Vn.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=function(n,r){return r.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=r.getProperty().getLineWidth()):!1},t.getNeedToRebuildShaders=function(n,r,a){return!!(a.getNeedToRebuildShaders(t,n,r)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<a.getMTime()||t.getShaderSourceTime().getMTime()<r.getMTime())},t.updateShaders=function(n,r,a){if(t.getNeedToRebuildShaders(n,r,a)){var i={Vertex:null,Fragment:null,Geometry:null};a.buildShaders(i,n,r);var o=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(i.Vertex,i.Fragment,i.Geometry);o!==t.getProgram()&&(t.setProgram(o),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),a.setMapperShaderParameters(t,n,r),a.setPropertyShaderParameters(t,n,r),a.setCameraShaderParameters(t,n,r),a.setLightingShaderParameters(t,n,r),a.invokeShaderCallbacks(t,n,r)},t.setMapperShaderParameters=function(n,r,a){if(t.haveWideLines(n,r)){t.getProgram().setUniform2f("viewportSize",a.usize,a.vsize);var i=parseFloat(r.getProperty().getLineWidth()),o=i/2;t.getProgram().setUniformf("lineWidthStepSize",i/Math.ceil(i)),t.getProgram().setUniformf("halfLineWidth",o)}e.primitiveType===Vn.Points||r.getProperty().getRepresentation()===Zt.POINTS?t.getProgram().setUniformf("pointSize",r.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=function(n,r,a){var i=n.Vertex;i=_.substitute(i,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,i=_.substitute(i,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(a.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(r,a)&&(i=_.substitute(i,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,i=_.substitute(i,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),n.Vertex=i},t.getPointPickingPrimitiveSize=function(){return e.primitiveType===Vn.Points?2:e.primitiveType===Vn.Lines?4:6}}var ix={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function Gp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ix,n),E.obj(t,e),e.shaderSourceTime={},E.obj(e.shaderSourceTime),e.attributeUpdateTime={},E.obj(e.attributeUpdateTime),E.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=_.newInstance(),e.VAO=Eu.newInstance(),e.CABO=HE.newInstance(),ax(t,e)}var ox=E.newInstance(Gp),aa={newInstance:ox,extend:Gp,primTypes:Vn};function og(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function sx(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?og(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):og(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var xa=Su.Representation,Oa=Su.Interpolation;function sg(t){return function(){return E.vtkErrorMacro("vtkProperty::".concat(t," - NOT IMPLEMENTED"))}}function cx(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=function(n,r,a){Array.isArray(n)?(e.color[0]!==n[0]||e.color[1]!==n[1]||e.color[2]!==n[2])&&(e.color[0]=n[0],e.color[1]=n[1],e.color[2]=n[2],t.modified()):(e.color[0]!==n||e.color[1]!==r||e.color[2]!==a)&&(e.color[0]=n,e.color[1]=r,e.color[2]=a,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=sg("ComputeCompositeColor"),t.getColor=function(){var n=0;e.ambient+e.diffuse+e.specular>0&&(n=1/(e.ambient+e.diffuse+e.specular));for(var r=0;r<3;r++)e.color[r]=n*(e.ambient*e.ambientColor[r]+e.diffuse*e.diffuseColor[r]+e.specular*e.specularColor[r]);return[].concat(e.color)},t.addShaderVariable=sg("AddShaderVariable"),t.setInterpolationToFlat=function(){return t.setInterpolation(Oa.FLAT)},t.setInterpolationToGouraud=function(){return t.setInterpolation(Oa.GOURAUD)},t.setInterpolationToPhong=function(){return t.setInterpolation(Oa.PHONG)},t.getInterpolationAsString=function(){return E.enumToString(Oa,e.interpolation)},t.setRepresentationToWireframe=function(){return t.setRepresentation(xa.WIREFRAME)},t.setRepresentationToSurface=function(){return t.setRepresentation(xa.SURFACE)},t.setRepresentationToPoints=function(){return t.setRepresentation(xa.POINTS)},t.getRepresentationAsString=function(){return E.enumToString(xa,e.representation)}}var ux={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,specular:0,specularPower:1,opacity:1,interpolation:Oa.GOURAUD,representation:xa.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null};function Ap(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ux,n),E.obj(t,e),E.setGet(t,e,["lighting","interpolation","ambient","diffuse","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation"]),E.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),cx(t,e)}var fx=E.newInstance(Ap,"vtkProperty"),ia=sx({newInstance:fx,extend:Ap},Su),gx=ia.Representation,cg=E.vtkErrorMacro;function lx(t){var e=_.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}var vx=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function px(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=function(){var n=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),r=new Float32Array([0,0,1,0,0,1,1,1]),a=new Uint16Array([4,0,1,3,2]),i=Ve.newInstance({numberOfComponents:3,values:n});i.setName("points");var o=Ve.newInstance({numberOfComponents:2,values:r});o.setName("tcoords");var s=Ve.newInstance({numberOfComponents:1,values:a});e.tris.getCABO().createVBO(s,"polys",gx.SURFACE,{points:i,tcoords:o,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=function(n){var r,a=n.getSize(),i=n.getContext();e.framebuffer=_o.newInstance(),e.framebuffer.setOpenGLRenderWindow(n),(r=e.framebuffer).create.apply(r,Ne(a)),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=st.newInstance(),e.translucentRGBATexture.setInternalFormat(i.RGBA16F),e.translucentRGBATexture.setFormat(i.RGBA),e.translucentRGBATexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(n),e.translucentRGBATexture.create2DFromRaw(a[0],a[1],4,"Float32Array",null),e.translucentRTexture=st.newInstance(),e.translucentRTexture.setInternalFormat(i.R16F),e.translucentRTexture.setFormat(i.RED),e.translucentRTexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(n),e.translucentRTexture.create2DFromRaw(a[0],a[1],1,"Float32Array",null),e.translucentZTexture=st.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(n),e.translucentZTexture.createDepthFromRaw(a[0],a[1],"Float32Array",null),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=function(n){e.copyShader=n.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),vx,"")},t.createVBO=function(n){var r=n.getContext();e.tris.setOpenGLRenderWindow(n),t.createVertexBuffer();var a=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),r.FLOAT,3,r.FALSE)||cg("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),r.FLOAT,2,r.FALSE)||cg("Error setting vertexDC in copy shader VAO.")},t.traverse=function(n,r,a){if(!e.deleted){var i=n.getSize(),o=n.getContext();if(e._supported=!1,r.getSelector()||!o||!n.getWebgl2()||!o.getExtension("EXT_color_buffer_half_float")&&!o.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),r.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(n);else{var s=e.framebuffer.getSize();s===null||s[0]!==i[0]||s[1]!==i[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRTexture.releaseGraphicsResources(n),e.translucentZTexture.releaseGraphicsResources(n),t.createFramebuffer(n)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}o.drawBuffers([o.COLOR_ATTACHMENT0]),o.clearBufferfv(o.COLOR,0,[0,0,0,0]),o.clearBufferfv(o.DEPTH,0,[1]),o.colorMask(!1,!1,!1,!1),a.getOpaqueActorCount()>0&&(a.setCurrentOperation("opaquePass"),r.traverse(a)),o.colorMask(!0,!0,!0,!0),o.drawBuffers([o.COLOR_ATTACHMENT0,o.COLOR_ATTACHMENT1]),o.viewport(0,0,i[0],i[1]),o.scissor(0,0,i[0],i[1]),o.clearBufferfv(o.COLOR,0,[0,0,0,1]),o.clearBufferfv(o.COLOR,1,[0,0,0,0]),o.enable(o.DEPTH_TEST),o.enable(o.BLEND),o.blendFuncSeparate(o.ONE,o.ONE,o.ZERO,o.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),r.traverse(t),o.drawBuffers([o.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(n):n.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=Eu.newInstance(),e.copyVAO.setOpenGLRenderWindow(n)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(n),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA),o.depthMask(!1),o.depthFunc(o.ALWAYS),o.viewport(0,0,i[0],i[1]),o.scissor(0,0,i[0],i[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),o.depthMask(!0),o.depthFunc(o.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate()}},t.getShaderReplacement=function(){return e._supported?lx:null},t.releaseGraphicsResources=function(n){e.framebuffer&&(e.framebuffer.releaseGraphicsResources(n),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(n),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(n),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(n),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(n),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(n),e.tris=null),t.modified()}}var hx={framebuffer:null,copyShader:null,tris:null};function Ip(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hx,n),wu.extend(t,e,n),e.VBOBuildTime={},E.obj(e.VBOBuildTime,{mtime:0}),e.tris=aa.newInstance(),E.get(t,e,["framebuffer"]),px(t,e)}var dx=E.newInstance(Ip,"vtkOpenGLOrderIndependentTranslucentPass"),yx={newInstance:dx,extend:Ip};function Tx(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!e.deleted){e.currentParent=r,t.setCurrentOperation("buildPass"),n.traverse(t);for(var a=n.getRenderable().getNumberOfLayers(),i=n.getChildren(),o=0;o<a;o++)for(var s=0;s<i.length;s++){var c=i[s],u=n.getRenderable().getRenderers()[s];if(u.getDraw()&&u.getLayer()===o){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),c.traverse(t),e.opaqueActorCount>0&&e.volumeCount>0||e.depthRequested){var g=n.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=_o.newInstance()),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.saveCurrentBindingsAndBuffers();var f=e.framebuffer.getSize();(f===null||f[0]!==g[0]||f[1]!==g[1])&&(e.framebuffer.create(g[0],g[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("opaqueZBufferPass"),c.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),c.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),c.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=yx.newInstance()),e.translucentPass.traverse(n,c,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),c.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),c.traverse(t))}}}},t.getZBufferTexture=function(){return e.framebuffer?e.framebuffer.getColorTexture():null},t.requestDepth=function(){e.depthRequested=!0},t.incrementOpaqueActorCount=function(){return e.opaqueActorCount++},t.incrementTranslucentActorCount=function(){return e.translucentActorCount++},t.incrementVolumeCount=function(){return e.volumeCount++},t.incrementOverlayActorCount=function(){return e.overlayActorCount++}}var mx={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function Pp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mx,n),wu.extend(t,e,n),E.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),Tx(t,e)}var Cx=E.newInstance(Pp,"vtkForwardPass"),wx={newInstance:Cx,extend:Pp},pt={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3},Wp={PassTypes:pt};function Sx(t,e){e.classHierarchy.push("vtkFieldData");var n=t.getState;e.arrays&&(e.arrays=e.arrays.map(function(r){return{data:Pt(r.data)}})),t.initialize=function(){t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=function(){e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=function(r){t.initializeFields(),e.copyFieldFlags=r.getCopyFieldFlags().map(function(a){return a}),e.arrays=r.arrays().map(function(a){return{array:a}})},t.getNumberOfArrays=function(){return e.arrays.length},t.getNumberOfActiveArrays=function(){return e.arrays.length},t.addArray=function(r){return e.arrays=[].concat(e.arrays,{data:r}),e.arrays.length-1},t.removeAllArrays=function(){e.arrays=[]},t.removeArray=function(r){e.arrays=e.arrays.filter(function(a){return r!==a.data.getName()})},t.removeArrayByIndex=function(r){e.arrays=e.arrays.filter(function(a,i){return i!==r})},t.getArrays=function(){return e.arrays.map(function(r){return r.data})},t.getArray=function(r){return typeof r=="number"?t.getArrayByIndex(r):t.getArrayByName(r)},t.getArrayByName=function(r){return e.arrays.reduce(function(a,i,o){return i.data.getName()===r?i.data:a},null)},t.getArrayWithIndex=function(r){return e.arrays.reduce(function(a,i,o){return i.data&&i.data.getName()===r?{array:i.data,index:o}:a},{array:null,index:-1})},t.getArrayByIndex=function(r){return r>=0&&r<e.arrays.length?e.arrays[r].data:null},t.hasArray=function(r){return t.getArrayWithIndex(r).index>=0},t.getArrayName=function(r){var a=e.arrays[r];return a?a.data.getName():""},t.getCopyFieldFlags=function(){return e.copyFieldFlags},t.getFlag=function(r){return e.copyFieldFlags[r]},t.passData=function(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;r.getArrays().forEach(function(o){var s=t.getFlag(o.getName());if(s!==!1&&!(e.doCopyAllOff&&s!==!0)&&o){var c=t.getArrayByName(o.getName());if(c){if(o.getNumberOfComponents()===c.getNumberOfComponents())if(a>-1&&a<o.getNumberOfTuples()){var l=i>-1?i:a;c.setTuple(l,o.getTuple(a))}else for(var v=0;v<o.getNumberOfTuples();++v)c.setTuple(v,o.getTuple(v))}else if(a<0||a>o.getNumberOfTuples())t.addArray(o);else{var u=o.getNumberOfComponents(),g=o.getNumberOfValues(),f=i>-1?i:a;g<f*u&&(g=(f+1)*u),c=Ve.newInstance({name:o.getName(),dataType:o.getDataType(),numberOfComponents:o.getNumberOfComponents(),size:g}),c.setTuple(f,o.getTuple(a)),t.addArray(c)}}})},t.copyFieldOn=function(r){e.copyFieldFlags[r]=!0},t.copyFieldOff=function(r){e.copyFieldFlags[r]=!1},t.copyAllOn=function(){(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=function(){(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=function(){e.copyFieldFlags={}},t.deepCopy=function(r){e.arrays=r.getArrays().map(function(a){var i=a.newClone();return i.deepCopy(a),{data:i}})},t.copyFlags=function(r){return r.getCopyFieldFlags().map(function(a){return a})},t.reset=function(){return e.arrays.forEach(function(r){return r.data.reset()})},t.getMTime=function(){return e.arrays.reduce(function(r,a){return a.data.getMTime()>r?a.data.getMTime():r},e.mtime)},t.getNumberOfComponents=function(){return e.arrays.reduce(function(r,a){return r+a.data.getNumberOfComponents()},0)},t.getNumberOfTuples=function(){return e.arrays.length>0?e.arrays[0].getNumberOfTuples():0},t.getState=function(){var r=n();return r&&(r.arrays=e.arrays.map(function(a){return{data:a.data.getState()}})),r}}var Ex={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function zp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ex,n),E.obj(t,e),Sx(t,e)}var xx=E.newInstance(zp,"vtkFieldData"),Ox={newInstance:xx,extend:zp},Mx={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},Rx={MAX:0,EXACT:1,NOLIMIT:2},Dx={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},Vx={DUPLICATEPOINT:1,HIDDENPOINT:2},Lx={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},Nx="vtkGhostType",Fx={DEFAULT:0,SINGLE:1,DOUBLE:2},xu={AttributeCopyOperations:Lx,AttributeLimitTypes:Rx,AttributeTypes:Mx,CellGhostTypes:Dx,DesiredOutputPrecision:Fx,PointGhostTypes:Vx,ghostArrayName:Nx};function ug(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function _x(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ug(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ug(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Hn=xu.AttributeTypes,Mr=xu.AttributeCopyOperations,gi=E.vtkWarningMacro;function bx(t,e){var n=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function r(i){var o=n.find(function(s){return Hn[s.toUpperCase()]===i||typeof i!="number"&&s.toLowerCase()===i.toLowerCase()});return typeof o>"u"&&(o=null),o}e.classHierarchy.push("vtkDataSetAttributes"),t.checkNumberOfComponents=function(i){return!0},t.setAttribute=function(i,o){var s=r(o);if(i&&s.toUpperCase()==="PEDIGREEIDS"&&!i.isA("vtkDataArray"))return gi("Cannot set attribute ".concat(s,". The attribute must be a vtkDataArray.")),-1;if(i&&!t.checkNumberOfComponents(i,s))return gi("Cannot set attribute ".concat(s,". Incorrect number of components.")),-1;var c=e["active".concat(s)];if(c>=0&&c<e.arrays.length){if(e.arrays[c]===i)return c;t.removeArrayByIndex(c)}return i?(c=t.addArray(i),e["active".concat(s)]=c):e["active".concat(s)]=-1,t.modified(),e["active".concat(s)]},t.setActiveAttributeByName=function(i,o){return t.setActiveAttributeByIndex(t.getArrayWithIndex(i).index,o)},t.setActiveAttributeByIndex=function(i,o){var s=r(o);if(i>=0&&i<e.arrays.length){if(s.toUpperCase()!=="PEDIGREEIDS"){var c=t.getArrayByIndex(i);if(!c.isA("vtkDataArray"))return gi("Cannot set attribute ".concat(s,". Only vtkDataArray subclasses can be set as active attributes.")),-1;if(!t.checkNumberOfComponents(c,s))return gi("Cannot set attribute ".concat(s,". Incorrect number of components.")),-1}return e["active".concat(s)]=i,t.modified(),i}return i===-1&&(e["active".concat(s)]=i,t.modified()),-1},t.getActiveAttribute=function(i){var o=r(i);return t["get".concat(o)]()},t.removeAllArrays=function(){e.arrays=[],n.forEach(function(i){e["active".concat(i)]=-1})},t.removeArray=function(i){e.arrays=e.arrays.filter(function(o,s){return i===o.data.getName()?(n.forEach(function(c){s===e["active".concat(c)]&&(e["active".concat(c)]=-1)}),!1):!0})},t.removeArrayByIndex=function(i){e.arrays=e.arrays.filter(function(o,s){return s!==i}),n.forEach(function(o){i===e["active".concat(o)]&&(e["active".concat(o)]=-1)})},n.forEach(function(i){var o="active".concat(i);t["get".concat(i)]=function(){return t.getArrayByIndex(e[o])},t["set".concat(i)]=function(s){return t.setAttribute(s,i)},t["setActive".concat(i)]=function(s){return t.setActiveAttributeByIndex(t.getArrayWithIndex(s).index,i)},t["copy".concat(i,"Off")]=function(){var s=i.toUpperCase();e.copyAttributeFlags[Mr.PASSDATA][Hn[s]]=!1}}),t.initializeAttributeCopyFlags=function(){e.copyAttributeFlags=[],Object.keys(Mr).filter(function(i){return i!=="ALLCOPY"}).forEach(function(i){e.copyAttributeFlags[Mr[i]]=Object.keys(Hn).filter(function(o){return o!=="NUM_ATTRIBUTES"}).reduce(function(o,s){return o[Hn[s]]=!0,o},[])}),e.copyAttributeFlags[Mr.COPYTUPLE][Hn.GLOBALIDS]=!1,e.copyAttributeFlags[Mr.INTERPOLATE][Hn.GLOBALIDS]=!1,e.copyAttributeFlags[Mr.COPYTUPLE][Hn.PEDIGREEIDS]=!1},t.initialize=E.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(function(i){!e.dataArrays[i].ref&&e.dataArrays[i].type==="vtkDataArray"&&t.addArray(Ve.newInstance(e.dataArrays[i]))});var a=t.shallowCopy;t.shallowCopy=function(i,o){a(i,o),e.arrays=i.getArrays().map(function(s){var c=s.newClone();return c.shallowCopy(s,o),{data:c}})},t.initializeAttributeCopyFlags()}var kx={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function $p(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kx,n),Ox.extend(t,e,n),E.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),bx(t,e)}var Ux=E.newInstance($p,"vtkDataSetAttributes"),fg=_x({newInstance:Ux,extend:$p},xu),Bx={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},Gx={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7},Ax={FieldDataTypes:Bx,FieldAssociations:Gx};function gg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function Ix(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?gg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Nc=["pointData","cellData","fieldData"];function Px(t,e){e.classHierarchy.push("vtkDataSet"),Nc.forEach(function(r){e[r]?e[r]=Pt(e[r]):e[r]=fg.newInstance()});var n=t.shallowCopy;t.shallowCopy=function(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,a),Nc.forEach(function(i){e[i]=fg.newInstance(),e[i].shallowCopy(r.getReferenceByName(i))})}}var Wx={};function jp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Wx,n),E.obj(t,e),E.setGet(t,e,Nc),Px(t,e)}var zx=E.newInstance(jp,"vtkDataSet"),oa=Ix({newInstance:zx,extend:jp},Ax),$x=oa.FieldAssociations;function jx(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=function(){var n=qr(Dt.mark(function r(a,i,o,s,c){return Dt.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:case"end":return g.stop()}},r)}));return function(r,a,i,o,s){return n.apply(this,arguments)}}(),t.selectAsync=function(){var n=qr(Dt.mark(function r(a,i,o,s,c){var u;return Dt.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,t.getSourceDataAsync(a,i,o,s,c);case 2:if(u=f.sent,!u){f.next=5;break}return f.abrupt("return",u.generateSelection(i,o,s,c));case 5:return f.abrupt("return",[]);case 6:case"end":return f.stop()}},r)}));return function(r,a,i,o,s){return n.apply(this,arguments)}}()}var Hx={fieldAssociation:$x.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function Hp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Hx,n),E.obj(t,e),E.setGet(t,e,["fieldAssociation","captureZValues"]),jx(t,e)}var Kx=E.newInstance(Hp,"vtkHardwareSelector"),qx={newInstance:Kx,extend:Hp},Xx={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},Yx={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5},Zx={SelectionContent:Xx,SelectionField:Yx};function lg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function Jx(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?lg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):lg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Qx(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=function(){return e.points.getBounds()}}var eO={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function Kp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eO,n),E.obj(t,e),e.properties={},E.setGet(t,e,["contentType","fieldType","properties","selectionList"]),Qx(t,e)}var tO=E.newInstance(Kp,"vtkSelectionNode"),Ou=Jx({newInstance:tO,extend:Kp},Zx);function vg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function nO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?vg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var $e=Wp.PassTypes,rO=Ou.SelectionContent,pg=Ou.SelectionField,_a=oa.FieldAssociations,qp=E.vtkErrorMacro,kn=1;function Xp(t){return"".concat(t.propID," ").concat(t.compositeID)}function Yp(t,e,n,r){if(!n)return 0;var a=(e*(r[2]-r[0]+1)+t)*4;return n[a+3]}function fn(t,e,n,r){if(!n)return 0;var a=(e*(r[2]-r[0]+1)+t)*4,i=[];i[0]=n[a],i[1]=n[a+1],i[2]=n[a+2];var o=i[2];return o*=256,o+=i[1],o*=256,o+=i[0],o}function Zp(t,e){var n=e;return n<<=24,n|=t,n}function Ar(t,e,n,r){var a=n<0?0:n;if(a===0){if(r[0]=e[0],r[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;var i=[e[0]-t.area[0],e[1]-t.area[1]],o=fn(i[0],i[1],t.pixBuffer[$e.ACTOR_PASS],t.area);if(o<=0||o-kn>=t.props.length)return null;var s={};s.valid=!0,s.propID=o-kn,s.prop=t.props[s.propID];var c=fn(i[0],i[1],t.pixBuffer[$e.COMPOSITE_INDEX_PASS],t.area);if((c<0||c>16777215)&&(c=0),s.compositeID=c-kn,t.captureZValues){var u=(i[1]*(t.area[2]-t.area[0]+1)+i[0])*4;s.zValue=(256*t.zBuffer[u]+t.zBuffer[u+1])/65535,s.displayPosition=e}if(t.pixBuffer[$e.ID_LOW24]&&Yp(i[0],i[1],t.pixBuffer[$e.ID_LOW24],t.area)===0)return s;var g=fn(i[0],i[1],t.pixBuffer[$e.ID_LOW24],t.area),f=fn(i[0],i[1],t.pixBuffer[$e.ID_HIGH24],t.area);return s.attributeID=Zp(g,f),s}var l=[e[0],e[1]],v=[0,0],p=Ar(t,e,0,r);if(p&&p.valid)return p;for(var d=1;d<a;++d){for(var h=l[1]>d?l[1]-d:0;h<=l[1]+d;++h)if(v[1]=h,l[0]>=d&&(v[0]=l[0]-d,p=Ar(t,v,0,r),p&&p.valid)||(v[0]=l[0]+d,p=Ar(t,v,0,r),p&&p.valid))return p;for(var T=l[0]>=d?l[0]-(d-1):0;T<=l[0]+(d-1);++T)if(v[0]=T,l[1]>=d&&(v[1]=l[1]-d,p=Ar(t,v,0,r),p&&p.valid)||(v[1]=l[1]+d,p=Ar(t,v,0,r),p&&p.valid))return p}return r[0]=e[0],r[1]=e[1],null}function Jp(t,e,n,r,a){var i=[],o=0;return e.forEach(function(s,c){var u=Ou.newInstance();switch(u.setContentType(rO.INDICES),t){case _a.FIELD_ASSOCIATION_CELLS:u.setFieldType(pg.CELL);break;case _a.FIELD_ASSOCIATION_POINTS:u.setFieldType(pg.POINT);break;default:qp("Unknown field association")}u.getProperties().propID=s.info.propID,u.getProperties().prop=s.info.prop,u.getProperties().compositeID=s.info.compositeID,u.getProperties().attributeID=s.info.attributeID,u.getProperties().pixelCount=s.pixelCount,n&&(u.getProperties().displayPosition=[s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue],u.getProperties().worldPosition=a.displayToWorld(s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue,r)),u.setSelectionList(s.attributeIDs),i[o]=u,o++}),i}function aO(t,e,n,r,a){for(var i=Math.floor(e),o=Math.floor(n),s=Math.floor(r),c=Math.floor(a),u=new Map,g=[0,0],f=o;f<=c;f++)for(var l=i;l<=s;l++){var v=[l,f],p=Ar(t,v,0,g);if(p&&p.valid){var d=Xp(p);if(!u.has(d))u.set(d,{info:p,pixelCount:1,attributeIDs:[p.attributeID]});else{var h=u.get(d);h.pixelCount++,t.captureZValues&&p.zValue<h.info.zValue&&(h.info=p),h.attributeIDs.indexOf(p.attributeID)===-1&&h.attributeIDs.push(p.attributeID)}}}return Jp(t.fieldAssociation,u,t.captureZValues,t.renderer,t.openGLRenderWindow)}function iO(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=function(){e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=function(){e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;var r=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=_o.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();var a=e.framebuffer.getSize();a[0]!==r[0]||a[1]!==r[1]?(e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===_a.FIELD_ASSOCIATION_POINTS){var i=e._openGLRenderWindow.getContext(),o=i.isEnabled(i.BLEND);i.disable(i.BLEND),e._openGLRenderWindow.traverseAllPasses(),e._renderer.setPreserveDepthBuffer(!0),o&&i.enable(i.BLEND)}},t.endSelection=function(){e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers(),e._renderer.setPreserveDepthBuffer(!1)},t.preCapturePass=function(){var r=e._openGLRenderWindow.getContext();e.originalBlending=r.isEnabled(r.BLEND),r.disable(r.BLEND)},t.postCapturePass=function(){var r=e._openGLRenderWindow.getContext();e.originalBlending&&r.enable(r.BLEND)},t.select=function(){var r=null;return t.captureBuffers()&&(r=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),r},t.getSourceDataAsync=function(){var r=qr(Dt.mark(function a(i,o,s,c,u){var g,f;return Dt.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(e._renderer=i,o===void 0?(g=e._openGLRenderWindow.getSize(),t.setArea(0,0,g[0]-1,g[1]-1)):t.setArea(o,s,c,u),t.captureBuffers()){v.next=4;break}return v.abrupt("return",!1);case 4:return f={area:Ne(e.area),pixBuffer:Ne(e.pixBuffer),captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:Ne(e.props),fieldAssociation:e.fieldAssociation,renderer:i,openGLRenderWindow:e._openGLRenderWindow},f.generateSelection=function(){for(var p=arguments.length,d=new Array(p),h=0;h<p;h++)d[h]=arguments[h];return aO.apply(void 0,[f].concat(d))},v.abrupt("return",f);case 7:case"end":return v.stop()}},a)}));return function(a,i,o,s,c){return r.apply(this,arguments)}}(),t.captureBuffers=function(){if(!e._renderer||!e._openGLRenderWindow)return qp("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);var r=e._openGLRenderWindow.getRenderPasses();for(t.beginSelection(),e.currentPass=$e.MIN_KNOWN_PASS;e.currentPass<=$e.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===$e.ACTOR_PASS&&typeof r[0].requestDepth=="function"&&typeof r[0].getFramebuffer=="function"&&r[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),t.processPixelBuffers());return t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=function(){e.props.forEach(function(r,a){t.isPropHit(a)&&r.processSelectorPixelBuffers(t,e.propPixels[a])})},t.passRequired=function(r){if(r===$e.ID_HIGH24){if(e.fieldAssociation===_a.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===_a.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=function(r){if(e.pixBuffer[r]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[r]){var a=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[r]=new Uint8Array(a),e.rawPixBuffer[r].set(e.pixBuffer[r])}if(r===$e.ACTOR_PASS){if(e.captureZValues){var i=e._openGLRenderWindow.getRenderPasses();if(typeof i[0].requestDepth=="function"&&typeof i[0].getFramebuffer=="function"){var o=i[0].getFramebuffer();o.saveCurrentBindingsAndBuffers(),o.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),o.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[r])}},t.buildPropHitList=function(r){for(var a=0,i=0;i<=e.area[3]-e.area[1];i++)for(var o=0;o<=e.area[2]-e.area[0];o++){var s=fn(o,i,r,e.area);s>0&&(s--,s in e.hitProps||(e.hitProps[s]=!0,e.propPixels[s]=[]),e.propPixels[s].push(a*4)),++a}},t.renderProp=function(r){e.currentPass===$e.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+kn),e.props.push(r))},t.renderCompositeIndex=function(r){e.currentPass===$e.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(r+kn)},t.renderAttributeId=function(r){r<0||(e.maxAttributeId=r>e.maxAttributeId?r:e.maxAttributeId)},t.passTypeToString=function(r){return E.enumToString($e,r)},t.isPropHit=function(r){return Boolean(e.hitProps[r])},t.setPropColorValueFromInt=function(r){e.propColorValue[0]=r%256/255,e.propColorValue[1]=Math.floor(r/256)%256/255,e.propColorValue[2]=Math.floor(r/65536)%256/255},t.getPixelInformation=function(r,a,i){var o=a<0?0:a;if(o===0){if(i[0]=r[0],i[1]=r[1],r[0]<e.area[0]||r[0]>e.area[2]||r[1]<e.area[1]||r[1]>e.area[3])return null;var s=[r[0]-e.area[0],r[1]-e.area[1]],c=fn(s[0],s[1],e.pixBuffer[$e.ACTOR_PASS],e.area);if(c<=0||c-kn>=e.props.length)return null;var u={};u.valid=!0,u.propID=c-kn,u.prop=e.props[u.propID];var g=fn(s[0],s[1],e.pixBuffer[$e.COMPOSITE_INDEX_PASS],e.area);if((g<0||g>16777215)&&(g=0),u.compositeID=g-kn,e.captureZValues){var f=(s[1]*(e.area[2]-e.area[0]+1)+s[0])*4;u.zValue=(256*e.zBuffer[f]+e.zBuffer[f+1])/65535,u.displayPosition=r}if(e.pixBuffer[$e.ID_LOW24]&&Yp(s[0],s[1],e.pixBuffer[$e.ID_LOW24],e.area)===0)return u;var l=fn(s[0],s[1],e.pixBuffer[$e.ID_LOW24],e.area),v=fn(s[0],s[1],e.pixBuffer[$e.ID_HIGH24],e.area);return u.attributeID=Zp(l,v),u}var p=[r[0],r[1]],d=[0,0],h=t.getPixelInformation(r,0,i);if(h&&h.valid)return h;for(var T=1;T<o;++T){for(var C=p[1]>T?p[1]-T:0;C<=p[1]+T;++C)if(d[1]=C,p[0]>=T&&(d[0]=p[0]-T,h=t.getPixelInformation(d,0,i),h&&h.valid)||(d[0]=p[0]+T,h=t.getPixelInformation(d,0,i),h&&h.valid))return h;for(var m=p[0]>=T?p[0]-(T-1):0;m<=p[0]+(T-1);++m)if(d[0]=m,p[1]>=T&&(d[1]=p[1]-T,h=t.getPixelInformation(d,0,i),h&&h.valid)||(d[1]=p[1]+T,h=t.getPixelInformation(d,0,i),h&&h.valid))return h}return i[0]=r[0],i[1]=r[1],null},t.generateSelection=function(r,a,i,o){for(var s=Math.floor(r),c=Math.floor(a),u=Math.floor(i),g=Math.floor(o),f=new Map,l=[0,0],v=c;v<=g;v++)for(var p=s;p<=u;p++){var d=[p,v],h=t.getPixelInformation(d,0,l);if(h&&h.valid){var T=Xp(h);if(!f.has(T))f.set(T,{info:h,pixelCount:1,attributeIDs:[h.attributeID]});else{var C=f.get(T);C.pixelCount++,e.captureZValues&&h.zValue<C.info.zValue&&(C.info=h),C.attributeIDs.indexOf(h.attributeID)===-1&&C.attributeIDs.push(h.attributeID)}}}return Jp(e.fieldAssociation,f,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=function(r){return e.rawPixBuffer[r]},t.getPixelBuffer=function(r){return e.pixBuffer[r]},t.attach=function(r,a){e._openGLRenderWindow=r,e._renderer=a};var n=t.setArea;t.setArea=function(){return n.apply(void 0,arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}var oO={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function Qp(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oO,n),qx.extend(t,e,n),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),E.setGetArray(t,e,["area"],4),E.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),E.setGetArray(t,e,["propColorValue"],3),E.moveToProtected(t,e,["renderer","openGLRenderWindow"]),E.event(t,e,"event"),iO(t,e)}var sO=E.newInstance(Qp,"vtkOpenGLHardwareSelector"),Mu=nO({newInstance:sO,extend:Qp},Wp),e1={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function a(T,C){var m=T[0],y=T[1],w=T[2],S=T[3];m+=(y&w|~y&S)+C[0]-680876936|0,m=(m<<7|m>>>25)+y|0,S+=(m&y|~m&w)+C[1]-389564586|0,S=(S<<12|S>>>20)+m|0,w+=(S&m|~S&y)+C[2]+606105819|0,w=(w<<17|w>>>15)+S|0,y+=(w&S|~w&m)+C[3]-1044525330|0,y=(y<<22|y>>>10)+w|0,m+=(y&w|~y&S)+C[4]-176418897|0,m=(m<<7|m>>>25)+y|0,S+=(m&y|~m&w)+C[5]+1200080426|0,S=(S<<12|S>>>20)+m|0,w+=(S&m|~S&y)+C[6]-1473231341|0,w=(w<<17|w>>>15)+S|0,y+=(w&S|~w&m)+C[7]-45705983|0,y=(y<<22|y>>>10)+w|0,m+=(y&w|~y&S)+C[8]+1770035416|0,m=(m<<7|m>>>25)+y|0,S+=(m&y|~m&w)+C[9]-1958414417|0,S=(S<<12|S>>>20)+m|0,w+=(S&m|~S&y)+C[10]-42063|0,w=(w<<17|w>>>15)+S|0,y+=(w&S|~w&m)+C[11]-1990404162|0,y=(y<<22|y>>>10)+w|0,m+=(y&w|~y&S)+C[12]+1804603682|0,m=(m<<7|m>>>25)+y|0,S+=(m&y|~m&w)+C[13]-40341101|0,S=(S<<12|S>>>20)+m|0,w+=(S&m|~S&y)+C[14]-1502002290|0,w=(w<<17|w>>>15)+S|0,y+=(w&S|~w&m)+C[15]+1236535329|0,y=(y<<22|y>>>10)+w|0,m+=(y&S|w&~S)+C[1]-165796510|0,m=(m<<5|m>>>27)+y|0,S+=(m&w|y&~w)+C[6]-1069501632|0,S=(S<<9|S>>>23)+m|0,w+=(S&y|m&~y)+C[11]+643717713|0,w=(w<<14|w>>>18)+S|0,y+=(w&m|S&~m)+C[0]-373897302|0,y=(y<<20|y>>>12)+w|0,m+=(y&S|w&~S)+C[5]-701558691|0,m=(m<<5|m>>>27)+y|0,S+=(m&w|y&~w)+C[10]+38016083|0,S=(S<<9|S>>>23)+m|0,w+=(S&y|m&~y)+C[15]-660478335|0,w=(w<<14|w>>>18)+S|0,y+=(w&m|S&~m)+C[4]-405537848|0,y=(y<<20|y>>>12)+w|0,m+=(y&S|w&~S)+C[9]+568446438|0,m=(m<<5|m>>>27)+y|0,S+=(m&w|y&~w)+C[14]-1019803690|0,S=(S<<9|S>>>23)+m|0,w+=(S&y|m&~y)+C[3]-187363961|0,w=(w<<14|w>>>18)+S|0,y+=(w&m|S&~m)+C[8]+1163531501|0,y=(y<<20|y>>>12)+w|0,m+=(y&S|w&~S)+C[13]-1444681467|0,m=(m<<5|m>>>27)+y|0,S+=(m&w|y&~w)+C[2]-51403784|0,S=(S<<9|S>>>23)+m|0,w+=(S&y|m&~y)+C[7]+1735328473|0,w=(w<<14|w>>>18)+S|0,y+=(w&m|S&~m)+C[12]-1926607734|0,y=(y<<20|y>>>12)+w|0,m+=(y^w^S)+C[5]-378558|0,m=(m<<4|m>>>28)+y|0,S+=(m^y^w)+C[8]-2022574463|0,S=(S<<11|S>>>21)+m|0,w+=(S^m^y)+C[11]+1839030562|0,w=(w<<16|w>>>16)+S|0,y+=(w^S^m)+C[14]-35309556|0,y=(y<<23|y>>>9)+w|0,m+=(y^w^S)+C[1]-1530992060|0,m=(m<<4|m>>>28)+y|0,S+=(m^y^w)+C[4]+1272893353|0,S=(S<<11|S>>>21)+m|0,w+=(S^m^y)+C[7]-155497632|0,w=(w<<16|w>>>16)+S|0,y+=(w^S^m)+C[10]-1094730640|0,y=(y<<23|y>>>9)+w|0,m+=(y^w^S)+C[13]+681279174|0,m=(m<<4|m>>>28)+y|0,S+=(m^y^w)+C[0]-358537222|0,S=(S<<11|S>>>21)+m|0,w+=(S^m^y)+C[3]-722521979|0,w=(w<<16|w>>>16)+S|0,y+=(w^S^m)+C[6]+76029189|0,y=(y<<23|y>>>9)+w|0,m+=(y^w^S)+C[9]-640364487|0,m=(m<<4|m>>>28)+y|0,S+=(m^y^w)+C[12]-421815835|0,S=(S<<11|S>>>21)+m|0,w+=(S^m^y)+C[15]+530742520|0,w=(w<<16|w>>>16)+S|0,y+=(w^S^m)+C[2]-995338651|0,y=(y<<23|y>>>9)+w|0,m+=(w^(y|~S))+C[0]-198630844|0,m=(m<<6|m>>>26)+y|0,S+=(y^(m|~w))+C[7]+1126891415|0,S=(S<<10|S>>>22)+m|0,w+=(m^(S|~y))+C[14]-1416354905|0,w=(w<<15|w>>>17)+S|0,y+=(S^(w|~m))+C[5]-57434055|0,y=(y<<21|y>>>11)+w|0,m+=(w^(y|~S))+C[12]+1700485571|0,m=(m<<6|m>>>26)+y|0,S+=(y^(m|~w))+C[3]-1894986606|0,S=(S<<10|S>>>22)+m|0,w+=(m^(S|~y))+C[10]-1051523|0,w=(w<<15|w>>>17)+S|0,y+=(S^(w|~m))+C[1]-2054922799|0,y=(y<<21|y>>>11)+w|0,m+=(w^(y|~S))+C[8]+1873313359|0,m=(m<<6|m>>>26)+y|0,S+=(y^(m|~w))+C[15]-30611744|0,S=(S<<10|S>>>22)+m|0,w+=(m^(S|~y))+C[6]-1560198380|0,w=(w<<15|w>>>17)+S|0,y+=(S^(w|~m))+C[13]+1309151649|0,y=(y<<21|y>>>11)+w|0,m+=(w^(y|~S))+C[4]-145523070|0,m=(m<<6|m>>>26)+y|0,S+=(y^(m|~w))+C[11]-1120210379|0,S=(S<<10|S>>>22)+m|0,w+=(m^(S|~y))+C[2]+718787259|0,w=(w<<15|w>>>17)+S|0,y+=(S^(w|~m))+C[9]-343485551|0,y=(y<<21|y>>>11)+w|0,T[0]=m+T[0]|0,T[1]=y+T[1]|0,T[2]=w+T[2]|0,T[3]=S+T[3]|0}function i(T){var C=[],m;for(m=0;m<64;m+=4)C[m>>2]=T.charCodeAt(m)+(T.charCodeAt(m+1)<<8)+(T.charCodeAt(m+2)<<16)+(T.charCodeAt(m+3)<<24);return C}function o(T){var C=[],m;for(m=0;m<64;m+=4)C[m>>2]=T[m]+(T[m+1]<<8)+(T[m+2]<<16)+(T[m+3]<<24);return C}function s(T){var C=T.length,m=[1732584193,-271733879,-1732584194,271733878],y,w,S,O,M,R;for(y=64;y<=C;y+=64)a(m,i(T.substring(y-64,y)));for(T=T.substring(y-64),w=T.length,S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y=0;y<w;y+=1)S[y>>2]|=T.charCodeAt(y)<<(y%4<<3);if(S[y>>2]|=128<<(y%4<<3),y>55)for(a(m,S),y=0;y<16;y+=1)S[y]=0;return O=C*8,O=O.toString(16).match(/(.*?)(.{0,8})$/),M=parseInt(O[2],16),R=parseInt(O[1],16)||0,S[14]=M,S[15]=R,a(m,S),m}function c(T){var C=T.length,m=[1732584193,-271733879,-1732584194,271733878],y,w,S,O,M,R;for(y=64;y<=C;y+=64)a(m,o(T.subarray(y-64,y)));for(T=y-64<C?T.subarray(y-64):new Uint8Array(0),w=T.length,S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y=0;y<w;y+=1)S[y>>2]|=T[y]<<(y%4<<3);if(S[y>>2]|=128<<(y%4<<3),y>55)for(a(m,S),y=0;y<16;y+=1)S[y]=0;return O=C*8,O=O.toString(16).match(/(.*?)(.{0,8})$/),M=parseInt(O[2],16),R=parseInt(O[1],16)||0,S[14]=M,S[15]=R,a(m,S),m}function u(T){var C="",m;for(m=0;m<4;m+=1)C+=r[T>>m*8+4&15]+r[T>>m*8&15];return C}function g(T){var C;for(C=0;C<T.length;C+=1)T[C]=u(T[C]);return T.join("")}g(s("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function T(C,m){return C=C|0||0,C<0?Math.max(C+m,0):Math.min(C,m)}ArrayBuffer.prototype.slice=function(C,m){var y=this.byteLength,w=T(C,y),S=y,O,M,R,D;return m!==n&&(S=T(m,y)),w>S?new ArrayBuffer(0):(O=S-w,M=new ArrayBuffer(O),R=new Uint8Array(M),D=new Uint8Array(this,w,O),R.set(D),M)}}();function f(T){return/[\u0080-\uFFFF]/.test(T)&&(T=unescape(encodeURIComponent(T))),T}function l(T,C){var m=T.length,y=new ArrayBuffer(m),w=new Uint8Array(y),S;for(S=0;S<m;S+=1)w[S]=T.charCodeAt(S);return C?w:y}function v(T){return String.fromCharCode.apply(null,new Uint8Array(T))}function p(T,C,m){var y=new Uint8Array(T.byteLength+C.byteLength);return y.set(new Uint8Array(T)),y.set(new Uint8Array(C),T.byteLength),m?y:y.buffer}function d(T){var C=[],m=T.length,y;for(y=0;y<m-1;y+=2)C.push(parseInt(T.substr(y,2),16));return String.fromCharCode.apply(String,C)}function h(){this.reset()}return h.prototype.append=function(T){return this.appendBinary(f(T)),this},h.prototype.appendBinary=function(T){this._buff+=T,this._length+=T.length;var C=this._buff.length,m;for(m=64;m<=C;m+=64)a(this._hash,i(this._buff.substring(m-64,m)));return this._buff=this._buff.substring(m-64),this},h.prototype.end=function(T){var C=this._buff,m=C.length,y,w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S;for(y=0;y<m;y+=1)w[y>>2]|=C.charCodeAt(y)<<(y%4<<3);return this._finish(w,m),S=g(this._hash),T&&(S=d(S)),this.reset(),S},h.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},h.prototype.setState=function(T){return this._buff=T.buff,this._length=T.length,this._hash=T.hash,this},h.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},h.prototype._finish=function(T,C){var m=C,y,w,S;if(T[m>>2]|=128<<(m%4<<3),m>55)for(a(this._hash,T),m=0;m<16;m+=1)T[m]=0;y=this._length*8,y=y.toString(16).match(/(.*?)(.{0,8})$/),w=parseInt(y[2],16),S=parseInt(y[1],16)||0,T[14]=w,T[15]=S,a(this._hash,T)},h.hash=function(T,C){return h.hashBinary(f(T),C)},h.hashBinary=function(T,C){var m=s(T),y=g(m);return C?d(y):y},h.ArrayBuffer=function(){this.reset()},h.ArrayBuffer.prototype.append=function(T){var C=p(this._buff.buffer,T,!0),m=C.length,y;for(this._length+=T.byteLength,y=64;y<=m;y+=64)a(this._hash,o(C.subarray(y-64,y)));return this._buff=y-64<m?new Uint8Array(C.buffer.slice(y-64)):new Uint8Array(0),this},h.ArrayBuffer.prototype.end=function(T){var C=this._buff,m=C.length,y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w,S;for(w=0;w<m;w+=1)y[w>>2]|=C[w]<<(w%4<<3);return this._finish(y,m),S=g(this._hash),T&&(S=d(S)),this.reset(),S},h.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.ArrayBuffer.prototype.getState=function(){var T=h.prototype.getState.call(this);return T.buff=v(T.buff),T},h.ArrayBuffer.prototype.setState=function(T){return T.buff=l(T.buff,!0),h.prototype.setState.call(this,T)},h.ArrayBuffer.prototype.destroy=h.prototype.destroy,h.ArrayBuffer.prototype._finish=h.prototype._finish,h.ArrayBuffer.hash=function(T,C){var m=c(new Uint8Array(T)),y=g(m);return C?d(y):y},h})})(e1);const cO=e1.exports;var uO=["lastShaderBound","context","_openGLRenderWindow"];function fO(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=function(n,r,a){var i=r;a.length>0&&(i=_.substitute(i,"VSOut","GSOut").result);var o=e._openGLRenderWindow.getWebgl2(),s=`
`,c=`#version 100
`;o?c=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(s=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(s+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),i=_.substitute(i,"//VTK::System::Dec",["".concat(c,`
`),o?"":`#extension GL_OES_standard_derivatives : enable
`,s,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;var u=_.substitute(n,"//VTK::System::Dec",["".concat(c,`
`),"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(o){u=_.substitute(u,"varying","out").result,i=_.substitute(i,"varying","in").result;for(var g="",f=0;i.includes("gl_FragData[".concat(f,"]"));)i=_.substitute(i,"gl_FragData\\[".concat(f,"\\]"),"fragOutput".concat(f)).result,g+="layout(location = ".concat(f,") out vec4 fragOutput").concat(f,`;
`),f++;i=_.substitute(i,"//VTK::Output::Dec",g).result}var l=_.substitute(a,"//VTK::System::Dec",c).result;return{VSSource:u,FSSource:i,GSSource:l}},t.readyShaderProgramArray=function(n,r,a){var i=t.replaceShaderValues(n,r,a),o=t.getShaderProgram(i.VSSource,i.FSSource,i.GSSource);return t.readyShaderProgram(o)},t.readyShaderProgram=function(n){return!n||!n.getCompiled()&&!n.compileShader()||!t.bindShader(n)?null:n},t.getShaderProgram=function(n,r,a){var i="".concat(n).concat(r).concat(a),o=cO.hash(i),s=Object.keys(e.shaderPrograms).indexOf(o);if(s===-1){var c=_.newInstance();return c.setContext(e.context),c.getVertexShader().setSource(n),c.getFragmentShader().setSource(r),a&&c.getGeometryShader().setSource(a),c.setMd5Hash(o),e.shaderPrograms[o]=c,c}return e.shaderPrograms[o]},t.releaseGraphicsResources=function(n){t.releaseCurrentShader(),Object.keys(e.shaderPrograms).map(function(r){return e.shaderPrograms[r]}).forEach(function(r){return r.releaseGraphicsResources(n)})},t.releaseGraphicsResources=function(){e.astShaderBound&&(e.lastShaderBound.release(),e.lastShaderBound=null)},t.bindShader=function(n){return e.lastShaderBound===n||(e.lastShaderBound&&e.lastShaderBound.release(),n.bind(),e.lastShaderBound=n),1}}var gO={lastShaderBound:null,shaderPrograms:null,context:null};function t1(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gO,n),e.shaderPrograms={},E.obj(t,e),E.setGet(t,e,uO),E.moveToProtected(t,e,["openGLRenderWindow"]),fO(t,e)}var lO=E.newInstance(t1,"vtkShaderCache"),vO={newInstance:lO,extend:t1},pO=E.vtkErrorMacro;function hO(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=function(){for(var n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]===!0&&pO("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=function(n){if(e.context!==n){if(e.context!==0&&t.deleteTable(),e.context=n,e.context){e.numberOfTextureUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);for(var r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]=!1}t.modified()}},t.allocate=function(){for(var n=0;n<e.numberOfTextureUnits;n++)if(!t.isAllocated(n))return e.textureUnits[n]=!0,n;return-1},t.allocateUnit=function(n){return t.isAllocated(n)?-1:(e.textureUnits[n]=!0,n)},t.isAllocated=function(n){return e.textureUnits[n]},t.free=function(n){e.textureUnits[n]=!1}}var dO={context:null,numberOfTextureUnits:0,textureUnits:0};function n1(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dO,n),E.obj(t,e),e.textureUnits=[],E.get(t,e,["numberOfTextureUnits"]),E.setGet(t,e,["context"]),hO(t,e)}var yO=E.newInstance(n1,"vtkOpenGLTextureUnitManager"),TO={newInstance:yO,extend:n1};function mO(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=function(){return null},t.getAspectRatio=function(){return e.size[0]/e.size[1]},t.getAspectRatioForRenderer=function(n){var r=n.getViewportByReference();return e.size[0]*(r[2]-r[0])/((r[3]-r[1])*e.size[1])},t.isInViewport=function(n,r,a){var i=a.getViewportByReference(),o=t.getFramebufferSize();return i[0]*o[0]<=n&&i[2]*o[0]>=n&&i[1]*o[1]<=r&&i[3]*o[1]>=r},t.getViewportSize=function(n){var r=n.getViewportByReference(),a=t.getFramebufferSize();return[(r[2]-r[0])*a[0],(r[3]-r[1])*a[1]]},t.getViewportCenter=function(n){var r=t.getViewportSize(n);return[r[0]*.5,r[1]*.5]},t.displayToNormalizedDisplay=function(n,r,a){var i=t.getFramebufferSize();return[n/i[0],r/i[1],a]},t.normalizedDisplayToDisplay=function(n,r,a){var i=t.getFramebufferSize();return[n*i[0],r*i[1],a]},t.worldToView=function(n,r,a,i){return i.worldToView(n,r,a)},t.viewToWorld=function(n,r,a,i){return i.viewToWorld(n,r,a)},t.worldToDisplay=function(n,r,a,i){var o=i.worldToView(n,r,a),s=t.getViewportSize(i),c=i.viewToProjection(o[0],o[1],o[2],s[0]/s[1]),u=i.projectionToNormalizedDisplay(c[0],c[1],c[2]);return t.normalizedDisplayToDisplay(u[0],u[1],u[2])},t.displayToWorld=function(n,r,a,i){var o=t.displayToNormalizedDisplay(n,r,a),s=i.normalizedDisplayToProjection(o[0],o[1],o[2]),c=t.getViewportSize(i),u=i.projectionToView(s[0],s[1],s[2],c[0]/c[1]);return i.viewToWorld(u[0],u[1],u[2])},t.normalizedDisplayToViewport=function(n,r,a,i){var o=i.getViewportByReference();o=t.normalizedDisplayToDisplay(o[0],o[1],0);var s=t.normalizedDisplayToDisplay(n,r,a);return[s[0]-o[0]-.5,s[1]-o[1]-.5,a]},t.viewportToNormalizedViewport=function(n,r,a,i){var o=t.getViewportSize(i);return o&&o[0]!==0&&o[1]!==0?[n/(o[0]-1),r/(o[1]-1),a]:[n,r,a]},t.normalizedViewportToViewport=function(n,r,a,i){var o=t.getViewportSize(i);return[n*(o[0]-1),r*(o[1]-1),a]},t.displayToLocalDisplay=function(n,r,a){var i=t.getFramebufferSize();return[n,i[1]-r-1,a]},t.viewportToNormalizedDisplay=function(n,r,a,i){var o=i.getViewportByReference();o=t.normalizedDisplayToDisplay(o[0],o[1],0);var s=n+o[0]+.5,c=r+o[1]+.5;return t.displayToNormalizedDisplay(s,c,a)},t.getPixelData=function(n,r,a,i){E.vtkErrorMacro("not implemented")},t.createSelector=function(){E.vtkErrorMacro("not implemented")}}var CO={size:void 0,selector:void 0};function r1(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CO,n),e.size||(e.size=[300,300]),E.getArray(t,e,["size"],2),E.get(t,e,["selector"]),Qe.extend(t,e,n),mO(t,e)}var wO=E.newInstance(r1,"vtkRenderWindowViewNode"),SO={newInstance:wO,extend:r1},hg=E.vtkDebugMacro,dg=E.vtkErrorMacro,EO={position:"absolute",top:0,left:0,width:"100%",height:"100%"},Rr={vr:{rescaleFactor:1,translateZ:-.7},ar:{rescaleFactor:.25,translateZ:-.5}};function vt(t,e,n){var r=t.createFramebuffer(),a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,n,null),t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a,0);var i=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),i===t.FRAMEBUFFER_COMPLETE}var oo=0,bo=[];function xO(){oo++,bo.forEach(function(t){return t(oo)})}function OO(){oo--,bo.forEach(function(t){return t(oo)})}function MO(t){bo.push(t)}function RO(t){return bo.pop()}function DO(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow"),t.getViewNodeFactory=function(){return e.myFactory},e.canvas.addEventListener("webglcontextlost",function(s){s.preventDefault()},!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);var n=navigator.xr!==void 0&&navigator.xr.isSessionSupported("immersive-vr"),r=[0,0];function a(){e.renderable&&(e.size[0]!==r[0]||e.size[1]!==r[1])&&(r[0]=e.size[0],r[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(a),t.buildPass=function(s){if(s){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(function(c){c.setOpenGLRenderWindow(t)})}},t.initialize=function(){if(!e.initialized){e.context=t.get3DContext(),e.textureUnitManager=TO.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);var s=e.context;s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA),s.depthFunc(s.LEQUAL),s.enable(s.BLEND),e.initialized=!0}},t.makeCurrent=function(){e.context.makeCurrent()},t.setContainer=function(s){e.el&&e.el!==s&&(e.canvas.parentNode!==e.el&&dg("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==s&&(e.el=s,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=function(){return e.el},t.getContainerSize=function(){if(!e.containerSize&&e.el){var s=e.el.getBoundingClientRect(),c=s.width,u=s.height;e.containerSize=[c,u]}return e.containerSize||e.size},t.getFramebufferSize=function(){return e.activeFramebuffer?e.activeFramebuffer.getSize():e.size},t.getPixelData=function(s,c,u,g){var f=new Uint8Array((u-s+1)*(g-c+1)*4);return e.context.readPixels(s,c,u-s+1,g-c+1,e.context.RGBA,e.context.UNSIGNED_BYTE,f),f},t.get3DContext=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},c=null;n&&t.invokeHaveVRDisplay();var u=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&u&&(c=e.canvas.getContext("webgl2",s),c&&(e.webgl2=!0,hg("using webgl2"))),c||(hg("using webgl1"),c=e.canvas.getContext("webgl",s)||e.canvas.getContext("experimental-webgl",s)),c},t.startXR=function(s){if(navigator.xr===void 0)throw new Error("WebXR is not available");e.xrSessionIsAR=s;var c=s?"immersive-ar":"immersive-vr";if(!navigator.xr.isSessionSupported(c))throw s?new Error("Device does not support AR session"):new Error("VR display is not available");if(e.xrSession===null)navigator.xr.requestSession(c).then(t.enterXR,function(){throw new Error("Failed to create XR session!")});else throw new Error("XR Session already exists!")},t.enterXR=function(){var s=qr(Dt.mark(function c(u){var g,f;return Dt.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(e.xrSession=u,e.oldCanvasSize=e.size.slice(),e.xrSession===null){v.next=15;break}return g=t.get3DContext(),v.next=6,g.makeXRCompatible();case 6:f=new global.XRWebGLLayer(e.xrSession,g),t.setSize(f.framebufferWidth,f.framebufferHeight),e.xrSession.updateRenderState({baseLayer:f}),e.xrSession.requestReferenceSpace("local").then(function(p){e.xrReferenceSpace=p}),t.resetXRScene(),e.renderable.getInteractor().switchToXRAnimation(),e.xrSceneFrame=e.xrSession.requestAnimationFrame(t.xrRender),v.next=16;break;case 15:throw new Error("Failed to enter VR with a null xrSession.");case 16:case"end":return v.stop()}},c)}));return function(c){return s.apply(this,arguments)}}(),t.resetXRScene=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Rr.vr.rescaleFactor,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Rr.vr.translateZ,u=s,g=c;e.xrSessionIsAR&&u===Rr.vr.rescaleFactor&&(u=Rr.ar.rescaleFactor),e.xrSessionIsAR&&g===Rr.vr.translateZ&&(g=Rr.ar.translateZ);var f=e.renderable.getRenderers()[0];f.resetCamera();var l=f.getActiveCamera(),v=l.getPhysicalScale(),p=l.getPhysicalTranslation();v/=u,g*=v,p[2]+=g,l.setPhysicalScale(v),l.setPhysicalTranslation(p),l.setClippingRange(.1*v,100*v)},t.stopXR=qr(Dt.mark(function s(){var c,u;return Dt.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(navigator.xr!==void 0){f.next=2;break}return f.abrupt("return");case 2:if(e.xrSession===null){f.next=10;break}return e.xrSession.cancelAnimationFrame(e.xrSceneFrame),e.renderable.getInteractor().returnFromXRAnimation(),c=t.get3DContext(),c.bindFramebuffer(c.FRAMEBUFFER,null),f.next=9,e.xrSession.end().catch(function(l){if(!(l instanceof DOMException))throw l});case 9:e.xrSession=null;case 10:e.oldCanvasSize!==void 0&&t.setSize.apply(t,Ne(e.oldCanvasSize)),u=e.renderable.getRenderers()[0],u.getActiveCamera().setProjectionMatrix(null),u.resetCamera(),u.setViewport(0,0,1,1),t.traverseAllPasses();case 16:case"end":return f.stop()}},s)})),t.xrRender=function(){var s=qr(Dt.mark(function c(u,g){var f,l,v,p,d;return Dt.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:f=g.session,e.renderable.getInteractor().updateXRGamepads(f,g,e.xrReferenceSpace),e.xrSceneFrame=e.xrSession.requestAnimationFrame(t.xrRender),l=g.getViewerPose(e.xrReferenceSpace),l&&(v=t.get3DContext(),e.xrSessionIsAR&&e.oldCanvasSize!==void 0&&(v.canvas.width=e.oldCanvasSize[0],v.canvas.height=e.oldCanvasSize[1]),p=f.renderState.baseLayer,v.bindFramebuffer(v.FRAMEBUFFER,p.framebuffer),v.clear(v.COLOR_BUFFER_BIT),v.clear(v.DEPTH_BUFFER_BIT),d=e.renderable.getRenderers()[0],l.views.forEach(function(C){var m=p.getViewport(C);if(v.viewport(m.x,m.y,m.width,m.height),!e.xrSessionIsAR)if(C.eye==="left")d.setViewport(0,0,.5,1);else if(C.eye==="right")d.setViewport(.5,0,1,1);else return;d.getActiveCamera().computeViewParametersFromPhysicalMatrix(C.transform.inverse.matrix),d.getActiveCamera().setProjectionMatrix(C.projectionMatrix),t.traverseAllPasses()}));case 5:case"end":return T.stop()}},c)}));return function(c,u){return s.apply(this,arguments)}}(),t.restoreContext=function(){var s=wu.newInstance();s.setCurrentOperation("Release"),s.traverse(t,null)},t.activateTexture=function(s){var c=e._textureResourceIds.get(s);if(c!==void 0){e.context.activeTexture(e.context.TEXTURE0+c);return}var u=t.getTextureUnitManager().allocate();if(u<0){dg("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(s,u),e.context.activeTexture(e.context.TEXTURE0+u)},t.deactivateTexture=function(s){var c=e._textureResourceIds.get(s);c!==void 0&&(t.getTextureUnitManager().free(c),delete e._textureResourceIds.delete(s))},t.getTextureUnitForTexture=function(s){var c=e._textureResourceIds.get(s);return c!==void 0?c:-1},t.getDefaultTextureInternalFormat=function(s,c,u){if(e.webgl2)switch(s){case Xe.UNSIGNED_CHAR:switch(c){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case Xe.FLOAT:default:switch(c){case 1:return e.context.R16F;case 2:return e.context.RG16F;case 3:return e.context.RGB16F;case 4:default:return e.context.RGBA16F}}switch(c){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=function(s){e.bgImage.src=s.src},t.setUseBackgroundImage=function(s){e.useBackgroundImage=s,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function i(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat,c=document.createElement("canvas"),u=c.getContext("2d");c.width=e.canvas.width,c.height=e.canvas.height,u.drawImage(e.canvas,0,0);var g=e.canvas.getBoundingClientRect(),f=e.renderable,l=f.getRenderers();l.forEach(function(p){var d=p.getViewProps();d.forEach(function(h){if(h.getContainer)for(var T=h.getContainer(),C=T.getElementsByTagName("canvas"),m=0;m<C.length;m++){var y=C[m],w=y.getBoundingClientRect(),S=w.x-g.x,O=w.y-g.y;u.drawImage(y,S,O)}})});var v=c.toDataURL(s);c.remove(),t.invokeImageReady(v)}t.captureNextImage=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=c.resetCamera,g=u===void 0?!1:u,f=c.size,l=f===void 0?null:f,v=c.scale,p=v===void 0?1:v;if(e.deleted)return null;e.imageFormat=s;var d=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:!!l||p!==1?l||e.size.map(function(h){return h*p}):null},new Promise(function(h,T){var C=t.onImageReady(function(m){if(e._screenshot.size===null)e.notifyStartCaptureImage=d,C.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(function(S){var O=S.restoreParamsFn,M=S.arg;return O(M)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),h(m);else{var y=document.createElement("img");if(y.style=EO,y.src=m,e._screenshot.placeHolder=e.el.appendChild(y),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e._screenshot.size=null,t.modified(),g){var w=g!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(function(S){var O=S.getActiveCamera(),M=O.get("focalPoint","position","parallelScale");return{resetCameraArgs:w?{renderer:S}:void 0,resetCameraFn:w?g:S.resetCamera,restoreParamsFn:O.set,arg:JSON.parse(JSON.stringify(M))}}),e._screenshot.cameras.forEach(function(S){var O=S.resetCameraFn,M=S.resetCameraArgs;return O(M)})}t.traverseAllPasses()}})})};var o;t.getHardwareMaximumLineWidth=function(){if(o!=null)return o;var s=t.get3DContext(),c=s.getParameter(s.ALIASED_LINE_WIDTH_RANGE);return o=c[1],c[1]},t.getGLInformations=function(){for(var s=t.get3DContext(),c=s.getExtension("OES_texture_float"),u=s.getExtension("OES_texture_half_float"),g=s.getExtension("WEBGL_debug_renderer_info"),f=s.getExtension("WEBGL_draw_buffers"),l=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),v=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",s.getParameter(s.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",s.getParameter(s.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",s.getParameter(s.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",s.getParameter(s.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",l&&s.getParameter(l.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",s.getParameter(s.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",s.getParameter(s.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",s.getParameter(s.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",s.getParameter(s.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",s.getParameter(s.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",s.getParameter(s.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",s.getParameter(s.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",s.getParameter(s.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",s.getParameter(s.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",s.getParameter(s.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",s.getParameter(s.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",s.getParameter(s.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",s.getParameter(s.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[c&&vt(s,s.RGBA,s.UNSIGNED_BYTE)?"RGBA":"",c&&vt(s,s.RGB,s.UNSIGNED_BYTE)?"RGB":"",c&&vt(s,s.LUMINANCE,s.UNSIGNED_BYTE)?"LUMINANCE":"",c&&vt(s,s.ALPHA,s.UNSIGNED_BYTE)?"ALPHA":"",c&&vt(s,s.LUMINANCE_ALPHA,s.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[u&&vt(s,s.RGBA,u.HALF_FLOAT_OES)?"RGBA":"",u&&vt(s,s.RGB,u.HALF_FLOAT_OES)?"RGB":"",u&&vt(s,s.LUMINANCE,u.HALF_FLOAT_OES)?"LUMINANCE":"",u&&vt(s,s.ALPHA,u.HALF_FLOAT_OES)?"ALPHA":"",u&&vt(s,s.LUMINANCE_ALPHA,u.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[c&&vt(s,s.RGBA,s.FLOAT)?"RGBA":"",c&&vt(s,s.RGB,s.FLOAT)?"RGB":"",c&&vt(s,s.LUMINANCE,s.FLOAT)?"LUMINANCE":"",c&&vt(s,s.ALPHA,s.FLOAT)?"ALPHA":"",c&&vt(s,s.LUMINANCE_ALPHA,s.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",f?s.getParameter(f.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).precision," (-2<sup>",s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).precision," (-2<sup>",s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.LOW_FLOAT).precision," (-2<sup>",s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision," (-2<sup>",s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).precision," (-2<sup>",s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.LOW_FLOAT).precision," (-2<sup>",s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_INT).precision," (-2<sup>",s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_INT).rangeMin,"</sup> - 2<sup>",s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_INT).precision," (-2<sup>",s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.LOW_INT).precision," (-2<sup>",s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.LOW_INT).rangeMin,"</sup> - 2<sup>",s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_INT).precision," (-2<sup>",s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_INT).rangeMin,"</sup> - 2<sup>",s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_INT).precision," (-2<sup>",s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.LOW_INT).precision," (-2<sup>",s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.LOW_INT).rangeMin,"</sup> - 2<sup>",s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",s.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",s.getParameter(s.RENDERER)],["WebGL Vendor","VENDOR",s.getParameter(s.VENDOR)],["WebGL Version","VERSION",s.getParameter(s.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",s.getParameter(s.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",g&&s.getParameter(g.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",g&&s.getParameter(g.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],p={};v.length;){var d=v.pop(),h=dt(d,3),T=h[0],C=h[1],m=h[2];C&&(p[C]={label:T,value:m})}return p},t.traverseAllPasses=function(){if(e.renderPasses)for(var s=0;s<e.renderPasses.length;++s)e.renderPasses[s].traverse(t,null);e.notifyStartCaptureImage&&i()},t.disableCullFace=function(){e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=function(){e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=function(s){if(e.viewStream===s)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=s,e.viewStream){var c=e.renderable.getRenderers()[0];c.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(function(u){return t.setBackgroundImage(u.image)}),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=function(){var s=Mu.newInstance();return s.setOpenGLRenderWindow(t),s},t.delete=E.chain(t.delete,t.setViewStream,OO)}var VO={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,xrSession:null,xrSessionIsAR:!1,xrReferenceSpace:null,xrSupported:!0,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function a1(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VO,n),SO.extend(t,e,n),e.canvas=document.createElement("canvas"),e.canvas.style.width="100%",xO(),e.selector||(e.selector=Mu.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e.myFactory=OE.newInstance(),e.myFactory.registerOverride("vtkRenderWindow",Ru),e.shaderCache=vO.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=wx.newInstance(),E.event(t,e,"imageReady"),E.event(t,e,"haveVRDisplay"),E.get(t,e,["shaderCache","textureUnitManager","webgl2","vrDisplay","useBackgroundImage","xrSupported"]),E.setGet(t,e,["initialized","context","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen","activeFramebuffer"]),E.setGetArray(t,e,["size"],2),DO(t,e)}var Ru=E.newInstance(a1,"vtkOpenGLRenderWindow");dp("WebGL",Ru);var LO={newInstance:Ru,extend:a1,pushMonitorGLContextCount:MO,popMonitorGLContextCount:RO};function NO(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=function(n){if(n){e._openGLRenderWindow=t.getFirstAncestorOfType("vtkOpenGLRenderWindow"),e.openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(var r=0;r<e.children.length;r++){var a=e.children[r];a.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(a)):e.oglmapper=a}}},t.traverseOpaqueZBufferPass=function(n){!e.renderable||!e.renderable.getNestedVisibility()||e.openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOpaquePass=function(n){!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=function(n){!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=function(){if(!!e.ogltextures){e.activeTextures=[];for(var n=0;n<e.ogltextures.length;n++){var r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.queryPass=function(n,r){if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.opaqueZBufferPass=function(n,r){return t.opaquePass(n,r)},t.opaquePass=function(n,r){if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(var a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.translucentPass=function(n,r){if(n)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(var a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.getKeyMatrices=function(){return e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),Ke(e.keyMatrices.mcwc,e.renderable.getMatrix()),Oe(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?Jt(e.keyMatrices.normalMatrix):(wo(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),So(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),_0(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices}}var FO={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function i1(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FO,n),Qe.extend(t,e,n),e.keyMatrixTime={},Ge(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:Jt(new Float64Array(9)),mcwc:ie(new Float64Array(16))},at(t,e,["context"]),Et(t,e,["activeTextures"]),NO(t,e)}var o1=ke(i1),_O={newInstance:o1,extend:i1};yt("vtkActor",o1);function bO(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=function(n){if(n){if(!e.renderable)return;e._openGLRenderWindow=t.getFirstAncestorOfType("vtkOpenGLRenderWindow"),e.openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(var r=0;r<e.children.length;r++){var a=e.children[r];a.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(a)):e.oglmapper=a}}},t.queryPass=function(n,r){if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOverlayActorCount()}},t.traverseOpaquePass=function(n){!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=function(n){!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOverlayPass=function(n){!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=function(){if(!!e.ogltextures){e.activeTextures=[];for(var n=0;n<e.ogltextures.length;n++){var r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.opaquePass=function(n,r){if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(var a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.translucentPass=function(n,r){if(n)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(var a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.overlayPass=function(n,r){if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(var a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()}}var kO={context:null,activeTextures:null};function s1(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kO,n),Qe.extend(t,e,n),at(t,e,["context"]),Et(t,e,["activeTextures"]),bO(t,e)}var c1=ke(s1),UO={newInstance:c1,extend:s1};yt("vtkActor2D",c1);function BO(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=function(n){n&&(e.openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e.openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=function(n){if(n){var r=e.openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize),e.context.scissor(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)}},t.translucentPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=function(n){if(n!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||n.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){Ke(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),wo(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),So(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Oe(e.keyMatrices.wcvc,e.keyMatrices.wcvc);var r=e.openGLRenderer.getAspectRatio();Ke(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(r,-1,1)),Oe(e.keyMatrices.vcpc,e.keyMatrices.vcpc),Me(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=n}return e.keyMatrices}}var GO={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function u1(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GO,n),Qe.extend(t,e,n),e.keyMatrixTime={},Ge(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},at(t,e,["context","keyMatrixTime"]),BO(t,e)}var f1=ke(u1),AO={newInstance:f1,extend:u1};yt("vtkCamera",f1);function IO(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=function(){t.getInputData()},t.addClippingPlane=function(n){return n.isA("vtkPlane")?e.clippingPlanes.includes(n)?!1:(e.clippingPlanes.push(n),t.modified(),!0):!1},t.getNumberOfClippingPlanes=function(){return e.clippingPlanes.length},t.removeAllClippingPlanes=function(){e.clippingPlanes.length=0},t.removeClippingPlane=function(n){var r=e.clippingPlanes.indexOf(n);return r===-1?!1:(e.clippingPlanes.splice(r,1),t.modified(),!0)},t.getClippingPlanes=function(){return e.clippingPlanes},t.setClippingPlanes=function(n){if(!!n)if(!Array.isArray(n))t.addClippingPlane(n);else for(var r=n.length,a=0;a<r&&a<6;a++)t.addClippingPlane(n[a])},t.getClippingPlaneInDataCoords=function(n,r,a){var i=e.clippingPlanes,o=n;if(i){var s=i.length;if(r>=0&&r<s){var c=i[r],u=c.getNormal(),g=c.getOrigin(),f=u[0],l=u[1],v=u[2],p=-(f*g[0]+l*g[1]+v*g[2]);a[0]=f*o[0]+l*o[4]+v*o[8]+p*o[12],a[1]=f*o[1]+l*o[5]+v*o[9]+p*o[13],a[2]=f*o[2]+l*o[6]+v*o[10]+p*o[14],a[3]=f*o[3]+l*o[7]+v*o[11]+p*o[15];return}}E.vtkErrorMacro("Clipping plane index ".concat(r," is out of range."))}}var PO={clippingPlanes:[]};function WO(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PO,n),E.obj(t,e),E.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),IO(t,e)}var Du={extend:WO};function zO(t,e){t.getBounds=function(){return 0},t.getBounds=function(n){t.getBounds();for(var r=0;r<6;r++)n[r]=e.bounds[r]},t.getCenter=function(){t.getBounds();for(var n=0;n<3;n++)e.center[n]=(e.bounds[2*n+1]+e.bounds[2*n])/2;return e.center.slice()},t.getLength=function(){var n=0,r=0;t.getBounds();for(var a=0;a<3;a++)n=e.bounds[2*a+1]-e.bounds[2*a],r+=n*n;return Math.sqrt(r)}}var $O={bounds:[1,-1,1,-1,1,-1],center:[0,0,0]};function jO(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$O,n),Du.extend(t,e,n),e.bounds||hr(e.bounds),e.center||(e.center=[0,0,0]),zO(t,e)}var HO={extend:jO};function yg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function KO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?yg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Fc=1e-6,g1="coincide",l1="disjoint";function qO(t,e,n){return t[0]*(n[0]-e[0])+t[1]*(n[1]-e[1])+t[2]*(n[2]-e[2])}function v1(t,e,n){var r=n[0]*(t[0]-e[0])+n[1]*(t[1]-e[1])+n[2]*(t[2]-e[2]);return Math.abs(r)}function p1(t,e,n,r){var a=[];hn(t,e,a);var i=ce(n,a);r[0]=t[0]-i*n[0],r[1]=t[1]-i*n[1],r[2]=t[2]-i*n[2]}function h1(t,e,n){var r=ce(t,e),a=ce(e,e);return a===0&&(a=1),n[0]=t[0]-r*e[0]/a,n[1]=t[1]-r*e[1]/a,n[2]=t[2]-r*e[2]/a,n}function d1(t,e,n,r){var a=[];hn(t,e,a);var i=ce(n,a),o=ce(n,n);o!==0?(r[0]=t[0]-i*n[0]/o,r[1]=t[1]-i*n[1]/o,r[2]=t[2]-i*n[2]/o):(r[0]=t[0],r[1]=t[1],r[2]=t[2])}function y1(t,e,n,r){var a={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},i=[],o=[];hn(e,t,i),hn(n,t,o);var s=ce(r,o),c=ce(r,i),u,g;return c<0?u=-c:u=c,s<0?g=-s*Fc:g=s*Fc,u<=g||(a.t=s/c,a.x[0]=t[0]+a.t*i[0],a.x[1]=t[1]+a.t*i[1],a.x[2]=t[2]+a.t*i[2],a.intersection=!0,a.betweenPoints=a.t>=0&&a.t<=1),a}function T1(t,e,n,r){var a={intersection:!1,l0:[],l1:[],error:null},i=[];Qt(e,r,i);var o=i.map(function(l){return Math.abs(l)});if(o[0]+o[1]+o[2]<Fc){var s=[];return hn(t,n,s),ce(e,s)===0?a.error=g1:a.error=l1,a}var c;o[0]>o[1]&&o[0]>o[2]?c="x":o[1]>o[2]?c="y":c="z";var u=[],g=-ce(e,t),f=-ce(r,n);switch(c){case"x":u[0]=0,u[1]=(f*e[2]-g*r[2])/i[0],u[2]=(g*r[1]-f*e[1])/i[0];break;case"y":u[0]=(g*r[2]-f*e[2])/i[1],u[1]=0,u[2]=(f*e[0]-g*r[0])/i[1];break;case"z":u[0]=(f*e[1]-g*r[1])/i[2],u[1]=(g*r[0]-f*e[0])/i[2],u[2]=0;break}return a.l0=u,eo(u,i,a.l1),a.intersection=!0,a}var XO={evaluate:qO,distanceToPlane:v1,projectPoint:p1,projectVector:h1,generalizedProjectPoint:d1,intersectWithLine:y1,intersectWithPlane:T1,DISJOINT:l1,COINCIDE:g1};function YO(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=function(n){return v1(n,e.origin,e.normal)},t.projectPoint=function(n,r){p1(n,e.origin,e.normal,r)},t.projectVector=function(n,r){return h1(n,e.normal,r)},t.push=function(n){if(n!==0)for(var r=0;r<3;r++)e.origin[r]+=n*e.normal[r]},t.generalizedProjectPoint=function(n,r){d1(n,e.origin,e.normal,r)},t.evaluateFunction=function(n,r,a){return Array.isArray(n)?e.normal[0]*(n[0]-e.origin[0])+e.normal[1]*(n[1]-e.origin[1])+e.normal[2]*(n[2]-e.origin[2]):e.normal[0]*(n-e.origin[0])+e.normal[1]*(r-e.origin[1])+e.normal[2]*(a-e.origin[2])},t.evaluateGradient=function(n){var r=[e.normal[0],e.normal[1],e.normal[2]];return r},t.intersectWithLine=function(n,r){return y1(n,r,e.origin,e.normal)},t.intersectWithPlane=function(n,r){return T1(n,r,e.origin,e.normal)}}var ZO={normal:[0,0,1],origin:[0,0,0]};function m1(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZO,n),E.obj(t,e),E.setGetArray(t,e,["normal","origin"],3),YO(t,e)}var JO=E.newInstance(m1,"vtkPlane"),Tn=KO({newInstance:JO,extend:m1},XO);function Tg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function QO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Tg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Tg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var ko=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function C1(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function mn(t){return t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function Vu(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function w1(t){return Vu(t,ko)}function S1(t){var e=dt(t,6),n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5];return t[0]=n<(arguments.length<=1?void 0:arguments[1])?n:arguments.length<=1?void 0:arguments[1],t[1]=r>(arguments.length<=1?void 0:arguments[1])?r:arguments.length<=1?void 0:arguments[1],t[2]=a<(arguments.length<=2?void 0:arguments[2])?a:arguments.length<=2?void 0:arguments[2],t[3]=i>(arguments.length<=2?void 0:arguments[2])?i:arguments.length<=2?void 0:arguments[2],t[4]=o<(arguments.length<=3?void 0:arguments[3])?o:arguments.length<=3?void 0:arguments[3],t[5]=s>(arguments.length<=3?void 0:arguments[3])?s:arguments.length<=3?void 0:arguments[3],t}function E1(t,e,n,r,a,i,o){var s=dt(t,6),c=s[0],u=s[1],g=s[2],f=s[3],l=s[4],v=s[5];return o===void 0?(t[0]=Math.min(e[0],c),t[1]=Math.max(e[1],u),t[2]=Math.min(e[2],g),t[3]=Math.max(e[3],f),t[4]=Math.min(e[4],l),t[5]=Math.max(e[5],v)):(t[0]=Math.min(e,c),t[1]=Math.max(n,u),t[2]=Math.min(r,g),t[3]=Math.max(a,f),t[4]=Math.min(i,l),t[5]=Math.max(o,v)),t}function x1(t,e,n,r){var a=dt(t,6),i=a[0],o=a[1],s=a[2],c=a[3],u=a[4],g=a[5];return t[0]=e,t[1]=e>o?e:o,t[2]=n,t[3]=n>c?n:c,t[4]=r,t[5]=r>g?r:g,i!==e||s!==n||u!==r}function O1(t,e,n,r){var a=dt(t,6),i=a[0],o=a[1],s=a[2],c=a[3],u=a[4],g=a[5];return t[0]=e<i?e:i,t[1]=e,t[2]=n<s?n:s,t[3]=n,t[4]=r<u?r:u,t[5]=r,o!==e||c!==n||g!==r}function M1(t,e){return t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t}function Lu(t,e,n,r){return mn(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),n>=0?(t[2]*=n,t[3]*=n):(t[2]=n*t[3],t[3]=n*t[2]),r>=0?(t[4]*=r,t[5]*=r):(t[4]=r*t[5],t[5]=r*t[4]),!0):!1}function Nu(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function eM(t,e,n,r){if(!mn(t))return!1;var a=Nu(t);return t[0]-=a[0],t[1]-=a[0],t[2]-=a[1],t[3]-=a[1],t[4]-=a[2],t[5]-=a[2],Lu(t,e,n,r),t[0]+=a[0],t[1]+=a[0],t[2]+=a[1],t[3]+=a[1],t[4]+=a[2],t[5]+=a[2],!0}function ba(t,e){return t[e*2+1]-t[e*2]}function Uo(t){return[ba(t,0),ba(t,1),ba(t,2)]}function R1(t){return t.slice(0,2)}function D1(t){return t.slice(2,4)}function V1(t){return t.slice(4,6)}function L1(t){var e=Uo(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function N1(t){if(mn(t)){var e=Uo(t);return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}return null}function Fu(t){return[t[0],t[2],t[4]]}function _u(t){return[t[1],t[3],t[5]]}function li(t,e){return t<=0&&e>=0||t>=0&&e<=0}function F1(t,e){for(var n=0,r=0;r<2;r++)for(var a=2;a<4;a++)for(var i=4;i<6;i++)e[n]=[t[r],t[a],t[i]],n++;return e}function _1(t,e,n){return e[0]=t[0],e[1]=t[2],e[2]=t[4],n[0]=t[1],n[1]=t[3],n[2]=t[5],e}function b1(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function k1(t,e,n,r){for(var a=[].concat(ko),i=t.getData(),o=0;o<i.length;o+=3){var s=[i[o],i[o+1],i[o+2]],c=ce(s,e);a[0]=Math.min(c,a[0]),a[1]=Math.max(c,a[1]);var u=ce(s,n);a[2]=Math.min(u,a[2]),a[3]=Math.max(u,a[3]);var g=ce(s,r);a[4]=Math.min(g,a[4]),a[5]=Math.max(g,a[5])}return a}function U1(t,e,n,r,a){for(var i=!0,o=[],s=0,c=[],u=[0,0,0],g=0,f=1,l=2,v=0;v<3;v++)e[v]<t[2*v]?(o[v]=f,u[v]=t[2*v],i=!1):e[v]>t[2*v+1]?(o[v]=g,u[v]=t[2*v+1],i=!1):o[v]=l;if(i)return r[0]=e[0],r[1]=e[1],r[2]=e[2],a[0]=0,1;for(var p=0;p<3;p++)o[p]!==l&&n[p]!==0?c[p]=(u[p]-e[p])/n[p]:c[p]=-1;for(var d=0;d<3;d++)c[s]<c[d]&&(s=d);if(c[s]>1||c[s]<0)return 0;a[0]=c[s];for(var h=0;h<3;h++)if(s!==h){if(r[h]=e[h]+c[s]*n[h],r[h]<t[2*h]||r[h]>t[2*h+1])return 0}else r[h]=u[h];return 1}function B1(t,e,n){for(var r=[],a=0,i=1,o=1,s=4;s<=5;++s){r[2]=t[s];for(var c=2;c<=3;++c){r[1]=t[c];for(var u=0;u<=1;++u)if(r[0]=t[u],a=Tn.evaluate(n,e,r),o&&(i=a>=0?1:-1,o=0),a===0||i>0&&a<0||i<0&&a>0)return 1}}return 0}function G1(t,e){if(!(mn(t)&&mn(e)))return!1;for(var n=[0,0,0,0,0,0],r,a=0;a<3;a++)if(r=!1,e[a*2]>=t[a*2]&&e[a*2]<=t[a*2+1]?(r=!0,n[a*2]=e[a*2]):t[a*2]>=e[a*2]&&t[a*2]<=e[a*2+1]&&(r=!0,n[a*2]=t[a*2]),e[a*2+1]>=t[a*2]&&e[a*2+1]<=t[a*2+1]?(r=!0,n[a*2+1]=e[2*a+1]):t[a*2+1]>=e[a*2]&&t[a*2+1]<=e[a*2+1]&&(r=!0,n[a*2+1]=t[a*2+1]),!r)return!1;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],!0}function so(t,e){if(!(mn(t)&&mn(e)))return!1;for(var n=0;n<3;n++)if(!(e[n*2]>=t[n*2]&&e[n*2]<=t[n*2+1])&&!(t[n*2]>=e[n*2]&&t[n*2]<=e[n*2+1])&&!(e[n*2+1]>=t[n*2]&&e[n*2+1]<=t[n*2+1])&&!(t[n*2+1]>=e[n*2]&&t[n*2+1]<=e[n*2+1]))return!1;return!0}function co(t,e,n,r){return!(e<t[0]||e>t[1]||n<t[2]||n>t[3]||r<t[4]||r>t[5])}function tM(t,e){return!(!so(t,e)||!co.apply(void 0,[t].concat(Ne(Fu(e))))||!co.apply(void 0,[t].concat(Ne(_u(e)))))}function A1(t,e,n){for(var r=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],a=[0,0,0,0,0,0,0,0],i=0,o=0;o<2;o++)for(var s=2;s<4;s++)for(var c=4;c<6;c++){var u=[t[o],t[s],t[c]];a[i++]=Tn.evaluate(n,e,u)}for(var g=2;g--&&!(li(a[r[g][0]],a[r[g][4]])&&li(a[r[g][1]],a[r[g][5]])&&li(a[r[g][2]],a[r[g][6]])&&li(a[r[g][3]],a[r[g][7]])););if(g<0)return!1;for(var f=Math.sign(n[g]),l=Math.abs((t[g*2+1]-t[g*2])*n[g]),v=f>0?1:0,p=0;p<4;p++)if(l!==0){var d=Math.abs(a[r[g][p]])/l;f>0&&d<v&&(v=d),f<0&&d>v&&(v=d)}var h=(1-v)*t[g*2]+v*t[g*2+1];return f>0?t[g*2]=h:t[g*2+1]=h,!0}var nM=function(){function t(e){Do(this,t),this.bounds=e,this.bounds||(this.bounds=new Float64Array(ko))}return Vo(t,[{key:"getBounds",value:function(){return this.bounds}},{key:"equals",value:function(n){return C1(this.bounds,n)}},{key:"isValid",value:function(){return mn(this.bounds)}},{key:"setBounds",value:function(n){return Vu(this.bounds,n)}},{key:"reset",value:function(){return w1(this.bounds)}},{key:"addPoint",value:function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return S1(this.bounds,r)}},{key:"addBounds",value:function(n,r,a,i,o,s){return E1(this.bounds,n,r,a,i,o,s)}},{key:"setMinPoint",value:function(n,r,a){return x1(this.bounds,n,r,a)}},{key:"setMaxPoint",value:function(n,r,a){return O1(this.bounds,n,r,a)}},{key:"inflate",value:function(n){return M1(this.bounds,n)}},{key:"scale",value:function(n,r,a){return Lu(this.bounds,n,r,a)}},{key:"getCenter",value:function(){return Nu(this.bounds)}},{key:"getLength",value:function(n){return ba(this.bounds,n)}},{key:"getLengths",value:function(){return Uo(this.bounds)}},{key:"getMaxLength",value:function(){return L1(this.bounds)}},{key:"getDiagonalLength",value:function(){return N1(this.bounds)}},{key:"getMinPoint",value:function(){return Fu(this.bounds)}},{key:"getMaxPoint",value:function(){return _u(this.bounds)}},{key:"getXRange",value:function(){return R1(this.bounds)}},{key:"getYRange",value:function(){return D1(this.bounds)}},{key:"getZRange",value:function(){return V1(this.bounds)}},{key:"getCorners",value:function(n){return F1(this.bounds,n)}},{key:"computeCornerPoints",value:function(n,r){return _1(this.bounds,n,r)}},{key:"computeLocalBounds",value:function(n,r,a){return k1(this.bounds,n,r,a)}},{key:"computeScale3",value:function(n){return b1(this.bounds,n)}},{key:"cutWithPlane",value:function(n,r){return A1(this.bounds,n,r)}},{key:"intersectBox",value:function(n,r,a,i){return U1(this.bounds,n,r,a,i)}},{key:"intersectPlane",value:function(n,r){return B1(this.bounds,n,r)}},{key:"intersect",value:function(n){return G1(this.bounds,n)}},{key:"intersects",value:function(n){return so(this.bounds,n)}},{key:"containsPoint",value:function(n,r,a){return co(this.bounds,n,r,a)}},{key:"contains",value:function(n){return so(this.bounds,n)}}]),t}();function rM(t){var e=t&&t.bounds;return new nM(e)}var aM={equals:C1,isValid:mn,setBounds:Vu,reset:w1,addPoint:S1,addBounds:E1,setMinPoint:x1,setMaxPoint:O1,inflate:M1,scale:Lu,scaleAboutCenter:eM,getCenter:Nu,getLength:ba,getLengths:Uo,getMaxLength:L1,getDiagonalLength:N1,getMinPoint:Fu,getMaxPoint:_u,getXRange:R1,getYRange:D1,getZRange:V1,getCorners:F1,computeCornerPoints:_1,computeLocalBounds:k1,computeScale3:b1,cutWithPlane:A1,intersectBox:U1,intersectPlane:B1,intersect:G1,intersects:so,containsPoint:co,contains:tM,INIT_BOUNDS:ko},Je=QO({newInstance:rM},aM),Gt={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9},I1={StructuredType:Gt};function mg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function iM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?mg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var nn=I1.StructuredType;function oM(t){for(var e=0,n=0;n<3;++n)t[n*2]<t[n*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?nn.EMPTY:e===3?nn.XYZ_GRID:e===2?t[0]===t[1]?nn.YZ_PLANE:t[2]===t[3]?nn.XZ_PLANE:nn.XY_PLANE:e===1?t[0]<t[1]?nn.X_LINE:t[2]<t[3]?nn.Y_LINE:nn.Z_LINE:nn.SINGLE_POINT}var sM=iM({getDataDescriptionFromExtent:oM},I1),xn=E.vtkErrorMacro;function cM(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return xn("instance deleted - cannot call any method"),!1;for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=r.length===1?r[0]:r;if(i.length!==6)return!1;var o=!1;return e.extent.forEach(function(s,c){if(s!==i[c]){if(o)return;o=!0}}),o&&(e.extent=i.slice(),e.dataDescription=sM.getDataDescriptionFromExtent(e.extent),t.modified()),o},t.setDimensions=function(){var n,r,a;if(e.deleted){xn("instance deleted - cannot call any method");return}if(arguments.length===1){var i=arguments.length<=0?void 0:arguments[0];n=i[0],r=i[1],a=i[2]}else if(arguments.length===3)n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],a=arguments.length<=2?void 0:arguments[2];else{xn("Bad dimension specification");return}t.setExtent(0,n-1,0,r-1,0,a-1)},t.getDimensions=function(){return[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1]},t.getNumberOfCells=function(){for(var n=t.getDimensions(),r=1,a=0;a<3;a++){if(n[a]===0)return 0;n[a]>1&&(r*=n[a]-1)}return r},t.getNumberOfPoints=function(){var n=t.getDimensions();return n[0]*n[1]*n[2]},t.getPoint=function(n){var r=t.getDimensions();if(r[0]===0||r[1]===0||r[2]===0)return xn("Requesting a point from an empty image."),null;var a=new Float64Array(3);switch(e.dataDescription){case Gt.EMPTY:return null;case Gt.SINGLE_POINT:break;case Gt.X_LINE:a[0]=n;break;case Gt.Y_LINE:a[1]=n;break;case Gt.Z_LINE:a[2]=n;break;case Gt.XY_PLANE:a[0]=n%r[0],a[1]=n/r[0];break;case Gt.YZ_PLANE:a[1]=n%r[1],a[2]=n/r[1];break;case Gt.XZ_PLANE:a[0]=n%r[0],a[2]=n/r[0];break;case Gt.XYZ_GRID:a[0]=n%r[0],a[1]=n/r[0]%r[1],a[2]=n/(r[0]*r[1]);break;default:xn("Invalid dataDescription");break}var i=[0,0,0];return t.indexToWorld(a,i),i},t.getBounds=function(){return t.extentToBounds(t.getSpatialExtent())},t.extentToBounds=function(n){var r=[n[0],n[2],n[4],n[1],n[2],n[4],n[0],n[3],n[4],n[1],n[3],n[4],n[0],n[2],n[5],n[1],n[2],n[5],n[0],n[3],n[5],n[1],n[3],n[5]],a=new Float64Array([r[0],r[1],r[2]]),i=new Float64Array(3);t.indexToWorld(a,i);for(var o=[i[0],i[0],i[1],i[1],i[2],i[2]],s=3;s<24;s+=3)te(a,r[s],r[s+1],r[s+2]),t.indexToWorld(a,i),i[0]<o[0]&&(o[0]=i[0]),i[1]<o[2]&&(o[2]=i[1]),i[2]<o[4]&&(o[4]=i[2]),i[0]>o[1]&&(o[1]=i[0]),i[1]>o[3]&&(o[3]=i[1]),i[2]>o[5]&&(o[5]=i[2]);return o},t.getSpatialExtent=function(){var n=Je.newInstance();return n.setBounds(e.extent),n.inflate(.5),n.getBounds()},t.computeTransforms=function(){k0(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],Pn(e.indexToWorld,e.indexToWorld,e.spacing),ct(e.worldToIndex,e.indexToWorld)},t.setDirection=function(){if(e.deleted)return xn("instance deleted - cannot call any method"),!1;for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=r;if(i.length===1&&(Array.isArray(i[0])||i[0].constructor===Float32Array||i[0].constructor===Float64Array)&&(i=i[0]),i.length!==9)throw new RangeError("Invalid number of values for array setter");var o=!1;if(e.direction.forEach(function(c,u){if(c!==i[u]){if(o)return;o=!0}}),o){for(var s=0;s<9;++s)e.direction[s]=i[s];t.modified()}return!0},t.indexToWorld=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return ue(r,n,e.indexToWorld),r},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return ue(r,n,e.worldToIndex),r},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],a=[0,0,0],i=[0,0,0];Je.computeCornerPoints(n,a,i);var o=[0,0,0],s=[0,0,0];return ue(o,a,e.indexToWorld),ue(s,i,e.indexToWorld),Rc(o,s,r)},t.worldToIndexBounds=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],a=[0,0,0],i=[0,0,0];Je.computeCornerPoints(n,a,i);var o=[0,0,0],s=[0,0,0];return ue(o,a,e.worldToIndex),ue(s,i,e.worldToIndex),Rc(o,s,r)},t.onModified(t.computeTransforms),t.computeTransforms(),t.getCenter=function(){for(var n=t.getBounds(),r=[],a=0;a<3;a++)r[a]=(n[2*a+1]+n[2*a])/2;return r},t.computeHistogram=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,a=[0,0,0,0,0,0];t.worldToIndexBounds(n,a);var i=[0,0,0],o=[0,0,0];Je.computeCornerPoints(a,i,o),Oc(i,i),Oc(o,o);var s=t.getDimensions();Dc(i,[0,0,0],[s[0]-1,s[1]-1,s[2]-1],i),Dc(o,[0,0,0],[s[0]-1,s[1]-1,s[2]-1],o);for(var c=s[0],u=s[0]*s[1],g=t.getPointData().getScalars().getData(),f=-1/0,l=1/0,v=0,p=0,d=0,h=i[2];h<=o[2];h++)for(var T=i[1];T<=o[1];T++)for(var C=i[0]+T*c+h*u,m=i[0];m<=o[0];m++){if(!r||r([m,T,h],a)){var y=g[C];y>f&&(f=y),y<l&&(l=y),v+=y*y,p+=y,d+=1}++C}var w=d>0?p/d:0,S=d?Math.abs(v/d-w*w):0,O=Math.sqrt(S);return{minimum:l,maximum:f,average:w,variance:S,sigma:O,count:d}},t.computeIncrements=function(n){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,a=[],i=r,o=0;o<3;++o)a[o]=i,i*=n[o*2+1]-n[o*2]+1;return a},t.computeOffsetIndex=function(n){var r=dt(n,3),a=r[0],i=r[1],o=r[2],s=t.getExtent(),c=t.getPointData().getScalars().getNumberOfComponents(),u=t.computeIncrements(s,c);return Math.floor((Math.round(a)-s[0])*u[0]+(Math.round(i)-s[2])*u[1]+(Math.round(o)-s[4])*u[2])},t.getOffsetIndexFromWorld=function(n){for(var r=t.getExtent(),a=t.worldToIndex(n),i=0;i<3;++i)if(a[i]<r[i*2]||a[i]>r[i*2+1])return xn("GetScalarPointer: Pixel ".concat(a," is not in memory. Current extent = ").concat(r)),NaN;return t.computeOffsetIndex(a)},t.getScalarValueFromWorld=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=t.getPointData().getScalars().getNumberOfComponents();if(r<0||r>=a)return xn("GetScalarPointer: Scalar Component ".concat(r," is not within bounds. Current Scalar numberOfComponents: ").concat(a)),NaN;var i=t.getOffsetIndexFromWorld(n);return Number.isNaN(i)?i:t.getPointData().getScalars().getComponent(i,r)}}var uM={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:Gt.EMPTY};function P1(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uM,n),oa.extend(t,e,n),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=Jt(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),E.get(t,e,["direction","indexToWorld","worldToIndex"]),E.setGetArray(t,e,["origin","spacing"],3),E.getArray(t,e,["extent"],6),cM(t,e)}var fM=E.newInstance(P1,"vtkImageData"),Bo={newInstance:fM,extend:P1},gM={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},_c={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4},Go={VectorMode:gM,ScalarMappingTarget:_c},lM={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},vM={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},pM={BY_ID:0,BY_NAME:1},Qa={ColorMode:lM,GetArray:pM,ScalarMode:vM};function Cg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function hM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Cg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Cg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var wg=Go.ScalarMappingTarget,jt=Go.VectorMode,Dr=Ve.VtkDataTypes,Sg=Qa.ColorMode,Eg=E.vtkErrorMacro;function dM(t){return t}function xg(t){return Math.floor(t*255+.5)}function yM(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=function(){return t.setVectorMode(jt.MAGNITUDE)},t.setVectorModeToComponent=function(){return t.setVectorMode(jt.COMPONENT)},t.setVectorModeToRGBColors=function(){return t.setVectorMode(jt.RGBCOLORS)},t.build=function(){},t.isOpaque=function(){return!0},t.setAnnotations=function(n,r){if(!(n&&!r||!n&&r)){if(n&&r&&n.length!==r.length){Eg("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],r&&n)for(var a=r.length,i=0;i<a;i++)e.annotationArray.push({value:n[i],annotation:String(r[i])});t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=function(n,r){var a=t.checkForAnnotatedValue(n),i=!1;return a>=0?e.annotationArray[a].annotation!==r&&(e.annotationArray[a].annotation=r,i=!0):(e.annotationArray.push({value:n,annotation:r}),a=e.annotationArray.length-1,i=!0),i&&(t.updateAnnotatedValueMap(),t.modified()),a},t.getNumberOfAnnotatedValues=function(){return e.annotationArray.length},t.getAnnotatedValue=function(n){return n<0||n>=e.annotationArray.length?null:e.annotationArray[n].value},t.getAnnotation=function(n){return e.annotationArray[n]===void 0?null:e.annotationArray[n].annotation},t.getAnnotatedValueIndex=function(n){return e.annotationArray.length?t.checkForAnnotatedValue(n):-1},t.removeAnnotation=function(n){var r=t.checkForAnnotatedValue(n),a=r>=0;return a&&(e.annotationArray.splice(r,1),t.updateAnnotatedValueMap(),t.modified()),a},t.resetAnnotations=function(){e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=function(n,r){if(e.indexedLookup){var a=t.getAnnotatedValueIndex(n);t.getIndexedColor(a,r)}else t.getColor(parseFloat(n),r),r[3]=1},t.checkForAnnotatedValue=function(n){return t.getAnnotatedValueIndexInternal(n)},t.getAnnotatedValueIndexInternal=function(n){if(e.annotatedValueMap[n]!==void 0){var r=e.annotationArray.length;return e.annotatedValueMap[n]%r}return-1},t.getIndexedColor=function(n,r){r[0]=0,r[1]=0,r[2]=0,r[3]=0},t.updateAnnotatedValueMap=function(){e.annotatedValueMap=[];for(var n=e.annotationArray.length,r=0;r<n;r++)e.annotatedValueMap[e.annotationArray[r].value]=r},t.mapScalars=function(n,r,a){var i=n.getNumberOfComponents(),o=null;if(r===Sg.DEFAULT&&n.getDataType()===Dr.UNSIGNED_CHAR||r===Sg.DIRECT_SCALARS&&n)o=t.convertToRGBA(n,i,n.getNumberOfTuples());else{var s={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:Dr.UNSIGNED_CHAR},c=E.newTypedArray(s.dataType,4*n.getNumberOfTuples());s.values=c,s.size=c.length,o=Ve.newInstance(s);var u=a;u<0&&i>1?t.mapVectorsThroughTable(n,o,wg.RGBA,-1,-1):(u<0&&(u=0),u>=i&&(u=i-1),t.mapScalarsThroughTable(n,o,wg.RGBA,u))}return o},t.mapVectorsToMagnitude=function(n,r,a){for(var i=n.getNumberOfTuples(),o=n.getNumberOfComponents(),s=r.getData(),c=n.getData(),u=0;u<i;u++){for(var g=0,f=0;f<a;f++)g+=c[u*o+f]*c[u*o+f];s[u]=Math.sqrt(g)}},t.mapVectorsThroughTable=function(n,r,a,i,o){var s=t.getVectorMode(),c=o,u=i,g=n.getNumberOfComponents();s===jt.COMPONENT?(u===-1&&(u=t.getVectorComponent()),u<0&&(u=0),u>=g&&(u=g-1)):(c===-1&&(c=t.getVectorSize()),c<=0?(u=0,c=g):(u<0&&(u=0),u>=g&&(u=g-1),u+c>g&&(c=g-u)),s===jt.MAGNITUDE&&(g===1||c===1)&&(s=jt.COMPONENT));var f=0;switch(u>0&&(f=u),s){case jt.COMPONENT:{t.mapScalarsThroughTable(n,r,a,f);break}case jt.RGBCOLORS:break;case jt.MAGNITUDE:default:{var l=Ve.newInstance({numberOfComponents:1,values:new Float32Array(n.getNumberOfTuples())});t.mapVectorsToMagnitude(n,l,c),t.mapScalarsThroughTable(l,r,a,0);break}}},t.luminanceToRGBA=function(n,r,a,i){for(var o=i(a),s=r.getData(),c=n.getData(),u=s.length,g=0,f=1,l=0,v=g;v<u;v+=f){var p=i(s[v]);c[l*4]=p,c[l*4+1]=p,c[l*4+2]=p,c[l*4+3]=o,l++}},t.luminanceAlphaToRGBA=function(n,r,a,i){for(var o=r.getData(),s=n.getData(),c=o.length,u=0,g=2,f=0,l=u;l<c;l+=g){var v=i(o[l]);s[f]=v,s[f+1]=v,s[f+2]=v,s[f+3]=i(o[l+1])*a,f+=4}},t.rGBToRGBA=function(n,r,a,i){for(var o=xg(a),s=r.getData(),c=n.getData(),u=s.length,g=0,f=3,l=0,v=g;v<u;v+=f)c[l*4]=i(s[v]),c[l*4+1]=i(s[v+1]),c[l*4+2]=i(s[v+2]),c[l*4+3]=o,l++},t.rGBAToRGBA=function(n,r,a,i){for(var o=r.getData(),s=n.getData(),c=o.length,u=0,g=4,f=0,l=u;l<c;l+=g)s[f*4]=i(o[l]),s[f*4+1]=i(o[l+1]),s[f*4+2]=i(o[l+2]),s[f*4+3]=i(o[l+3])*a,f++},t.convertToRGBA=function(n,r,a){var i=e.alpha;if(r===4&&i>=1&&n.getDataType()===Dr.UNSIGNED_CHAR)return n;var o=Ve.newInstance({numberOfComponents:4,empty:!0,size:4*a,dataType:Dr.UNSIGNED_CHAR});if(a<=0)return o;i=i>0?i:0,i=i<1?i:1;var s=dM;switch((n.getDataType()===Dr.FLOAT||n.getDataType()===Dr.DOUBLE)&&(s=xg),r){case 1:t.luminanceToRGBA(o,n,i,s);break;case 2:t.luminanceAlphaToRGBA(o,n,s);break;case 3:t.rGBToRGBA(o,n,i,s);break;case 4:t.rGBAToRGBA(o,n,i,s);break;default:return Eg("Cannot convert colors"),null}return o},t.usingLogScale=function(){return!1},t.getNumberOfAvailableColors=function(){return 256*256*256},t.setRange=function(n,r){return t.setMappingRange(n,r)},t.getRange=function(n,r){return t.getMappingRange()}}var TM={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:jt.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1};function W1(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TM,n),E.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],E.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),E.setArray(t,e,["mappingRange"],2),E.getArray(t,e,["mappingRange"]),yM(t,e)}var mM=E.newInstance(W1,"vtkScalarsToColors"),bu=hM({newInstance:mM,extend:W1},Go),Og=E.vtkErrorMacro,Mg=0,Rg=1,ms=2;function CM(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=function(){if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){var n=!0;e.nanColor[3]<1&&(n=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(n=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(n=0);for(var r=3;r<e.table.length&&n;r+=4)e.table[r]<255&&(n=!1);e.opaqueFlag=n,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=function(){return!1},t.getNumberOfAvailableColors=function(){return e.table.length},t.linearIndexLookup=function(n,r){var a=0;return n<r.range[0]?a=r.maxIndex+Mg+1.5:n>r.range[1]?a=r.maxIndex+Rg+1.5:(a=(n+r.shift)*r.scale,a=a<r.maxIndex?a:r.maxIndex),Math.floor(a)},t.linearLookup=function(n,r,a){var i=0;no(n)?i=Math.floor(a.maxIndex+1.5+ms):i=t.linearIndexLookup(n,a);var o=4*i;return[r[o],r[o+1],r[o+2],r[o+3]]},t.indexedLookupFunction=function(n,r,a){var i=t.getAnnotatedValueIndexInternal(n);i===-1&&(i=e.numberOfColors+ms);var o=4*i;return[r[o],r[o+1],r[o+2],r[o+3]]},t.lookupShiftAndScale=function(n,r){r.shift=-n[0],r.scale=Number.MAX_VALUE,n[1]>n[0]&&(r.scale=(r.maxIndex+1)/(n[1]-n[0]))},t.mapScalarsThroughTable=function(n,r,a,i){var o=t.linearLookup;e.indexedLookup&&(o=t.indexedLookupFunction);var s=t.getMappingRange(),c={maxIndex:t.getNumberOfColors()-1,range:s,shift:0,scale:0};t.lookupShiftAndScale(s,c);var u=t.getAlpha(),g=n.getNumberOfTuples(),f=n.getNumberOfComponents(),l=r.getData(),v=n.getData();if(u>=1){if(a===_c.RGBA)for(var p=0;p<g;p++){var d=o(v[p*f+i],e.table,c);l[p*4]=d[0],l[p*4+1]=d[1],l[p*4+2]=d[2],l[p*4+3]=d[3]}}else if(a===_c.RGBA)for(var h=0;h<g;h++){var T=o(v[h*f+i],e.table,c);l[h*4]=T[0],l[h*4+1]=T[1],l[h*4+2]=T[2],l[h*4+3]=Math.floor(T[3]*u+.5)}},t.forceBuild=function(){var n=0,r=0,a=0,i=0,o=e.numberOfColors-1;o&&(n=(e.hueRange[1]-e.hueRange[0])/o,r=(e.saturationRange[1]-e.saturationRange[0])/o,a=(e.valueRange[1]-e.valueRange[0])/o,i=(e.alphaRange[1]-e.alphaRange[0])/o);for(var s=[],c=[],u=0;u<=o;u++)s[0]=e.hueRange[0]+u*n,s[1]=e.saturationRange[0]+u*r,s[2]=e.valueRange[0]+u*a,tr(s,c),c[3]=e.alphaRange[0]+u*i,e.table[u*4]=c[0]*255+.5,e.table[u*4+1]=c[1]*255+.5,e.table[u*4+2]=c[2]*255+.5,e.table[u*4+3]=c[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=function(n){if(n.getNumberOfComponents()!==4){Og("Expected 4 components for RGBA colors");return}if(n.getDataType()!==Xe.UNSIGNED_CHAR){Og("Expected unsigned char values for RGBA colors");return}e.numberOfColors=n.getNumberOfTuples();for(var r=n.getData(),a=0;a<r.length;a++)e.table[a]=r[a];t.buildSpecialColors(),e.insertTime.modified(),t.modified()},t.buildSpecialColors=function(){var n=e.numberOfColors,r=e.table,a=(n+Mg)*4;e.useBelowRangeColor||n===0?(r[a]=e.belowRangeColor[0]*255+.5,r[a+1]=e.belowRangeColor[1]*255+.5,r[a+2]=e.belowRangeColor[2]*255+.5,r[a+3]=e.belowRangeColor[3]*255+.5):(r[a]=r[0],r[a+1]=r[1],r[a+2]=r[2],r[a+3]=r[3]),a=(n+Rg)*4,e.useAboveRangeColor||n===0?(r[a]=e.aboveRangeColor[0]*255+.5,r[a+1]=e.aboveRangeColor[1]*255+.5,r[a+2]=e.aboveRangeColor[2]*255+.5,r[a+3]=e.aboveRangeColor[3]*255+.5):(r[a]=r[4*(n-1)+0],r[a+1]=r[4*(n-1)+1],r[a+2]=r[4*(n-1)+2],r[a+3]=r[4*(n-1)+3]),a=(n+ms)*4,r[a]=e.nanColor[0]*255+.5,r[a+1]=e.nanColor[1]*255+.5,r[a+2]=e.nanColor[2]*255+.5,r[a+3]=e.nanColor[3]*255+.5},t.build=function(){(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&e.insertTime.modified()}var wM={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function z1(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wM,n),bu.extend(t,e,n),e.table||(e.table=[]),e.buildTime={},E.obj(e.buildTime),e.opaqueFlagBuildTime={},E.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},E.obj(e.insertTime,{mtime:0}),E.get(t,e,["buildTime"]),E.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),E.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),E.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),E.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),CM(t,e)}var SM=E.newInstance(z1,"vtkLookupTable"),vi={newInstance:SM,extend:z1},$1=1,ku=0,EM=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function xM(){return $1}function OM(t){$1=t}function MM(){return ku}function Ao(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;ku=t}function RM(){Ao(0)}function DM(){Ao(0)}function VM(){Ao(1)}function LM(){return EM[ku]}var bc={getResolveCoincidentTopologyAsString:LM,getResolveCoincidentTopologyPolygonOffsetFaces:xM,getResolveCoincidentTopology:MM,setResolveCoincidentTopology:Ao,setResolveCoincidentTopologyPolygonOffsetFaces:OM,setResolveCoincidentTopologyToDefault:RM,setResolveCoincidentTopologyToOff:DM,setResolveCoincidentTopologyToPolygonOffset:VM};function j1(t,e,n){n.forEach(function(r){t["get".concat(r.method)]=function(){return e[r.key]},t["set".concat(r.method)]=function(a,i){e[r.key]={factor:a,offset:i}}})}var Uu=["Polygon","Line","Point"],NM={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},nr={};j1(nr,NM,Uu.map(function(t){return{key:t,method:"ResolveCoincidentTopology".concat(t,"OffsetParameters")}}));function FM(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),E.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(bc).forEach(function(n){t[n]=bc[n]}),Object.keys(nr).forEach(function(n){t[n]=nr[n]}),j1(t,e.topologyOffset,Uu.map(function(n){return{key:n,method:"RelativeCoincidentTopology".concat(n,"OffsetParameters")}})),t.getCoincidentTopologyPolygonOffsetParameters=function(){var n=nr.getResolveCoincidentTopologyPolygonOffsetParameters(),r=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyLineOffsetParameters=function(){var n=nr.getResolveCoincidentTopologyLineOffsetParameters(),r=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyPointOffsetParameter=function(){var n=nr.getResolveCoincidentTopologyPointOffsetParameters(),r=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}}}var sa={implementCoincidentTopologyMethods:FM,staticOffsetAPI:nr,otherStaticMethods:bc,CATEGORIES:Uu};function Dg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function Cs(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Dg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Dg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Vg=oa.FieldAssociations,_M=sa.staticOffsetAPI,bM=sa.otherStaticMethods,ws=Qa.ColorMode,Kn=Qa.ScalarMode,Ss=Qa.GetArray,kM=Go.VectorMode,UM=Ve.VtkDataTypes;function ha(t){return function(){return E.vtkErrorMacro("vtkMapper::".concat(t," - NOT IMPLEMENTED"))}}function BM(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=function(){var n=t.getInputData();return n?(e.static||t.update(),e.bounds=n.getBounds()):e.bounds=Zr(),e.bounds},t.setForceCompileOnly=function(n){e.forceCompileOnly=n},t.createDefaultLookupTable=function(){e.lookupTable=vi.newInstance()},t.getColorModeAsString=function(){return E.enumToString(ws,e.colorMode)},t.setColorModeToDefault=function(){return t.setColorMode(0)},t.setColorModeToMapScalars=function(){return t.setColorMode(1)},t.setColorModeToDirectScalars=function(){return t.setColorMode(2)},t.getScalarModeAsString=function(){return E.enumToString(Kn,e.scalarMode)},t.setScalarModeToDefault=function(){return t.setScalarMode(0)},t.setScalarModeToUsePointData=function(){return t.setScalarMode(1)},t.setScalarModeToUseCellData=function(){return t.setScalarMode(2)},t.setScalarModeToUsePointFieldData=function(){return t.setScalarMode(3)},t.setScalarModeToUseCellFieldData=function(){return t.setScalarMode(4)},t.setScalarModeToUseFieldData=function(){return t.setScalarMode(5)},t.getAbstractScalars=function(n,r,a,i,o){if(!n||!e.scalarVisibility)return{scalars:null,cellFLag:!1};var s=null,c=!1;if(r===Kn.DEFAULT)s=n.getPointData().getScalars(),s||(s=n.getCellData().getScalars(),c=!0);else if(r===Kn.USE_POINT_DATA)s=n.getPointData().getScalars();else if(r===Kn.USE_CELL_DATA)s=n.getCellData().getScalars(),c=!0;else if(r===Kn.USE_POINT_FIELD_DATA){var u=n.getPointData();a===Ss.BY_ID?s=u.getArrayByIndex(i):s=u.getArrayByName(o)}else if(r===Kn.USE_CELL_FIELD_DATA){var g=n.getCellData();c=!0,a===Ss.BY_ID?s=g.getArrayByIndex(i):s=g.getArrayByName(o)}else if(r===Kn.USE_FIELD_DATA){var f=n.getFieldData();a===Ss.BY_ID?s=f.getArrayByIndex(i):s=f.getArrayByName(o)}return{scalars:s,cellFlag:c}},t.mapScalars=function(n,r){var a=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!a){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}var i="".concat(t.getMTime()).concat(a.getMTime()).concat(r);if(e.colorBuildString!==i){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(n))t.mapScalarsToTexture(a,r);else{e.colorCoordinates=null,e.colorTextureMap=null;var o=t.getLookupTable();o&&(o.build(),e.colorMapColors=o.mapScalars(a,e.colorMode,e.fieldDataTupleId))}e.colorBuildString="".concat(t.getMTime()).concat(a.getMTime()).concat(r)}},t.scalarToTextureCoordinate=function(n,r,a){var i=.5,o=1;return no(n)||(o=.49,i=(n-r)*a,i>1e3?i=1e3:i<-1e3&&(i=-1e3)),{texCoordS:i,texCoordT:o}},t.createColorTextureCoordinates=function(n,r,a,i,o,s,c,u,g){var f=(s[1]-s[0])/u,l=[];l[0]=s[0]-f,l[1]=s[1]+f;var v=1/(l[1]-l[0]),p=r.getData(),d=n.getData(),h=0,T=0;if(o<0||o>=i)for(var C=0;C<a;++C){for(var m=0,y=0;y<i;++y)m+=d[h]*d[h],h++;var w=Math.sqrt(m);g&&(w=vi.applyLogScale(w,c,s));var S=t.scalarToTextureCoordinate(w,l[0],v);p[T]=S.texCoordS,p[T+1]=S.texCoordT,T+=2}else{h+=o;for(var O=0;O<a;++O){var M=d[h];g&&(M=vi.applyLogScale(M,c,s));var R=t.scalarToTextureCoordinate(M,l[0],v);p[T]=R.texCoordS,p[T+1]=R.texCoordT,T+=2,h+=i}}},t.mapScalarsToTexture=function(n,r){var a=e.lookupTable.getRange(),i=e.lookupTable.usingLogScale();i&&vi.getLogRange(a,a);var o=e.lookupTable.getAlpha();if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==r){e.lookupTable.setAlpha(r),e.colorTextureMap=null,e.lookupTable.build();var s=e.lookupTable.getNumberOfAvailableColors();s>4094&&(s=4094),s+=2;for(var c=(a[1]-a[0])/(s-1-2),u=new Float64Array(s*2),g=0;g<s;++g)u[g]=a[0]+g*c-c,i&&(u[g]=Math.pow(10,u[g]));for(var f=0;f<s;++f)u[f+s]=NaN;e.colorTextureMap=Bo.newInstance(),e.colorTextureMap.setExtent(0,s-1,0,1,0,0);var l=Ve.newInstance({numberOfComponents:1,values:u});e.colorTextureMap.getPointData().setScalars(e.lookupTable.mapScalars(l,e.colorMode,0)),e.lookupTable.setAlpha(o)}if(!e.colorCoordinates||t.getMTime()>e.colorCoordinates.getMTime()||t.getInputData(0).getMTime()>e.colorCoordinates.getMTime()||e.lookupTable.getMTime()>e.colorCoordinates.getMTime()){e.colorCoordinates=null;var v=n.getNumberOfComponents(),p=n.getNumberOfTuples();e.colorCoordinates=Ve.newInstance({numberOfComponents:2,values:new Float32Array(p*2)});var d=e.lookupTable.getVectorComponent();e.lookupTable.getVectorMode()===kM.MAGNITUDE&&n.getNumberOfComponents()>1&&(d=-1),t.createColorTextureCoordinates(n,e.colorCoordinates,p,v,d,a,e.lookupTable.getRange(),e.colorTextureMap.getPointData().getScalars().getNumberOfTuples()/2-2,i)}},t.getIsOpaque=function(){var n=t.getLookupTable();return n?(n.build(),n.isOpaque()):!0},t.canUseTextureMapForColoring=function(n){if(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup())return!1;var r=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName),a=r.scalars;return!(!a||r.cellFlag||e.colorMode===ws.DEFAULT&&a.getDataType()===UM.UNSIGNED_CHAR||e.colorMode===ws.DIRECT_SCALARS)},t.clearColorArrays=function(){e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=function(){return e.lookupTable||t.createDefaultLookupTable(),e.lookupTable},t.getMTime=function(){var n=e.mtime;if(e.lookupTable!==null){var r=e.lookupTable.getMTime();n=r>n?r:n}return n},t.getPrimitiveCount=function(){var n=t.getInputData(),r={points:n.getPoints().getNumberOfValues()/3,verts:n.getVerts().getNumberOfValues()-n.getVerts().getNumberOfCells(),lines:n.getLines().getNumberOfValues()-2*n.getLines().getNumberOfCells(),triangles:n.getPolys().getNumberOfValues()-3*n.getPolys().getNumberOfCells()};return r},t.acquireInvertibleLookupTable=ha("AcquireInvertibleLookupTable"),t.valueToColor=ha("ValueToColor"),t.colorToValue=ha("ColorToValue"),t.useInvertibleColorFor=ha("UseInvertibleColorFor"),t.clearInvertibleColor=ha("ClearInvertibleColor"),t.processSelectorPixelBuffers=function(n,r){if(!(!n||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)){var a=n.getRawPixelBuffer(pt.ID_LOW24),i=n.getRawPixelBuffer(pt.ID_HIGH24),o=n.getCurrentPass(),s=n.getFieldAssociation(),c=null;s===Vg.FIELD_ASSOCIATION_POINTS?c=e.selectionWebGLIdsToVTKIds.points:s===Vg.FIELD_ASSOCIATION_CELLS&&(c=e.selectionWebGLIdsToVTKIds.cells),c&&r.forEach(function(u){if(o===pt.ID_LOW24){var g=0;i&&(g+=i[u],g*=256),g+=a[u+2],g*=256,g+=a[u+1],g*=256,g+=a[u];var f=c[g],l=n.getPixelBuffer(pt.ID_LOW24);l[u]=f&255,l[u+1]=(f&65280)>>8,l[u+2]=(f&16711680)>>16}else if(o===pt.ID_HIGH24&&i){var v=0;v+=i[u],v*=256,v+=a[u],v*=256,v+=a[u+1],v*=256,v+=a[u+2];var p=c[v],d=n.getPixelBuffer(pt.ID_HIGH24);d[u]=(p&4278190080)>>24}})}}}var GM={colorMapColors:null,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,viewSpecificProperties:null,customShaderAttributes:[]};function H1(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GM,n),HO.extend(t,e,n),E.get(t,e,["colorCoordinates","colorMapColors","colorTextureMap"]),E.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","selectionWebGLIdsToVTKIds","static","useLookupTableScalarRange","viewSpecificProperties","customShaderAttributes"]),E.setGetArray(t,e,["scalarRange"],2),e.viewSpecificProperties||(e.viewSpecificProperties={}),sa.implementCoincidentTopologyMethods(t,e),BM(t,e)}var AM=E.newInstance(H1,"vtkMapper"),IM=Cs(Cs(Cs({newInstance:AM,extend:H1},_M),bM),Qa),K1=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`,Io=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;function PM(t,e){t.replaceShaderCoincidentOffset=function(n,r,a){var i=t.getCoincidentParameters(r,a);if(i&&(i.factor!==0||i.offset!==0)){var o=n.Fragment;o=_.substitute(o,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(i.factor!==0?(o=_.substitute(o,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,o=_.substitute(o,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):o=_.substitute(o,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(i.factor!==0?(o=_.substitute(o,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,o=_.substitute(o,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):o=_.substitute(o,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),n.Fragment=o}}}var q1={implementReplaceShaderCoincidentOffset:PM},Es=oa.FieldAssociations,Ze=aa.primTypes,Vr=ia.Representation,Lg=ia.Shading,pi=IM.ScalarMode,Ng=st.Filter,Fg=st.Wrap,qn=re,WM={type:"StartEvent"},zM={type:"EndEvent"};function $M(t){var e=t.getSelector();return e?e.getCurrentPass():pt.MIN_KNOWN_PASS-1}function jM(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=function(r){r&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e.openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e.openGLRenderer.getParent(),e.openGLCamera=e.openGLRenderer.getViewNodeFor(e.openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=function(r,a){r&&(e.currentRenderPass=a,t.render())},t.opaqueZBufferPass=function(r){r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaquePass=function(r){r&&t.render()},t.render=function(){var r=e._openGLRenderWindow.getContext();if(e.context!==r){e.context=r;for(var a=Ze.Start;a<Ze.End;a++)e.primitives[a].setOpenGLRenderWindow(e._openGLRenderWindow)}var i=e.openGLActor.getRenderable(),o=e.openGLRenderer.getRenderable();t.renderPiece(o,i)},t.buildShaders=function(r,a,i){t.getShaderTemplate(r,a,i),e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(r);var o=e.renderable.getViewSpecificProperties().OpenGL,s=null;if(o&&(s=o.ShaderReplacements),s)for(var c=0;c<s.length;c++){var u=s[c];if(u.replaceFirst){var g=u.shaderType,f=r[g],l=_.substitute(f,u.originalValue,u.replacementValue,u.replaceAll);r[g]=l.result}}if(t.replaceShaderValues(r,a,i),s)for(var v=0;v<s.length;v++){var p=s[v];if(!p.replaceFirst){var d=p.shaderType,h=r[d],T=_.substitute(h,p.originalValue,p.replacementValue,p.replaceAll);r[d]=T.result}}},t.getShaderTemplate=function(r,a,i){var o=e.renderable.getViewSpecificProperties().OpenGL,s=K1;if(o){var c=o.VertexShaderCode;c!==void 0&&c!==""&&(s=c)}r.Vertex=s;var u=Io;if(o){var g=o.FragmentShaderCode;g!==void 0&&g!==""&&(u=g)}r.Fragment=u;var f="";if(o){var l=o.GeometryShaderCode;l!==void 0&&(f=l)}r.Geometry=f},t.replaceShaderColor=function(r,a,i){var o=r.Vertex,s=r.Geometry,c=r.Fragment,u=e.lastBoundBO.getReferenceByName("lastLightComplexity"),g=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];u&&(g=g.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));var f=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];u&&(f=f.concat(["  vec3 specularColor;","  float specularPower;"])),f=f.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),u&&(f=f.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(g=g.concat(["varying vec4 vertexColorVSOutput;"]),o=_.substitute(o,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,o=_.substitute(o,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,s=_.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=_.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?c=_.substitute(c,"//VTK::Color::Impl",f.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:e.renderable.getInterpolateScalarsBeforeMapping()&&e.renderable.getColorCoordinates()&&!e.drawingEdges?c=_.substitute(c,"//VTK::Color::Impl",f.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(i.getBackfaceProperty()&&!e.drawingEdges&&(g=g.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),u?(g=g.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),f=f.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):f=f.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(g=g.concat(["uniform samplerBuffer texture1;"])),c=_.substitute(c,"//VTK::Color::Impl",f).result),c=_.substitute(c,"//VTK::Color::Dec",g).result,r.Vertex=o,r.Geometry=s,r.Fragment=c},t.replaceShaderLight=function(r,a,i){var o=r.Fragment,s="",c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),u=e.lastBoundBO.getReferenceByName("lastLightCount"),g=[];switch(c){case 0:o=_.substitute(o,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:o=_.substitute(o,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(var f=0;f<u;++f)g=g.concat(["uniform vec3 lightColor".concat(f,";"),"uniform vec3 lightDirectionVC".concat(f,"; // normalized"),"uniform vec3 lightHalfAngleVC".concat(f,"; // normalized")]);o=_.substitute(o,"//VTK::Light::Dec",g).result,g=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(var l=0;l<u;++l)g=g.concat(["  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC".concat(l,"));"),"  diffuseL += ((df".concat(s,") * lightColor").concat(l,");"),"  if (dot(normalVCVSOutput, lightDirectionVC".concat(l,") < 0.0)"),"    {","    float sf = pow( max(0.0, dot(lightHalfAngleVC".concat(l,",normalVCVSOutput)), specularPower);"),"    specularL += ((sf".concat(s,") * lightColor").concat(l,");"),"    }"]);g=g.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),o=_.substitute(o,"//VTK::Light::Impl",g,!1).result;break;case 3:for(var v=0;v<u;++v)g=g.concat(["uniform vec3 lightColor".concat(v,";"),"uniform vec3 lightDirectionVC".concat(v,"; // normalized"),"uniform vec3 lightHalfAngleVC".concat(v,"; // normalized"),"uniform vec3 lightPositionVC".concat(v,";"),"uniform vec3 lightAttenuation".concat(v,";"),"uniform float lightConeAngle".concat(v,";"),"uniform float lightExponent".concat(v,";"),"uniform int lightPositional".concat(v,";")]);o=_.substitute(o,"//VTK::Light::Dec",g).result,g=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(var p=0;p<u;++p)g=g.concat(["  attenuation = 1.0;","  if (lightPositional".concat(p," == 0)"),"    {","      vertLightDirectionVC = lightDirectionVC".concat(p,";"),"    }","  else","    {","    vertLightDirectionVC = vertexVC.xyz - lightPositionVC".concat(p,";"),"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /","      (lightAttenuation".concat(p,".x"),"       + lightAttenuation".concat(p,".y * distanceVC"),"       + lightAttenuation".concat(p,".z * distanceVC * distanceVC);"),"    // per OpenGL standard cone angle is 90 or less for a spot light","    if (lightConeAngle".concat(p," <= 90.0)"),"      {","      float coneDot = dot(vertLightDirectionVC, lightDirectionVC".concat(p,");"),"      // if inside the cone","      if (coneDot >= cos(radians(lightConeAngle".concat(p,")))"),"        {","        attenuation = attenuation * pow(coneDot, lightExponent".concat(p,");"),"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));","    diffuseL += ((df".concat(s,") * lightColor").concat(p,");"),"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {","      float sf = attenuation*pow( max(0.0, dot(lightHalfAngleVC".concat(p,",normalVCVSOutput)), specularPower);"),"    specularL += ((sf".concat(s,") * lightColor").concat(p,");"),"    }"]);g=g.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),o=_.substitute(o,"//VTK::Light::Impl",g,!1).result;break;default:qn("bad light complexity")}r.Fragment=o},t.replaceShaderNormal=function(r,a,i){var o=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(o>0){var s=r.Vertex,c=r.Geometry,u=r.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(s=_.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=_.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,c=_.substitute(c,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,c=_.substitute(c,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,u=_.substitute(u,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,u=_.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(u=_.substitute(u,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,u=_.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(i.getProperty().getRepresentation())===e.context.LINES?(u=_.substitute(u,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,u=_.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(u=_.substitute(u,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,u=_.substitute(u,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,u=_.substitute(u,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),r.Vertex=s,r.Geometry=c,r.Fragment=u}},t.replaceShaderPositionVC=function(r,a,i){e.lastBoundBO.replaceShaderPositionVC(r,a,i);var o=r.Vertex,s=r.Geometry,c=r.Fragment,u=e.lastBoundBO.getReferenceByName("lastLightComplexity");u>0?(o=_.substitute(o,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,o=_.substitute(o,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,o=_.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,s=_.substitute(s,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,s=_.substitute(s,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,c=_.substitute(c,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,c=_.substitute(c,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(o=_.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=_.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),r.Vertex=o,r.Geometry=s,r.Fragment=c},t.replaceShaderTCoord=function(r,a,i){if(e.lastBoundBO.getCABO().getTCoordOffset()){var o=r.Vertex,s=r.Geometry,c=r.Fragment;if(e.drawingEdges)return;o=_.substitute(o,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;var u=e.openGLActor.getActiveTextures(),g=2,f=2;if(u&&u.length>0&&(g=u[0].getComponents(),u[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(f=3)),e.renderable.getColorTextureMap()&&(g=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),f=2),f===2){if(o=_.substitute(o,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,s=_.substitute(s,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,s=_.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=_.substitute(c,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,u&&u.length>=1)switch(g){case 1:c=_.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=_.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=_.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(o=_.substitute(o,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,s=_.substitute(s,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,s=_.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=_.substitute(c,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,g){case 1:c=_.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=_.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=_.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}r.Vertex=o,r.Geometry=s,r.Fragment=c}},t.replaceShaderClip=function(r,a,i){var o=r.Vertex,s=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){var c=e.renderable.getNumberOfClippingPlanes();o=_.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[".concat(c,"];"),"varying float clipDistancesVSOutput[".concat(c,"];")]).result,o=_.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < ".concat(c,"; planeNum++)"),"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=_.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[".concat(c,"];")]).result,s=_.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < ".concat(c,"; planeNum++)"),"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=o,r.Fragment=s},t.getCoincidentParameters=function(r,a){var i={factor:0,offset:0},o=a.getProperty();if(e.renderable.getResolveCoincidentTopology()||o.getEdgeVisibility()&&o.getRepresentation()===Vr.SURFACE){var s=e.lastBoundBO.getPrimitiveType();s===Ze.Points||o.getRepresentation()===Vr.POINTS?i=e.renderable.getCoincidentTopologyPointOffsetParameter():s===Ze.Lines||o.getRepresentation()===Vr.WIREFRAME?i=e.renderable.getCoincidentTopologyLineOffsetParameters():(s===Ze.Tris||s===Ze.TriStrips)&&(i=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(s===Ze.TrisEdges||s===Ze.TriStripsEdges)&&(i=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),i.factor/=2,i.offset/=2)}var c=e.openGLRenderer.getSelector();return c&&c.getFieldAssociation()===Es.FIELD_ASSOCIATION_POINTS&&(i.offset-=2),i},t.replaceShaderPicking=function(r,a,i){var o=r.Fragment,s=r.Vertex;if(o=_.substitute(o,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e.openGLRenderer.getSelector()){switch((e.lastSelectionState===pt.ID_LOW24||e.lastSelectionState===pt.ID_HIGH24)&&(s=_.substitute(s,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,s=_.substitute(s,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,o=_.substitute(o,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,o=_.substitute(o,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case pt.ID_LOW24:o=_.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case pt.ID_HIGH24:o=_.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx)/255.0, 0.0, 0.0, 1.0);").result;break;default:o=_.substitute(o,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,o=_.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}r.Fragment=o,r.Vertex=s}},t.replaceShaderValues=function(r,a,i){if(t.replaceShaderColor(r,a,i),t.replaceShaderNormal(r,a,i),t.replaceShaderLight(r,a,i),t.replaceShaderTCoord(r,a,i),t.replaceShaderPicking(r,a,i),t.replaceShaderClip(r,a,i),t.replaceShaderCoincidentOffset(r,a,i),t.replaceShaderPositionVC(r,a,i),e.haveSeenDepthRequest){var o=r.Fragment;o=_.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=_.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,r.Fragment=o}},t.getNeedToRebuildShaders=function(r,a,i){var o=0,s=0,c=r.getPrimitiveType(),u=e.currentInput,g=!1,f=u.getPointData().getNormals(),l=u.getCellData().getNormals(),v=i.getProperty().getInterpolation()===Lg.FLAT,p=i.getProperty().getRepresentation(),d=r.getOpenGLMode(p,c);if((d===e.context.TRIANGLES||l&&!f||!v&&f||!v&&d===e.context.LINES)&&(g=!0),i.getProperty().getLighting()&&g){o=0;for(var h=a.getLightsByReference(),T=0;T<h.length;++T){var C=h[T],m=C.getSwitch();m>0&&(s++,o===0&&(o=1)),o===1&&(s>1||C.getIntensity()!==1||!C.lightTypeIsHeadLight())&&(o=2),o<3&&C.getPositional()&&(o=3)}}var y=!1,w=e.lastBoundBO.getReferenceByName("lastLightComplexity"),S=e.lastBoundBO.getReferenceByName("lastLightCount");return(w!==o||S!==s)&&(e.lastBoundBO.set({lastLightComplexity:o},!0),e.lastBoundBO.set({lastLightCount:s},!0),y=!0),!e.currentRenderPass&&e.lastRenderPassShaderReplacement&&(y=!0,e.lastRenderPassShaderReplacement=null),e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement&&(e.lastRenderPassShaderReplacement=e.currentRenderPass.getShaderReplacement(),y=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||r.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||y?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=function(r,a,i){var o=e.renderable.getViewSpecificProperties().ShadersCallbacks;o&&o.forEach(function(s){s.callback(s.userData,r,a,i)})},t.setMapperShaderParameters=function(r,a,i){if(r.getProgram().isUniformUsed("PrimitiveIDOffset")&&r.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),r.getProgram().isUniformUsed("VertexIDOffset")&&r.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){var o=e.lastBoundBO.getReferenceByName("lastLightComplexity");r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||qn("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("normalMC")&&r.getCABO().getNormalOffset()&&o>0?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"normalMC",r.getCABO().getNormalOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||qn("Error setting normalMC in shader VAO."):r.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach(function(S,O){r.getProgram().isAttributeUsed("".concat(S,"MC"))&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"".concat(S,"MC"),r.getCABO().getCustomData()[O].offset,r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getCustomData()[O].components,!1)||qn("Error setting ".concat(S,"MC in shader VAO.")))}),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),!1)||qn("Error setting tcoordMC in shader VAO."):r.getVAO().removeAttributeArray("tcoordMC"),r.getProgram().isAttributeUsed("scalarColor")&&r.getCABO().getColorComponents()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"scalarColor",r.getCABO().getColorOffset(),r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||qn("Error setting scalarColor in shader VAO."):r.getVAO().removeAttributeArray("scalarColor"),r.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){var s=e.renderable.getNumberOfClippingPlanes(),c=[],u=r.getCABO().getCoordShiftAndScaleEnabled(),g=u?r.getCABO().getInverseShiftAndScaleMatrix():null,f=g?Ke(e.tmpMat4,i.getMatrix()):i.getMatrix();g&&(Oe(f,f),Me(f,f,g),Oe(f,f));for(var l=0;l<s;l++){var v=[];e.renderable.getClippingPlaneInDataCoords(f,l,v);for(var p=0;p<4;p++)c.push(v[p])}r.getProgram().setUniformi("numClipPlanes",s),r.getProgram().setUniform4fv("clipPlanes",c)}e.internalColorTexture&&r.getProgram().isUniformUsed("texture1")&&r.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());var d=e.openGLActor.getActiveTextures();if(d)for(var h=0;h<d.length;++h){var T=d[h],C=T.getTextureUnit(),m="texture".concat(C+1);r.getProgram().isUniformUsed(m)&&r.getProgram().setUniformi(m,C)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){var y=t.getCoincidentParameters(a,i);r.getProgram().setUniformf("coffset",y.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",y.factor)}r.setMapperShaderParameters(a,i,e.openGLRenderer.getTiledSizeAndOrigin());var w=e.openGLRenderer.getSelector();r.getProgram().setUniform3fArray("mapperIndex",w?w.getPropColorValue():[0,0,0]),r.getProgram().setUniformi("picking",w?w.getCurrentPass()+1:0)},t.setLightingShaderParameters=function(r,a,i){var o=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(!(o<2)){for(var s=r.getProgram(),c=0,u=a.getLightsByReference(),g=0;g<u.length;++g){var f=u[g],l=f.getSwitch();if(l>0){var v=f.getColorByReference(),p=f.getIntensity();e.lightColor[0]=v[0]*p,e.lightColor[1]=v[1]*p,e.lightColor[2]=v[2]*p;var d=f.getDirection(),h=a.getActiveCamera().getViewMatrix(),T=Ne(d);f.lightTypeIsSceneLight()&&(T[0]=h[0]*d[0]+h[1]*d[1]+h[2]*d[2],T[1]=h[4]*d[0]+h[5]*d[1]+h[6]*d[2],T[2]=h[8]*d[0]+h[9]*d[1]+h[10]*d[2],lr(T)),e.lightDirection[0]=T[0],e.lightDirection[1]=T[1],e.lightDirection[2]=T[2],e.lightHalfAngle[0]=-e.lightDirection[0],e.lightHalfAngle[1]=-e.lightDirection[1],e.lightHalfAngle[2]=-e.lightDirection[2]+1,lr(e.lightDirection),s.setUniform3fArray("lightColor".concat(c),e.lightColor),s.setUniform3fArray("lightDirectionVC".concat(c),e.lightDirection),s.setUniform3fArray("lightHalfAngleVC".concat(c),e.lightHalfAngle),c++}}if(!(o<3)){var C=a.getActiveCamera(),m=C.getViewMatrix();Oe(m,m),c=0;for(var y=0;y<u.length;++y){var w=u[y],S=w.getSwitch();if(S>0){var O=w.getTransformedPosition(),M=new Float64Array(3);ue(M,O,m),s.setUniform3fArray("lightAttenuation".concat(c),w.getAttenuationValuesByReference()),s.setUniformi("lightPositional".concat(c),w.getPositional()),s.setUniformf("lightExponent".concat(c),w.getExponent()),s.setUniformf("lightConeAngle".concat(c),w.getConeAngle()),s.setUniform3fArray("lightPositionVC".concat(c),[M[0],M[1],M[2]]),c++}}}}};function n(r,a,i){return a.identity(i),r.reduce(function(o,s,c){return c===0?s?a.copy(o,s):a.identity(o):s?a.multiply(o,o,s):o},i)}t.setCameraShaderParameters=function(r,a,i){var o=r.getProgram(),s=e.openGLCamera.getKeyMatrices(a),c=a.getActiveCamera(),u=e.openGLCamera.getKeyMatrixTime().getMTime(),g=o.getLastCameraMTime(),f=r.getCABO().getCoordShiftAndScaleEnabled(),l=f?r.getCABO().getInverseShiftAndScaleMatrix():null,v=i.getIsIdentity(),p=v?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();o.setUniformMatrix("MCPCMatrix",n([s.wcpc,p.mcwc,l],Rf,e.tmpMat4)),o.isUniformUsed("MCVCMatrix")&&o.setUniformMatrix("MCVCMatrix",n([s.wcvc,p.mcwc,l],Rf,e.tmpMat4)),o.isUniformUsed("normalMatrix")&&o.setUniformMatrix3x3("normalMatrix",n([s.normalMatrix,p.normalMatrix],uT,e.tmpMat3)),g!==u&&(o.isUniformUsed("cameraParallel")&&o.setUniformi("cameraParallel",c.getParallelProjection()),o.setLastCameraMTime(u)),v||o.setLastCameraMTime(0)},t.setPropertyShaderParameters=function(r,a,i){var o=r.getProgram(),s=i.getProperty(),c=s.getOpacity(),u=e.drawingEdges?s.getEdgeColorByReference():s.getAmbientColorByReference(),g=e.drawingEdges?s.getEdgeColorByReference():s.getDiffuseColorByReference(),f=e.drawingEdges?1:s.getAmbient(),l=e.drawingEdges?0:s.getDiffuse(),v=e.drawingEdges?0:s.getSpecular(),p=s.getSpecularPower();o.setUniformf("opacityUniform",c),o.setUniform3fArray("ambientColorUniform",u),o.setUniform3fArray("diffuseColorUniform",g),o.setUniformf("ambient",f),o.setUniformf("diffuse",l);var d=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(!(d<1)){var h=s.getSpecularColorByReference();if(o.setUniform3fArray("specularColorUniform",h),o.setUniformf("specularPowerUniform",p),o.setUniformf("specular",v),o.isUniformUsed("ambientIntensityBF")){if(s=i.getBackfaceProperty(),c=s.getOpacity(),u=s.getAmbientColor(),f=s.getAmbient(),g=s.getDiffuseColor(),l=s.getDiffuse(),h=s.getSpecularColor(),v=s.getSpecular(),o.setUniformf("ambientIntensityBF",f),o.setUniformf("diffuseIntensityBF",l),o.setUniformf("opacityUniformBF",c),o.setUniform3fArray("ambientColorUniformBF",u),o.setUniform3fArray("diffuseColorUniformBF",g),d<1)return;o.setUniformf("specularIntensityBF",v),o.setUniform3fArray("specularColorUniformBF",h),o.setUniformf("specularPowerUniformBF",p)}}},t.updateMaximumPointCellIds=function(r,a){var i,o,s,c,u=e.openGLRenderer.getSelector();if(!!u){if((i=e.selectionWebGLIdsToVTKIds)!==null&&i!==void 0&&(o=i.points)!==null&&o!==void 0&&o.length){var g=e.selectionWebGLIdsToVTKIds.points.length;u.setMaximumPointId(g-1)}if((s=e.selectionWebGLIdsToVTKIds)!==null&&s!==void 0&&(c=s.cells)!==null&&c!==void 0&&c.length){var f=e.selectionWebGLIdsToVTKIds.cells.length;u.setMaximumCellId(f-1)}var l=u.getFieldAssociation();l===Es.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)}},t.renderPieceStart=function(r,a){e.primitiveIDOffset=0,e.vertexIDOffset=0;var i=$M(e.openGLRenderer);if(e.lastSelectionState!==i&&(e.selectionStateChanged.modified(),e.lastSelectionState=i),e.openGLRenderer.getSelector())switch(i){default:e.openGLRenderer.getSelector().renderProp(a)}t.updateBufferObjects(r,a),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=function(r,a){for(var i=a.getProperty().getRepresentation(),o=a.getProperty().getEdgeVisibility()&&i===Vr.SURFACE,s=e.openGLRenderer.getSelector(),c=s&&s.getFieldAssociation()===Es.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===pt.ID_LOW24||e.lastSelectionState===pt.ID_HIGH24),u=Ze.Start;u<Ze.End;u++){e.primitives[u].setPointPicking(c);var g=e.primitives[u].getCABO();g.getElementCount()&&(e.drawingEdges=o&&(u===Ze.TrisEdges||u===Ze.TriStripsEdges),(!e.drawingEdges||!e.renderDepth)&&(e.lastBoundBO=e.primitives[u],e.primitiveIDOffset+=e.primitives[u].drawArrays(r,a,i,t),e.vertexIDOffset+=e.primitives[u].getCABO().getElementCount()))}},t.renderPieceFinish=function(r,a){e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=function(r,a){if(t.invokeEvent(WM),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(zM),!e.currentInput){qn("No input!");return}if(!(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())){var i=e.context,o=a.getProperty().getBackfaceCulling(),s=a.getProperty().getFrontfaceCulling();!o&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),i.cullFace(i.FRONT)):(e._openGLRenderWindow.enableCullFace(),i.cullFace(i.BACK)),t.renderPieceStart(r,a),t.renderPieceDraw(r,a),t.renderPieceFinish(r,a)}},t.computeBounds=function(r,a){if(!t.getInput()){hr(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=function(r,a){t.getNeedToRebuildBufferObjects(r,a)&&t.buildBufferObjects(r,a)},t.getNeedToRebuildBufferObjects=function(r,a){var i=e.VBOBuildTime.getMTime();return i<t.getMTime()||i<e.renderable.getMTime()||i<a.getMTime()||i<e.currentInput.getMTime()},t.buildBufferObjects=function(r,a){var i=e.currentInput;if(i!==null){e.renderable.mapScalars(i,1);var o=e.renderable.getColorMapColors();e.haveCellScalars=!1;var s=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(s===pi.USE_CELL_DATA||s===pi.USE_CELL_FIELD_DATA||s===pi.USE_FIELD_DATA||!i.getPointData().getScalars())&&s!==pi.USE_POINT_FIELD_DATA&&o&&(e.haveCellScalars=!0);var c=a.getProperty().getInterpolation()!==Lg.FLAT?i.getPointData().getNormals():null;c===null&&i.getCellData().getNormals()&&(e.haveCellNormals=!0,c=i.getCellData().getNormals());var u=a.getProperty().getRepresentation(),g=i.getPointData().getTCoords();if(e.openGLActor.getActiveTextures()||(g=null),e.renderable.getColorCoordinates()){g=e.renderable.getColorCoordinates(),e.internalColorTexture||(e.internalColorTexture=st.newInstance());var f=e.internalColorTexture;f.setMinificationFilter(Ng.NEAREST),f.setMagnificationFilter(Ng.NEAREST),f.setWrapS(Fg.CLAMP_TO_EDGE),f.setWrapT(Fg.CLAMP_TO_EDGE),f.setOpenGLRenderWindow(e._openGLRenderWindow);var l=e.renderable.getColorTextureMap(),v=l.getExtent(),p=l.getPointData().getScalars();f.create2DFromRaw(v[1]-v[0]+1,v[3]-v[2]+1,p.getNumberOfComponents(),p.getDataType(),p.getData()),f.activate(),f.sendParameters(),f.deactivate()}var d="".concat(i.getMTime(),"A").concat(u,"B").concat(i.getMTime())+"C".concat(c?c.getMTime():1,"D").concat(o?o.getMTime():1)+"E".concat(a.getProperty().getEdgeVisibility())+"F".concat(g?g.getMTime():1);if(e.VBOBuildString!==d){var h=i.getPoints(),T={points:h,normals:c,tcoords:g,colors:o,cellOffset:0,vertexOffset:0,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(function(w){return i.getPointData().getArrayByName(w)})};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});for(var C=[{inRep:"verts",cells:i.getVerts()},{inRep:"lines",cells:i.getLines()},{inRep:"polys",cells:i.getPolys()},{inRep:"strips",cells:i.getStrips()},{inRep:"polys",cells:i.getPolys()},{inRep:"strips",cells:i.getStrips()}],m=a.getProperty().getEdgeVisibility()&&u===Vr.SURFACE,y=Ze.Start;y<Ze.End;y++)y!==Ze.TrisEdges&&y!==Ze.TriStripsEdges?(T.cellOffset+=e.primitives[y].getCABO().createVBO(C[y].cells,C[y].inRep,u,T,e.selectionWebGLIdsToVTKIds),T.vertexOffset+=e.primitives[y].getCABO().getElementCount()):m?e.primitives[y].getCABO().createVBO(C[y].cells,C[y].inRep,Vr.WIREFRAME,{points:h,normals:c,tcoords:null,colors:null,cellOffset:0,haveCellScalars:!1,haveCellNormals:!1}):e.primitives[y].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&(e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),t.updateMaximumPointCellIds()),e.VBOBuildTime.modified(),e.VBOBuildString=d}}}}var HM={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightHalfAngle:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:pt.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function X1(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HM,n),Qe.extend(t,e,n),q1.implementReplaceShaderCoincidentOffset(t,e,n),e.primitives=[],e.primTypes=Ze,e.tmpMat3=Jt(new Float64Array(9)),e.tmpMat4=ie(new Float64Array(16));for(var r=Ze.Start;r<Ze.End;r++)e.primitives[r]=aa.newInstance(),e.primitives[r].setPrimitiveType(r),e.primitives[r].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);at(t,e,["context"]),e.VBOBuildTime={},Ge(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},Ge(e.selectionStateChanged,{mtime:0}),jM(t,e)}var Y1=ke(X1,"vtkOpenGLPolyDataMapper"),Po={newInstance:Y1,extend:X1};yt("vtkMapper",Y1);function _g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function KM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_g(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_g(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var da=re,qM=ia.Representation,hi=ln.ObjectType,XM=Mu.PassTypes,YM={type:"StartEvent"},ZM={type:"EndEvent"};function JM(t,e){e.classHierarchy.push("vtkOpenGLGlyph3DMapper");var n=KM({},t);t.renderPiece=function(r,a){if(t.invokeEvent(YM),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(1),t.invokeEvent(ZM),!e.currentInput){da("No input!");return}if(!(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())){var i=e.context;e._openGLRenderWindow.getWebgl2()?(e.hardwareSupport=!0,e.extension=null):e.extension||(e.extension=e.context.getExtension("ANGLE_instanced_arrays"),e.hardwareSupport=!!e.extension);var o=a.getProperty().getBackfaceCulling(),s=a.getProperty().getFrontfaceCulling();!o&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),i.cullFace(i.FRONT)):(e._openGLRenderWindow.enableCullFace(),i.cullFace(i.BACK)),t.renderPieceStart(r,a),t.renderPieceDraw(r,a),t.renderPieceFinish(r,a)}},t.multiply4x4WithOffset=function(r,a,i,o){var s=a[0],c=a[1],u=a[2],g=a[3],f=a[4],l=a[5],v=a[6],p=a[7],d=a[8],h=a[9],T=a[10],C=a[11],m=a[12],y=a[13],w=a[14],S=a[15],O=i[o],M=i[o+1],R=i[o+2],D=i[o+3];r[0]=O*s+M*f+R*d+D*m,r[1]=O*c+M*l+R*h+D*y,r[2]=O*u+M*v+R*T+D*w,r[3]=O*g+M*p+R*C+D*S,O=i[o+4],M=i[o+5],R=i[o+6],D=i[o+7],r[4]=O*s+M*f+R*d+D*m,r[5]=O*c+M*l+R*h+D*y,r[6]=O*u+M*v+R*T+D*w,r[7]=O*g+M*p+R*C+D*S,O=i[o+8],M=i[o+9],R=i[o+10],D=i[o+11],r[8]=O*s+M*f+R*d+D*m,r[9]=O*c+M*l+R*h+D*y,r[10]=O*u+M*v+R*T+D*w,r[11]=O*g+M*p+R*C+D*S,O=i[o+12],M=i[o+13],R=i[o+14],D=i[o+15],r[12]=O*s+M*f+R*d+D*m,r[13]=O*c+M*l+R*h+D*y,r[14]=O*u+M*v+R*T+D*w,r[15]=O*g+M*p+R*C+D*S},t.replaceShaderNormal=function(r,a,i){if(e.hardwareSupport){var o=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(o>0){var s=r.Vertex;e.lastBoundBO.getCABO().getNormalOffset()&&(s=_.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","attribute mat3 gNormal;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=_.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * gNormal * normalMC;"]).result),r.Vertex=s}}n.replaceShaderNormal(r,a,i)},t.replaceShaderColor=function(r,a,i){if(e.hardwareSupport&&e.renderable.getColorArray()){var o=r.Vertex,s=r.Geometry,c=r.Fragment,u=e.lastBoundBO.getReferenceByName("lastLightComplexity"),g=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity"];u&&(g=g.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));var f=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];u&&(f=f.concat(["  vec3 specularColor;","  float specularPower;"])),f=f.concat(["  opacity = opacityUniform;"]),u&&(f=f.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.drawingEdges||(g=g.concat(["varying vec4 vertexColorVSOutput;"]),o=_.substitute(o,"//VTK::Color::Dec",["attribute vec4 gColor;","varying vec4 vertexColorVSOutput;"]).result,o=_.substitute(o,"//VTK::Color::Impl",["vertexColorVSOutput = gColor;"]).result,s=_.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=_.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result,f=f.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])),c=_.substitute(c,"//VTK::Color::Impl",f).result,c=_.substitute(c,"//VTK::Color::Dec",g).result,r.Vertex=o,r.Geometry=s,r.Fragment=c}n.replaceShaderColor(r,a,i)},t.replaceShaderPositionVC=function(r,a,i){if(e.hardwareSupport){var o=r.Vertex,s=e.lastBoundBO.getReferenceByName("lastLightComplexity");s>0?(o=_.substitute(o,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","vertexVCVSOutput = MCVCMatrix * gVertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result,o=_.substitute(o,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result):(o=_.substitute(o,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;"]).result,o=_.substitute(o,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result),r.Vertex=o}n.replaceShaderPositionVC(r,a,i)},t.replaceShaderPicking=function(r,a,i){if(e.hardwareSupport){var o=r.Fragment,s=r.Vertex;s=_.substitute(s,"//VTK::Picking::Dec",["attribute vec3 mapperIndexVS;","varying vec3 mapperIndexVSOutput;"]).result,s=_.substitute(s,"//VTK::Picking::Impl","  mapperIndexVSOutput = mapperIndexVS;").result,r.Vertex=s,o=_.substitute(o,"//VTK::Picking::Dec",["varying vec3 mapperIndexVSOutput;","uniform vec3 mapperIndex;","uniform int picking;"]).result,o=_.substitute(o,"//VTK::Picking::Impl",["  vec4 pickColor = picking == 2 ? vec4(mapperIndexVSOutput,1.0) : vec4(mapperIndex,1.0);","  gl_FragData[0] = picking != 0 ? pickColor : gl_FragData[0];"]).result,r.Fragment=o}else n.replaceShaderPicking(r,a,i)},t.updateGlyphShaderParameters=function(r,a,i,o,s,c,u,g){var f=i.getProgram();if(r){var l=e.normalMatrix,v=c,p=u*9,d=e.tmpMat3,h=l[0],T=l[1],C=l[2],m=l[3],y=l[4],w=l[5],S=l[6],O=l[7],M=l[8],R=v[p],D=v[p+1],L=v[p+2],N=v[p+3],U=v[p+4],b=v[p+5],G=v[p+6],P=v[p+7],z=v[p+8];d[0]=R*h+D*m+L*S,d[1]=R*T+D*y+L*O,d[2]=R*C+D*w+L*M,d[3]=N*h+U*m+b*S,d[4]=N*T+U*y+b*O,d[5]=N*C+U*w+b*M,d[6]=G*h+P*m+z*S,d[7]=G*T+P*y+z*O,d[8]=G*C+P*w+z*M,f.setUniformMatrix3x3("normalMatrix",e.tmpMat3)}if(t.multiply4x4WithOffset(e.tmpMat4,e.mcpcMatrix,s,u*16),f.setUniformMatrix("MCPCMatrix",e.tmpMat4),a&&(t.multiply4x4WithOffset(e.tmpMat4,e.mcvcMatrix,s,u*16),f.setUniformMatrix("MCVCMatrix",e.tmpMat4)),o){var F=o.getData();e.tmpColor[0]=F[u*4]/255,e.tmpColor[1]=F[u*4+1]/255,e.tmpColor[2]=F[u*4+2]/255,f.setUniform3fArray("ambientColorUniform",e.tmpColor),f.setUniform3fArray("diffuseColorUniform",e.tmpColor)}g&&f.setUniform3fArray("mapperIndex",g.getPropColorValue())},t.renderPieceDraw=function(r,a){var i=a.getProperty().getRepresentation(),o=e.context,s=a.getProperty().getEdgeVisibility()&&i===qM.SURFACE,c=e.openGLCamera.getKeyMatrices(r),u=e.openGLActor.getKeyMatrices();In(e.normalMatrix,c.normalMatrix,u.normalMatrix),Me(e.mcpcMatrix,c.wcpc,u.mcwc),Me(e.mcvcMatrix,c.wcvc,u.mcwc);var g=e.renderable.getMatrixArray(),f=e.renderable.getNormalArray(),l=e.renderable.getColorArray(),v=g.length/16,p=!1;e.openGLRenderer.getSelector()&&e.openGLRenderer.getSelector().getCurrentPass()===XM.COMPOSITE_INDEX_PASS&&(p=!0);for(var d=e.primTypes.Start;d<e.primTypes.End;d++){var h=e.primitives[d].getCABO();if(h.getElementCount()){e.drawingEdges=s&&(d===e.primTypes.TrisEdges||d===e.primTypes.TriStripsEdges),e.lastBoundBO=e.primitives[d],e.primitives[d].updateShaders(r,a,t);var T=e.primitives[d].getProgram(),C=e.primitives[d].getOpenGLMode(i),m=T.isUniformUsed("normalMatrix"),y=T.isUniformUsed("MCVCMatrix");if(e.hardwareSupport)e.extension?e.extension.drawArraysInstancedANGLE(C,0,h.getElementCount(),v):o.drawArraysInstanced(C,0,h.getElementCount(),v);else for(var w=0;w<v;++w)p&&e.openGLRenderer.getSelector().renderCompositeIndex(w),t.updateGlyphShaderParameters(m,y,e.primitives[d],l,g,f,w,p?e.openGLRenderer.getSelector():null),o.drawArrays(C,0,h.getElementCount())}}},t.setMapperShaderParameters=function(r,a,i){if(r.getCABO().getElementCount()&&(e.glyphBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){r.getProgram().isAttributeUsed("gMatrix")?r.getVAO().addAttributeMatrixWithDivisor(r.getProgram(),e.matrixBuffer,"gMatrix",0,64,e.context.FLOAT,4,!1,1)||da("Error setting gMatrix in shader VAO."):r.getVAO().removeAttributeArray("gMatrix"),r.getProgram().isAttributeUsed("gNormal")?r.getVAO().addAttributeMatrixWithDivisor(r.getProgram(),e.normalBuffer,"gNormal",0,36,e.context.FLOAT,3,!1,1)||da("Error setting gNormal in shader VAO."):r.getVAO().removeAttributeArray("gNormal"),r.getProgram().isAttributeUsed("gColor")?r.getVAO().addAttributeArrayWithDivisor(r.getProgram(),e.colorBuffer,"gColor",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||da("Error setting gColor in shader VAO."):r.getVAO().removeAttributeArray("gColor"),r.getProgram().isAttributeUsed("mapperIndexVS")?r.getVAO().addAttributeArrayWithDivisor(r.getProgram(),e.pickBuffer,"mapperIndexVS",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||da("Error setting mapperIndexVS in shader VAO."):r.getVAO().removeAttributeArray("mapperIndexVS"),n.setMapperShaderParameters(r,a,i),r.getAttributeUpdateTime().modified();return}n.setMapperShaderParameters(r,a,i)},t.getNeedToRebuildBufferObjects=function(r,a){e.renderable.buildArrays();var i=e.VBOBuildTime.getMTime();return i<e.renderable.getBuildTime().getMTime()?!0:n.getNeedToRebuildBufferObjects(r,a)},t.getNeedToRebuildShaders=function(r,a,i){return!!(n.getNeedToRebuildShaders(r,a,i)||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime())},t.buildBufferObjects=function(r,a){if(e.hardwareSupport){var i=e.renderable.getMatrixArray(),o=e.renderable.getNormalArray(),s=e.renderable.getColorArray();if(e.matrixBuffer||(e.matrixBuffer=ln.newInstance(),e.matrixBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.normalBuffer=ln.newInstance(),e.normalBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorBuffer=ln.newInstance(),e.colorBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.pickBuffer=ln.newInstance(),e.pickBuffer.setOpenGLRenderWindow(e._openGLRenderWindow)),e.renderable.getBuildTime().getMTime()>e.glyphBOBuildTime.getMTime()){e.matrixBuffer.upload(i,hi.ARRAY_BUFFER),e.normalBuffer.upload(o,hi.ARRAY_BUFFER),s?e.colorBuffer.upload(s.getData(),hi.ARRAY_BUFFER):e.colorBuffer.releaseGraphicsResources();for(var c=i.length/16,u=new Uint8Array(4*c),g=0;g<c;++g){var f=g+1,l=g*4;u[l]=f%256,f-=u[l],f/=256,u[l+1]=f%256,f-=u[l+1],f/=256,u[l+2]=f%256,u[l+3]=255}e.pickBuffer.upload(u,hi.ARRAY_BUFFER),e.glyphBOBuildTime.modified()}}return n.buildBufferObjects(r,a)}}var QM={normalMatrix:null,mcpcMatrix:null,mcwcMatrix:null};function Z1(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QM,n),Po.extend(t,e,n),e.tmpMat3=Jt(new Float64Array(9)),e.normalMatrix=Jt(new Float64Array(9)),e.mcpcMatrix=ie(new Float64Array(16)),e.mcvcMatrix=ie(new Float64Array(16)),e.tmpColor=[],e.glyphBOBuildTime={},Ge(e.glyphBOBuildTime,{mtime:0}),JM(t,e)}var J1=ke(Z1,"vtkOpenGLGlyph3DMapper"),eR={newInstance:J1,extend:Z1};yt("vtkGlyph3DMapper",J1);var tR={NONE:-1,I:0,J:1,K:2,X:3,Y:4,Z:5},Wo={SlicingMode:tR},uo={NEAREST:0,LINEAR:1},nR={InterpolationType:uo},Lr=re,bt=Wo.SlicingMode;function bg(t,e,n){var r=e.apply(t);if(r){var a=t.getIndependentComponents();return"".concat(t.getMTime(),"-").concat(a,"-").concat(n)}return"0"}function rR(t,e){e.classHierarchy.push("vtkOpenGLImageMapper"),t.buildPass=function(n){if(n){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e.openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e.openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow);var r=e.openGLRenderer.getRenderable();e.openGLCamera=e.openGLRenderer.getViewNodeFor(r.getActiveCamera()),e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(r.getActiveCamera())}},t.translucentPass=function(n,r){n&&(e.currentRenderPass=r,t.render())},t.opaqueZBufferPass=function(n){n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaquePass=function(n){n&&t.render()},t.getCoincidentParameters=function(n,r){return e.renderable.getResolveCoincidentTopology()?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null},t.render=function(){var n=e.openGLImageSlice.getRenderable(),r=e.openGLRenderer.getRenderable();t.renderPiece(r,n)},t.buildShaders=function(n,r,a){t.getShaderTemplate(n,r,a),e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(n),t.replaceShaderValues(n,r,a)},t.getShaderTemplate=function(n,r,a){n.Vertex=K1,n.Fragment=Io,n.Geometry=""},t.replaceShaderValues=function(n,r,a){var i=n.Vertex,o=n.Fragment;i=_.substitute(i,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,i=_.substitute(i,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result,i=_.substitute(i,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result,i=_.substitute(i,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result;var s=e.openGLTexture.getComponents(),c=a.getProperty().getIndependentComponents(),u=["varying vec2 tcoordVCVSOutput;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D texture1;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;"];if(c){for(var g=1;g<s;g++)u=u.concat(["uniform float cshift".concat(g,";"),"uniform float cscale".concat(g,";"),"uniform float pwfshift".concat(g,";"),"uniform float pwfscale".concat(g,";")]);switch(s){case 1:u=u.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:u=u.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:u=u.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:u=u.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:Lr("Unsupported number of independent coordinates.")}}if(o=_.substitute(o,"//VTK::TCoord::Dec",u).result,c){for(var f=["r","g","b","a"],l=["vec4 tvalue = texture2D(texture1, tcoordVCVSOutput);"],v=0;v<s;v++)l=l.concat(["vec3 tcolor".concat(v," = mix").concat(v," * texture2D(colorTexture1, vec2(tvalue.").concat(f[v]," * cscale").concat(v," + cshift").concat(v,", height").concat(v,")).rgb;"),"float compWeight".concat(v," = mix").concat(v," * texture2D(pwfTexture1, vec2(tvalue.").concat(f[v]," * pwfscale").concat(v," + pwfshift").concat(v,", height").concat(v,")).r;")]);switch(s){case 1:l=l.concat(["gl_FragData[0] = vec4(tcolor0.rgb, opacity);"]);break;case 2:l=l.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:l=l.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:l=l.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:Lr("Unsupported number of independent coordinates.")}o=_.substitute(o,"//VTK::TCoord::Impl",l).result}else switch(s){case 1:o=_.substitute(o,"//VTK::TCoord::Impl",["float intensity = texture2D(texture1, tcoordVCVSOutput).r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]).result;break;case 2:o=_.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","float intensity = tcolor.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tcolor.g + pwfshift0);"]).result;break;case 3:o=_.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]).result;break;default:o=_.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"]).result}e.haveSeenDepthRequest&&(o=_.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=_.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=i,n.Fragment=o,t.replaceShaderClip(n,r,a),t.replaceShaderCoincidentOffset(n,r,a)},t.replaceShaderClip=function(n,r,a){var i=n.Vertex,o=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){var s=e.renderable.getNumberOfClippingPlanes();s>6&&(re("OpenGL has a limit of 6 clipping planes"),s=6),i=_.substitute(i,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,i=_.substitute(i,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=_.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,o=_.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=i,n.Fragment=o},t.getNeedToRebuildShaders=function(n,r,a){var i=e.openGLTexture.getComponents(),o=a.getProperty().getIndependentComponents(),s=!1;return!e.currentRenderPass&&e.lastRenderPassShaderReplacement&&(s=!0,e.lastRenderPassShaderReplacement=null),e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement&&(e.lastRenderPassShaderReplacement=e.currentRenderPass.getShaderReplacement(),s=!0),s||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||n.getProgram()===0||e.lastTextureComponents!==i||e.lastIndependentComponents!==o?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=i,e.lastIndependentComponents=o,!0):!1},t.updateShaders=function(n,r,a){if(e.lastBoundBO=n,t.getNeedToRebuildShaders(n,r,a)){var i={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(i,r,a);var o=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(i.Vertex,i.Fragment,i.Geometry);o!==n.getProgram()&&(n.setProgram(o),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),t.setMapperShaderParameters(n,r,a),t.setCameraShaderParameters(n,r,a),t.setPropertyShaderParameters(n,r,a)},t.setMapperShaderParameters=function(n,r,a){n.getCABO().getElementCount()&&(e.VBOBuildTime>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(n.getProgram().isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexMC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Lr("Error setting vertexMC in shader VAO.")),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),e.context.FALSE)||Lr("Error setting tcoordMC in shader VAO.")),n.getAttributeUpdateTime().modified());var i=e.openGLTexture.getTextureUnit();n.getProgram().setUniformi("texture1",i);var o=e.openGLTexture.getComponents(),s=a.getProperty().getIndependentComponents();if(s)for(var c=0;c<o;c++)n.getProgram().setUniformf("mix".concat(c),a.getProperty().getComponentWeight(c));for(var u=e.openGLTexture.getShiftAndScale(),g=0;g<o;g++){var f=a.getProperty().getColorWindow(),l=a.getProperty().getColorLevel(),v=s?g:0,p=a.getProperty().getRGBTransferFunction(v);if(p&&a.getProperty().getUseLookupTableScalarRange()){var d=p.getRange();f=d[1]-d[0],l=.5*(d[1]+d[0])}var h=u.scale/f,T=(u.shift-l)/f+.5;n.getProgram().setUniformf("cshift".concat(g),T),n.getProgram().setUniformf("cscale".concat(g),h)}for(var C=0;C<o;C++){var m=1,y=0,w=s?C:0,S=a.getProperty().getPiecewiseFunction(w);if(S){var O=S.getRange(),M=O[1]-O[0],R=.5*(O[0]+O[1]);m=u.scale/M,y=(u.shift-R)/M+.5}n.getProgram().setUniformf("pwfshift".concat(C),y),n.getProgram().setUniformf("pwfscale".concat(C),m)}if(e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){var D=t.getCoincidentParameters(r,a);n.getProgram().setUniformf("coffset",D.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",D.factor)}var L=e.colorTexture.getTextureUnit();n.getProgram().setUniformi("colorTexture1",L);var N=e.pwfTexture.getTextureUnit();if(n.getProgram().setUniformi("pwfTexture1",N),e.renderable.getNumberOfClippingPlanes()){var U=e.renderable.getNumberOfClippingPlanes();U>6&&(re("OpenGL has a limit of 6 clipping planes"),U=6);var b=e.currentInput,G=b.getWorldToIndex(),P=n.getCABO().getCoordShiftAndScaleEnabled(),z=P?n.getCABO().getInverseShiftAndScaleMatrix():null,F=z?Ke(e.imagematinv,a.getMatrix()):a.getMatrix();z&&(Oe(F,F),Me(F,F,z),Oe(F,F)),Me(e.imagematinv,F,G);for(var V=[],B=0;B<U;B++){var W=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,B,W);for(var I=0;I<4;I++)V.push(W[I])}n.getProgram().setUniformi("numClipPlanes",U),n.getProgram().setUniform4fv("clipPlanes",V)}},t.setCameraShaderParameters=function(n,r,a){var i=n.getProgram(),o=e.openGLImageSlice.getKeyMatrices(),s=e.currentInput,c=s.getIndexToWorld();Me(e.imagemat,o.mcwc,c);var u=e.openGLCamera.getKeyMatrices(r);if(Me(e.imagemat,u.wcpc,e.imagemat),n.getCABO().getCoordShiftAndScaleEnabled()){var g=n.getCABO().getInverseShiftAndScaleMatrix();Me(e.imagemat,e.imagemat,g)}i.setUniformMatrix("MCPCMatrix",e.imagemat)},t.setPropertyShaderParameters=function(n,r,a){var i=n.getProgram(),o=a.getProperty(),s=o.getOpacity();i.setUniformf("opacity",s)},t.renderPieceStart=function(n,r){t.updateBufferObjects(n,r),e.lastBoundBO=null},t.renderPieceDraw=function(n,r){var a=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,n,r),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=function(n,r){},t.renderPiece=function(n,r){if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){Lr("No input!");return}t.renderPieceStart(n,r),t.renderPieceDraw(n,r),t.renderPieceFinish(n,r)},t.computeBounds=function(n,r){if(!t.getInput()){hr(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=function(n,r){t.getNeedToRebuildBufferObjects(n,r)&&t.buildBufferObjects(n,r)},t.getNeedToRebuildBufferObjects=function(n,r){return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<r.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<r.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()},t.buildBufferObjects=function(n,r){var a=e.currentInput;if(!!a){var i=a.getPointData()&&a.getPointData().getScalars();if(!!i){var o=r.getProperty(),s=o.getInterpolationType();s===uo.NEAREST?(e.colorTexture.setMinificationFilter(xe.NEAREST),e.colorTexture.setMagnificationFilter(xe.NEAREST),e.pwfTexture.setMinificationFilter(xe.NEAREST),e.pwfTexture.setMagnificationFilter(xe.NEAREST)):(e.colorTexture.setMinificationFilter(xe.LINEAR),e.colorTexture.setMagnificationFilter(xe.LINEAR),e.pwfTexture.setMinificationFilter(xe.LINEAR),e.pwfTexture.setMagnificationFilter(xe.LINEAR));var c=i.getNumberOfComponents(),u=o.getIndependentComponents(),g=u?c:1,f=u?2*g:1,l=bg(o,o.getRGBTransferFunction,g);if(e.colorTextureString!==l){var v=1024,p=v*f*3,d=new Uint8Array(p),h=o.getRGBTransferFunction();if(h){for(var T=new Float32Array(v*3),C=0;C<g;C++){h=o.getRGBTransferFunction(C);var m=h.getRange();if(h.getTable(m[0],m[1],v,T,1),u)for(var y=0;y<v*3;y++)d[C*v*6+y]=255*T[y],d[C*v*6+y+v*3]=255*T[y];else for(var w=0;w<v*3;w++)d[C*v*6+w]=255*T[w]}e.colorTexture.create2DFromRaw(v,f,3,Xe.UNSIGNED_CHAR,d)}else{for(var S=0;S<v*3;++S)d[S]=255*S/((v-1)*3),d[S+1]=255*S/((v-1)*3),d[S+2]=255*S/((v-1)*3);e.colorTexture.create2DFromRaw(v,1,3,Xe.UNSIGNED_CHAR,d)}e.colorTextureString=l}var O=bg(o,o.getPiecewiseFunction,g);if(e.pwfTextureString!==O){var M=1024,R=M*f,D=new Uint8Array(R),L=o.getPiecewiseFunction();if(e.pwfTexture.resetFormatAndType(),L){for(var N=new Float32Array(R),U=new Float32Array(M),b=0;b<g;++b)if(L=o.getPiecewiseFunction(b),L===null)N.fill(1);else{var G=L.getRange();if(L.getTable(G[0],G[1],M,U,1),u)for(var P=0;P<M;P++)N[b*M*2+P]=U[P],N[b*M*2+P+M]=U[P];else for(var z=0;z<M;z++)N[b*M*2+z]=U[z]}e.pwfTexture.create2DFromRaw(M,f,1,Xe.FLOAT,N)}else D.fill(255),e.pwfTexture.create2DFromRaw(M,1,1,Xe.UNSIGNED_CHAR,D);e.pwfTextureString=O}var F=e.renderable.getClosestIJKAxis(),V=F.ijkMode,B=e.renderable.getSlice();V!==e.renderable.getSlicingMode()&&(B=e.renderable.getSliceAtPosition(B));var W=Math.round(B),I=a.getExtent(),$;V===bt.I&&($=W-I[0]),V===bt.J&&($=W-I[2]),(V===bt.K||V===bt.NONE)&&($=W-I[4]);var Q="".concat(B,"A").concat(a.getMTime(),"A").concat(i.getMTime(),"B").concat(t.getMTime(),"C").concat(e.renderable.getSlicingMode(),"D").concat(r.getProperty().getMTime());if(e.VBOBuildString!==Q){var H=a.getDimensions();s===uo.NEAREST?(c===4&&e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(xe.NEAREST),e.openGLTexture.setMagnificationFilter(xe.NEAREST)):(c===4?(e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(xe.LINEAR_MIPMAP_LINEAR)):e.openGLTexture.setMinificationFilter(xe.LINEAR),e.openGLTexture.setMagnificationFilter(xe.LINEAR)),e.openGLTexture.setWrapS(Wa.CLAMP_TO_EDGE),e.openGLTexture.setWrapT(Wa.CLAMP_TO_EDGE);for(var he=H[0]*H[1]*c,j=new Float32Array(12),Ee=new Float32Array(8),de=0;de<4;de++)Ee[de*2]=de%2?1:0,Ee[de*2+1]=de>1?1:0;var oe=[bt.X,bt.Y,bt.Z].includes(e.renderable.getSlicingMode())?B:W,Z=a.getSpatialExtent(),se=i.getData(),X=null;if(V===bt.I){X=new se.constructor(H[2]*H[1]*c);for(var ae=0,ge=0;ge<H[2];ge++)for(var J=0;J<H[1];J++){var et=($+J*H[0]+ge*H[0]*H[1])*c;ae=(ge*H[1]+J)*c,X.set(se.subarray(et,et+c),ae)}H[0]=H[1],H[1]=H[2],j[0]=oe,j[1]=Z[2],j[2]=Z[4],j[3]=oe,j[4]=Z[3],j[5]=Z[4],j[6]=oe,j[7]=Z[2],j[8]=Z[5],j[9]=oe,j[10]=Z[3],j[11]=Z[5]}else if(V===bt.J){X=new se.constructor(H[2]*H[0]*c);for(var tt=0,Ie=0;Ie<H[2];Ie++)for(var gt=0;gt<H[0];gt++){var _t=(gt+$*H[0]+Ie*H[0]*H[1])*c;tt=(Ie*H[0]+gt)*c,X.set(se.subarray(_t,_t+c),tt)}H[1]=H[2],j[0]=Z[0],j[1]=oe,j[2]=Z[4],j[3]=Z[1],j[4]=oe,j[5]=Z[4],j[6]=Z[0],j[7]=oe,j[8]=Z[5],j[9]=Z[1],j[10]=oe,j[11]=Z[5]}else V===bt.K||V===bt.NONE?(X=se.subarray($*he,($+1)*he),j[0]=Z[0],j[1]=Z[2],j[2]=oe,j[3]=Z[1],j[4]=Z[2],j[5]=oe,j[6]=Z[0],j[7]=Z[3],j[8]=oe,j[9]=Z[1],j[10]=Z[3],j[11]=oe):Lr("Reformat slicing not yet supported.");e.openGLTexture.create2DFromRaw(H[0],H[1],c,i.getDataType(),X),e.openGLTexture.activate(),e.openGLTexture.sendParameters(),e.openGLTexture.deactivate();var zt=Ve.newInstance({numberOfComponents:3,values:j});zt.setName("points");var ga=Ve.newInstance({numberOfComponents:2,values:Ee});ga.setName("tcoords");var nt=new Uint16Array(8);nt[0]=3,nt[1]=0,nt[2]=1,nt[3]=3,nt[4]=3,nt[5]=0,nt[6]=3,nt[7]=2;var Tr=Ve.newInstance({numberOfComponents:1,values:nt});e.tris.getCABO().createVBO(Tr,"polys",Zt.SURFACE,{points:zt,tcoords:ga,cellOffset:0}),e.VBOBuildTime.modified(),e.VBOBuildString=Q}}}}}var aR={VBOBuildTime:0,VBOBuildString:null,openGLTexture:null,tris:null,imagemat:null,imagematinv:null,colorTexture:null,pwfTexture:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0};function Q1(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aR,n),Qe.extend(t,e,n),q1.implementReplaceShaderCoincidentOffset(t,e,n),e.tris=aa.newInstance(),e.openGLTexture=st.newInstance(),e.colorTexture=st.newInstance(),e.pwfTexture=st.newInstance(),e.imagemat=ie(new Float64Array(16)),e.imagematinv=ie(new Float64Array(16)),at(t,e,[]),e.VBOBuildTime={},Ge(e.VBOBuildTime),rR(t,e)}var eh=ke(Q1,"vtkOpenGLImageMapper"),iR={newInstance:eh,extend:Q1};yt("vtkImageMapper",eh);function oR(t,e){e.classHierarchy.push("vtkOpenGLImageSlice"),t.buildPass=function(n){if(!(!e.renderable||!e.renderable.getVisibility())&&n){if(!e.renderable)return;e._openGLRenderWindow=t.getFirstAncestorOfType("vtkOpenGLRenderWindow"),e.openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseOpaqueZBufferPass=function(n){t.traverseOpaquePass(n)},t.traverseOpaquePass=function(n){!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(function(r){r.traverse(n)}),t.apply(n,!1))},t.traverseTranslucentPass=function(n){!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(function(r){r.traverse(n)}),t.apply(n,!1))},t.queryPass=function(n,r){if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.opaqueZBufferPass=function(n,r){return t.opaquePass(n,r)},t.opaquePass=function(n,r){n&&e.context.depthMask(!0)},t.translucentPass=function(n,r){e.context.depthMask(!n)},t.getKeyMatrices=function(){return e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(Ke(e.keyMatrices.mcwc,e.renderable.getMatrix()),Oe(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.keyMatrixTime.modified()),e.keyMatrices}}var sR={context:null,keyMatrixTime:null,keyMatrices:null};function th(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sR,n),Qe.extend(t,e,n),e.keyMatrixTime={},Ge(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:ie(new Float64Array(16))},at(t,e,["context"]),oR(t,e)}var nh=ke(th,"vtkOpenGLImageSlice"),cR={newInstance:nh,extend:th};yt("vtkImageSlice",nh);var uR=Wn;function fR(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=function(n,r){e.openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e.openGLRenderer.getParent();var a=e.openGLRenderer.getAspectRatio(),i=e.openGLRenderer?e.openGLRenderer.getRenderable().getActiveCamera():null,o=e.openGLRenderer.getTiledSizeAndOrigin(),s=null;if(e.renderable.getUseZValues()){var c=r.getZBufferTexture(),u=Math.floor(c.getWidth()),g=Math.floor(c.getHeight()),f=e._openGLRenderWindow.getContext();c.bind();var l=r.getFramebuffer();l?l.saveCurrentBindingsAndBuffers():uR("No framebuffer to save/restore");var v=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,v),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,c.getHandle(),0),f.checkFramebufferStatus(f.FRAMEBUFFER)===f.FRAMEBUFFER_COMPLETE&&(s=new Uint8Array(u*g*4),f.viewport(0,0,u,g),f.readPixels(0,0,u,g,f.RGBA,f.UNSIGNED_BYTE,s)),l&&l.restorePreviousBindingsAndBuffers(),f.deleteFramebuffer(v)}e.renderable.invokeCallback(e.renderable.getInputData(),i,a,o,s)},t.queryPass=function(n,r){n&&e.renderable.getUseZValues()&&r.requestDepth()}}var gR={};function rh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gR,n),Qe.extend(t,e,n),fR(t,e)}var ah=ke(rh,"vtkOpenGLPixelSpaceCallbackMapper"),lR={newInstance:ah,extend:rh};yt("vtkPixelSpaceCallbackMapper",ah);var vR=Wn;function pR(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=function(n){if(n){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes()}},t.updateLights=function(){for(var n=0,r=e.renderable.getLightsByReference(),a=0;a<r.length;++a)r[a].getSwitch()>0&&n++;return n||(vR("No lights are on, creating one."),e.renderable.createLight()),n},t.opaqueZBufferPass=function(n){if(n){var r=0,a=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),r|=a.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(a.clearDepth(1),r|=a.DEPTH_BUFFER_BIT,e.context.depthMask(!0));var i=t.getTiledSizeAndOrigin();a.enable(a.SCISSOR_TEST),a.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),a.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),a.colorMask(!0,!0,!0,!0),r&&a.clear(r),a.enable(a.DEPTH_TEST)}},t.cameraPass=function(n){n&&t.clear()},t.getAspectRatio=function(){var n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.getTiledSizeAndOrigin=function(){var n=e.renderable.getViewportByReference(),r=[0,0,1,1],a=n[0]-r[0],i=n[1]-r[1],o=e._parent.normalizedDisplayToDisplay(a,i),s=Math.round(o[0]),c=Math.round(o[1]),u=n[2]-r[0],g=n[3]-r[1],f=e._parent.normalizedDisplayToDisplay(u,g),l=Math.round(f[0])-s,v=Math.round(f[1])-c;return l<0&&(l=0),v<0&&(v=0),{usize:l,vsize:v,lowerLeftU:s,lowerLeftV:c}},t.clear=function(){var n=0,r=e.context;if(!e.renderable.getTransparent()){var a=e.renderable.getBackgroundByReference();e.context.clearColor(a[0],a[1],a[2],a[3]),n|=r.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(r.clearDepth(1),n|=r.DEPTH_BUFFER_BIT,e.context.depthMask(!0)),r.colorMask(!0,!0,!0,!0);var i=t.getTiledSizeAndOrigin();r.enable(r.SCISSOR_TEST),r.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),r.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),n&&r.clear(n),r.enable(r.DEPTH_TEST)},t.releaseGraphicsResources=function(){e.selector!==null&&e.selector.releaseGraphicsResources()},t.setOpenGLRenderWindow=function(n){e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}var hR={context:null,selector:null};function ih(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hR,n),Qe.extend(t,e,n),Et(t,e,["shaderCache"]),at(t,e,["selector"]),vu(t,e,["openGLRenderWindow"]),pR(t,e)}var oh=ke(ih,"vtkOpenGLRenderer"),dR={newInstance:oh,extend:ih};yt("vtkRenderer",oh);var kg=re;function yR(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=function(n){if(n){e.openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e.openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);var r=e.openGLRenderer.getRenderable();e.openGLCamera=e.openGLRenderer.getViewNodeFor(r.getActiveCamera())}},t.queryPass=function(n,r){if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOpaqueActorCount()}},t.opaquePass=function(n,r){if(n&&!e.openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);var a=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",a);var i=e.openGLRenderer.getRenderable(),o=e.openGLCamera.getKeyMatrices(i),s=new Float64Array(16);if(ct(s,o.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",s),e.lastFormat==="box"){var c=i.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",c[0],c[1],c[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=function(){if(!e.tris.getCABO().getElementCount()){for(var n=new Float32Array(12),r=0;r<4;r++)n[r*3]=r%2*2-1,n[r*3+1]=r>1?1:-1,n[r*3+2]=1;var a=Ve.newInstance({numberOfComponents:3,values:n});a.setName("points");var i=new Uint16Array(8);i[0]=3,i[1]=0,i[2]=1,i[3]=3,i[4]=3,i[5]=0,i[6]=3,i[7]=2;var o=Ve.newInstance({numberOfComponents:1,values:i});e.tris.getCABO().createVBO(o,"polys",Zt.SURFACE,{points:a,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||kg("Error setting vertexMC in shader VAO."));var s=e.renderable.getTextures();s.length||kg("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==s[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(s[0]))}}var TR={context:null};function sh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TR,n),Qe.extend(t,e,n),e.openGLTexture=st.newInstance(),e.tris=aa.newInstance(),e.keyMatrixTime={},Ge(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:Jt(new Float64Array(9)),mcwc:ie(new Float64Array(16))},at(t,e,["context"]),Et(t,e,["activeTextures"]),yR(t,e)}var ch=ke(sh),mR={newInstance:ch,extend:sh};yt("vtkSkybox",ch);var CR=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkSphereMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Spheres

attribute vec4 vertexMC;
attribute vec2 offsetMC;

// optional normal declaration
//VTK::Normal::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying vec3 centerVCVSOutput;

uniform int cameraParallel;

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  // compute the projected vertex position
  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = length(offsetMC)*0.5;

  // make the triangle face the camera
  if (cameraParallel == 0)
    {
    vec3 dir = normalize(-vertexVCVSOutput.xyz);
    vec3 base2 = normalize(cross(dir,vec3(1.0,0.0,0.0)));
    vec3 base1 = cross(base2,dir);
    vertexVCVSOutput.xyz = vertexVCVSOutput.xyz + offsetMC.x*base1 + offsetMC.y*base2;
    }
  else
    {
    // add in the offset
    vertexVCVSOutput.xy = vertexVCVSOutput.xy + offsetMC;
    }

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;function Ug(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function wR(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ug(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ug(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var SR=re;function ER(t,e){e.classHierarchy.push("vtkOpenGLSphereMapper");var n=wR({},t);t.getShaderTemplate=function(r,a,i){r.Vertex=CR,r.Fragment=Io,r.Geometry=""},t.replaceShaderValues=function(r,a,i){var o=r.Vertex,s=r.Fragment;o=_.substitute(o,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=_.substitute(s,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,s=_.substitute(s,"//VTK::PositionVC::Impl",[`vec4 vertexVC = vertexVCVSOutput;
`]).result;var c=[`uniform float invertedDepth;
`,`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=_.substitute(s,"//VTK::Normal::Dec",c).result;var u="";e.context.getExtension("EXT_frag_depth")&&(u=`gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(u=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=_.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float b = 2.0*dot(EyePos,EyeDir);
`,`  float c = dot(EyePos,EyePos) - 1.0;
`,`  float d = b*b - 4.0*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t = (-b - invertedDepth*sqrt(d))*0.5;
`,`    normalVCVSOutput = invertedDepth*normalize(EyePos + t*EyeDir);
`,`    vertexVC.xyz = normalVCVSOutput*radiusVCVSOutput + centerVCVSOutput;
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,u]).result,s=_.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=_.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,n.replaceShaderValues(r,a,i)},t.setMapperShaderParameters=function(r,a,i){r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&r.getProgram().isAttributeUsed("offsetMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"offsetMC",12,r.getCABO().getStride(),e.context.FLOAT,2,!1)||SR("Error setting 'offsetMC' in shader VAO.")),r.getProgram().isUniformUsed("invertedDepth")&&r.getProgram().setUniformf("invertedDepth",e.invert?-1:1),n.setMapperShaderParameters(r,a,i)},t.setCameraShaderParameters=function(r,a,i){var o=r.getProgram(),s=a.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(a);if(o.isUniformUsed("VCPCMatrix")&&o.setUniformMatrix("VCPCMatrix",c.vcpc),o.isUniformUsed("MCVCMatrix"))if(i.getIsIdentity())o.setUniformMatrix("MCVCMatrix",c.wcvc);else{var u=e.openGLActor.getKeyMatrices(),g=new Float64Array(16);Me(g,c.wcvc,u.mcwc),o.setUniformMatrix("MCVCMatrix",g)}o.isUniformUsed("cameraParallel")&&r.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=function(r,a){return e.context.TRIANGLES},t.buildBufferObjects=function(r,a){var i=e.currentInput;if(i!==null){e.renderable.mapScalars(i,1);var o=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),c=i.getPointData(),u=i.getPoints(),g=u.getNumberOfPoints(),f=u.getData(),l=5,v=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(v=c.getArray(e.renderable.getScaleArray()).getData());var p=null,d=0,h=null;o?(d=o.getNumberOfComponents(),s.setColorOffset(0),s.setColorBOStride(4),p=o.getData(),h=new Uint8Array(3*g*4),s.getColorBO()||s.setColorBO(ln.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow)):s.getColorBO()&&s.setColorBO(null),s.setColorComponents(d);var T=new Float32Array(l*g*3);s.setStride(l*4);for(var C=Math.cos(We(30)),m=0,y=0,w=0,S=0,O=0;O<g;++O){var M=e.renderable.getRadius();v&&(M=v[O]),m=O*3,T[w++]=f[m++],T[w++]=f[m++],T[w++]=f[m++],T[w++]=-2*M*C,T[w++]=-M,p&&(y=O*d,h[S++]=p[y],h[S++]=p[y+1],h[S++]=p[y+2],h[S++]=p[y+3]),m=O*3,T[w++]=f[m++],T[w++]=f[m++],T[w++]=f[m++],T[w++]=2*M*C,T[w++]=-M,p&&(h[S++]=p[y],h[S++]=p[y+1],h[S++]=p[y+2],h[S++]=p[y+3]),m=O*3,T[w++]=f[m++],T[w++]=f[m++],T[w++]=f[m++],T[w++]=0,T[w++]=2*M,p&&(h[S++]=p[y],h[S++]=p[y+1],h[S++]=p[y+2],h[S++]=p[y+3])}s.setElementCount(w/l),s.upload(T,dn.ARRAY_BUFFER),o&&s.getColorBO().upload(h,dn.ARRAY_BUFFER),e.VBOBuildTime.modified()}}}var xR={};function uh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xR,n),Po.extend(t,e,n),ER(t,e)}var fh=ke(uh,"vtkOpenGLSphereMapper"),OR={newInstance:fh,extend:uh};yt("vtkSphereMapper",fh);var MR=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkStickMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Sticks

attribute vec4 vertexMC;
attribute vec3 orientMC;
attribute vec4 offsetMC;
attribute float radiusMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying float lengthVCVSOutput;
varying vec3 centerVCVSOutput;
varying vec3 orientVCVSOutput;

uniform int cameraParallel;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = radiusMC;
  lengthVCVSOutput = length(orientMC);
  orientVCVSOutput = normalMatrix * normalize(orientMC);

  // make sure it is pointing out of the screen
  if (orientVCVSOutput.z < 0.0)
    {
    orientVCVSOutput = -orientVCVSOutput;
    }

  // make the basis
  vec3 xbase;
  vec3 ybase;
  vec3 dir = vec3(0.0,0.0,1.0);
  if (cameraParallel == 0)
    {
    dir = normalize(-vertexVCVSOutput.xyz);
    }
  if (abs(dot(dir,orientVCVSOutput)) == 1.0)
    {
    xbase = normalize(cross(vec3(0.0,1.0,0.0),orientVCVSOutput));
    ybase = cross(xbase,orientVCVSOutput);
    }
  else
    {
    xbase = normalize(cross(orientVCVSOutput,dir));
    ybase = cross(orientVCVSOutput,xbase);
    }

  vec3 offsets = offsetMC.xyz*2.0-1.0;
  vertexVCVSOutput.xyz = vertexVCVSOutput.xyz +
    radiusVCVSOutput*offsets.x*xbase +
    radiusVCVSOutput*offsets.y*ybase +
    0.5*lengthVCVSOutput*offsets.z*orientVCVSOutput;

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;function Bg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function RR(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Bg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Bg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var di=re;function DR(t,e){e.classHierarchy.push("vtkOpenGLStickMapper");var n=RR({},t);t.getShaderTemplate=function(r,a,i){r.Vertex=MR,r.Fragment=Io,r.Geometry=""},t.replaceShaderValues=function(r,a,i){var o=r.Vertex,s=r.Fragment;o=_.substitute(o,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=_.substitute(s,"//VTK::PositionVC::Dec","varying vec4 vertexVCVSOutput;").result,s=_.substitute(s,"//VTK::PositionVC::Impl",`  vec4 vertexVC = vertexVCVSOutput;
`).result;var c=[`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 orientVCVSOutput;
`,`varying float lengthVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=_.substitute(s,"//VTK::Normal::Dec",c).result;var u="";e.context.getExtension("EXT_frag_depth")&&(u=`  gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(u=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=_.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  vec3 base1;
`,`  if (abs(orientVCVSOutput.z) < 0.99) {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,0.0,1.0))); }
`,`  else {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,1.0,0.0))); }
`,`  vec3 base2 = cross(orientVCVSOutput,base1);
`,`  EyePos = vec3(dot(EyePos,base1),dot(EyePos,base2),dot(EyePos,orientVCVSOutput));
`,`  EyeDir = vec3(dot(EyeDir,base1),dot(EyeDir,base2),dot(EyeDir,orientVCVSOutput));
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float a = EyeDir.x*EyeDir.x + EyeDir.y*EyeDir.y;
`,`  float b = 2.0*(EyePos.x*EyeDir.x + EyePos.y*EyeDir.y);
`,`  float c = EyePos.x*EyePos.x + EyePos.y*EyePos.y - 1.0;
`,`  float d = b*b - 4.0*a*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t =  (-b - sqrt(d))/(2.0*a);
`,`    float tz = EyePos.z + t*EyeDir.z;
`,`    vec3 iPoint = EyePos + t*EyeDir;
`,`    if (abs(iPoint.z)*radiusVCVSOutput > lengthVCVSOutput*0.5) {
`,`      float t2 = (-b + sqrt(d))/(2.0*a);
`,`      float tz2 = EyePos.z + t2*EyeDir.z;
`,`      if (tz2*radiusVCVSOutput > lengthVCVSOutput*0.5 || tz*radiusVCVSOutput < -0.5*lengthVCVSOutput) { discard; }
`,`      else {
`,`        normalVCVSOutput = orientVCVSOutput;
`,`        float t3 = (lengthVCVSOutput*0.5/radiusVCVSOutput - EyePos.z)/EyeDir.z;
`,`        iPoint = EyePos + t3*EyeDir;
`,`        vertexVC.xyz = radiusVCVSOutput*(iPoint.x*base1 + iPoint.y*base2 + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`        }
`,`      }
`,`    else {
`,`      normalVCVSOutput = iPoint.x*base1 + iPoint.y*base2;
`,`      vertexVC.xyz = radiusVCVSOutput*(normalVCVSOutput + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`      }
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,u]).result,s=_.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=_.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,n.replaceShaderValues(r,a,i)},t.setMapperShaderParameters=function(r,a,i){r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(r.getProgram().isAttributeUsed("orientMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"orientMC",12,r.getCABO().getStride(),e.context.FLOAT,3,!1)||di("Error setting 'orientMC' in shader VAO.")),r.getProgram().isAttributeUsed("offsetMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"offsetMC",0,r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,3,!0)||di("Error setting 'offsetMC' in shader VAO.")),r.getProgram().isAttributeUsed("radiusMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"radiusMC",24,r.getCABO().getStride(),e.context.FLOAT,1,!1)||di("Error setting 'radiusMC' in shader VAO."))),n.setMapperShaderParameters(r,a,i)},t.setCameraShaderParameters=function(r,a,i){var o=r.getProgram(),s=a.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(a);if(o.isUniformUsed("VCPCMatrix")&&o.setUniformMatrix("VCPCMatrix",c.vcpc),i.getIsIdentity())o.isUniformUsed("MCVCMatrix")&&o.setUniformMatrix("MCVCMatrix",c.wcvc),o.isUniformUsed("normalMatrix")&&o.setUniformMatrix3x3("normalMatrix",c.normalMatrix);else{var u=e.openGLActor.getKeyMatrices();if(o.isUniformUsed("MCVCMatrix")){var g=new Float64Array(16);Me(g,c.wcvc,u.mcwc),o.setUniformMatrix("MCVCMatrix",g)}if(o.isUniformUsed("normalMatrix")){var f=new Float64Array(9);In(f,c.normalMatrix,u.normalMatrix),o.setUniformMatrix3x3("normalMatrix",f)}}o.isUniformUsed("cameraParallel")&&r.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=function(r,a){return e.context.TRIANGLES},t.buildBufferObjects=function(r,a){var i=e.currentInput;if(i!==null){e.renderable.mapScalars(i,1);var o=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),c=i.getPointData(),u=i.getPoints(),g=u.getNumberOfPoints(),f=u.getData(),l=3;l+=4;var v=null,p=0;s.setColorBOStride(4),s.getColorBO()||s.setColorBO(ln.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow),o&&(p=o.getNumberOfComponents(),s.setColorOffset(4),v=o.getData(),s.setColorBOStride(8)),s.setColorComponents(p),s.setStride(l*4);var d=new Float32Array(l*g*12),h=new Uint8Array(12*g*(v?8:4)),T=null,C=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(T=c.getArray(e.renderable.getScaleArray()).getData()),e.renderable.getOrientationArray()!=null&&c.hasArray(e.renderable.getOrientationArray())?C=c.getArray(e.renderable.getOrientationArray()).getData():di([`Error setting orientationArray.
`,"You have to specify the stick orientation"]);for(var m=[0,1,3,0,3,2,2,3,5,2,5,4],y=0,w=0,S=0,O=0,M=0;M<g;++M){var R=e.renderable.getLength(),D=e.renderable.getRadius();T&&(R=T[M*2],D=T[M*2+1]);for(var L=0;L<m.length;++L)y=M*3,d[S++]=f[y++],d[S++]=f[y++],d[S++]=f[y++],y=M*3,d[S++]=C[y++]*R,d[S++]=C[y++]*R,d[S++]=C[y++]*R,d[S++]=D,h[O++]=255*(m[L]%2),h[O++]=m[L]>=4?255:0,h[O++]=m[L]>=2?255:0,h[O++]=255,w=M*p,v&&(h[O++]=v[w],h[O++]=v[w+1],h[O++]=v[w+2],h[O++]=v[w+3])}s.setElementCount(S/l),s.upload(d,dn.ARRAY_BUFFER),s.getColorBO().upload(h,dn.ARRAY_BUFFER),e.VBOBuildTime.modified()}}}var VR={};function gh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VR,n),Po.extend(t,e,n),DR(t,e)}var lh=ke(gh,"vtkOpenGLStickMapper"),LR={newInstance:lh,extend:gh};yt("vtkStickMapper",lh);function NR(t,e){e.classHierarchy.push("vtkOpenGLVolume"),t.buildPass=function(n){!e.renderable||!e.renderable.getVisibility()||n&&(e._openGLRenderWindow=t.getFirstAncestorOfType("vtkOpenGLRenderWindow"),e.openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.queryPass=function(n,r){if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementVolumeCount()}},t.traverseVolumePass=function(n){!e.renderable||!e.renderable.getNestedVisibility()||e.openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0].traverse(n),t.apply(n,!1))},t.volumePass=function(n){!e.renderable||!e.renderable.getVisibility()||e.context.depthMask(!n)},t.getKeyMatrices=function(){return e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),Ke(e.MCWCMatrix,e.renderable.getMatrix()),Oe(e.MCWCMatrix,e.MCWCMatrix),e.renderable.getIsIdentity()?Jt(e.normalMatrix):(wo(e.normalMatrix,e.MCWCMatrix),So(e.normalMatrix,e.normalMatrix)),e.keyMatrixTime.modified()),{mcwc:e.MCWCMatrix,normalMatrix:e.normalMatrix}}}var FR={};function vh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FR,n),Qe.extend(t,e,n),e.keyMatrixTime={},Ge(e.keyMatrixTime,{mtime:0}),e.normalMatrix=new Float64Array(9),e.MCWCMatrix=new Float64Array(16),at(t,e,["context"]),NR(t,e)}var ph=ke(vh,"vtkOpenGLVolume"),_R={newInstance:ph,extend:vh};yt("vtkVolume",ph);var kc={NEAREST:0,LINEAR:1,FAST_LINEAR:2},hh={FRACTIONAL:0,PROPORTIONAL:1},Bu={InterpolationType:kc,OpacityMode:hh},bR=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexDC;

varying vec3 vertexVCVSOutput;
uniform mat4 PCVCMatrix;

uniform float dcxmin;
uniform float dcxmax;
uniform float dcymin;
uniform float dcymax;

void main()
{
  // dcsmall is the device coords reduced to the
  // x y area covered by the volume
  vec4 dcsmall = vec4(
    dcxmin + 0.5 * (vertexDC.x + 1.0) * (dcxmax - dcxmin),
    dcymin + 0.5 * (vertexDC.y + 1.0) * (dcymax - dcymin),
    vertexDC.z,
    vertexDC.w);
  vec4 vcpos = PCVCMatrix * dcsmall;
  vertexVCVSOutput = vcpos.xyz/vcpos.w;
  gl_Position = dcsmall;
}
`,kR=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the volume mappers fragment shader

// the output of this shader
//VTK::Output::Dec

varying vec3 vertexVCVSOutput;

// first declare the settings from the mapper
// that impact the code paths in here

// always set vtkNumComponents 1,2,3,4
//VTK::NumComponents

// possibly define vtkTrilinearOn
//VTK::TrilinearOn

// possibly define vtkIndependentComponents
//VTK::IndependentComponentsOn

// possibly define any "proportional" components
//VTK::vtkProportionalComponents

// Define the blend mode to use
#define vtkBlendMode //VTK::BlendMode

// Possibly define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

#ifdef vtkImageLabelOutlineOn
uniform int outlineThickness;
uniform float vpWidth;
uniform float vpHeight;
uniform float vpOffsetX;
uniform float vpOffsetY;
uniform mat4 PCWCMatrix;
uniform mat4 vWCtoIDX;
#endif

// define vtkLightComplexity
//VTK::LightComplexity
#if vtkLightComplexity > 0
uniform float vSpecularPower;
uniform float vAmbient;
uniform float vDiffuse;
uniform float vSpecular;
//VTK::Light::Dec
#endif

//VTK::VolumeShadowOn
//VTK::SurfaceShadowOn
//VTK::VolumeShadow::Dec

// define vtkComputeNormalFromOpacity
//VTK::vtkComputeNormalFromOpacity

// possibly define vtkGradientOpacityOn
//VTK::GradientOpacityOn
#ifdef vtkGradientOpacityOn
uniform float goscale0;
uniform float goshift0;
uniform float gomin0;
uniform float gomax0;
#if defined(vtkIndependentComponentsOn) && (vtkNumComponents > 1)
uniform float goscale1;
uniform float goshift1;
uniform float gomin1;
uniform float gomax1;
#if vtkNumComponents >= 3
uniform float goscale2;
uniform float goshift2;
uniform float gomin2;
uniform float gomax2;
#endif
#if vtkNumComponents >= 4
uniform float goscale3;
uniform float goshift3;
uniform float gomin3;
uniform float gomax3;
#endif
#endif
#endif

// if you want to see the raw tiled
// data in webgl1 uncomment the following line
// #define debugtile

// camera values
uniform float camThick;
uniform float camNear;
uniform float camFar;
uniform int cameraParallel;

// values describing the volume geometry
uniform vec3 vOriginVC;
uniform vec3 vSpacing;
uniform ivec3 volumeDimensions; // 3d texture dimensions
uniform vec3 vPlaneNormal0;
uniform float vPlaneDistance0;
uniform vec3 vPlaneNormal1;
uniform float vPlaneDistance1;
uniform vec3 vPlaneNormal2;
uniform float vPlaneDistance2;
uniform vec3 vPlaneNormal3;
uniform float vPlaneDistance3;
uniform vec3 vPlaneNormal4;
uniform float vPlaneDistance4;
uniform vec3 vPlaneNormal5;
uniform float vPlaneDistance5;

//VTK::ClipPlane::Dec

// opacity and color textures
uniform sampler2D otexture;
uniform float oshift0;
uniform float oscale0;
uniform sampler2D ctexture;
uniform float cshift0;
uniform float cscale0;

// jitter texture
uniform sampler2D jtexture;

// some 3D texture values
uniform float sampleDistance;
uniform vec3 vVCToIJK;

// the heights defined below are the locations
// for the up to four components of the tfuns
// the tfuns have a height of 2XnumComps pixels so the
// values are computed to hit the middle of the two rows
// for that component
#ifdef vtkIndependentComponentsOn
#if vtkNumComponents == 2
uniform float mix0;
uniform float mix1;
#define height0 0.25
#define height1 0.75
#endif
#if vtkNumComponents == 3
uniform float mix0;
uniform float mix1;
uniform float mix2;
#define height0 0.17
#define height1 0.5
#define height2 0.83
#endif
#if vtkNumComponents == 4
uniform float mix0;
uniform float mix1;
uniform float mix2;
uniform float mix3;
#define height0 0.125
#define height1 0.375
#define height2 0.625
#define height3 0.875
#endif
#endif

#if vtkNumComponents >= 2
uniform float oshift1;
uniform float oscale1;
uniform float cshift1;
uniform float cscale1;
#endif
#if vtkNumComponents >= 3
uniform float oshift2;
uniform float oscale2;
uniform float cshift2;
uniform float cscale2;
#endif
#if vtkNumComponents >= 4
uniform float oshift3;
uniform float oscale3;
uniform float cshift3;
uniform float cscale3;
#endif

uniform vec4 ipScalarRangeMin;
uniform vec4 ipScalarRangeMax;

// declaration for intermixed geometry
//VTK::ZBuffer::Dec

//=======================================================================
// global and custom variables (a temporary section before photorealistics rendering module is complete)
vec3 rayDirVC;
float sampleDistanceISVS;

#define SQRT3    1.7321
#define INV4PI   0.0796
#define EPSILON  0.001

//=======================================================================
// Webgl2 specific version of functions
#if __VERSION__ == 300

uniform highp sampler3D texture1;

vec4 getTextureValue(vec3 pos)
{
  vec4 tmp = texture(texture1, pos);
#if vtkNumComponents == 1
  tmp.a = tmp.r;
#endif
#if vtkNumComponents == 2
  tmp.a = tmp.g;
#endif
#if vtkNumComponents == 3
  tmp.a = length(tmp.rgb);
#endif
  return tmp;
}

//=======================================================================
// WebGL1 specific version of functions
#else

uniform sampler2D texture1;

uniform float texWidth;
uniform float texHeight;
uniform int xreps;
uniform int xstride;
uniform int ystride;

// if computing trilinear values from multiple z slices
#ifdef vtkTrilinearOn
vec4 getTextureValue(vec3 ijk)
{
  float zoff = 1.0/float(volumeDimensions.z);
  vec4 val1 = getOneTextureValue(ijk);
  vec4 val2 = getOneTextureValue(vec3(ijk.xy, ijk.z + zoff));

  float indexZ = float(volumeDimensions)*ijk.z;
  float zmix =  indexZ - floor(indexZ);

  return mix(val1, val2, zmix);
}

vec4 getOneTextureValue(vec3 ijk)
#else // nearest or fast linear
vec4 getTextureValue(vec3 ijk)
#endif
{
  vec3 tdims = vec3(volumeDimensions);

#ifdef debugtile
  vec2 tpos = vec2(ijk.x, ijk.y);
  vec4 tmp = texture2D(texture1, tpos);
  tmp.a = 1.0;

#else
  int z = int(ijk.z * tdims.z);
  int yz = z / xreps;
  int xz = z - yz*xreps;

  int tileWidth = volumeDimensions.x/xstride;
  int tileHeight = volumeDimensions.y/ystride;

  xz *= tileWidth;
  yz *= tileHeight;

  float ni = float(xz) + (ijk.x*float(tileWidth));
  float nj = float(yz) + (ijk.y*float(tileHeight));

  vec2 tpos = vec2(ni/texWidth, nj/texHeight);

  vec4 tmp = texture2D(texture1, tpos);

#if vtkNumComponents == 1
  tmp.a = tmp.r;
#endif
#if vtkNumComponents == 2
  tmp.g = tmp.a;
#endif
#if vtkNumComponents == 3
  tmp.a = length(tmp.rgb);
#endif
#endif

  return tmp;
}

// End of Webgl1 specific code
//=======================================================================
#endif

//=======================================================================
// transformation between VC and IS space

// convert vector position from idx to vc
#if vtkLightComplexity > 0
vec3 IStoVC(vec3 posIS){
  vec3 posVC = posIS / vVCToIJK;
  return posVC.x * vPlaneNormal0 +
         posVC.y * vPlaneNormal2 +
         posVC.z * vPlaneNormal4 +
         vOriginVC;
}

// convert vector position from vc to idx
vec3 VCtoIS(vec3 posVC){
  posVC = posVC - vOriginVC;
  posVC = vec3(
    dot(posVC, vPlaneNormal0),
    dot(posVC, vPlaneNormal2),
    dot(posVC, vPlaneNormal4));
  return posVC * vVCToIJK;
}
#endif

//Rotate vector to view coordinate
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
void rotateToViewCoord(inout vec3 dirIS){
  dirIS.xyz =
    dirIS.x * vPlaneNormal0 +
    dirIS.y * vPlaneNormal2 +
    dirIS.z * vPlaneNormal4;
}

//Rotate vector to idx coordinate
vec3 rotateToIDX(vec3 dirVC){
  vec3 dirIS;
  dirIS.xyz = vec3(
    dot(dirVC, vPlaneNormal0),
    dot(dirVC, vPlaneNormal2),
    dot(dirVC, vPlaneNormal4));
  return dirIS;
}
#endif

//=======================================================================
// Given a normal compute the gradient opacity factors
float computeGradientOpacityFactor(
  float normalMag, float goscale, float goshift, float gomin, float gomax)
{
#if defined(vtkGradientOpacityOn)
  return clamp(normalMag * goscale + goshift, gomin, gomax);
#else
  return 1.0;
#endif
}

//=======================================================================
// compute the normal and gradient magnitude for a position, uses forward difference
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
  #ifdef vtkComputeNormalFromOpacity
    #ifdef vtkGradientOpacityOn
      vec4 computeNormalForDensity(vec3 pos, float scalar, vec3 tstep, out mat3 scalarInterp, out vec3 secondaryGradientMag)
      {
        vec4 result;
        scalarInterp[0][0] = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)).a;
        scalarInterp[0][1] = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)).a;
        scalarInterp[0][2] = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)).a;
        // look up scalar values for computing secondary gradient
        scalarInterp[1][0] = getTextureValue(pos + vec3(2.0*tstep.x, 0.0, 0.0)).a;
        scalarInterp[1][1] = getTextureValue(pos + vec3(0.0, 2.0*tstep.y, 0.0)).a;
        scalarInterp[1][2] = getTextureValue(pos + vec3(0.0, 0.0, 2.0*tstep.z)).a;
        scalarInterp[2][0] = getTextureValue(pos + vec3(tstep.x, tstep.y, 0.0)).a;
        scalarInterp[2][1] = getTextureValue(pos + vec3(tstep.x, 0.0, tstep.z)).a;
        scalarInterp[2][2] = getTextureValue(pos + vec3(0.0, tstep.y, tstep.z)).a;
        result.x = scalarInterp[0][0] - scalar;
        result.y = scalarInterp[0][1] - scalar;
        result.z = scalarInterp[0][2] - scalar;
        // divide by spacing
        result.xyz /= vSpacing;
        result.w = length(result.xyz);
        rotateToViewCoord(result.xyz);
        secondaryGradientMag.x = length(vec3(scalarInterp[1][0] - scalarInterp[0][0],
                                             scalarInterp[2][0] - scalarInterp[0][0],
                                             scalarInterp[2][1] - scalarInterp[0][0]) / vSpacing);
        secondaryGradientMag.y = length(vec3(scalarInterp[2][0] - scalarInterp[0][1],
                                             scalarInterp[1][1] - scalarInterp[0][1],
                                             scalarInterp[2][2] - scalarInterp[0][1]) / vSpacing);
        secondaryGradientMag.z = length(vec3(scalarInterp[2][1] - scalarInterp[0][2],
                                             scalarInterp[2][2] - scalarInterp[0][2],
                                             scalarInterp[1][2] - scalarInterp[0][2]) / vSpacing);
        if (length(result.xyz) > 0.0) {
          return vec4(normalize(result.xyz),result.w);
        } else {
          return vec4(0.0);
        }
      }

      vec4 computeDensityNormal(float scalar, float gradientMag, mat3 scalarInterp, vec3 secondaryGradientMag)
      {
        vec4 opacityG;
        vec3 opacityInterp = vec3(0.0);
        float opacity = texture2D(otexture, vec2(scalar * oscale0 + oshift0, 0.5)).r;
        if (gradientMag >= 0.0){
          opacity *= computeGradientOpacityFactor(gradientMag, goscale0, goshift0, gomin0, gomax0);
        }
        opacityInterp.x = texture2D(otexture, vec2(scalarInterp[0][0] * oscale0 + oshift0, 0.5)).r;
        if (secondaryGradientMag.x >= 0.0){
          opacityInterp.x *= computeGradientOpacityFactor(secondaryGradientMag.x, goscale0, goshift0, gomin0, gomax0);
        }

        opacityInterp.y = texture2D(otexture, vec2(scalarInterp[0][1] * oscale0 + oshift0, 0.5)).r;
        if (secondaryGradientMag.y >= 0.0){
          opacityInterp.y *= computeGradientOpacityFactor(secondaryGradientMag.y, goscale0, goshift0, gomin0, gomax0);
        }

        opacityInterp.z = texture2D(otexture, vec2(scalarInterp[0][2] * oscale0 + oshift0, 0.5)).r;
        if (secondaryGradientMag.z >= 0.0){
          opacityInterp.z *= computeGradientOpacityFactor(secondaryGradientMag.z, goscale0, goshift0, gomin0, gomax0);
        }

        opacityG.xyz = opacityInterp - vec3(opacity,opacity,opacity);
        // divide by spacing
        opacityG.xyz /= vSpacing;
        opacityG.w = length(opacityG.xyz);
        rotateToViewCoord(opacityG.xyz);
        if (length(opacityG.xyz) > 0.0) {
          return vec4(normalize(opacityG.xyz),opacityG.w);
        } else {
          return vec4(0.0);
        }
      }

    #else
    //if gradient opacity not on but using density gradient
      vec4 computeDensityNormal(float scalar, vec3 scalarInterp)
      {
        vec4 opacityG;
        float opacity = texture2D(otexture, vec2(scalar * oscale0 + oshift0, 0.5)).r;
        opacityG.x = texture2D(otexture, vec2(scalarInterp.x * oscale0 + oshift0, 0.5)).r - opacity;
        opacityG.y = texture2D(otexture, vec2(scalarInterp.y * oscale0 + oshift0, 0.5)).r - opacity;
        opacityG.z = texture2D(otexture, vec2(scalarInterp.z * oscale0 + oshift0, 0.5)).r - opacity;
        // divide by spacing
        opacityG.xyz /= vSpacing;
        opacityG.w = length(opacityG.xyz);
        // rotate to View Coords
        rotateToViewCoord(opacityG.xyz);
        if (length(opacityG.xyz) > 0.0) {
          return vec4(normalize(opacityG.xyz),opacityG.w);
        } else {
          return vec4(0.0);
        }
      }
      vec4 computeNormalForDensity(vec3 pos, float scalar, vec3 tstep, out vec3 scalarInterp)
      {
        vec4 result;
        scalarInterp.x = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)).a;
        scalarInterp.y = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)).a;
        scalarInterp.z = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)).a;
        result.x = scalarInterp.x - scalar;
        result.y = scalarInterp.y - scalar;
        result.z = scalarInterp.z - scalar;
        // divide by spacing
        result.xyz /= vSpacing;
        result.w = length(result.xyz);
        // rotate to View Coords
        rotateToViewCoord(result.xyz);
        if (length(result.xyz) > 0.0) {
          return vec4(normalize(result.xyz),result.w);
        } else {
          return vec4(0.0);
        }
      }
    #endif
  #endif
  // compute scalar density
  vec4 computeNormal(vec3 pos, float scalar, vec3 tstep)
  {
    vec4 result;
    result.x = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)).a - scalar;
    result.y = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)).a - scalar;
    result.z = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)).a - scalar;
    // divide by spacing
    result.xyz /= vSpacing;
    result.w = length(result.xyz);
    // rotate to View Coords
    rotateToViewCoord(result.xyz);
    return vec4(normalize(result.xyz),result.w);
  }
#endif

#ifdef vtkImageLabelOutlineOn
vec3 fragCoordToIndexSpace(vec4 fragCoord) {
  vec4 pcPos = vec4(
    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,
    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,
    (fragCoord.z - 0.5) * 2.0,
    1.0);

  vec4 worldCoord = PCWCMatrix * pcPos;
  vec4 vertex = (worldCoord/worldCoord.w);

  vec3 index = (vWCtoIDX * vertex).xyz;

  // half voxel fix for labelmapOutline
  return (index + vec3(0.5)) / vec3(volumeDimensions);
}
#endif

//=======================================================================
// compute the normals and gradient magnitudes for a position
// for independent components
mat4 computeMat4Normal(vec3 pos, vec4 tValue, vec3 tstep)
{
  mat4 result;
  vec4 distX = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)) - tValue;
  vec4 distY = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)) - tValue;
  vec4 distZ = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)) - tValue;

  // divide by spacing
  distX /= vSpacing.x;
  distY /= vSpacing.y;
  distZ /= vSpacing.z;

  mat3 rot;
  rot[0] = vPlaneNormal0;
  rot[1] = vPlaneNormal2;
  rot[2] = vPlaneNormal4;

#if !defined(vtkComponent0Proportional)
  result[0].xyz = vec3(distX.r, distY.r, distZ.r);
  result[0].a = length(result[0].xyz);
  result[0].xyz *= rot;
  if (result[0].w > 0.0)
  {
    result[0].xyz /= result[0].w;
  }
#endif

// optionally compute the 2nd component
#if vtkNumComponents >= 2 && !defined(vtkComponent1Proportional)
  result[1].xyz = vec3(distX.g, distY.g, distZ.g);
  result[1].a = length(result[1].xyz);
  result[1].xyz *= rot;
  if (result[1].w > 0.0)
  {
    result[1].xyz /= result[1].w;
  }
#endif

// optionally compute the 3rd component
#if vtkNumComponents >= 3 && !defined(vtkComponent2Proportional)
  result[2].xyz = vec3(distX.b, distY.b, distZ.b);
  result[2].a = length(result[2].xyz);
  result[2].xyz *= rot;
  if (result[2].w > 0.0)
  {
    result[2].xyz /= result[2].w;
  }
#endif

// optionally compute the 4th component
#if vtkNumComponents >= 4 && !defined(vtkComponent3Proportional)
  result[3].xyz = vec3(distX.a, distY.a, distZ.a);
  result[3].a = length(result[3].xyz);
  result[3].xyz *= rot;
  if (result[3].w > 0.0)
  {
    result[3].xyz /= result[3].w;
  }
#endif

  return result;
}

//=======================================================================
// global shadow - secondary ray
#ifdef VolumeShadowOn

// henyey greenstein phase function
float phase_function(float cos_angle)
{
  // divide by 2.0 instead of 4pi to increase intensity
  return ((1.0-anisotropy2)/pow(1.0+anisotropy2-2.0*anisotropy*cos_angle, 1.5))/2.0;
}

float random()
{
  float rand = fract(sin(dot(gl_FragCoord.xy,vec2(12.9898,78.233)))*43758.5453123);
  float jitter=texture2D(jtexture,gl_FragCoord.xy/32.).r;
  uint pcg_state = floatBitsToUint(jitter);
  uint state = pcg_state;
  pcg_state = pcg_state * uint(747796405) + uint(2891336453);
  uint word = ((state >> ((state >> uint(28)) + uint(4))) ^ state) * uint(277803737);
  return (float((((word >> uint(22)) ^ word) >> 1 ))/float(2147483647) + rand)/2.0;
}

// Computes the intersection between a ray and a box
struct Hit
{
  float tmin;
  float tmax;
};

struct Ray
{
  vec3 origin;
  vec3 dir;
  vec3 invDir;
};

bool BBoxIntersect(vec3 boundMin, vec3 boundMax, const Ray r, out Hit hit)
{
  vec3 tbot = r.invDir * (boundMin - r.origin);
  vec3 ttop = r.invDir * (boundMax - r.origin);
  vec3 tmin = min(ttop, tbot);
  vec3 tmax = max(ttop, tbot);
  vec2 t = max(tmin.xx, tmin.yz);
  float t0 = max(t.x, t.y);
  t = min(tmax.xx, tmax.yz);
  float t1 = min(t.x, t.y);
  hit.tmin = t0;
  hit.tmax = t1;
  return t1 > max(t0,0.0);
}

// As BBoxIntersect requires the inverse of the ray coords,
// this function is used to avoid numerical issues
void safe_0_vector(inout Ray ray)
{
  if(abs(ray.dir.x) < EPSILON) ray.dir.x = sign(ray.dir.x) * EPSILON;
  if(abs(ray.dir.y) < EPSILON) ray.dir.y = sign(ray.dir.y) * EPSILON;
  if(abs(ray.dir.z) < EPSILON) ray.dir.z = sign(ray.dir.z) * EPSILON;
}

float volume_shadow(vec3 posIS, vec3 lightDirNormIS)
{
  float shadow = 1.0;
  float opacity = 0.0;

  // modify sample distance with a random number between 0.8 and 1.0
  float sampleDistanceISVS_jitter = sampleDistanceISVS * mix(0.8, 1.0, random());
  float opacityPrev = texture2D(otexture, vec2(getTextureValue(posIS).r * oscale0 + oshift0, 0.5)).r;

  // in case the first sample near surface has a very tiled light ray, we need to offset start position
  posIS += sampleDistanceISVS_jitter * lightDirNormIS;

  // compute the start and end points for the ray
  Ray ray;
  Hit hit;
  ray.origin = posIS;
  ray.dir = lightDirNormIS;
  safe_0_vector(ray);
  ray.invDir = 1.0/ray.dir;

  if(!BBoxIntersect(vec3(0.0),vec3(1.0), ray, hit))
  {
    return 1.0;
  }
  vec4 scalar = vec4(0.0);
  float maxdist = hit.tmax;
  if(maxdist < EPSILON) {
    return 1.0;
  }

  // interpolate shadow ray length between: 1 unit of sample distance in IS to SQRT3, based on globalIlluminationReach
  float maxgi = mix(sampleDistanceISVS_jitter,SQRT3,giReach);
  maxdist = min(maxdist,maxgi);

  // support gradient opacity
  #ifdef vtkGradientOpacityOn
    vec4 normal;
  #endif

  vec3 current_step = sampleDistanceISVS_jitter * lightDirNormIS;
  float maxSteps = ceil(maxdist/sampleDistanceISVS_jitter);
  float opacityDelta = 0.0;

  for (float i = 0.0; i < maxSteps; i++)
  {
    scalar = getTextureValue(posIS);
    opacity = texture2D(otexture, vec2(scalar.r * oscale0 + oshift0, 0.5)).r;
    #ifdef vtkGradientOpacityOn
      normal = computeNormal(posIS, scalar.a, vec3(1.0/vec3(volumeDimensions)));
      opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
    #endif
    shadow *= 1.0 - opacity;

    // optimization: early termination
    if (shadow < EPSILON){
      return 0.0;
    }

    // optimization: increase/decrease sample distance based on changed in opacity value
    opacityDelta = opacityPrev - opacity;
    opacityPrev = opacity;
    if (opacityDelta > 0.0){
      current_step *= 0.9;
    } else if (opacityDelta < 0.0){
      current_step *= 1.1;
    }
    posIS += current_step;
  }

  return shadow;
}

vec3 applyShadowRay(vec3 tColor, vec3 posIS, vec3 viewDirectionVC)
{
  vec3 vertLight = vec3(0.0);
  vec3 secondary_contrib = vec3(0.0);
  // here we assume only positional light, no effect of cones
  for (int i = 0; i < lightNum; i++)
  {
    #if(vtkLightComplexity==3)
      if (lightPositional[i] == 1){
        vertLight = lightPositionVC[i] - IStoVC(posIS);
      }else{
        vertLight = - lightDirectionVC[i];
      }
    #else
      vertLight = - lightDirectionVC[i];
    #endif
    // here we assume achromatic light, only intensity
    float dDotL = dot(viewDirectionVC, normalize(vertLight));
    // isotropic scatter returns 0.5 instead of 1/4pi to increase intensity
    float phase_attenuation = 0.5;
    if (abs(anisotropy) > EPSILON){
      phase_attenuation = phase_function(dDotL);
    }
    float vol_shadow = volume_shadow(posIS, normalize(rotateToIDX(vertLight)));
    secondary_contrib += tColor * vDiffuse * lightColor[i] * vol_shadow * phase_attenuation;
    secondary_contrib += tColor * vAmbient;
  }
  return secondary_contrib;
}
#endif

//=======================================================================
// surface light contribution
#if vtkLightComplexity > 0
  void applyLighting(inout vec3 tColor, vec4 normal)
  {
    vec3 diffuse = vec3(0.0, 0.0, 0.0);
    vec3 specular = vec3(0.0, 0.0, 0.0);
    float df, sf = 0.0;
    for (int i = 0; i < lightNum; i++){
        df = abs(dot(normal.rgb, -lightDirectionVC[i]));
        diffuse += df * lightColor[i];
        sf = pow( abs(dot(lightHalfAngleVC[i],normal.rgb)), vSpecularPower);
        specular += sf * lightColor[i];
    }
    tColor.rgb = tColor.rgb*(diffuse*vDiffuse + vAmbient) + specular*vSpecular;
  }
  #if vtkLightComplexity < 3 && defined(SurfaceShadowOn)
    void applyLightingDirectional(inout vec3 tColor, vec4 normal)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float ndotL,vdotR;
        vertLightDirection = lightDirectionVC[i];
        ndotL = dot(normal.xyz, vertLightDirection);
        if (ndotL < 0.0 && twoSidedLighting)
        {
          ndotL = -ndotL;
        }
        if (ndotL > 0.0)
        {
          diffuse += ndotL * lightColor[i];
          //specular
          vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
          if (vdotR > 0.0)
          {
            specular += pow(vdotR, vSpecularPower) * lightColor[i];
          }
        }
      }
      tColor.rgb = tColor.rgb*(diffuse*vDiffuse + vAmbient) + specular*vSpecular;
    }
  #else
    void applyLightingPositional(inout vec3 tColor, vec4 normal, vec3 posVC)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float distance,attenuation,ndotL,vdotR;
        vec3 lightDir;
        if (lightPositional[i] == 1){
          lightDir = lightDirectionVC[i];
          vertLightDirection = posVC - lightPositionVC[i];
          distance = length(vertLightDirection);
          vertLightDirection = normalize(vertLightDirection);
          attenuation = 1.0 / (lightAttenuation[i].x
                              + lightAttenuation[i].y * distance
                              + lightAttenuation[i].z * distance * distance);
          // per OpenGL standard cone angle is 90 or less for a spot light
          if (lightConeAngle[i] <= 90.0){
            float coneDot = dot(vertLightDirection, lightDir);
            if (coneDot >= cos(radians(lightConeAngle[i]))){  // if inside cone
              attenuation = attenuation * pow(coneDot, lightExponent[i]);
            }
            else {
              attenuation = 0.0;
            }
          }
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * attenuation * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * attenuation * lightColor[i];
            }
          }
        } else {
          vertLightDirection = lightDirectionVC[i];
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * lightColor[i];
            }
          }
        }
      }
      tColor.rgb = tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
    }
  #endif
#endif

//=======================================================================
// Given a texture value compute the color and opacity
//
vec4 getColorForValue(vec4 tValue, vec3 posIS, vec3 tstep)
{
#ifdef vtkImageLabelOutlineOn
  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord); // pos in texture space
  vec4 centerValue = getTextureValue(centerPosIS);
  bool pixelOnBorder = false;
  vec4 tColor = texture2D(ctexture, vec2(centerValue.r * cscale0 + cshift0, 0.5));

  // Get alpha of segment from opacity function.
  tColor.a = texture2D(otexture, vec2(centerValue.r * oscale0 + oshift0, 0.5)).r;

  // Only perform outline check on fragments rendering voxels that aren't invisible.
  // Saves a bunch of needless checks on the background.
  // TODO define epsilon when building shader?
  if (float(tColor.a) > 0.01) {
    for (int i = -outlineThickness; i <= outlineThickness; i++) {
      for (int j = -outlineThickness; j <= outlineThickness; j++) {
        if (i == 0 || j == 0) {
          continue;
        }

        vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
          gl_FragCoord.y + float(j),
          gl_FragCoord.z, gl_FragCoord.w);

        vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
        vec4 value = getTextureValue(neighborPosIS);

        // If any of my neighbours are not the same value as I
        // am, this means I am on the border of the segment.
        // We can break the loops
        if (any(notEqual(value, centerValue))) {
          pixelOnBorder = true;
          break;
        }
      }

      if (pixelOnBorder == true) {
        break;
      }
    }

    // If I am on the border, I am displayed at full opacity
    if (pixelOnBorder == true) {
      tColor.a = 1.0;
    }
  }

#else
  // compute the normal and gradient magnitude if needed
  // We compute it as a vec4 if possible otherwise a mat4
  //
  vec4 goFactor = vec4(1.0,1.0,1.0,1.0);

  // compute the normal vectors as needed
  #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)
    #if defined(vtkIndependentComponentsOn) && (vtkNumComponents > 1)
      mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
      #if !defined(vtkComponent0Proportional)
        vec4 normal0 = normalMat[0];
      #endif
      #if !defined(vtkComponent1Proportional)
        vec4 normal1 = normalMat[1];
      #endif
      #if vtkNumComponents > 2
        #if !defined(vtkComponent2Proportional)
          vec4 normal2 = normalMat[2];
        #endif
        #if vtkNumComponents > 3
          #if !defined(vtkComponent3Proportional)
            vec4 normal3 = normalMat[3];
          #endif
        #endif
      #endif
    #else
      vec4 normalLight;
      #ifdef vtkComputeNormalFromOpacity
        #ifdef vtkGradientOpacityOn
          mat3 scalarInterp;
          vec3 secondaryGradientMag;
          vec4 normal0 = computeNormalForDensity(posIS, tValue.a, tstep, scalarInterp, secondaryGradientMag);
          normalLight = computeDensityNormal(tValue.a, normal0.w, scalarInterp,secondaryGradientMag);
          if (length(normalLight) == 0.0){
            normalLight = normal0;
          }
        #else
          vec3 scalarInterp;
          vec4 normal0 = computeNormalForDensity(posIS, tValue.a, tstep, scalarInterp);
          if (length(normal0)>0.0){
            normalLight = computeDensityNormal(tValue.a,scalarInterp);
            if (length(normalLight)==0.0){
              normalLight = normal0;
            }
          }
        #endif
      #else
        vec4 normal0 = computeNormal(posIS, tValue.a, tstep);
        normalLight = normal0;
      #endif
    #endif
  #endif

  // compute gradient opacity factors as needed
  #if defined(vtkGradientOpacityOn)
    #if !defined(vtkComponent0Proportional)
      goFactor.x =
        computeGradientOpacityFactor(normal0.a, goscale0, goshift0, gomin0, gomax0);
    #endif
    #if defined(vtkIndependentComponentsOn) && (vtkNumComponents > 1)
      #if !defined(vtkComponent1Proportional)
        goFactor.y =
          computeGradientOpacityFactor(normal1.a, goscale1, goshift1, gomin1, gomax1);
      #endif
      #if vtkNumComponents > 2
        #if !defined(vtkComponent2Proportional)
          goFactor.z =
            computeGradientOpacityFactor(normal2.a, goscale2, goshift2, gomin2, gomax2);
        #endif
        #if vtkNumComponents > 3
          #if !defined(vtkComponent3Proportional)
            goFactor.w =
              computeGradientOpacityFactor(normal3.a, goscale3, goshift3, gomin3, gomax3);
          #endif
        #endif
      #endif
    #endif
  #endif

  // single component is always independent
  #if vtkNumComponents == 1
    vec4 tColor = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, 0.5));
    tColor.a = goFactor.x*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
    if (tColor.a < EPSILON){
      return vec4(0.0);
    }
  #endif

  #if defined(vtkIndependentComponentsOn) && vtkNumComponents >= 2
    vec4 tColor = mix0*texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, height0));
    #if !defined(vtkComponent0Proportional)
      tColor.a = goFactor.x*mix0*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, height0)).r;
    #else
      float pwfValue = texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, height0)).r;
      tColor *= pwfValue;
      tColor.a *= mix(pwfValue, 1.0, (1.0 - mix0));
    #endif

    vec3 tColor1 = mix1*texture2D(ctexture, vec2(tValue.g * cscale1 + cshift1, height1)).rgb;
    #if !defined(vtkComponent1Proportional)
      tColor.a += goFactor.y*mix1*texture2D(otexture, vec2(tValue.g * oscale1 + oshift1, height1)).r;
    #else
      float pwfValue = texture2D(otexture, vec2(tValue.g * oscale1 + oshift1, height1)).r;
      tColor1 *= pwfValue;
      tColor.a *= mix(pwfValue, 1.0, (1.0 - mix1));
    #endif

    #if vtkNumComponents >= 3
      vec3 tColor2 = mix2*texture2D(ctexture, vec2(tValue.b * cscale2 + cshift2, height2)).rgb;
      #if !defined(vtkComponent2Proportional)
        tColor.a += goFactor.z*mix2*texture2D(otexture, vec2(tValue.b * oscale2 + oshift2, height2)).r;
      #else
        float pwfValue = texture2D(otexture, vec2(tValue.b * oscale2 + oshift2, height2)).r;
        tColor2 *= pwfValue;
        tColor.a *= mix(pwfValue, 1.0, (1.0 - mix2));
      #endif

      #if vtkNumComponents >= 4
        vec3 tColor3 = mix3*texture2D(ctexture, vec2(tValue.a * cscale3 + cshift3, height3)).rgb;
        #if !defined(vtkComponent3Proportional)
          tColor.a += goFactor.w*mix3*texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, height3)).r;
        #else
          float pwfValue = texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, height3)).r;
          tColor3 *= pwfValue;
          tColor.a *= mix(pwfValue, 1.0, (1.0 - mix3));
        #endif
      #endif
    #endif
  #else // then not independent

  #if vtkNumComponents == 2
    float lum = tValue.r * cscale0 + cshift0;
    float alpha = goFactor.x*texture2D(otexture, vec2(tValue.a * oscale1 + oshift1, 0.5)).r;
    vec4 tColor = vec4(lum, lum, lum, alpha);
  #endif
  #if vtkNumComponents == 3
    vec4 tColor;
    tColor.r = tValue.r * cscale0 + cshift0;
    tColor.g = tValue.g * cscale1 + cshift1;
    tColor.b = tValue.b * cscale2 + cshift2;
    tColor.a = goFactor.x*texture2D(otexture, vec2(tValue.a * oscale0 + oshift0, 0.5)).r;
  #endif
  #if vtkNumComponents == 4
    vec4 tColor;
    tColor.r = tValue.r * cscale0 + cshift0;
    tColor.g = tValue.g * cscale1 + cshift1;
    tColor.b = tValue.b * cscale2 + cshift2;
    tColor.a = goFactor.x*texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, 0.5)).r;
  #endif
  #endif // dependent

  // apply lighting if requested as appropriate
  #if vtkLightComplexity > 0
    #if !defined(vtkComponent0Proportional) && defined(SurfaceShadowOn)
        #if vtkLightComplexity < 3
            applyLightingDirectional(tColor.rgb, normalLight);
        #else
            applyLightingPositional(tColor.rgb, normalLight, IStoVC(posIS));
        #endif
    #endif

    #ifdef VolumeShadowOn
      vec3 secondary_contrib = applyShadowRay(tColor.rgb, posIS, rayDirVC);
      float vol_coef;
      if (volumetricScatteringBlending == 1.0 || volumetricScatteringBlending == 0.0){
        vol_coef = volumetricScatteringBlending;
      } else {
        vol_coef = 1.0 - (pow(volumetricScatteringBlending,0.3) - 1.0)*(pow(volumetricScatteringBlending,0.3) - 1.0);
      }
      tColor.rgb = (1.0 - vol_coef) * tColor.rgb + vol_coef * secondary_contrib;
    #endif

  #if defined(vtkIndependentComponentsOn) && vtkNumComponents >= 2
    #if !defined(vtkComponent1Proportional)
      applyLighting(tColor1, normal1);
    #endif
  #if vtkNumComponents >= 3
    #if !defined(vtkComponent2Proportional)
      applyLighting(tColor2, normal2);
    #endif
  #if vtkNumComponents >= 4
    #if !defined(vtkComponent3Proportional)
      applyLighting(tColor3, normal3);
    #endif
  #endif
  #endif
  #endif
  #endif

// perform final independent blend as needed
#if defined(vtkIndependentComponentsOn) && vtkNumComponents >= 2
  tColor.rgb += tColor1;
#if vtkNumComponents >= 3
  tColor.rgb += tColor2;
#if vtkNumComponents >= 4
  tColor.rgb += tColor3;
#endif
#endif
#endif

#endif







return tColor;
}

bool valueWithinScalarRange(vec4 val, vec4 min, vec4 max) {
  bool withinRange = false;
  #if vtkNumComponents == 1
    if (val.r >= min.r && val.r <= max.r) {
      withinRange = true;
    }
  #endif
  #if defined(vtkIndependentComponentsOn) && vtkNumComponents == 2
     if (val.r >= min.r && val.r <= max.r &&
        val.g >= min.g && val.g <= max.g) {
      withinRange = true;
    }
  #endif
  #if defined(vtkIndependentComponentsOn) && vtkNumComponents >= 3
    if (all(greaterThanEqual(val, ipScalarRangeMin)) &&
        all(lessThanEqual(val, ipScalarRangeMax))) {
      withinRange = true;
    }
  #endif
  return withinRange;
}

//=======================================================================
// Apply the specified blend mode operation along the ray's path.
//
void applyBlend(vec3 posIS, vec3 endIS, float sampleDistanceIS, vec3 tdims)
{
  vec3 tstep = 1.0/tdims;

  // start slightly inside and apply some jitter
  vec3 delta = endIS - posIS;
  vec3 stepIS = normalize(delta)*sampleDistanceIS;
  float raySteps = length(delta)/sampleDistanceIS;

  // avoid 0.0 jitter
  float jitter = 0.01 + 0.99*texture2D(jtexture, gl_FragCoord.xy/32.0).r;
  float stepsTraveled = jitter;

  // local vars for the loop
  vec4 color = vec4(0.0, 0.0, 0.0, 0.0);
  vec4 tValue;
  vec4 tColor;

  // if we have less than one step then pick the middle point
  // as our value
  // if (raySteps <= 1.0)
  // {
  //   posIS = (posIS + endIS)*0.5;
  // }

  // Perform initial step at the volume boundary
  // compute the scalar
  tValue = getTextureValue(posIS);

  #if vtkBlendMode == 0 // COMPOSITE_BLEND
    // now map through opacity and color
    tColor = getColorForValue(tValue, posIS, tstep);

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps);
      gl_FragData[0] = tColor;
      return;
    }

    tColor.a = 1.0 - pow(1.0 - tColor.a, jitter);
    color = vec4(tColor.rgb*tColor.a, tColor.a);
    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);

      float mix = (1.0 - color.a);

      // this line should not be needed but nvidia seems to not handle
      // the break correctly on windows/chrome 58 angle
      //mix = mix * sign(max(raySteps - stepsTraveled - 1.0, 0.0));

      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
      stepsTraveled++;
      posIS += stepIS;
      if (color.a > 0.99) { color.a = 1.0; break; }
    }

    if (color.a < 0.99 && (raySteps - stepsTraveled) > 0.0)
    {
      posIS = endIS;

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps - stepsTraveled);

      float mix = (1.0 - color.a);
      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
    }

    gl_FragData[0] = vec4(color.rgb/color.a, color.a);
  #endif
  #if vtkBlendMode == 1 || vtkBlendMode == 2
    // MAXIMUM_INTENSITY_BLEND || MINIMUM_INTENSITY_BLEND
    // Find maximum/minimum intensity along the ray.

    // Define the operation we will use (min or max)
    #if vtkBlendMode == 1
    #define OP max
    #else
    #define OP min
    #endif

    // If the clipping range is shorter than the sample distance
    // we can skip the sampling loop along the ray.
    if (raySteps <= 1.0)
    {
      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);
      return;
    }

    vec4 value = tValue;
    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // Update the maximum value if necessary
      value = OP(tValue, value);

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;
    tValue = getTextureValue(posIS);
    value = OP(tValue, value);

    // Now map through opacity and color
    gl_FragData[0] = getColorForValue(value, posIS, tstep);
  #endif
  #if vtkBlendMode == 3 || vtkBlendMode == 4 //AVERAGE_INTENSITY_BLEND || ADDITIVE_BLEND
    vec4 sum = vec4(0.);

    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;
    }

    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(sum, posIS, tstep);
      return;
    }

    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // One can control the scalar range by setting the AverageIPScalarRange to disregard scalar values, not in the range of interest, from the average computation.
      // Notes:
      // - We are comparing all values in the texture to see if any of them
      //   are outside of the scalar range. In the future we might want to allow
      //   scalar ranges for each component.
      if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
        // Sum the values across each step in the path
        sum += tValue;
      }
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;

    // compute the scalar
    tValue = getTextureValue(posIS);

    // One can control the scalar range by setting the IPScalarRange to disregard scalar values, not in the range of interest, from the average computation
    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;

      stepsTraveled++;
    }

    #if vtkBlendMode == 3 // Average
      sum /= vec4(stepsTraveled, stepsTraveled, stepsTraveled, 1.0);
    #endif

    gl_FragData[0] = getColorForValue(sum, posIS, tstep);
  #endif
}

//=======================================================================
// Compute a new start and end point for a given ray based
// on the provided bounded clipping plane (aka a rectangle)
void getRayPointIntersectionBounds(
  vec3 rayPos, vec3 rayDir,
  vec3 planeDir, float planeDist,
  inout vec2 tbounds, vec3 vPlaneX, vec3 vPlaneY,
  float vSize1, float vSize2)
{
  float result = dot(rayDir, planeDir);
  if (abs(result) < 1e-6)
  {
    return;
  }
  result = -1.0 * (dot(rayPos, planeDir) + planeDist) / result;
  vec3 xposVC = rayPos + rayDir*result;
  vec3 vxpos = xposVC - vOriginVC;
  vec2 vpos = vec2(
    dot(vxpos, vPlaneX),
    dot(vxpos, vPlaneY));

  // on some apple nvidia systems this does not work
  // if (vpos.x < 0.0 || vpos.x > vSize1 ||
  //     vpos.y < 0.0 || vpos.y > vSize2)
  // even just
  // if (vpos.x < 0.0 || vpos.y < 0.0)
  // fails
  // so instead we compute a value that represents in and out
  //and then compute the return using this value
  float xcheck = max(0.0, vpos.x * (vpos.x - vSize1)); //  0 means in bounds
  float check = sign(max(xcheck, vpos.y * (vpos.y - vSize2))); //  0 means in bounds, 1 = out

  tbounds = mix(
   vec2(min(tbounds.x, result), max(tbounds.y, result)), // in value
   tbounds, // out value
   check);  // 0 in 1 out
}

//=======================================================================
// given a
// - ray direction (rayDir)
// - starting point (vertexVCVSOutput)
// - bounding planes of the volume
// - optionally depth buffer values
// - far clipping plane
// compute the start/end distances of the ray we need to cast
vec2 computeRayDistances(vec3 rayDir, vec3 tdims)
{
  vec2 dists = vec2(100.0*camFar, -1.0);

  vec3 vSize = vSpacing*tdims;

  // all this is in View Coordinates
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal0, vPlaneDistance0, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal1, vPlaneDistance1, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal2, vPlaneDistance2, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal3, vPlaneDistance3, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal4, vPlaneDistance4, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal5, vPlaneDistance5, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);

  //VTK::ClipPlane::Impl

  // do not go behind front clipping plane
  dists.x = max(0.0,dists.x);

  // do not go PAST far clipping plane
  float farDist = -camThick/rayDir.z;
  dists.y = min(farDist,dists.y);

  // Do not go past the zbuffer value if set
  // This is used for intermixing opaque geometry
  //VTK::ZBuffer::Impl

  return dists;
}

//=======================================================================
// Compute the index space starting position (pos) and end
// position
//
void computeIndexSpaceValues(out vec3 pos, out vec3 endPos, out float sampleDistanceIS, vec3 rayDir, vec2 dists)
{
  // compute starting and ending values in volume space
  pos = vertexVCVSOutput + dists.x*rayDir;
  pos = pos - vOriginVC;
  // convert to volume basis and origin
  pos = vec3(
    dot(pos, vPlaneNormal0),
    dot(pos, vPlaneNormal2),
    dot(pos, vPlaneNormal4));

  endPos = vertexVCVSOutput + dists.y*rayDir;
  endPos = endPos - vOriginVC;
  endPos = vec3(
    dot(endPos, vPlaneNormal0),
    dot(endPos, vPlaneNormal2),
    dot(endPos, vPlaneNormal4));

  float delta = length(endPos - pos);

  pos *= vVCToIJK;
  endPos *= vVCToIJK;

  float delta2 = length(endPos - pos);
  sampleDistanceIS = sampleDistance*delta2/delta;
  #ifdef VolumeShadowOn
    sampleDistanceISVS = sampleDistanceIS * volumeShadowSamplingDistFactor;
  #endif
}

void main()
{

  if (cameraParallel == 1)
  {
    // Camera is parallel, so the rayDir is just the direction of the camera.
    rayDirVC = vec3(0.0, 0.0, -1.0);
  } else {
    // camera is at 0,0,0 so rayDir for perspective is just the vc coord
    rayDirVC = normalize(vertexVCVSOutput);
  }

  vec3 tdims = vec3(volumeDimensions);

  // compute the start and end points for the ray
  vec2 rayStartEndDistancesVC = computeRayDistances(rayDirVC, tdims);

  // do we need to composite? aka does the ray have any length
  // If not, bail out early
  if (rayStartEndDistancesVC.y <= rayStartEndDistancesVC.x)
  {
    discard;
  }

  // IS = Index Space
  vec3 posIS;
  vec3 endIS;
  float sampleDistanceIS;
  computeIndexSpaceValues(posIS, endIS, sampleDistanceIS, rayDirVC, rayStartEndDistancesVC);

  // Perform the blending operation along the ray
  applyBlend(posIS, endIS, sampleDistanceIS, tdims);
}
`;function Gg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function UR(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Gg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Gg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var BR=Xa,xs=re;function GR(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}function AR(t,e){e.classHierarchy.push("vtkOpenGLVolumeMapper"),t.buildPass=function(){e.zBufferTexture=null},t.opaqueZBufferPass=function(n,r){if(n){var a=r.getZBufferTexture();a!==e.zBufferTexture&&(e.zBufferTexture=a)}},t.volumePass=function(n,r){if(n){e._openGLRenderWindow=t.getFirstAncestorOfType("vtkOpenGLRenderWindow"),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.jitterTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.scalarTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.opacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLVolume=t.getFirstAncestorOfType("vtkOpenGLVolume");var a=e.openGLVolume.getRenderable();e.openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");var i=e.openGLRenderer.getRenderable();e.openGLCamera=e.openGLRenderer.getViewNodeFor(i.getActiveCamera()),t.renderPiece(i,a)}},t.buildShaders=function(n,r,a){t.getShaderTemplate(n,r,a),t.replaceShaderValues(n,r,a)},t.getShaderTemplate=function(n,r,a){n.Vertex=bR,n.Fragment=kR,n.Geometry=""},t.replaceShaderValues=function(n,r,a){var i=n.Fragment,o=a.getProperty().getInterpolationType();o===kc.LINEAR&&(i=_.substitute(i,"//VTK::TrilinearOn","#define vtkTrilinearOn").result);var s=a.getProperty().getUseLabelOutline();s===!0&&(i=_.substitute(i,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result);var c=e.scalarTexture.getComponents();i=_.substitute(i,"//VTK::NumComponents","#define vtkNumComponents ".concat(c)).result;var u=a.getProperty().getIndependentComponents();if(u){i=_.substitute(i,"//VTK::IndependentComponentsOn","#define vtkIndependentComponentsOn").result;for(var g=[],f=0;f<c;f++)a.getProperty().getOpacityMode(f)===hh.PROPORTIONAL&&g.push("#define vtkComponent".concat(f,"Proportional"));g.length>0&&(i=_.substitute(i,"//VTK::vtkProportionalComponents",g.join(`
`)).result)}var l=e.currentInput.getSpatialExtent(),v=e.currentInput.getSpacing(),p=new Float64Array(3);te(p,(l[1]-l[0])*v[0],(l[3]-l[2])*v[1],(l[5]-l[4])*v[2]);var d=vn(p)/e.renderable.getSampleDistance();i=_.substitute(i,"//VTK::MaximumSamplesValue","".concat(Math.ceil(d))).result,i=_.substitute(i,"//VTK::LightComplexity","#define vtkLightComplexity ".concat(e.lastLightComplexity)).result,e.lastLightComplexity>0&&(e.renderable.getVolumetricScatteringBlending()>0&&(i=_.substitute(i,"//VTK::VolumeShadowOn","#define VolumeShadowOn").result),e.renderable.getVolumetricScatteringBlending()<1&&(i=_.substitute(i,"//VTK::SurfaceShadowOn","#define SurfaceShadowOn").result)),e.gopacity=a.getProperty().getUseGradientOpacity(0);for(var h=1;u&&!e.gopacity&&h<c;++h)a.getProperty().getUseGradientOpacity(h)&&(e.gopacity=!0);e.gopacity&&(i=_.substitute(i,"//VTK::GradientOpacityOn","#define vtkGradientOpacityOn").result),e.renderable.getComputeNormalFromOpacity()&&(i=_.substitute(i,"//VTK::vtkComputeNormalFromOpacity","#define vtkComputeNormalFromOpacity").result),e.zBufferTexture!==null&&(i=_.substitute(i,"//VTK::ZBuffer::Dec",["uniform sampler2D zBufferTexture;","uniform float vpWidth;","uniform float vpHeight;"]).result,i=_.substitute(i,"//VTK::ZBuffer::Impl",["vec4 depthVec = texture2D(zBufferTexture, vec2(gl_FragCoord.x / vpWidth, gl_FragCoord.y/vpHeight));","float zdepth = (depthVec.r*256.0 + depthVec.g)/257.0;","zdepth = zdepth * 2.0 - 1.0;","zdepth = -2.0 * camFar * camNear / (zdepth*(camFar-camNear)-(camFar+camNear)) - camNear;","zdepth = -zdepth/rayDir.z;","dists.y = min(zdepth,dists.y);"]).result),i=_.substitute(i,"//VTK::BlendMode","".concat(e.renderable.getBlendMode())).result,n.Fragment=i,t.replaceShaderLight(n,r,a),t.replaceShaderClippingPlane(n,r,a)},t.replaceShaderLight=function(n,r,a){if(e.lastLightComplexity!==0){var i=n.Fragment,o=0;r.getLights().forEach(function(s){s.getSwitch()&&(o+=1)}),i=_.substitute(i,"//VTK::Light::Dec",["uniform int lightNum;","uniform bool twoSidedLighting;","uniform vec3 lightColor[".concat(o,"];"),"uniform vec3 lightDirectionVC[".concat(o,"]; // normalized"),"uniform vec3 lightHalfAngleVC[".concat(o,"];"),"//VTK::Light::Dec"],!1).result,e.lastLightComplexity===3&&(i=_.substitute(i,"//VTK::Light::Dec",["uniform vec3 lightPositionVC[".concat(o,"];"),"uniform vec3 lightAttenuation[".concat(o,"];"),"uniform float lightConeAngle[".concat(o,"];"),"uniform float lightExponent[".concat(o,"];"),"uniform int lightPositional[".concat(o,"];")],!1).result),e.renderable.getVolumetricScatteringBlending()>0&&(i=_.substitute(i,"//VTK::VolumeShadow::Dec",["uniform float volumetricScatteringBlending;","uniform float giReach;","uniform float volumeShadowSamplingDistFactor;","uniform float anisotropy;","uniform float anisotropy2;"],!1).result),n.Fragment=i}},t.replaceShaderClippingPlane=function(n,r,a){var i=n.Fragment;if(e.renderable.getClippingPlanes().length>0){var o=e.renderable.getClippingPlanes().length;i=_.substitute(i,"//VTK::ClipPlane::Dec",["uniform vec3 vClipPlaneNormals[6];","uniform float vClipPlaneDistances[6];","//VTK::ClipPlane::Dec"],!1).result,i=_.substitute(i,"//VTK::ClipPlane::Impl",["for(int i = 0; i < ".concat(o,"; i++) {"),"  float rayDirRatio = dot(rayDir, vClipPlaneNormals[i]);","  float equationResult = dot(vertexVCVSOutput, vClipPlaneNormals[i]) + vClipPlaneDistances[i];","  if (rayDirRatio == 0.0)","  {","    if (equationResult < 0.0) dists.x = dists.y;","    continue;","  }","  float result = -1.0 * equationResult / rayDirRatio;","  if (rayDirRatio < 0.0) dists.y = min(dists.y, result);","  else dists.x = max(dists.x, result);","}","//VTK::ClipPlane::Impl"],!1).result}n.Fragment=i},t.getNeedToRebuildShaders=function(n,r,a){var i=0;a.getProperty().getShade()&&e.renderable.getBlendMode()===O0.COMPOSITE_BLEND&&(i=0,e.numberOfLights=0,r.getLights().forEach(function(T){var C=T.getSwitch();C>0&&(e.numberOfLights++,i===0&&(i=1)),i===1&&(e.numberOfLights>1||T.getIntensity()!==1||!T.lightTypeIsHeadLight())&&(i=2),i<3&&T.getPositional()&&(i=3)}));var o=!1;e.lastLightComplexity!==i&&(e.lastLightComplexity=i,o=!0);var s=e.scalarTexture.getComponents(),c=a.getProperty().getIndependentComponents(),u=!1,g=[];if(c){for(var f=0;f<s;f++)g.push(a.getProperty().getOpacityMode(f));g.length>0&&(u=!0)}var l=e.currentInput.getSpatialExtent(),v=e.currentInput.getSpacing(),p=new Float64Array(3);te(p,(l[1]-l[0])*v[0],(l[3]-l[2])*v[1],(l[5]-l[4])*v[2]);var d=vn(p)/e.renderable.getSampleDistance(),h={interpolationType:a.getProperty().getInterpolationType(),useLabelOutline:a.getProperty().getUseLabelOutline(),numComp:s,usesProportionalComponents:u,iComps:c,maxSamples:d,useGradientOpacity:a.getProperty().getUseGradientOpacity(0),blendMode:e.renderable.getBlendMode(),proportionalComponents:g};return!e.previousState||e.previousState.interpolationType!==h.interpolationType||e.previousState.useLabelOutline!==h.useLabelOutline||e.previousState.numComp!==h.numComp||e.previousState.usesProportionalComponents!==h.usesProportionalComponents||e.previousState.iComps!==h.iComps||e.previousState.maxSamples!==h.maxSamples||e.previousState.useGradientOpacity!==h.useGradientOpacity||e.previousState.blendMode!==h.blendMode||!GR(e.previousState.proportionalComponents,h.proportionalComponents)?(e.previousState=UR({},h),!0):n.getProgram()===0||o||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||!!e.lastZBufferTexture!=!!e.zBufferTexture||n.getShaderSourceTime().getMTime()<t.getMTime()||n.getShaderSourceTime().getMTime()<e.renderable.getMTime()?(e.lastZBufferTexture=e.zBufferTexture,!0):!1},t.updateShaders=function(n,r,a){if(e.lastBoundBO=n,t.getNeedToRebuildShaders(n,r,a)){var i={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(i,r,a);var o=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(i.Vertex,i.Fragment,i.Geometry);o!==n.getProgram()&&(n.setProgram(o),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),t.setMapperShaderParameters(n,r,a),t.setCameraShaderParameters(n,r,a),t.setPropertyShaderParameters(n,r,a),t.getClippingPlaneShaderParameters(n,r,a)},t.setMapperShaderParameters=function(n,r,a){var i=n.getProgram();n.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(i.isAttributeUsed("vertexDC")&&(n.getVAO().addAttributeArray(i,n.getCABO(),"vertexDC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||xs("Error setting vertexDC in shader VAO.")),n.getAttributeUpdateTime().modified()),i.setUniformi("texture1",e.scalarTexture.getTextureUnit()),i.setUniformf("sampleDistance",e.renderable.getSampleDistance());for(var o=e.scalarTexture.getVolumeInfo(),s=e.renderable.getIpScalarRange(),c=[],u=[],g=0;g<4;g++)c[g]=s[0]*o.dataComputedScale[g]+o.dataComputedOffset[g],u[g]=s[1]*o.dataComputedScale[g]+o.dataComputedOffset[g],c[g]=(c[g]-o.offset[g])/o.scale[g],u[g]=(u[g]-o.offset[g])/o.scale[g];if(i.setUniform4f("ipScalarRangeMin",c[0],c[1],c[2],c[3]),i.setUniform4f("ipScalarRangeMax",u[0],u[1],u[2],u[3]),e.zBufferTexture!==null){i.setUniformi("zBufferTexture",e.zBufferTexture.getTextureUnit());var f=e._useSmallViewport?[e._smallViewportWidth,e._smallViewportHeight]:e._openGLRenderWindow.getFramebufferSize();i.setUniformf("vpWidth",f[0]),i.setUniformf("vpHeight",f[1])}},t.setCameraShaderParameters=function(n,r,a){var i=e.openGLCamera.getKeyMatrices(r),o=e.openGLVolume.getKeyMatrices();Me(e.modelToView,i.wcvc,o.mcwc);var s=n.getProgram(),c=e.openGLCamera.getRenderable(),u=c.getClippingRange();s.setUniformf("camThick",u[1]-u[0]),s.setUniformf("camNear",u[0]),s.setUniformf("camFar",u[1]);for(var g=e.currentInput.getBounds(),f=e.currentInput.getDimensions(),l=new Float64Array(3),v=new Float64Array(3),p=1,d=-1,h=1,T=-1,C=0;C<8;++C){if(te(l,g[C%2],g[2+Math.floor(C/2)%2],g[4+Math.floor(C/4)]),ue(l,l,e.modelToView),!c.getParallelProjection()){Nt(v,l);var m=-u[0]/l[2];xo(l,v,m)}ue(l,l,i.vcpc),p=Math.min(l[0],p),d=Math.max(l[0],d),h=Math.min(l[1],h),T=Math.max(l[1],T)}s.setUniformf("dcxmin",p),s.setUniformf("dcxmax",d),s.setUniformf("dcymin",h),s.setUniformf("dcymax",T),s.isUniformUsed("cameraParallel")&&s.setUniformi("cameraParallel",c.getParallelProjection());var y=e.currentInput.getSpatialExtent(),w=e.currentInput.getSpacing(),S=new Float64Array(3);te(S,(y[1]-y[0])*w[0],(y[3]-y[2])*w[1],(y[5]-y[4])*w[2]),s.setUniform3f("vSpacing",w[0],w[1],w[2]),te(l,y[0],y[2],y[4]),e.currentInput.indexToWorldVec3(l,l),ue(l,l,e.modelToView),s.setUniform3f("vOriginVC",l[0],l[1],l[2]);var O=e.currentInput.getIndexToWorld();Me(e.idxToView,e.modelToView,O),In(e.idxNormalMatrix,i.normalMatrix,o.normalMatrix),In(e.idxNormalMatrix,e.idxNormalMatrix,e.currentInput.getDirection());var M=vn(S)/e.renderable.getSampleDistance();M>e.renderable.getMaximumSamplesPerRay()&&BR("The number of steps required ".concat(Math.ceil(M),` is larger than the
        specified maximum number of steps `).concat(e.renderable.getMaximumSamplesPerRay(),`.
        Please either change the
        volumeMapper sampleDistance or its maximum number of samples.`));var R=new Float64Array(3);if(te(R,1,1,1),Eo(R,R,S),s.setUniform3f("vVCToIJK",R[0],R[1],R[2]),s.setUniform3i("volumeDimensions",f[0],f[1],f[2]),!e._openGLRenderWindow.getWebgl2()){var D=e.scalarTexture.getVolumeInfo();s.setUniformf("texWidth",e.scalarTexture.getWidth()),s.setUniformf("texHeight",e.scalarTexture.getHeight()),s.setUniformi("xreps",D.xreps),s.setUniformi("xstride",D.xstride),s.setUniformi("ystride",D.ystride)}for(var L=new Float64Array(3),N=new Float64Array(3),U=0;U<6;++U){switch(U){case 1:te(L,-1,0,0),te(N,y[0],y[2],y[4]);break;case 2:te(L,0,1,0),te(N,y[1],y[3],y[5]);break;case 3:te(L,0,-1,0),te(N,y[0],y[2],y[4]);break;case 4:te(L,0,0,1),te(N,y[1],y[3],y[5]);break;case 5:te(L,0,0,-1),te(N,y[0],y[2],y[4]);break;case 0:default:te(L,1,0,0),te(N,y[1],y[3],y[5]);break}$r(L,L,e.idxNormalMatrix),ue(N,N,e.idxToView);var b=-1*ut(N,L);s.setUniform3f("vPlaneNormal".concat(U),L[0],L[1],L[2]),s.setUniformf("vPlaneDistance".concat(U),b)}if(a.getProperty().getUseLabelOutline()){var G=e.currentInput,P=G.getWorldToIndex();s.setUniformMatrix("vWCtoIDX",P),ct(e.projectionToWorld,i.wcpc),s.setUniformMatrix("PCWCMatrix",e.projectionToWorld);var z=t.getRenderTargetSize();s.setUniformf("vpWidth",z[0]),s.setUniformf("vpHeight",z[1]);var F=t.getRenderTargetOffset();s.setUniformf("vpOffsetX",F[0]/z[0]),s.setUniformf("vpOffsetY",F[1]/z[1])}if(ct(e.projectionToView,i.vcpc),s.setUniformMatrix("PCVCMatrix",e.projectionToView),e.lastLightComplexity!==0){var V=0,B=[],W=[],I=[];if(r.getLights().forEach(function(Ee){var de=Ee.getSwitch();if(de>0){var oe=Ee.getColor(),Z=Ee.getIntensity();B[0+V*3]=oe[0]*Z,B[1+V*3]=oe[1]*Z,B[2+V*3]=oe[2]*Z;var se=Ee.getDirection();te(L,se[0],se[1],se[2]),$r(L,L,i.normalMatrix),Nt(L,L),W[0+V*3]=L[0],W[1+V*3]=L[1],W[2+V*3]=L[2],I[0+V*3]=-.5*L[0],I[1+V*3]=-.5*L[1],I[2+V*3]=-.5*(L[2]-1),V++}}),s.setUniformi("twoSidedLighting",r.getTwoSidedLighting()),s.setUniformi("lightNum",V),s.setUniform3fv("lightColor",B),s.setUniform3fv("lightDirectionVC",W),s.setUniform3fv("lightHalfAngleVC",I),e.lastLightComplexity===3){V=0;var $=[],Q=[],H=[],he=[],j=[];r.getLights().forEach(function(Ee){var de=Ee.getSwitch();if(de>0){var oe=Ee.getAttenuationValues();Q[0+V*3]=oe[0],Q[1+V*3]=oe[1],Q[2+V*3]=oe[2],he[V]=Ee.getExponent(),H[V]=Ee.getConeAngle(),j[V]=Ee.getPositional();var Z=Ee.getTransformedPosition();ue(Z,Z,e.modelToView),$[0+V*3]=Z[0],$[1+V*3]=Z[1],$[2+V*3]=Z[2],V+=1}}),s.setUniform3fv("lightPositionVC",$),s.setUniform3fv("lightAttenuation",Q),s.setUniformfv("lightConeAngle",H),s.setUniformfv("lightExponent",he),s.setUniformiv("lightPositional",j)}e.renderable.getVolumetricScatteringBlending()>0&&(s.setUniformf("giReach",e.renderable.getGlobalIlluminationReach()),s.setUniformf("volumetricScatteringBlending",e.renderable.getVolumetricScatteringBlending()),s.setUniformf("volumeShadowSamplingDistFactor",e.renderable.getVolumeShadowSamplingDistFactor()),s.setUniformf("anisotropy",e.renderable.getAnisotropy()),s.setUniformf("anisotropy2",Math.pow(e.renderable.getAnisotropy(),2)))}},t.setPropertyShaderParameters=function(n,r,a){var i=n.getProgram();i.setUniformi("ctexture",e.colorTexture.getTextureUnit()),i.setUniformi("otexture",e.opacityTexture.getTextureUnit()),i.setUniformi("jtexture",e.jitterTexture.getTextureUnit());var o=e.scalarTexture.getVolumeInfo(),s=a.getProperty(),c=e.scalarTexture.getComponents(),u=a.getProperty().getIndependentComponents();if(u&&c>=2)for(var g=0;g<c;g++)i.setUniformf("mix".concat(g),a.getProperty().getComponentWeight(g));for(var f=0;f<c;f++){var l=u?f:0,v=o.scale[f],p=s.getScalarOpacity(l),d=p.getRange(),h=v/(d[1]-d[0]),T=(o.offset[f]-d[0])/(d[1]-d[0]);i.setUniformf("oshift".concat(f),T),i.setUniformf("oscale".concat(f),h);var C=s.getRGBTransferFunction(l),m=C.getRange();i.setUniformf("cshift".concat(f),(o.offset[f]-m[0])/(m[1]-m[0])),i.setUniformf("cscale".concat(f),v/(m[1]-m[0]))}if(e.gopacity)if(u)for(var y=0;y<c;++y){var w=o.scale[y],S=s.getUseGradientOpacity(y);if(S){var O=s.getGradientOpacityMinimumOpacity(y),M=s.getGradientOpacityMaximumOpacity(y);i.setUniformf("gomin".concat(y),O),i.setUniformf("gomax".concat(y),M);var R=[s.getGradientOpacityMinimumValue(y),s.getGradientOpacityMaximumValue(y)];i.setUniformf("goscale".concat(y),w*(M-O)/(R[1]-R[0])),i.setUniformf("goshift".concat(y),-R[0]*(M-O)/(R[1]-R[0])+O)}else i.setUniformf("gomin".concat(y),1),i.setUniformf("gomax".concat(y),1),i.setUniformf("goscale".concat(y),0),i.setUniformf("goshift".concat(y),1)}else{var D=o.scale[c-1],L=s.getGradientOpacityMinimumOpacity(0),N=s.getGradientOpacityMaximumOpacity(0);i.setUniformf("gomin0",L),i.setUniformf("gomax0",N);var U=[s.getGradientOpacityMinimumValue(0),s.getGradientOpacityMaximumValue(0)];i.setUniformf("goscale0",D*(N-L)/(U[1]-U[0])),i.setUniformf("goshift0",-U[0]*(N-L)/(U[1]-U[0])+L)}var b=a.getProperty().getUseLabelOutline();if(b===!0){var G=a.getProperty().getLabelOutlineThickness();i.setUniformi("outlineThickness",G)}e.lastLightComplexity>0&&(i.setUniformf("vAmbient",s.getAmbient()),i.setUniformf("vDiffuse",s.getDiffuse()),i.setUniformf("vSpecular",s.getSpecular()),i.setUniformf("vSpecularPower",s.getSpecularPower()))},t.getClippingPlaneShaderParameters=function(n,r,a){if(e.renderable.getClippingPlanes().length>0){for(var i=e.openGLCamera.getKeyMatrices(r),o=[],s=[],c=e.renderable.getClippingPlanes(),u=c.length,g=0;g<u;++g){var f=c[g].getNormal(),l=c[g].getOrigin();$r(f,f,i.normalMatrix),ue(l,l,i.wcvc);var v=-1*ut(l,f);o.push(f[0]),o.push(f[1]),o.push(f[2]),s.push(v)}var p=n.getProgram();p.setUniform3fv("vClipPlaneNormals",o),p.setUniformfv("vClipPlaneDistances",s)}},t.delete=Uv(function(){e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},t.delete),t.getRenderTargetSize=function(){if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];var n=e.openGLRenderer.getTiledSizeAndOrigin(),r=n.usize,a=n.vsize;return[r,a]},t.getRenderTargetOffset=function(){var n=e.openGLRenderer.getTiledSizeAndOrigin(),r=n.lowerLeftU,a=n.lowerLeftV;return[r,a]},t.renderPieceStart=function(n,r){var a=n.getVTKWindow().getInteractor();if(e._useSmallViewport=!1,a.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._animationRateSubscription||(e._animationRateSubscription=a.onAnimationFrameRateUpdate(function(){if(e.renderable.getAutoAdjustSampleDistances()){var u=a.getRecentAnimationFrameRate(),g=a.getDesiredUpdateRate()/u;(g>1.15||g<.85)&&(e._lastScale*=g),e._lastScale>400&&(e._lastScale=400),e._lastScale<1.5&&(e._lastScale=1.5)}else e._lastScale=e.renderable.getImageSampleDistance()*e.renderable.getImageSampleDistance();var f=e._openGLRenderWindow.getFramebufferSize();e._smallViewportWidth=Math.ceil(f[0]/Math.sqrt(e._lastScale)),e._smallViewportHeight=Math.ceil(f[1]/Math.sqrt(e._lastScale))})),e._useSmallViewport){var i=e._openGLRenderWindow.getFramebufferSize();if(e._smallViewportHeight>i[1]&&(e._smallViewportHeight=i[1]),e._smallViewportWidth>i[0]&&(e._smallViewportWidth=i[0]),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.getGLFramebuffer()===null)e.framebuffer.create(i[0],i[1]),e.framebuffer.populateFramebuffer();else{var o=e.framebuffer.getSize();(o[0]!==i[0]||o[1]!==i[1])&&(e.framebuffer.create(i[0],i[1]),e.framebuffer.populateFramebuffer())}e.framebuffer.bind();var s=e.context;s.clearColor(0,0,0,0),s.colorMask(!0,!0,!0,!0),s.clear(s.COLOR_BUFFER_BIT),s.viewport(0,0,e._smallViewportWidth,e._smallViewportHeight),e.fvp=[e._smallViewportWidth/i[0],e._smallViewportHeight/i[1]]}e.context.disable(e.context.DEPTH_TEST),t.updateBufferObjects(n,r);var c=r.getProperty().getInterpolationType();c===kc.NEAREST?(e.scalarTexture.setMinificationFilter(xe.NEAREST),e.scalarTexture.setMagnificationFilter(xe.NEAREST)):(e.scalarTexture.setMinificationFilter(xe.LINEAR),e.scalarTexture.setMagnificationFilter(xe.LINEAR)),e.lastBoundBO=null,e.zBufferTexture!==null&&e.zBufferTexture.activate()},t.renderPieceDraw=function(n,r){var a=e.context;e.scalarTexture.activate(),e.opacityTexture.activate(),e.colorTexture.activate(),e.jitterTexture.activate(),t.updateShaders(e.tris,n,r),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.scalarTexture.deactivate(),e.colorTexture.deactivate(),e.opacityTexture.deactivate(),e.jitterTexture.deactivate()},t.renderPieceFinish=function(n,r){if(e.zBufferTexture!==null&&e.zBufferTexture.deactivate(),e._useSmallViewport){if(e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null){e.copyShader=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","uniform vec2 tfactor;","varying vec2 tcoord;","void main() { tcoord = vec2(vertexDC.x*0.5 + 0.5, vertexDC.y*0.5 + 0.5) * tfactor; gl_Position = vertexDC; }"].join(`
`),["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D texture1;","varying vec2 tcoord;","void main() { gl_FragData[0] = texture2D(texture1,tcoord); }"].join(`
`),"");var a=e.copyShader;e.copyVAO=Eu.newInstance(),e.copyVAO.setOpenGLRenderWindow(e._openGLRenderWindow),e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||xs("Error setting vertexDC in copy shader VAO.")}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.copyShader);var i=e._openGLRenderWindow.getFramebufferSize();e.context.viewport(0,0,i[0],i[1]);var o=e.framebuffer.getColorTexture();o.activate(),e.copyShader.setUniformi("texture",o.getTextureUnit()),e.copyShader.setUniform2f("tfactor",e.fvp[0],e.fvp[1]);var s=e.context;s.blendFuncSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),o.deactivate(),s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA)}},t.renderPiece=function(n,r){if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){xs("No input!");return}t.renderPieceStart(n,r),t.renderPieceDraw(n,r),t.renderPieceFinish(n,r)},t.computeBounds=function(n,r){if(!t.getInput()){hr(e.Bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=function(n,r){t.getNeedToRebuildBufferObjects(n,r)&&t.buildBufferObjects(n,r)},t.getNeedToRebuildBufferObjects=function(n,r){return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<r.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<r.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()},t.buildBufferObjects=function(n,r){var a=e.currentInput;if(!!a){var i=a.getPointData()&&a.getPointData().getScalars();if(!!i){var o=r.getProperty();if(!e.jitterTexture.getHandle()){for(var s=new Uint8Array(1024),c=0;c<32*32;++c)s[c]=255*Math.random();e.jitterTexture.setMinificationFilter(xe.LINEAR),e.jitterTexture.setMagnificationFilter(xe.LINEAR),e.jitterTexture.create2DFromRaw(32,32,1,Xe.UNSIGNED_CHAR,s)}var u=i.getNumberOfComponents(),g=o.getIndependentComponents(),f=g?u:1,l="".concat(o.getMTime());if(e.opacityTextureString!==l){for(var v=1024,p=v*2*f,d=new Float32Array(p),h=new Float32Array(v),T=0;T<f;++T){var C=o.getScalarOpacity(T),m=e.renderable.getSampleDistance()/o.getScalarOpacityUnitDistance(T),y=C.getRange();C.getTable(y[0],y[1],v,h,1);for(var w=0;w<v;++w)d[T*v*2+w]=1-Math.pow(1-h[w],m),d[T*v*2+w+v]=d[T*v*2+w]}if(e.opacityTexture.releaseGraphicsResources(e._openGLRenderWindow),e.opacityTexture.setMinificationFilter(xe.LINEAR),e.opacityTexture.setMagnificationFilter(xe.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))e.opacityTexture.create2DFromRaw(v,2*f,1,Xe.FLOAT,d);else{for(var S=new Uint8Array(p),O=0;O<p;++O)S[O]=255*d[O];e.opacityTexture.create2DFromRaw(v,2*f,1,Xe.UNSIGNED_CHAR,S)}e.opacityTextureString=l}if(l="".concat(o.getMTime()),e.colorTextureString!==l){for(var M=1024,R=M*2*f*3,D=new Uint8Array(R),L=new Float32Array(M*3),N=0;N<f;++N){var U=o.getRGBTransferFunction(N),b=U.getRange();U.getTable(b[0],b[1],M,L,1);for(var G=0;G<M*3;++G)D[N*M*6+G]=255*L[G],D[N*M*6+G+M*3]=255*L[G]}e.colorTexture.releaseGraphicsResources(e._openGLRenderWindow),e.colorTexture.setMinificationFilter(xe.LINEAR),e.colorTexture.setMagnificationFilter(xe.LINEAR),e.colorTexture.create2DFromRaw(M,2*f,3,Xe.UNSIGNED_CHAR,D),e.colorTextureString=l}if(l="".concat(a.getMTime()),e.scalarTextureString!==l){var P=a.getDimensions();e.scalarTexture.releaseGraphicsResources(e._openGLRenderWindow),e.scalarTexture.resetFormatAndType(),e.scalarTexture.create3DFilterableFromRaw(P[0],P[1],P[2],u,i.getDataType(),i.getData(),e.renderable.getPreferSizeOverAccuracy()),e.scalarTextureString=l}if(!e.tris.getCABO().getElementCount()){for(var z=new Float32Array(12),F=0;F<4;F++)z[F*3]=F%2*2-1,z[F*3+1]=F>1?1:-1,z[F*3+2]=-1;var V=new Uint16Array(8);V[0]=3,V[1]=0,V[2]=1,V[3]=3,V[4]=3,V[5]=0,V[6]=3,V[7]=2;var B=Ve.newInstance({numberOfComponents:3,values:z});B.setName("points");var W=Ve.newInstance({numberOfComponents:1,values:V});e.tris.getCABO().createVBO(W,"polys",Zt.SURFACE,{points:B,cellOffset:0})}e.VBOBuildTime.modified()}}}}var IR={context:null,VBOBuildTime:null,scalarTexture:null,scalarTextureString:null,opacityTexture:null,opacityTextureString:null,colorTexture:null,colorTextureString:null,jitterTexture:null,tris:null,framebuffer:null,copyShader:null,copyVAO:null,lastXYF:1,targetXYF:1,zBufferTexture:null,lastZBufferTexture:null,lastLightComplexity:0,fullViewportTime:1,idxToView:null,idxNormalMatrix:null,modelToView:null,projectionToView:null,avgWindowArea:0,avgFrameTime:0};function dh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,IR,n),Qe.extend(t,e,n),e.VBOBuildTime={},Ge(e.VBOBuildTime,{mtime:0}),e.tris=aa.newInstance(),e.scalarTexture=st.newInstance(),e.opacityTexture=st.newInstance(),e.colorTexture=st.newInstance(),e.jitterTexture=st.newInstance(),e.jitterTexture.setWrapS(Wa.REPEAT),e.jitterTexture.setWrapT(Wa.REPEAT),e.framebuffer=_o.newInstance(),e.idxToView=ie(new Float64Array(16)),e.idxNormalMatrix=Jt(new Float64Array(9)),e.modelToView=ie(new Float64Array(16)),e.projectionToView=ie(new Float64Array(16)),e.projectionToWorld=ie(new Float64Array(16)),e._lastScale=1,at(t,e,["context"]),AR(t,e)}var yh=ke(dh,"vtkOpenGLVolumeMapper"),Th={newInstance:yh,extend:dh};yt("vtkVolumeMapper",yh);const{vtkWarningMacro:PR}=E;function WR(t,e){e.classHierarchy.push("vtkStreamingOpenGLVolumeMapper"),t.buildBufferObjects=(n,r)=>{const a=e.currentInput;if(!a)return;const i=a.getPointData()&&a.getPointData().getScalars();if(!i)return;const o=r.getProperty();if(!e.jitterTexture.getHandle()){const f=new Uint8Array(1024);for(let l=0;l<32*32;++l)f[l]=255*Math.random();e.jitterTexture.setMinificationFilter(xe.LINEAR),e.jitterTexture.setMagnificationFilter(xe.LINEAR),e.jitterTexture.create2DFromRaw(32,32,1,Xe.UNSIGNED_CHAR,f)}const s=i.getNumberOfComponents(),u=o.getIndependentComponents()?s:1;let g=`${o.getMTime()}`;if(e.opacityTextureString!==g){const l=2048*u,v=new Float32Array(l),p=new Float32Array(1024);for(let d=0;d<u;++d){const h=o.getScalarOpacity(d),T=e.renderable.getSampleDistance()/o.getScalarOpacityUnitDistance(d),C=h.getRange();h.getTable(C[0],C[1],1024,p,1);for(let m=0;m<1024;++m)v[d*1024*2+m]=1-(1-p[m])**T,v[d*1024*2+m+1024]=v[d*1024*2+m]}if(e.opacityTexture.releaseGraphicsResources(e._openGLRenderWindow),e.opacityTexture.setMinificationFilter(xe.LINEAR),e.opacityTexture.setMagnificationFilter(xe.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))e.opacityTexture.create2DFromRaw(1024,2*u,1,Xe.FLOAT,v);else{const d=new Uint8Array(l);for(let h=0;h<l;++h)d[h]=255*v[h];e.opacityTexture.create2DFromRaw(1024,2*u,1,Xe.UNSIGNED_CHAR,d)}e.opacityTextureString=g}if(g=`${o.getMTime()}`,e.colorTextureString!==g){const l=2048*u*3,v=new Uint8Array(l),p=new Float32Array(1024*3);for(let d=0;d<u;++d){const h=o.getRGBTransferFunction(d),T=h.getRange();h.getTable(T[0],T[1],1024,p,1);for(let C=0;C<1024*3;++C)v[d*1024*6+C]=255*p[C],v[d*1024*6+C+1024*3]=255*p[C]}e.colorTexture.releaseGraphicsResources(e._openGLRenderWindow),e.colorTexture.setMinificationFilter(xe.LINEAR),e.colorTexture.setMagnificationFilter(xe.LINEAR),e.colorTexture.create2DFromRaw(1024,2*u,3,Xe.UNSIGNED_CHAR,v),e.colorTextureString=g}if(g=`${a.getMTime()}`,e.scalarTextureString!==g){const f=a.getDimensions(),l=e.scalarTexture.getTextureParameters(),v=a.getPointData().getScalars().getDataType(),p=a.getPointData().getScalars().getData();let d=!0;if(l.dataType&&l.dataType===v){const h=l.width*l.height*l.depth*l.numComps;p.length===h&&(d=!1)}d?(e.scalarTexture.releaseGraphicsResources(e._openGLRenderWindow),e.scalarTexture.resetFormatAndType(),e.scalarTexture.create3DFilterableFromRaw(f[0],f[1],f[2],s,i.getDataType(),i.getData(),e.renderable.getPreferSizeOverAccuracy())):(e.scalarTexture.deactivate(),e.scalarTexture.update3DFromRaw(p)),e.scalarTextureString=g}if(!e.tris.getCABO().getElementCount()){const f=new Float32Array(12);for(let d=0;d<4;d++)f[d*3]=d%2*2-1,f[d*3+1]=d>1?1:-1,f[d*3+2]=-1;const l=new Uint16Array(8);l[0]=3,l[1]=0,l[2]=1,l[3]=3,l[4]=3,l[5]=0,l[6]=3,l[7]=2;const v=Ve.newInstance({numberOfComponents:3,values:f});v.setName("points");const p=Ve.newInstance({numberOfComponents:1,values:l});e.tris.getCABO().createVBO(p,"polys",Zt.SURFACE,{points:v,cellOffset:0})}e.VBOBuildTime.modified()},t.setCameraShaderParameters=(n,r,a)=>{const i=n.getProgram(),o=e.openGLCamera.getRenderable(),s=o.getClippingRange();i.setUniformf("camThick",s[1]-s[0]),i.setUniformf("camNear",s[0]),i.setUniformf("camFar",s[1]),o.setIsPerformingCoordinateTransformation(!0);const c=e.openGLCamera.getKeyMatrices(r);o.setIsPerformingCoordinateTransformation(!1);const u=e.openGLVolume.getKeyMatrices();Me(e.modelToView,c.wcvc,u.mcwc);const g=e.currentInput.getBounds(),f=e.currentInput.getSpacing(),l=e.currentInput.getDimensions(),v=new Float64Array(3),p=new Float64Array(3);let d=1,h=-1,T=1,C=-1;for(let D=0;D<8;++D){if(te(v,g[D%2],g[2+Math.floor(D/2)%2],g[4+Math.floor(D/4)]),ue(v,v,e.modelToView),!o.getParallelProjection()){Nt(p,v);const L=-s[0]/v[2];xo(v,p,L)}ue(v,v,c.vcpc),d=Math.min(v[0],d),h=Math.max(v[0],h),T=Math.min(v[1],T),C=Math.max(v[1],C)}i.setUniformf("dcxmin",d),i.setUniformf("dcxmax",h),i.setUniformf("dcymin",T),i.setUniformf("dcymax",C),i.isUniformUsed("cameraParallel")&&i.setUniformi("cameraParallel",o.getParallelProjection());const m=e.currentInput.getSpatialExtent(),y=new Float64Array(3);te(y,(m[1]-m[0])*f[0],(m[3]-m[2])*f[1],(m[5]-m[4])*f[2]),i.setUniform3f("vSpacing",f[0],f[1],f[2]),te(v,m[0],m[2],m[4]),e.currentInput.indexToWorldVec3(v,v),ue(v,v,e.modelToView),i.setUniform3f("vOriginVC",v[0],v[1],v[2]);const w=e.currentInput.getIndexToWorld();Me(e.idxToView,e.modelToView,w),In(e.idxNormalMatrix,c.normalMatrix,u.normalMatrix),In(e.idxNormalMatrix,e.idxNormalMatrix,e.currentInput.getDirection());const S=vn(y)/e.renderable.getSampleDistance();S>e.renderable.getMaximumSamplesPerRay()&&PR(`The number of steps required ${Math.ceil(S)} is larger than the
        specified maximum number of steps ${e.renderable.getMaximumSamplesPerRay()}.
        Please either change the
        volumeMapper sampleDistance or its maximum number of samples.`);const O=new Float64Array(3);if(te(O,1,1,1),Eo(O,O,y),i.setUniform3f("vVCToIJK",O[0],O[1],O[2]),i.setUniform3i("volumeDimensions",l[0],l[1],l[2]),!e._openGLRenderWindow.getWebgl2()){const D=e.scalarTexture.getVolumeInfo();i.setUniformf("texWidth",e.scalarTexture.getWidth()),i.setUniformf("texHeight",e.scalarTexture.getHeight()),i.setUniformi("xreps",D.xreps),i.setUniformi("xstride",D.xstride),i.setUniformi("ystride",D.ystride)}const M=new Float64Array(3),R=new Float64Array(3);for(let D=0;D<6;++D){switch(D){case 1:te(M,-1,0,0),te(R,m[0],m[2],m[4]);break;case 2:te(M,0,1,0),te(R,m[1],m[3],m[5]);break;case 3:te(M,0,-1,0),te(R,m[0],m[2],m[4]);break;case 4:te(M,0,0,1),te(R,m[1],m[3],m[5]);break;case 5:te(M,0,0,-1),te(R,m[0],m[2],m[4]);break;case 0:default:te(M,1,0,0),te(R,m[1],m[3],m[5]);break}$r(M,M,e.idxNormalMatrix),ue(R,R,e.idxToView);const L=-1*ut(R,M);if(i.setUniform3f(`vPlaneNormal${D}`,M[0],M[1],M[2]),i.setUniformf(`vPlaneDistance${D}`,L),a.getProperty().getUseLabelOutline()){const U=e.currentInput.getWorldToIndex();i.setUniformMatrix("vWCtoIDX",U),ct(e.projectionToWorld,c.wcpc),i.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const b=t.getRenderTargetSize(),G=t.getRenderTargetOffset();i.setUniformf("vpWidth",b[0]),i.setUniformf("vpHeight",b[1]),i.setUniformf("vpOffsetX",G[0]/b[0]),i.setUniformf("vpOffsetY",G[1]/b[1])}}switch(ct(e.projectionToView,c.vcpc),e.projectionToView[10]=e.projectionToView[14],i.setUniformMatrix("PCVCMatrix",e.projectionToView),e.lastLightComplexity){default:case 0:break;case 1:case 2:case 3:{let D=0;const L=[];r.getLights().forEach(N=>{if(N.getSwitch()>0){const b=N.getColor(),G=N.getIntensity();L[0]=b[0]*G,L[1]=b[1]*G,L[2]=b[2]*G,i.setUniform3fArray(`lightColor${D}`,L);const P=N.getDirection();te(M,P[0],P[1],P[2]),$r(M,M,c.normalMatrix),i.setUniform3f(`lightDirectionVC${D}`,M[0],M[1],M[2]);const z=[-.5*M[0],-.5*M[1],-.5*(M[2]-1)];i.setUniform3fArray(`lightHalfAngleVC${D}`,z),D++}})}}},t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:n,vsize:r}=e.openGLRenderer.getTiledSizeAndOrigin();return[n,r]},t.getRenderTargetOffset=()=>{const{lowerLeftU:n,lowerLeftV:r}=e.openGLRenderer.getTiledSizeAndOrigin();return[n,r]}}const zR={};function mh(t,e,n={}){Object.assign(e,zR,n),Th.extend(t,e,n),e.scalarTexture=n.scalarTexture,e.previousState={},WR(t,e)}const $R=E.newInstance(mh,"vtkStreamingOpenGLVolumeMapper"),jR={newInstance:$R,extend:mh};function HR(t,e){e.classHierarchy.push("vtkStreamingOpenGLViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,a=n.getClassName(r++),i=!1;const o=Object.keys(e.overrides);for(;a&&!i;)o.indexOf(a)!==-1?i=!0:a=n.getClassName(r++);if(!i)return null;const s=e.getModelInitialValues(n),c=e.overrides[a](s);return c.setMyFactory(t),c},e.getModelInitialValues=n=>{const r={};return n.getClassName()==="vtkSharedVolumeMapper"&&(r.scalarTexture=n.getScalarTexture()),r}}const KR={};function Ch(t,e,n={}){Object.assign(e,KR,n),Cu.extend(t,e,n),HR(t,e),t.registerOverride("vtkActor",_O.newInstance),t.registerOverride("vtkActor2D",UO.newInstance),t.registerOverride("vtkCamera",AO.newInstance),t.registerOverride("vtkGlyph3DMapper",eR.newInstance),t.registerOverride("vtkImageMapper",iR.newInstance),t.registerOverride("vtkImageSlice",cR.newInstance),t.registerOverride("vtkMapper",Po.newInstance),t.registerOverride("vtkPixelSpaceCallbackMapper",lR.newInstance),t.registerOverride("vtkRenderer",dR.newInstance),t.registerOverride("vtkSkybox",mR.newInstance),t.registerOverride("vtkSphereMapper",OR.newInstance),t.registerOverride("vtkStickMapper",LR.newInstance),t.registerOverride("vtkTexture",st.newInstance),t.registerOverride("vtkVolume",_R.newInstance),t.registerOverride("vtkVolumeMapper",Th.newInstance),t.registerOverride("vtkSharedVolumeMapper",jR.newInstance)}const qR=E.newInstance(Ch,"vtkStreamingOpenGLViewNodeFactory"),XR={newInstance:qR,extend:Ch};function YR(t,e){e.classHierarchy.push("vtkStreamingOpenGLRenderWindow")}function wh(t,e,n={}){Object.assign(e,n),LO.extend(t,e,n),e.myFactory=XR.newInstance(),e.myFactory.registerOverride("vtkRenderWindow",Sh),YR(t,e)}const Sh=E.newInstance(wh,"vtkStreamingOpenGLRenderWindow"),ZR={newInstance:Sh,extend:wh};var yi=E.vtkDebugMacro;function JR(t,e){e.classHierarchy.push("vtkCamera");var n=new Float64Array(3),r=new Float64Array([0,0,-1]),a=new Float64Array([0,1,0]),i=ie(new Float64Array(16)),o=ie(new Float64Array(16)),s=new Float64Array(3),c=new Float64Array(3),u=new Float64Array(3),g=ie(new Float64Array(16)),f=ie(new Float64Array(16)),l=new Float64Array(3),v=new Float64Array(3);function p(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=function(){var d=t.getViewMatrix();e.viewUp[0]=d[4],e.viewUp[1]=d[5],e.viewUp[2]=d[6],t.modified()},t.setPosition=function(d,h,T){d===e.position[0]&&h===e.position[1]&&T===e.position[2]||(e.position[0]=d,e.position[1]=h,e.position[2]=T,t.computeDistance(),t.modified())},t.setFocalPoint=function(d,h,T){d===e.focalPoint[0]&&h===e.focalPoint[1]&&T===e.focalPoint[2]||(e.focalPoint[0]=d,e.focalPoint[1]=h,e.focalPoint[2]=T,t.computeDistance(),t.modified())},t.setDistance=function(d){if(e.distance!==d){e.distance=d,e.distance<1e-20&&(e.distance=1e-20,yi("Distance is set to minimum."));var h=e.directionOfProjection;e.focalPoint[0]=e.position[0]+h[0]*e.distance,e.focalPoint[1]=e.position[1]+h[1]*e.distance,e.focalPoint[2]=e.position[2]+h[2]*e.distance,t.modified()}},t.computeDistance=function(){var d=e.focalPoint[0]-e.position[0],h=e.focalPoint[1]-e.position[1],T=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(d*d+h*h+T*T),e.distance<1e-20){e.distance=1e-20,yi("Distance is set to minimum.");var C=e.directionOfProjection;e.focalPoint[0]=e.position[0]+C[0]*e.distance,e.focalPoint[1]=e.position[1]+C[1]*e.distance,e.focalPoint[2]=e.position[2]+C[2]*e.distance}e.directionOfProjection[0]=d/e.distance,e.directionOfProjection[1]=h/e.distance,e.directionOfProjection[2]=T/e.distance,p()},t.dolly=function(d){if(!(d<=0)){var h=e.distance/d;t.setPosition(e.focalPoint[0]-h*e.directionOfProjection[0],e.focalPoint[1]-h*e.directionOfProjection[1],e.focalPoint[2]-h*e.directionOfProjection[2])}},t.roll=function(d){var h=e.position,T=e.focalPoint,C=e.viewUp,m=new Float64Array([C[0],C[1],C[2],0]);ie(g);var y=new Float64Array([T[0]-h[0],T[1]-h[1],T[2]-h[2]]);Bt(g,g,We(d),y),rr(m,m,g),e.viewUp[0]=m[0],e.viewUp[1]=m[1],e.viewUp[2]=m[2],t.modified()},t.azimuth=function(d){var h=e.focalPoint;ie(f),je(f,f,h),Bt(f,f,We(d),e.viewUp),je(f,f,[-h[0],-h[1],-h[2]]),ue(l,e.position,f),t.setPosition(l[0],l[1],l[2])},t.yaw=function(d){var h=e.position;ie(f),je(f,f,h),Bt(f,f,We(d),e.viewUp),je(f,f,[-h[0],-h[1],-h[2]]),ue(v,e.focalPoint,f),t.setFocalPoint(v[0],v[1],v[2])},t.elevation=function(d){var h=e.focalPoint,T=t.getViewMatrix(),C=[-T[0],-T[1],-T[2]];ie(f),je(f,f,h),Bt(f,f,We(d),C),je(f,f,[-h[0],-h[1],-h[2]]),ue(l,e.position,f),t.setPosition(l[0],l[1],l[2])},t.pitch=function(d){var h=e.position,T=t.getViewMatrix(),C=[T[0],T[1],T[2]];ie(f),je(f,f,h),Bt(f,f,We(d),C),je(f,f,[-h[0],-h[1],-h[2]]),ue(v,e.focalPoint,f),t.setFocalPoint.apply(t,Ne(v))},t.zoom=function(d){d<=0||(e.parallelProjection?e.parallelScale/=d:e.viewAngle/=d,t.modified())},t.translate=function(d,h,T){var C=[d,h,T];eo(e.position,C,e.position),eo(e.focalPoint,C,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=function(d){var h=[].concat(Ne(e.viewUp),[1]),T=[],C=[],m=[];h[0]+=e.position[0],h[1]+=e.position[1],h[2]+=e.position[2],rr(T,[].concat(Ne(e.position),[1]),d),rr(C,[].concat(Ne(e.focalPoint),[1]),d),rr(m,h,d),m[0]-=T[0],m[1]-=T[1],m[2]-=T[2],t.setPosition.apply(t,Ne(T.slice(0,3))),t.setFocalPoint.apply(t,Ne(C.slice(0,3))),t.setViewUp.apply(t,Ne(m.slice(0,3)))},t.getThickness=function(){return e.clippingRange[1]-e.clippingRange[0]},t.setThickness=function(d){var h=d;h<1e-20&&(h=1e-20,yi("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+h)},t.setThicknessFromFocalPoint=function(d){var h=d;h<1e-20&&(h=1e-20,yi("Thickness is set to minimum.")),t.setClippingRange(e.distance-h/2,e.distance+h/2)},t.setRoll=function(d){},t.getRoll=function(){},t.setObliqueAngles=function(d,h){},t.getOrientation=function(){},t.getOrientationWXYZ=function(){},t.getFrustumPlanes=function(d){},t.getCameraLightTransformMatrix=function(d){return Ke(d,e.cameraLightTransform),d},t.computeCameraLightTransform=function(){Ke(i,t.getViewMatrix()),ct(i,i),U0(o,[e.distance,e.distance,e.distance]),Me(i,i,o),ie(e.cameraLightTransform),je(e.cameraLightTransform,i,[0,0,-1])},t.deepCopy=function(d){},t.physicalOrientationToWorldDirection=function(d){var h=Lf(d[0],d[1],d[2],d[3]),T=ur(),C=Lf(0,0,1,0);return lm(T,h),Vf(C,h,C),Vf(C,C,T),[C[0],C[1],C[2]]},t.getPhysicalToWorldMatrix=function(d){t.getWorldToPhysicalMatrix(d),ct(d,d)},t.getWorldToPhysicalMatrix=function(d){ie(d);var h=[3];Qt(e.physicalViewNorth,e.physicalViewUp,h),d[0]=h[0],d[1]=h[1],d[2]=h[2],d[4]=e.physicalViewUp[0],d[5]=e.physicalViewUp[1],d[6]=e.physicalViewUp[2],d[8]=-e.physicalViewNorth[0],d[9]=-e.physicalViewNorth[1],d[10]=-e.physicalViewNorth[2],Oe(d,d),te(s,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),Pn(d,d,s),je(d,d,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=function(d){ct(i,d),ue(s,n,i),t.computeDistance();var h=e.distance;t.setPosition(s[0],s[1],s[2]),ue(c,r,i),Kt(c,c,s),Nt(c,c),t.setDirectionOfProjection(c[0],c[1],c[2]),ue(u,a,i),Kt(u,u,s),Nt(u,u),t.setViewUp(u[0],u[1],u[2]),t.setDistance(h)},t.computeViewParametersFromPhysicalMatrix=function(d){t.getWorldToPhysicalMatrix(i),Me(i,d,i),t.computeViewParametersFromViewMatrix(i)},t.setViewMatrix=function(d){e.viewMatrix=d,e.viewMatrix&&(Ke(i,e.viewMatrix),t.computeViewParametersFromViewMatrix(i),Oe(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=function(){if(e.viewMatrix)return e.viewMatrix;z0(i,e.position,e.focalPoint,e.viewUp),Oe(i,i);var d=new Float64Array(16);return Ke(d,i),d},t.setProjectionMatrix=function(d){e.projectionMatrix=d},t.getProjectionMatrix=function(d,h,T){var C=new Float64Array(16);if(ie(C),e.projectionMatrix){var m=1/e.physicalScale;return te(s,m,m,m),Ke(C,e.projectionMatrix),Pn(C,C,s),Oe(C,C),C}ie(i);var y=e.clippingRange[1]-e.clippingRange[0],w=[e.clippingRange[0]+(h+1)*y/2,e.clippingRange[0]+(T+1)*y/2];if(e.parallelProjection){var S=e.parallelScale*d,O=e.parallelScale,M=(e.windowCenter[0]-1)*S,R=(e.windowCenter[0]+1)*S,D=(e.windowCenter[1]-1)*O,L=(e.windowCenter[1]+1)*O;nu(i,M,R,D,L,w[0],w[1]),Oe(i,i)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");var N=Math.tan(We(e.viewAngle)/2),U,b;e.useHorizontalViewAngle===!0?(U=e.clippingRange[0]*N,b=e.clippingRange[0]*N/d):(U=e.clippingRange[0]*N*d,b=e.clippingRange[0]*N);var G=(e.windowCenter[0]-1)*U,P=(e.windowCenter[0]+1)*U,z=(e.windowCenter[1]-1)*b,F=(e.windowCenter[1]+1)*b,V=w[0],B=w[1];i[0]=2*V/(P-G),i[5]=2*V/(F-z),i[2]=(G+P)/(P-G),i[6]=(z+F)/(F-z),i[10]=-(V+B)/(B-V),i[14]=-1,i[11]=-2*V*B/(B-V),i[15]=0}return Ke(C,i),C},t.getCompositeProjectionMatrix=function(d,h,T){var C=t.getViewMatrix(),m=t.getProjectionMatrix(d,h,T);return Me(m,C,m),m},t.setDirectionOfProjection=function(d,h,T){if(!(e.directionOfProjection[0]===d&&e.directionOfProjection[1]===h&&e.directionOfProjection[2]===T)){e.directionOfProjection[0]=d,e.directionOfProjection[1]=h,e.directionOfProjection[2]=T;var C=e.directionOfProjection;e.focalPoint[0]=e.position[0]+C[0]*e.distance,e.focalPoint[1]=e.position[1]+C[1]*e.distance,e.focalPoint[2]=e.position[2]+C[2]*e.distance,p()}},t.setDeviceAngles=function(d,h,T,C){var m=[3];Qt(e.physicalViewNorth,e.physicalViewUp,m);var y=ie(new Float64Array(16));Bt(y,y,We(d),e.physicalViewUp),Bt(y,y,We(h),m),Bt(y,y,We(T),e.physicalViewNorth),Bt(y,y,We(-C),e.physicalViewUp);var w=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),S=new Float64Array(e.physicalViewNorth);ue(w,w,y),ue(S,S,y),t.setDirectionOfProjection(w[0],w[1],w[2]),t.setViewUp(S[0],S[1],S[2]),t.modified()},t.setOrientationWXYZ=function(d,h,T,C){var m=ie(new Float64Array(16));if(d!==0&&(h!==0||T!==0||C!==0)){var y=We(d),w=ur();au(w,[h,T,C],y),tu(m,w)}var S=new Float64Array(3);ue(S,[0,0,-1],m);var O=new Float64Array(3);ue(O,[0,1,0],m),t.setDirectionOfProjection.apply(t,Ne(S)),t.setViewUp.apply(t,Ne(O)),t.modified()},t.computeClippingRange=function(d){var h=null,T=null;h=e.viewPlaneNormal,T=e.position;for(var C=-h[0],m=-h[1],y=-h[2],w=-(C*T[0]+m*T[1]+y*T[2]),S=[C*d[0]+m*d[2]+y*d[4]+w,1e-18],O=0;O<2;O++)for(var M=0;M<2;M++)for(var R=0;R<2;R++){var D=C*d[R]+m*d[2+M]+y*d[4+O]+w;S[0]=D<S[0]?D:S[0],S[1]=D>S[1]?D:S[1]}return S}}var QR={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,cameraLightTransform:ta(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function Eh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QR,n),E.obj(t,e),E.get(t,e,["distance"]),E.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),E.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),E.setGetArray(t,e,["clippingRange","windowCenter"],2),E.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),JR(t,e)}var eD=E.newInstance(Eh,"vtkCamera"),Gu={newInstance:eD,extend:Eh},tD=["HeadLight","CameraLight","SceneLight"];function nD(t,e){e.classHierarchy.push("vtkLight");var n=new Float64Array(3);t.getTransformedPosition=function(){return e.transformMatrix?ue(n,e.position,e.transformMatrix):te(n,e.position[0],e.position[1],e.position[2]),n},t.getTransformedFocalPoint=function(){return e.transformMatrix?ue(n,e.focalPoint,e.transformMatrix):te(n,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),n},t.getDirection=function(){return e.directionMTime<e.mtime&&(e.direction[0]=e.focalPoint[0]-e.position[0],e.direction[1]=e.focalPoint[1]-e.position[1],e.direction[2]=e.focalPoint[2]-e.position[2],lr(e.direction),e.directionMTime=e.mtime),e.direction},t.setDirectionAngle=function(r,a){var i=We(r),o=We(a);t.setPosition(Math.cos(i)*Math.sin(o),Math.sin(i),Math.cos(i)*Math.cos(o)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=function(){t.setLightType("HeadLight")},t.setLightTypeToCameraLight=function(){t.setLightType("CameraLight")},t.setLightTypeToSceneLight=function(){t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=function(){return e.lightType==="HeadLight"},t.lightTypeIsSceneLight=function(){return e.lightType==="SceneLight"},t.lightTypeIsCameraLight=function(){return e.lightType==="CameraLight"}}var rD={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function xh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rD,n),E.obj(t,e),E.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),E.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),nD(t,e)}var aD=E.newInstance(xh,"vtkLight"),iD={newInstance:aD,extend:xh,LIGHT_TYPES:tD},Bi=E.vtkErrorMacro;function oD(t){return function(){return Bi("vtkViewport::".concat(t," - NOT IMPLEMENTED"))}}function sD(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=function(){return e.props},t.hasViewProp=function(r){return!!e.props.filter(function(a){return a===r}).length},t.addViewProp=function(r){r&&!t.hasViewProp(r)&&(e.props=e.props.concat(r))},t.removeViewProp=function(r){var a=e.props.filter(function(i){return i!==r});e.props.length!==a.length&&(e.props=a)},t.removeAllViewProps=function(){e.props=[]};function n(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];a.push(r);var i=r.getNestedProps();if(i&&i.length)for(var o=0;o<i.length;o++)n(i[o],a);return a}t.getViewPropsWithNestedProps=function(){for(var r=[],a=0;a<e.props.length;a++)n(e.props[a],r);return r},t.addActor2D=t.addViewProp,t.removeActor2D=function(r){t.removeViewProp(r)},t.getActors2D=function(){return e.actors2D=[],e.props.forEach(function(r){e.actors2D=e.actors2D.concat(r.getActors2D())}),e.actors2D},t.displayToView=function(){return Bi("call displayToView on your view instead")},t.viewToDisplay=function(){return Bi("callviewtodisplay on your view instead")},t.getSize=function(){return Bi("call getSize on your View instead")},t.normalizedDisplayToProjection=function(r,a,i){var o=t.normalizedDisplayToNormalizedViewport(r,a,i);return t.normalizedViewportToProjection(o[0],o[1],o[2])},t.normalizedDisplayToNormalizedViewport=function(r,a,i){var o=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(r-e.viewport[0])/o[0],(a-e.viewport[1])/o[1],i]},t.normalizedViewportToProjection=function(r,a,i){return[r*2-1,a*2-1,i*2-1]},t.projectionToNormalizedDisplay=function(r,a,i){var o=t.projectionToNormalizedViewport(r,a,i);return t.normalizedViewportToNormalizedDisplay(o[0],o[1],o[2])},t.normalizedViewportToNormalizedDisplay=function(r,a,i){var o=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[r*o[0]+e.viewport[0],a*o[1]+e.viewport[1],i]},t.projectionToNormalizedViewport=function(r,a,i){return[(r+1)*.5,(a+1)*.5,(i+1)*.5]},t.PickPropFrom=oD("PickPropFrom")}var cD={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function Oh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cD,n),E.obj(t,e),E.event(t,e,"event"),E.setGetArray(t,e,["viewport"],4),E.setGetArray(t,e,["background","background2"],3),sD(t,e)}var uD=E.newInstance(Oh,"vtkViewport"),fD={newInstance:uD,extend:Oh},ya=Wn,Ln=re,gD=Xa;function Ag(t){return function(){return Ln("vtkRenderer::".concat(t," - NOT IMPLEMENTED"))}}function lD(t,e){e.classHierarchy.push("vtkRenderer");var n={type:"ComputeVisiblePropBoundsEvent",renderer:t},r={type:"ResetCameraClippingRangeEvent",renderer:t},a={type:"ResetCameraEvent",renderer:t};t.updateCamera=function(){return e.activeCamera||(ya("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0},t.updateLightsGeometryToFollowCamera=function(){var i=t.getActiveCameraAndResetIfCreated();e.lights.forEach(function(o){o.lightTypeIsSceneLight()||(o.lightTypeIsHeadLight()?(o.setPositionFrom(i.getPositionByReference()),o.setFocalPointFrom(i.getFocalPointByReference()),o.modified(i.getMTime())):o.lightTypeIsCameraLight()?o.setTransformMatrix(i.getCameraLightTransformMatrix(ta())):Ln("light has unknown light type",o.get()))})},t.updateLightGeometry=function(){return e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0},t.allocateTime=Ag("allocateTime"),t.updateGeometry=Ag("updateGeometry"),t.getVTKWindow=function(){return e._renderWindow},t.setLayer=function(i){ya(t.getClassName(),t,"setting Layer to ",i),e.layer!==i&&(e.layer=i,t.modified()),t.setPreserveColorBuffer(!!i)},t.setActiveCamera=function(i){return e.activeCamera===i?!1:(e.activeCamera=i,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:i}),!0)},t.makeCamera=function(){var i=Gu.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:i}),i},t.getActiveCamera=function(){return e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera},t.getActiveCameraAndResetIfCreated=function(){return e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera},t.getActors=function(){return e.actors=[],e.props.forEach(function(i){e.actors=e.actors.concat(i.getActors())}),e.actors},t.addActor=t.addViewProp,t.removeActor=function(i){e.actors=e.actors.filter(function(o){return o!==i}),t.removeViewProp(i),t.modified()},t.removeAllActors=function(){var i=t.getActors();i.forEach(function(o){t.removeViewProp(o)}),e.actors=[],t.modified()},t.getVolumes=function(){return e.volumes=[],e.props.forEach(function(i){e.volumes=e.volumes.concat(i.getVolumes())}),e.volumes},t.addVolume=t.addViewProp,t.removeVolume=function(i){e.volumes=e.volumes.filter(function(o){return o!==i}),t.removeViewProp(i),t.modified()},t.removeAllVolumes=function(){var i=t.getVolumes();i.forEach(function(o){t.removeViewProp(o)}),e.volumes=[],t.modified()},t.addLight=function(i){e.lights=[].concat(e.lights,i),t.modified()},t.removeLight=function(i){e.lights=e.lights.filter(function(o){return o!==i}),t.modified()},t.removeAllLights=function(){e.lights=[],t.modified()},t.setLightCollection=function(i){e.lights=i,t.modified()},t.makeLight=iD.newInstance,t.createLight=function(){!e.automaticLightCreation||(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=function(i,o,s,c){var u=t.normalizedDisplayToProjection(i,o,s);return u=t.projectionToView(u[0],u[1],u[2],c),t.viewToWorld(u[0],u[1],u[2])},t.worldToNormalizedDisplay=function(i,o,s,c){var u=t.worldToView(i,o,s);return u=t.viewToProjection(u[0],u[1],u[2],c),t.projectionToNormalizedDisplay(u[0],u[1],u[2])},t.viewToWorld=function(i,o,s){if(e.activeCamera===null)return Ln("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];var c=e.activeCamera.getViewMatrix();ct(c,c),Oe(c,c);var u=new Float64Array([i,o,s]);return ue(u,u,c),u},t.projectionToView=function(i,o,s,c){if(e.activeCamera===null)return Ln("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];var u=e.activeCamera.getProjectionMatrix(c,-1,1);ct(u,u),Oe(u,u);var g=new Float64Array([i,o,s]);return ue(g,g,u),g},t.worldToView=function(i,o,s){if(e.activeCamera===null)return Ln("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];var c=e.activeCamera.getViewMatrix();Oe(c,c);var u=new Float64Array([i,o,s]);return ue(u,u,c),u},t.viewToProjection=function(i,o,s,c){if(e.activeCamera===null)return Ln("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];var u=e.activeCamera.getProjectionMatrix(c,-1,1);Oe(u,u);var g=new Float64Array([i,o,s]);return ue(g,g,u),g},t.computeVisiblePropBounds=function(){e.allBounds[0]=Je.INIT_BOUNDS[0],e.allBounds[1]=Je.INIT_BOUNDS[1],e.allBounds[2]=Je.INIT_BOUNDS[2],e.allBounds[3]=Je.INIT_BOUNDS[3],e.allBounds[4]=Je.INIT_BOUNDS[4],e.allBounds[5]=Je.INIT_BOUNDS[5];var i=!0;t.invokeEvent(n);for(var o=0;o<e.props.length;++o){var s=e.props[o];if(s.getVisibility()&&s.getUseBounds()){var c=s.getBounds();c&&ki(c)&&(i=!1,c[0]<e.allBounds[0]&&(e.allBounds[0]=c[0]),c[1]>e.allBounds[1]&&(e.allBounds[1]=c[1]),c[2]<e.allBounds[2]&&(e.allBounds[2]=c[2]),c[3]>e.allBounds[3]&&(e.allBounds[3]=c[3]),c[4]<e.allBounds[4]&&(e.allBounds[4]=c[4]),c[5]>e.allBounds[5]&&(e.allBounds[5]=c[5]))}}return i&&(hr(e.allBounds),ya("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,o=i||t.computeVisiblePropBounds(),s=[0,0,0];if(!ki(o))return ya("Cannot reset camera!"),!1;var c=null;if(t.getActiveCamera())c=e.activeCamera.getViewPlaneNormal();else return Ln("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),s[0]=(o[0]+o[1])/2,s[1]=(o[2]+o[3])/2,s[2]=(o[4]+o[5])/2;var u=o[1]-o[0],g=o[3]-o[2],f=o[5]-o[4];u*=u,g*=g,f*=f;var l=u+g+f;l=l===0?1:l,l=Math.sqrt(l)*.5;var v=We(e.activeCamera.getViewAngle()),p=l,d=l/Math.sin(v*.5),h=e.activeCamera.getViewUp();return Math.abs(ce(h,c))>.999&&(gD("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-h[2],h[0],h[1])),e.activeCamera.setFocalPoint(s[0],s[1],s[2]),e.activeCamera.setPosition(s[0]+d*c[0],s[1]+d*c[1],s[2]+d*c[2]),t.resetCameraClippingRange(o),e.activeCamera.setParallelScale(p),e.activeCamera.setPhysicalScale(l),e.activeCamera.setPhysicalTranslation(-s[0],-s[1],-s[2]),t.invokeEvent(a),!0},t.resetCameraClippingRange=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,o=i||t.computeVisiblePropBounds();if(!ki(o))return ya("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return Ln("Trying to reset clipping range of non-existent camera"),!1;var s=e.activeCamera.computeClippingRange(o),c=0;if(e.activeCamera.getParallelProjection())c=.2*e.activeCamera.getParallelScale();else{var u=We(e.activeCamera.getViewAngle());c=.2*Math.tan(u/2)*s[1]}return s[1]-s[0]<c&&(c=c-s[1]+s[0],s[1]+=c/2,s[0]-=c/2),s[0]<0&&(s[0]=0),s[0]=.99*s[0]-(s[1]-s[0])*e.clippingRangeExpansion,s[1]=1.01*s[1]+(s[1]-s[0])*e.clippingRangeExpansion,s[0]=s[0]>=s[1]?.01*s[1]:s[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),s[0]<e.nearClippingPlaneTolerance*s[1]&&(s[0]=e.nearClippingPlaneTolerance*s[1]),e.activeCamera.setClippingRange(s[0],s[1]),t.invokeEvent(r),!1},t.setRenderWindow=function(i){i!==e._renderWindow&&(e._vtkWindow=i,e._renderWindow=i)},t.visibleActorCount=function(){return e.props.filter(function(i){return i.getVisibility()}).length},t.visibleVolumeCount=t.visibleActorCount,t.getMTime=function(){var i=e.mtime,o=e.activeCamera?e.activeCamera.getMTime():0;o>i&&(i=o);var s=e._createdLight?e._createdLight.getMTime():0;return s>i&&(i=s),i},t.getTransparent=function(){return!!e.preserveColorBuffer},t.isActiveCameraCreated=function(){return!!e.activeCamera}}var vD={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:Zr(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,pass:0};function Mh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,vD,n),fD.extend(t,e,n),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),Et(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),at(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","useShadows","pass"]),Ya(t,e,["actors","volumes","lights"]),bv(t,e,["background"],4,1),vu(t,e,["renderWindow"]),lD(t,e)}var pD=ke(Mh,"vtkRenderer"),hD={newInstance:pD,extend:Mh},dD={Unknown:0,LeftController:1,RightController:2},yD={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},TD={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4},Au={Device:dD,Input:yD,Axis:TD};function Ig(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function De(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ig(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ig(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Ti=Au.Device,Jn=Au.Input,mi=E.vtkWarningMacro,Ci=E.vtkErrorMacro,mD=E.normalizeWheel,CD=E.vtkOnceErrorMacro,Nr=new MouseEvent(""),Os={"xr-standard":[Jn.Trigger,Jn.Grip,Jn.TrackPad,Jn.Thumbstick,Jn.A,Jn.B]},Iu=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function Ta(t){t.cancelable&&t.preventDefault()}function wi(t){var e=Object.create(null);return t.forEach(function(n){var r=n.pointerId,a=n.position;e[r]=a}),e}function wD(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");var n=new Set,r=new Map;t.start=function(){!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=function(f){Ci("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=function(f){e.interactorStyle!==f&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=f,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=function(){e.initialized=!0,t.enable(),t.render()},t.enable=function(){return t.setEnabled(!0)},t.disable=function(){return t.setEnabled(!1)},t.startEventLoop=function(){return mi("empty event loop")};function a(f,l){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(f,l))}t.getCurrentRenderer=function(){return e.currentRenderer||a(0,0),e.currentRenderer};function i(f){var l=e._view.getCanvas(),v=l.getBoundingClientRect(),p=l.width/v.width,d=l.height/v.height,h={x:p*(f.clientX-v.left),y:d*(v.height-f.clientY+v.top),z:0};return(r.size<=1||!e.currentRenderer)&&a(h.x,h.y),h}function o(f){return{controlKey:f.ctrlKey,altKey:f.altKey,shiftKey:f.shiftKey}}function s(f){var l=o(f),v=De({key:f.key,keyCode:f.charCode},l);return v}function c(f){return f.pointerType||""}t.bindEvents=function(f){e.container=f,f.addEventListener("contextmenu",Ta),f.addEventListener("wheel",t.handleWheel),f.addEventListener("DOMMouseScroll",t.handleWheel),f.addEventListener("pointerenter",t.handlePointerEnter),f.addEventListener("pointerleave",t.handlePointerLeave),f.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),f.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),f.addEventListener("pointerup",t.handlePointerUp),f.addEventListener("pointercancel",t.handlePointerCancel),document.addEventListener("keypress",t.handleKeyPress),document.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),f.style.touchAction="none",f.style.userSelect="none",f.style.webkitTapHighlightColor="rgba(0,0,0,0)"},t.unbindEvents=function(){var f=e.container;f.removeEventListener("contextmenu",Ta),f.removeEventListener("wheel",t.handleWheel),f.removeEventListener("DOMMouseScroll",t.handleWheel),f.removeEventListener("pointerenter",t.handlePointerEnter),f.removeEventListener("pointerleave",t.handlePointerLeave),f.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),f.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),f.removeEventListener("pointerup",t.handlePointerUp),f.removeEventListener("pointercancel",t.handlePointerCancel),document.removeEventListener("keypress",t.handleKeyPress),document.removeEventListener("keydown",t.handleKeyDown),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),e.container=null,r.clear()},t.handleKeyPress=function(f){var l=s(f);t.keyPressEvent(l)},t.handleKeyDown=function(f){var l=s(f);t.keyDownEvent(l)},t.handleKeyUp=function(f){var l=s(f);t.keyUpEvent(l)},t.handlePointerEnter=function(f){var l=De(De({},o(f)),{},{position:i(f),deviceType:c(f)});t.pointerEnterEvent(l),l.deviceType==="mouse"&&t.mouseEnterEvent(l)},t.handlePointerLeave=function(f){var l=De(De({},o(f)),{},{position:i(f),deviceType:c(f)});t.pointerLeaveEvent(l),l.deviceType==="mouse"&&t.mouseLeaveEvent(l)},t.handlePointerDown=function(f){if(!(f.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&Ta(f),f.target.hasPointerCapture(f.pointerId)&&f.target.releasePointerCapture(f.pointerId),e.container.setPointerCapture(f.pointerId),r.has(f.pointerId)&&mi("[RenderWindowInteractor] duplicate pointerId detected"),r.set(f.pointerId,{pointerId:f.pointerId,position:i(f)}),f.pointerType){case"pen":case"touch":t.handleTouchStart(f);break;case"mouse":default:t.handleMouseDown(f);break}},t.handlePointerUp=function(f){if(r.has(f.pointerId))switch(e.preventDefaultOnPointerUp&&Ta(f),r.delete(f.pointerId),e.container.releasePointerCapture(f.pointerId),f.pointerType){case"pen":case"touch":t.handleTouchEnd(f);break;case"mouse":default:t.handleMouseUp(f);break}},t.handlePointerCancel=function(f){if(r.has(f.pointerId))switch(r.delete(f.pointerId),f.pointerType){case"pen":case"touch":t.handleTouchEnd(f);break;case"mouse":default:t.handleMouseUp(f);break}},t.handlePointerMove=function(f){if(r.has(f.pointerId)){var l=r.get(f.pointerId);l.position=i(f)}switch(f.pointerType){case"pen":case"touch":t.handleTouchMove(f);break;case"mouse":default:t.handleMouseMove(f);break}},t.handleMouseDown=function(f){var l=De(De({},o(f)),{},{position:i(f),deviceType:c(f)});switch(f.button){case 0:t.leftButtonPressEvent(l);break;case 1:t.middleButtonPressEvent(l);break;case 2:t.rightButtonPressEvent(l);break;default:Ci("Unknown mouse button pressed: ".concat(f.button));break}},t.requestPointerLock=function(){e.container&&e.container.requestPointerLock()},t.exitPointerLock=function(){return document.exitPointerLock()},t.isPointerLocked=function(){return!!e.container&&document.pointerLockElement===e.container},t.handlePointerLockChange=function(){t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function u(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=function(f){if(f===void 0){Ci("undefined requester, can not start animating");return}if(n.has(f)){mi("requester is already registered for animating");return}n.add(f),!e.animationRequest&&n.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=function(f){var l=Date.now()+f;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,l),!e.animationRequest&&n.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=function(){return e.xrAnimation||e.animationRequest!==null},t.cancelAnimation=function(f){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!n.has(f)){if(!l){var v=f&&f.getClassName?f.getClassName():f;mi("".concat(v," did not request an animation"))}return}n.delete(f),e.animationRequest&&n.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=function(){e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=function(){e.xrAnimation=!1,n.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=function(f,l,v){f.inputSources.forEach(function(p){var d=p.gripSpace==null?null:l.getPose(p.gripSpace,v),h=p.gamepad,T=p.handedness;if(h){h.index in e.lastGamepadValues||(e.lastGamepadValues[h.index]={left:{buttons:{}},right:{buttons:{}}});for(var C=0;C<h.buttons.length;++C)C in e.lastGamepadValues[h.index][T].buttons||(e.lastGamepadValues[h.index][T].buttons[C]=!1),e.lastGamepadValues[h.index][T].buttons[C]!==h.buttons[C].pressed&&d!=null&&(t.button3DEvent({gamepad:h,position:d.transform.position,orientation:d.transform.orientation,pressed:h.buttons[C].pressed,device:p.handedness==="left"?Ti.LeftController:Ti.RightController,input:Os[h.mapping]&&Os[h.mapping][C]?Os[h.mapping][C]:Jn.Trigger}),e.lastGamepadValues[h.index][T].buttons[C]=h.buttons[C].pressed),e.lastGamepadValues[h.index][T].buttons[C]&&d!=null&&t.move3DEvent({gamepad:h,position:d.transform.position,orientation:d.transform.orientation,device:p.handedness==="left"?Ti.LeftController:Ti.RightController})}})},t.handleMouseMove=function(f){var l=De(De({},o(f)),{},{position:i(f),deviceType:c(f)});e.moveTimeoutID===0?t.startMouseMoveEvent(l):(t.mouseMoveEvent(l),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(function(){t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=function(){var f=Date.now();e._animationFrameCount++,f-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(f-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=f,e._animationFrameCount=1),t.animationEvent(),u(),n.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=function(f){Ta(f);var l=De(De(De({},mD(f)),o(f)),{},{position:i(f),deviceType:c(f)});e.wheelTimeoutID===0?t.startMouseWheelEvent(l):(t.mouseWheelEvent(l),clearTimeout(e.wheelTimeoutID)),e.wheelTimeoutID=setTimeout(function(){t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=function(f){var l=De(De({},o(f)),{},{position:i(f),deviceType:c(f)});switch(f.button){case 0:t.leftButtonReleaseEvent(l);break;case 1:t.middleButtonReleaseEvent(l);break;case 2:t.rightButtonReleaseEvent(l);break;default:Ci("Unknown mouse button released: ".concat(f.button));break}},t.handleTouchStart=function(f){var l=Ne(r.values());if(e.recognizeGestures&&l.length>1){var v=wi(r);if(l.length===2){var p=De(De({},o(Nr)),{},{position:l[0].position,deviceType:c(f)});t.leftButtonReleaseEvent(p)}t.recognizeGesture("TouchStart",v)}else if(l.length===1){var d=De(De({},o(Nr)),{},{position:i(f),deviceType:c(f)});t.leftButtonPressEvent(d)}},t.handleTouchMove=function(f){var l=Ne(r.values());if(e.recognizeGestures&&l.length>1){var v=wi(r);t.recognizeGesture("TouchMove",v)}else if(l.length===1){var p=De(De({},o(Nr)),{},{position:l[0].position,deviceType:c(f)});t.mouseMoveEvent(p)}},t.handleTouchEnd=function(f){var l=Ne(r.values());if(e.recognizeGestures)if(l.length===0){var v=De(De({},o(Nr)),{},{position:l[0].position,deviceType:c(f)});t.leftButtonReleaseEvent(v)}else if(l.length===1){var p=wi(r);t.recognizeGesture("TouchEnd",p);var d=De(De({},o(Nr)),{},{position:l[0].position,deviceType:c(f)});t.leftButtonPressEvent(d)}else{var h=wi(r);t.recognizeGesture("TouchMove",h)}else if(l.length===1){var T=De(De({},o(Nr)),{},{position:l[0].position,deviceType:c(f)});t.leftButtonReleaseEvent(T)}},t.setView=function(f){e._view!==f&&(e._view=f,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=function(){var f,l,v;return(f=e._view)===null||f===void 0||(l=f.getRenderable())===null||l===void 0||(v=l.getRenderersByReference())===null||v===void 0?void 0:v[0]},t.findPokedRenderer=function(){var f,l,v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;var d=(f=e._view)===null||f===void 0||(l=f.getRenderable())===null||l===void 0?void 0:l.getRenderers();if(!d)return null;d.sort(function(w,S){return w.getLayer()-S.getLayer()});for(var h=null,T=null,C=null,m=d.length;m--;){var y=d[m];if(e._view.isInViewport(v,p,y)&&y.getInteractive()){C=y;break}h===null&&y.getInteractive()&&(h=y),T===null&&e._view.isInViewport(v,p,y)&&(T=y)}return C===null&&(C=h),C===null&&(C=T),C==null&&(C=d[0]),C},t.render=function(){!t.isAnimating()&&!e.inRender&&u()},Iu.forEach(function(f){var l=f.charAt(0).toLowerCase()+f.slice(1);t["".concat(l,"Event")]=function(v){if(!!e.enabled){var p=t.getCurrentRenderer();if(!p){CD(`
          Can not forward events without a current renderer on the interactor.
        `);return}var d=De({type:f,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer()},v);t["invoke".concat(f)](d)}}}),t.recognizeGesture=function(f,l){if(!(Object.keys(l).length>2)){if(e.startingEventPositions||(e.startingEventPositions={}),f==="TouchStart"){Object.keys(l).forEach(function(P){e.startingEventPositions[P]=l[P]}),e.currentGesture="Start";return}if(f==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}var v=0,p=[],d=[];Object.keys(l).forEach(function(P){p[v]=l[P],d[v]=e.startingEventPositions[P],v++});var h=Math.sqrt((d[0].x-d[1].x)*(d[0].x-d[1].x)+(d[0].y-d[1].y)*(d[0].y-d[1].y)),T=Math.sqrt((p[0].x-p[1].x)*(p[0].x-p[1].x)+(p[0].y-p[1].y)*(p[0].y-p[1].y)),C=Qi(Math.atan2(d[1].y-d[0].y,d[1].x-d[0].x)),m=Qi(Math.atan2(p[1].y-p[0].y,p[1].x-p[0].x)),y=m-C;m=m+180>=360?m-180:m+180,C=C+180>=360?C-180:C+180,Math.abs(m-C)<Math.abs(y)&&(y=m-C);var w=[];if(w[0]=(p[0].x-d[0].x+p[1].x-d[1].x)/2,w[1]=(p[0].y-d[0].y+p[1].y-d[1].y)/2,f==="TouchMove")if(e.currentGesture==="Start"){var S=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);S<15&&(S=15);var O=Math.abs(T-h),M=T*3.1415926*Math.abs(y)/360,R=Math.sqrt(w[0]*w[0]+w[1]*w[1]);if(O>S&&O>M&&O>R){e.currentGesture="Pinch";var D={scale:1,touches:l};t.startPinchEvent(D)}else if(M>S&&M>R){e.currentGesture="Rotate";var L={rotation:0,touches:l};t.startRotateEvent(L)}else if(R>S){e.currentGesture="Pan";var N={translation:[0,0],touches:l};t.startPanEvent(N)}}else{if(e.currentGesture==="Rotate"){var U={rotation:y,touches:l};t.rotateEvent(U)}if(e.currentGesture==="Pinch"){var b={scale:T/h,touches:l};t.pinchEvent(b)}if(e.currentGesture==="Pan"){var G={translation:w,touches:l};t.panEvent(G)}}}},t.handleVisibilityChange=function(){e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=function(f){e._forcedRenderer=!!f,e.currentRenderer=f};var g=t.delete;t.delete=function(){for(;n.size;)t.cancelAnimation(n.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),g()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}var SD={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1};function Rh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SD,n),E.obj(t,e),e._animationExtendedEnd=0,E.event(t,e,"RenderEvent"),Iu.forEach(function(r){return E.event(t,e,r)}),E.get(t,e,["initialized","container","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),E.setGet(t,e,["lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp"]),E.moveToProtected(t,e,["view"]),wD(t,e)}var ED=E.newInstance(Rh,"vtkRenderWindowInteractor"),xD=De({newInstance:ED,extend:Rh,handledEvents:Iu},Au),OD=E.vtkErrorMacro,MD=[1,-1,1,-1,1,-1];function RD(t,e){e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==n&&(e.size=n*r,e.values=E.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(r),t.modified())},t.setPoint=function(n){for(var r=n*e.numberOfComponents,a=0;a<e.numberOfComponents;a++)e.values[r+a]=a+1<1||arguments.length<=a+1?void 0:arguments[a+1]},t.getPoint=t.getTuple,t.getBounds=function(){if(t.getNumberOfComponents()===3){var n=t.getRange(0);e.bounds[0]=n[0],e.bounds[1]=n[1];var r=t.getRange(1);e.bounds[2]=r[0],e.bounds[3]=r[1];var a=t.getRange(2);return e.bounds[4]=a[0],e.bounds[5]=a[1],e.bounds}if(t.getNumberOfComponents()!==2)return OD(`getBounds called on an array with components of
        `.concat(t.getNumberOfComponents())),MD;var i=t.getRange(0);e.bounds[0]=i[0],e.bounds[1]=i[1];var o=t.getRange(1);return e.bounds[2]=o[0],e.bounds[3]=o[1],e.bounds[4]=0,e.bounds[5]=0,e.bounds},t.computeBounds=t.getBounds,t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}var DD={empty:!0,numberOfComponents:3,dataType:Xe.FLOAT,bounds:[1,-1,1,-1,1,-1]};function Dh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DD,n),Ve.extend(t,e,n),RD(t,e)}var VD=E.newInstance(Dh,"vtkPoints"),Uc={newInstance:VD,extend:Dh};function Pg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function Vh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Pg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Pg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Lh(t){var e=0;return t.filter(function(n,r){return r===e?(e+=n+1,!0):!1})}function Nh(t){for(var e=0,n=0;n<t.length;)n+=t[n]+1,e++;return e}var LD={extractCellSizes:Lh,getNumberOfCells:Nh};function ND(t,e){e.classHierarchy.push("vtkCellArray"),t.getNumberOfCells=function(r){return e.numberOfCells!==void 0&&!r||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=Nh(e.values)),e.numberOfCells},t.getCellSizes=function(r){return e.cellSizes!==void 0&&!r||(e.cellSizes=Lh(e.values)),e.cellSizes};var n=t.setData;t.setData=function(r){n(r,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=function(r){var a=r,i=e.values[a++];return e.values.subarray(a,a+i)}}function FD(t){return Vh({empty:!0,numberOfComponents:1,dataType:Xe.UNSIGNED_INT},t)}function Fh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Ve.extend(t,e,FD(n)),ND(t,e)}var _D=E.newInstance(Fh,"vtkCellArray"),Wg=Vh({newInstance:_D,extend:Fh},LD);function bD(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(r){e.pointsIds=r;var i=e.points.getData();i.length!==3*e.pointsIds.length&&(i=E.newTypedArray(n.getDataType(),3*e.pointsIds.length));var o=n.getData();e.pointsIds.forEach(function(s,c){var u=3*s,g=3*c;i[g]=o[u],i[++g]=o[++u],i[++g]=o[++u]}),e.points.setData(i)}else{e.points=n,e.pointsIds=new Array(n.getNumberOfPoints());for(var a=n.getNumberOfPoints()-1;a>=0;--a)e.pointsIds[a]=a}},t.getBounds=function(){var n=e.points.getNumberOfPoints(),r=[];if(n){e.points.getPoint(0,r),e.bounds[0]=r[0],e.bounds[1]=r[0],e.bounds[2]=r[1],e.bounds[3]=r[1],e.bounds[4]=r[2],e.bounds[5]=r[2];for(var a=1;a<n;a++)e.points.getPoint(a,r),e.bounds[0]=r[0]<e.bounds[0]?r[0]:e.bounds[0],e.bounds[1]=r[0]>e.bounds[1]?r[0]:e.bounds[1],e.bounds[2]=r[1]<e.bounds[2]?r[1]:e.bounds[2],e.bounds[3]=r[1]>e.bounds[3]?r[1]:e.bounds[3],e.bounds[4]=r[2]<e.bounds[4]?r[2]:e.bounds[4],e.bounds[5]=r[2]>e.bounds[5]?r[2]:e.bounds[5]}else hr(e.bounds);return e.bounds},t.getLength2=function(){t.getBounds();for(var n=0,r=0,a=0;a<3;a++)r=e.bounds[2*a+1]-e.bounds[2*a],n+=r*r;return n},t.getParametricDistance=function(n){for(var r,a=0,i=0;i<3;i++)n[i]<0?r=-n[i]:n[i]>1?r=n[i]-1:r=0,r>a&&(a=r);return a},t.getNumberOfPoints=function(){return e.points.getNumberOfPoints()},t.deepCopy=function(n){n.initialize(e.points,e.pointsIds)},t.getCellDimension=function(){},t.intersectWithLine=function(n,r,a,i,o,s,c){},t.evaluatePosition=function(n,r,a,i,o,s){E.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}var kD={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function _h(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kD,n),E.obj(t,e),e.points||(e.points=Uc.newInstance()),E.get(t,e,["points","pointsIds"]),bD(t,e)}var UD=E.newInstance(_h,"vtkCell"),fo={newInstance:UD,extend:_h};function BD(t,e){var n=e;for(e>=t.array.length&&(n+=t.array.length);n>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=n}function GD(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=function(n){var r=n.getPoints().getNumberOfPoints(),a=n.getNumberOfCells(),i=new Uint32Array(r);if(n.isA("vtkPolyData")){for(var o=0;o<a;++o){var s=n.getCellPoints(o),c=s.cellPointIds;c.forEach(function(d){t.incrementLinkCount(d)})}t.allocateLinks(r),e.maxId=r-1;for(var u=function(h){var T=n.getCellPoints(h),C=T.cellPointIds;C.forEach(function(m){t.insertCellReference(m,i[m]++,h)})},g=0;g<a;++g)u(g)}else{for(var f=0;f<a;f++){var l=fo.newInstance();l.getPointsIds().forEach(function(d){t.incrementLinkCount(d)})}t.allocateLinks(r),e.maxId=r-1;for(var v=function(h){var T=fo.newInstance();T.getPointsIds().forEach(function(C){t.insertCellReference(C,i[C]++,h)})},p=0;p<a;++p)v(p)}},t.allocate=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(n).fill().map(function(){return{ncells:0,cells:null}}),e.extend=r,e.maxId=-1},t.initialize=function(){e.array=null},t.getLink=function(n){return e.array[n]},t.getNcells=function(n){return e.array[n].ncells},t.getCells=function(n){return e.array[n].cells},t.insertNextPoint=function(n){e.array.push({ncells:n,cells:Array(n)}),++e.maxId},t.insertNextCellReference=function(n,r){e.array[n].cells[e.array[n].ncells++]=r},t.deletePoint=function(n){e.array[n].ncells=0,e.array[n].cells=null},t.removeCellReference=function(n,r){e.array[r].cells=e.array[r].cells.filter(function(a){return a!==n}),e.array[r].ncells=e.array[r].cells.length},t.addCellReference=function(n,r){e.array[r].cells[e.array[r].ncells++]=n},t.resizeCellList=function(n,r){e.array[n].cells.length=r},t.squeeze=function(){BD(e,e.maxId+1)},t.reset=function(){e.maxId=-1},t.deepCopy=function(n){e.array=Ne(n.array),e.extend=n.extend,e.maxId=n.maxId},t.incrementLinkCount=function(n){++e.array[n].ncells},t.allocateLinks=function(n){for(var r=0;r<n;++r)e.array[r].cells=new Array(e.array[r].ncells)},t.insertCellReference=function(n,r,a){e.array[n].cells[r]=a}}var AD={array:null,maxId:0,extend:0};function bh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AD,n),E.obj(t,e),GD(t,e)}var ID=E.newInstance(bh,"vtkCellLinks"),PD={newInstance:ID,extend:bh},Fe={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_PIXEL:8,VTK_QUAD:9,VTK_TETRA:10,VTK_VOXEL:11,VTK_HEXAHEDRON:12,VTK_WEDGE:13,VTK_PYRAMID:14,VTK_PENTAGONAL_PRISM:15,VTK_HEXAGONAL_PRISM:16,VTK_QUADRATIC_EDGE:21,VTK_QUADRATIC_TRIANGLE:22,VTK_QUADRATIC_QUAD:23,VTK_QUADRATIC_POLYGON:36,VTK_QUADRATIC_TETRA:24,VTK_QUADRATIC_HEXAHEDRON:25,VTK_QUADRATIC_WEDGE:26,VTK_QUADRATIC_PYRAMID:27,VTK_BIQUADRATIC_QUAD:28,VTK_TRIQUADRATIC_HEXAHEDRON:29,VTK_QUADRATIC_LINEAR_QUAD:30,VTK_QUADRATIC_LINEAR_WEDGE:31,VTK_BIQUADRATIC_QUADRATIC_WEDGE:32,VTK_BIQUADRATIC_QUADRATIC_HEXAHEDRON:33,VTK_BIQUADRATIC_TRIANGLE:34,VTK_CUBIC_LINE:35,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42,VTK_PARAMETRIC_CURVE:51,VTK_PARAMETRIC_SURFACE:52,VTK_PARAMETRIC_TRI_SURFACE:53,VTK_PARAMETRIC_QUAD_SURFACE:54,VTK_PARAMETRIC_TETRA_REGION:55,VTK_PARAMETRIC_HEX_REGION:56,VTK_HIGHER_ORDER_EDGE:60,VTK_HIGHER_ORDER_TRIANGLE:61,VTK_HIGHER_ORDER_QUAD:62,VTK_HIGHER_ORDER_POLYGON:63,VTK_HIGHER_ORDER_TETRAHEDRON:64,VTK_HIGHER_ORDER_WEDGE:65,VTK_HIGHER_ORDER_PYRAMID:66,VTK_HIGHER_ORDER_HEXAHEDRON:67,VTK_LAGRANGE_CURVE:68,VTK_LAGRANGE_TRIANGLE:69,VTK_LAGRANGE_QUADRILATERAL:70,VTK_LAGRANGE_TETRAHEDRON:71,VTK_LAGRANGE_HEXAHEDRON:72,VTK_LAGRANGE_WEDGE:73,VTK_LAGRANGE_PYRAMID:74,VTK_NUMBER_OF_CELL_TYPES:75},Bc=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function zg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function WD(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?zg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function zD(t){return t<Bc.length?Bc[t]:"UnknownClass"}function $D(t){return Bc.findIndex(t)}function jD(t){return t<Fe.VTK_QUADRATIC_EDGE||t===Fe.VTK_CONVEX_POINT_SET||t===Fe.VTK_POLYHEDRON}function HD(t){return t===Fe.VTK_TRIANGLE_STRIP||t===Fe.VTK_POLY_LINE||t===Fe.VTK_POLY_VERTEX}var KD={getClassNameFromTypeId:zD,getTypeIdFromClassName:$D,isLinear:jD,hasSubCells:HD};function qD(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=n>0?n:1,e.extend=r>0?r:1,e.maxId=-1,e.typeArray=new Uint8Array(n),e.locationArray=new Uint32Array(n)},t.insertCell=function(n,r,a){e.typeArray[n]=r,e.locationArray[n]=a,n>e.maxId&&(e.maxId=n)},t.insertNextCell=function(n,r){return t.insertCell(++e.maxId,n,r),e.maxId},t.setCellTypes=function(n,r,a){e.size=n,e.typeArray=r,e.locationArray=a,e.maxId=n-1},t.getCellLocation=function(n){return e.locationArray[n]},t.deleteCell=function(n){e.typeArray[n]=Fe.VTK_EMPTY_CELL},t.getNumberOfTypes=function(){return e.maxId+1},t.isType=function(n){for(var r=t.getNumberOfTypes(),a=0;a<r;++a)if(n===t.getCellType(a))return!0;return!1},t.insertNextType=function(n){return t.insertNextCell(n,-1)},t.getCellType=function(n){return e.typeArray[n]},t.reset=function(){e.maxId=-1},t.deepCopy=function(n){t.allocate(n.getSize(),n.getExtend()),e.typeArray.set(n.getTypeArray()),e.locationArray.set(n.getLocationArray()),e.maxId=n.getMaxId()}}var XD={size:0,maxId:-1,extend:1e3};function kh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XD,n),E.obj(t,e),E.get(t,e,["size","maxId","extend"]),E.getArray(t,e,["typeArray","locationArray"]),qD(t,e)}var YD=E.newInstance(kh,"vtkCellTypes"),ZD=WD({newInstance:YD,extend:kh},KD),JD={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2},Uh={IntersectionState:JD};function $g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function jg(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$g(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$g(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Gi=Uh.IntersectionState;function Wr(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,a={t:Number.MIN_VALUE,distance:0},i=[],o;i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2];var s=i[0]*(t[0]-e[0])+i[1]*(t[1]-e[1])+i[2]*(t[2]-e[2]),c=ce(i,i),u=1e-5*s;return c!==0&&(a.t=s/c),u<0&&(u=-u),-u<c&&c<u||c<=0||a.t<0?o=e:a.t>1?o=n:(o=i,i[0]=e[0]+a.t*i[0],i[1]=e[1]+a.t*i[1],i[2]=e[2]+a.t*i[2]),r&&(r[0]=o[0],r[1]=o[1],r[2]=o[2]),a.distance=Ht(o,t),a}function Bh(t,e,n,r,a,i){var o=[],s=[],c=[];a[0]=0,i[0]=0,hn(e,t,o),hn(r,n,s),hn(n,t,c);var u=[];u[0]=[ce(o,o),-ce(o,s)],u[1]=[u[0][1],ce(s,s)];var g=[];if(g[0]=ce(o,c),g[1]=-ce(s,c),ep(u,g,2)===0){for(var f=Number.MAX_VALUE,l=[t,e,n,r],v=[n,n,t,t],p=[r,r,e,e],d=[i[0],i[0],a[0],a[0]],h=[a[0],a[0],i[0],i[0]],T,C=0;C<4;C++)T=Wr(l[C],v[C],p[C]),T.distance<f&&(f=T.distance,d[C]=T.t,h[C]=C%2);return Gi.ON_LINE}return a[0]=g[0],i[0]=g[1],a[0]>=0&&a[0]<=1&&i[0]>=0&&i[0]<=1?Gi.YES_INTERSECTION:Gi.NO_INTERSECTION}var QD={distanceToLine:Wr,intersection:Bh};function eV(t,e){e.classHierarchy.push("vtkLine");function n(r){return r>=0&&r<=1}t.getCellDimension=function(){return 1},t.intersectWithLine=function(r,a,i,o,s){var c={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};s[1]=0,s[2]=0;var u=[],g=[],f=[];e.points.getPoint(0,g),e.points.getPoint(1,f);var l=[],v=[],p=Bh(r,a,g,f,l,v);if(c.t=l[0],c.betweenPoints=n(c.t),s[0]=v[0],p===Gi.YES_INTERSECTION){for(var d=0;d<3;d++)o[d]=g[d]+s[0]*(f[d]-g[d]),u[d]=r[d]+c.t*(a[d]-r[d]);if(Ht(o,u)<=i*i)return c.intersect=1,c}else{var h;if(c.t<0)return h=Wr(r,g,f,o),h.distance<=i*i&&(c.t=0,c.intersect=1,c.betweenPoints=!0),c;if(c.t>1)return h=Wr(a,g,f,o),h.distance<=i*i&&(c.t=1,c.intersect=1,c.betweenPoints=!0),c;if(s[0]<0)return s[0]=0,h=Wr(g,r,a,o),c.t=h.t,h.distance<=i*i&&(c.intersect=1),c;if(s[0]>1)return s[0]=1,h=Wr(f,r,a,o),c.t=h.t,h.distance<=i*i&&(c.intersect=1),c}return c},t.evaluateLocation=function(r,a,i){var o=[],s=[];e.points.getPoint(0,o),e.points.getPoint(1,s);for(var c=0;c<3;c++)a[c]=o[c]+r[0]*(s[c]-o[c]);i[0]=1-r[0],i[1]=r[0]}}var tV={};function Gh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tV,n),fo.extend(t,e,n),eV(t,e)}var nV=E.newInstance(Gh,"vtkLine"),Rt=jg(jg({newInstance:nV,extend:Gh},QD),Uh);function rV(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=Pt(e.points):e.points=Uc.newInstance(),t.getNumberOfPoints=function(){return e.points.getNumberOfPoints()},t.getBounds=function(){return e.points.getBounds()},t.computeBounds=function(){t.getBounds()};var n=t.shallowCopy;t.shallowCopy=function(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,a),e.points=Uc.newInstance(),e.points.shallowCopy(r.getPoints())}}var aV={};function Ah(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aV,n),oa.extend(t,e,n),E.setGet(t,e,["points"]),rV(t,e)}var iV=E.newInstance(Ah,"vtkPointSet"),oV={newInstance:iV,extend:Ah};function Hg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function sV(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Hg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Hg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Pu(t,e,n,r){var a=n[0]-e[0],i=n[1]-e[1],o=n[2]-e[2],s=t[0]-e[0],c=t[1]-e[1],u=t[2]-e[2];r[0]=i*u-o*c,r[1]=o*s-a*u,r[2]=a*c-i*s}function go(t,e,n,r){Pu(t,e,n,r);var a=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);a!==0&&(r[0]/=a,r[1]/=a,r[2]/=a)}function cV(t,e,n,r,a,i){var o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,s=!1,c=[],u=[],g=[],f=[],l=[];go(t,e,n,f),go(r,a,i,l);var v=-ce(f,t),p=-ce(l,r),d=[ce(l,t)+p,ce(l,e)+p,ce(l,n)+p];if(d[0]*d[1]>o&&d[0]*d[2]>o)return{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:g};var h=[ce(f,r)+v,ce(f,a)+v,ce(f,i)+v];if(h[0]*h[1]>o&&h[0]*h[2]>o)return{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:g};if(Math.abs(f[0]-l[0])<1e-9&&Math.abs(f[1]-l[1])<1e-9&&Math.abs(f[2]-l[2])<1e-9&&Math.abs(v-p)<1e-9)return s=!0,{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:g};var T=[t,e,n],C=[r,a,i],m=ce(f,l),y=(v-p*m)/(m*m-1),w=(p-v*m)/(m*m-1),S=[y*f[0]+w*l[0],y*f[1]+w*l[1],y*f[2]+w*l[2]],O=Qt(f,l,[]);lr(O);for(var M=0,R=0,D=[],L=[],N=50,U=50,b=0;b<3;b++){var G=b,P=(b+1)%3,z=Tn.intersectWithLine(T[G],T[P],r,l);z.intersection&&z.t>0-o&&z.t<1+o&&(z.t<1+o&&z.t>1-o&&(N=M),D[M++]=ce(z.x,O)-ce(S,O));var F=Tn.intersectWithLine(C[G],C[P],t,f);F.intersection&&F.t>0-o&&F.t<1+o&&(F.t<1+o&&F.t>1-o&&(U=R),L[R++]=ce(F.x,O)-ce(S,O))}if(M>2){M--;var V=D[2];D[2]=D[N],D[N]=V}if(R>2){R--;var B=L[2];L[2]=L[U],L[U]=B}if(M!==2||R!==2)return{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:g};if(Number.isNaN(D[0])||Number.isNaN(D[1])||Number.isNaN(L[0])||Number.isNaN(L[1]))return{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:g};if(D[0]>D[1]){var W=D[1];D[1]=D[0],D[0]=W}if(L[0]>L[1]){var I=L[1];L[1]=L[0],L[0]=I}var $,Q;return D[1]<L[0]||L[1]<D[0]?{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:g}:(D[0]<L[0]?D[1]<L[1]?(g[0]=2,g[1]=1,$=L[0],Q=D[1]):(g[0]=2,g[1]=2,$=L[0],Q=L[1]):D[1]<L[1]?(g[0]=1,g[1]=1,$=D[0],Q=D[1]):(g[0]=1,g[1]=2,$=D[0],Q=L[1]),Sc(S,O,$,c),Sc(S,O,Q,u),{intersect:!0,coplanar:s,pt1:c,pt2:u,surfaceId:g})}var uV={computeNormalDirection:Pu,computeNormal:go,intersectWithTriangle:cV};function fV(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=function(){return 2},t.intersectWithLine=function(n,r,a,i,o){var s={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};o[2]=0;var c=[],u=a*a,g=[],f=[],l=[];e.points.getPoint(0,g),e.points.getPoint(1,f),e.points.getPoint(2,l);var v=[],p=[];if(go(g,f,l,v),v[0]!==0||v[1]!==0||v[2]!==0){var d=Tn.intersectWithLine(n,r,g,v);if(s.betweenPoints=d.betweenPoints,s.t=d.t,i[0]=d.x[0],i[1]=d.x[1],i[2]=d.x[2],!d.intersection)return o[0]=0,o[1]=0,s.intersect=0,s;var h=t.evaluatePosition(i,c,o,p);if(h.evaluation>=0)return h.dist2<=u?(s.intersect=1,s):(s.intersect=h.evaluation,s)}var T=Ht(g,f),C=Ht(f,l),m=Ht(l,g);e.line||(e.line=Rt.newInstance()),T>C&&T>m?(e.line.getPoints().setPoint(0,g),e.line.getPoints().setPoint(1,f)):C>m&&C>T?(e.line.getPoints().setPoint(0,f),e.line.getPoints().setPoint(1,l)):(e.line.getPoints().setPoint(0,l),e.line.getPoints().setPoint(1,g));var y=e.line.intersectWithLine(n,r,a,i,o);if(s.betweenPoints=y.betweenPoints,s.t=y.t,y.intersect){for(var w=[],S=[],O=[],M=0;M<3;M++)w[M]=g[M]-l[M],S[M]=f[M]-l[M],O[M]=i[M]-l[M];return o[0]=ce(O,w)/m,o[1]=ce(O,S)/C,s.intersect=1,s}return o[0]=0,o[1]=0,s.intersect=0,s},t.evaluatePosition=function(n,r,a,i){var o={subId:0,dist2:0,evaluation:-1},s,c,u=[],g=[],f=[],l=[],v,p=[],d=[],h=[],T=0,C=0,m=[],y,w,S,O=[],M=[],R=[],D=[];o.subId=0,a[2]=0,e.points.getPoint(1,u),e.points.getPoint(2,g),e.points.getPoint(0,f),Pu(u,g,f,l),Tn.generalizedProjectPoint(n,u,l,D);var L=0;for(s=0;s<3;s++)l[s]<0?v=-l[s]:v=l[s],v>L&&(L=v,C=s);for(c=0,s=0;s<3;s++)s!==C&&(m[c++]=s);for(s=0;s<2;s++)p[s]=D[m[s]]-f[m[s]],d[s]=u[m[s]]-f[m[s]],h[s]=g[m[s]]-f[m[s]];if(T=Be(d,h),T===0)return a[0]=0,a[1]=0,o.evaluation=-1,o;if(a[0]=Be(p,h)/T,a[1]=Be(d,p)/T,i[0]=1-(a[0]+a[1]),i[1]=a[0],i[2]=a[1],i[0]>=0&&i[0]<=1&&i[1]>=0&&i[1]<=1&&i[2]>=0&&i[2]<=1)r&&(o.dist2=Ht(D,n),r[0]=D[0],r[1]=D[1],r[2]=D[2]),o.evaluation=1;else{var N;if(r){if(i[1]<0&&i[2]<0)for(y=Ht(n,f),w=Rt.distanceToLine(n,u,f,N,M),S=Rt.distanceToLine(n,f,g,N,R),y<w?(o.dist2=y,O=f):(o.dist2=w,O=M),S<o.dist2&&(o.dist2=S,O=R),s=0;s<3;s++)r[s]=O[s];else if(i[2]<0&&i[0]<0)for(y=Ht(n,u),w=Rt.distanceToLine(n,u,f,N,M),S=Rt.distanceToLine(n,u,g,N,R),y<w?(o.dist2=y,O=u):(o.dist2=w,O=M),S<o.dist2&&(o.dist2=S,O=R),s=0;s<3;s++)r[s]=O[s];else if(i[1]<0&&i[0]<0)for(y=Ht(n,g),w=Rt.distanceToLine(n,g,f,N,M),S=Rt.distanceToLine(n,u,g,N,R),y<w?(o.dist2=y,O=g):(o.dist2=w,O=M),S<o.dist2&&(o.dist2=S,O=R),s=0;s<3;s++)r[s]=O[s];else if(i[0]<0){var U=Rt.distanceToLine(n,u,g,r);o.dist2=U.distance}else if(i[1]<0){var b=Rt.distanceToLine(n,g,f,r);o.dist2=b.distance}else if(i[2]<0){var G=Rt.distanceToLine(n,u,f,r);o.dist2=G.distance}}o.evaluation=0}return o},t.evaluateLocation=function(n,r,a){var i=[],o=[],s=[];e.points.getPoint(0,i),e.points.getPoint(1,o),e.points.getPoint(2,s);for(var c=1-n[0]-n[1],u=0;u<3;u++)r[u]=i[u]*c+o[u]*n[0]+s[u]*n[1];a[0]=c,a[1]=n[0],a[2]=n[1]},t.getParametricDistance=function(n){var r,a=0,i=[];i[0]=n[0],i[1]=n[1],i[2]=1-n[0]-n[1];for(var o=0;o<3;o++)i[o]<0?r=-i[o]:i[o]>1?r=i[o]-1:r=0,r>a&&(a=r);return a}}var gV={};function Ih(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gV,n),fo.extend(t,e,n),fV(t,e)}var lV=E.newInstance(Ih,"vtkTriangle"),vV=sV({newInstance:lV,extend:Ih},uV),Ms=["verts","lines","polys","strips"],ma,Kg=E.vtkWarningMacro,pV=(ma={},Te(ma,Fe.VTK_LINE,Rt),Te(ma,Fe.VTK_POLY_LINE,Rt),Te(ma,Fe.VTK_TRIANGLE,vV),ma);function hV(t,e){e.classHierarchy.push("vtkPolyData");function n(a){return a.replace(/(?:^\w|[A-Z]|\b\w)/g,function(i){return i.toUpperCase()}).replace(/\s+/g,"")}Ms.forEach(function(a){t["getNumberOf".concat(n(a))]=function(){return e[a].getNumberOfCells()},e[a]?e[a]=Pt(e[a]):e[a]=Wg.newInstance()}),t.getNumberOfCells=function(){return Ms.reduce(function(a,i){return a+e[i].getNumberOfCells()},0)};var r=t.shallowCopy;t.shallowCopy=function(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(a,i),Ms.forEach(function(o){e[o]=Wg.newInstance(),e[o].shallowCopy(a.getReferenceByName(o))})},t.buildCells=function(){var a=t.getNumberOfVerts(),i=t.getNumberOfLines(),o=t.getNumberOfPolys(),s=t.getNumberOfStrips(),c=a+i+o+s,u=new Uint8Array(c),g=u,f=new Uint32Array(c),l=f;if(a){var v=0;e.verts.getCellSizes().forEach(function(T,C){l[C]=v,g[C]=T>1?Fe.VTK_POLY_VERTEX:Fe.VTK_VERTEX,v+=T+1}),l=l.subarray(a),g=g.subarray(a)}if(i){var p=0;e.lines.getCellSizes().forEach(function(T,C){l[C]=p,g[C]=T>2?Fe.VTK_POLY_LINE:Fe.VTK_LINE,T===1&&Kg("Building VTK_LINE ",C," with only one point, but VTK_LINE needs at least two points. Check the input."),p+=T+1}),l=l.subarray(i),g=g.subarray(i)}if(o){var d=0;e.polys.getCellSizes().forEach(function(T,C){switch(l[C]=d,T){case 3:g[C]=Fe.VTK_TRIANGLE;break;case 4:g[C]=Fe.VTK_QUAD;break;default:g[C]=Fe.VTK_POLYGON;break}T<3&&Kg("Building VTK_TRIANGLE ",C," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),d+=T+1}),l+=l.subarray(o),g+=g.subarray(o)}if(s){var h=0;g.fill(Fe.VTK_TRIANGLE_STRIP,0,s),e.strips.getCellSizes().forEach(function(T,C){l[C]=h,h+=T+1})}e.cells=ZD.newInstance(),e.cells.setCellTypes(c,u,f)},t.buildLinks=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells===void 0&&t.buildCells(),e.links=PD.newInstance(),a>0?e.links.allocate(a):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=function(a){return e.cells.getCellType(a)},t.getCellPoints=function(a){var i=t.getCellType(a),o=null;switch(i){case Fe.VTK_VERTEX:case Fe.VTK_POLY_VERTEX:o=e.verts;break;case Fe.VTK_LINE:case Fe.VTK_POLY_LINE:o=e.lines;break;case Fe.VTK_TRIANGLE:case Fe.VTK_QUAD:case Fe.VTK_POLYGON:o=e.polys;break;case Fe.VTK_TRIANGLE_STRIP:o=e.strips;break;default:return o=null,{type:0,cellPointIds:null}}var s=e.cells.getCellLocation(a),c=o.getCell(s);return{cellType:i,cellPointIds:c}},t.getPointCells=function(a){return e.links.getCells(a)},t.getCellEdgeNeighbors=function(a,i,o){var s=e.links.getLink(i),c=e.links.getLink(o);return s.cells.filter(function(u){return u!==a&&c.cells.indexOf(u)!==-1})},t.getCell=function(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=t.getCellPoints(a),s=i||pV[o.cellType].newInstance();return s.initialize(t.getPoints(),o.cellPointIds),s}}var dV={};function Ph(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dV,n),oV.extend(t,e,n),E.get(t,e,["cells","links"]),E.setGet(t,e,["verts","lines","polys","strips"]),hV(t,e)}var yV=E.newInstance(Ph,"vtkPolyData"),TV={newInstance:yV,extend:Ph};function qg(t){return function(){return E.vtkErrorMacro("vtkProp::".concat(t," - NOT IMPLEMENTED"))}}function mV(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=function(){for(var n=e.mtime,r=0;r<e.textures.length;++r){var a=e.textures[r].getMTime();a>n&&(n=a)}return n},t.processSelectorPixelBuffers=function(n,r){},t.getNestedProps=function(){return null},t.getActors=function(){return[]},t.getActors2D=function(){return[]},t.getVolumes=function(){return[]},t.pick=qg("pick"),t.hasKey=qg("hasKey"),t.getNestedVisibility=function(){return e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility())},t.getNestedPickable=function(){return e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable())},t.getNestedDragable=function(){return e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable())},t.getRedrawMTime=function(){return e.mtime},t.setEstimatedRenderTime=function(n){e.estimatedRenderTime=n,e.savedEstimatedRenderTime=n},t.restoreEstimatedRenderTime=function(){e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=function(n){e.estimatedRenderTime+=n},t.setAllocatedRenderTime=function(n){e.allocatedRenderTime=n,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=function(){return!1},t.getTextures=function(){return e.textures},t.hasTexture=function(n){return e.textures.indexOf(n)!==-1},t.addTexture=function(n){n&&!t.hasTexture(n)&&(e.textures=e.textures.concat(n),t.modified())},t.removeTexture=function(n){var r=e.textures.filter(function(a){return a!==n});e.textures.length!==r.length&&(e.textures=r,t.modified())},t.removeAllTextures=function(){e.textures=[],t.modified()}}var CV={visibility:!0,pickable:!0,dragable:!0,useBounds:!0,allocatedRenderTime:10,estimatedRenderTime:0,savedEstimatedRenderTime:0,renderTimeMultiplier:1,paths:null,textures:[]};function Wh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CV,n),E.obj(t,e),E.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),E.setGet(t,e,["visibility","pickable","dragable","useBounds","renderTimeMultiplier","_parentProp"]),E.moveToProtected(t,e,["parentProp"]),mV(t,e)}var wV=E.newInstance(Wh,"vtkProp"),SV={newInstance:wV,extend:Wh};function EV(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=function(r){e.position=e.position.map(function(a,i){return a+r[i]}),t.modified()},t.getOrientationWXYZ=function(){var r=ur();A0(r,e.rotation);var a=new Float64Array(3),i=gm(a,r);return[Qi(i),a[0],a[1],a[2]]},t.rotateX=function(r){r!==0&&(Zc(e.rotation,e.rotation,We(r)),t.modified())},t.rotateY=function(r){r!==0&&(Jc(e.rotation,e.rotation,We(r)),t.modified())},t.rotateZ=function(r){r!==0&&(Qc(e.rotation,e.rotation,We(r)),t.modified())},t.rotateWXYZ=function(r,a,i,o){if(!(r===0||a===0&&i===0&&o===0)){var s=We(r),c=ur();au(c,[a,i,o],s);var u=new Float64Array(16);tu(u,c),Me(e.rotation,e.rotation,u),t.modified()}},t.setOrientation=function(r,a,i){return r===e.orientation[0]&&a===e.orientation[1]&&i===e.orientation[2]?!1:(e.orientation=[r,a,i],ie(e.rotation),t.rotateZ(i),t.rotateX(r),t.rotateY(a),t.modified(),!0)},t.setUserMatrix=function(r){Ke(e.userMatrix,r),t.modified()},t.getMatrix=function(){return t.computeMatrix(),e.matrix},t.computeMatrix=function(){if(t.getMTime()>e.matrixMTime.getMTime()){ie(e.matrix),e.userMatrix&&Me(e.matrix,e.matrix,e.userMatrix),je(e.matrix,e.matrix,e.origin),je(e.matrix,e.matrix,e.position),Me(e.matrix,e.matrix,e.rotation),Pn(e.matrix,e.matrix,e.scale),je(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),Oe(e.matrix,e.matrix),e.isIdentity=!0;for(var r=0;r<4;++r)for(var a=0;a<4;++a)(r===a?1:0)!==e.matrix[r+a*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getCenter=function(){return Je.getCenter(e.bounds)},t.getLength=function(){return Je.getLength(e.bounds)},t.getXRange=function(){return Je.getXRange(e.bounds)},t.getYRange=function(){return Je.getYRange(e.bounds)},t.getZRange=function(){return Je.getZRange(e.bounds)},t.getUserMatrix=function(){return e.userMatrix};function n(){t.computeMatrix()}t.onModified(n)}var xV={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[1,-1,1,-1,1,-1],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function zh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xV,n),SV.extend(t,e,n),e.matrixMTime={},E.obj(e.matrixMTime),E.get(t,e,["bounds","isIdentity"]),E.getArray(t,e,["orientation"]),E.setGetArray(t,e,["origin","position","scale"],3),e.matrix=ie(new Float64Array(16)),e.rotation=ie(new Float64Array(16)),e.userMatrix=ie(new Float64Array(16)),e.transform=null,EV(t,e)}var OV=E.newInstance(zh,"vtkProp3D"),Wu={newInstance:OV,extend:zh};function Xg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function MV(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Xg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Xg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var RV=E.vtkDebugMacro;function DV(t,e){e.classHierarchy.push("vtkActor");var n=MV({},t);t.getActors=function(){return[t]},t.getIsOpaque=function(){if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();var r=e.property.getOpacity()>=1;return r=r&&(!e.texture||!e.texture.isTranslucent()),r=r&&(!e.mapper||e.mapper.getIsOpaque()),r},t.hasTranslucentPolygonalGeometry=function(){return e.mapper===null?!1:(e.property===null&&t.setProperty(t.makeProperty()),!t.getIsOpaque())},t.makeProperty=ia.newInstance,t.getProperty=function(){return e.property===null&&(e.property=t.makeProperty()),e.property},t.getBounds=function(){if(e.mapper===null)return e.bounds;var r=e.mapper.getBounds();if(!r||r.length!==6)return r;if(r[0]>r[1])return e.mapperBounds=r.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),r;if(!e.mapperBounds||r[0]!==e.mapperBounds[0]||r[1]!==e.mapperBounds[1]||r[2]!==e.mapperBounds[2]||r[3]!==e.mapperBounds[3]||r[4]!==e.mapperBounds[4]||r[5]!==e.mapperBounds[5]||t.getMTime()>e.boundsMTime.getMTime()){RV("Recomputing bounds..."),e.mapperBounds=r.concat();var a=[];Je.getCorners(r,a),t.computeMatrix();var i=new Float64Array(16);Oe(i,e.matrix),a.forEach(function(o){return ue(o,o,i)}),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map(function(o,s){return s%2===0?a.reduce(function(c,u){return c>u[s/2]?u[s/2]:c},o):a.reduce(function(c,u){return c<u[(s-1)/2]?u[(s-1)/2]:c},o)}),e.boundsMTime.modified()}return e.bounds},t.getMTime=function(){var r=n.getMTime();if(e.property!==null){var a=e.property.getMTime();r=a>r?a:r}if(e.backfaceProperty!==null){var i=e.backfaceProperty.getMTime();r=i>r?i:r}return r},t.getRedrawMTime=function(){var r=e.mtime;if(e.mapper!==null){var a=e.mapper.getMTime();r=a>r?a:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),a=e.mapper.getInput().getMTime(),r=a>r?a:r)}return r},t.getSupportsSelection=function(){return e.mapper?e.mapper.getSupportsSelection():!1},t.processSelectorPixelBuffers=function(r,a){e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(r,a)}}var VV={mapper:null,property:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1,bounds:[1,-1,1,-1,1,-1]};function LV(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VV,n),Wu.extend(t,e,n),e.boundsMTime={},E.obj(e.boundsMTime),E.set(t,e,["property"]),E.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),DV(t,e)}E.newInstance(LV,"vtkActor");function NV(t,e){const n=t.invokeResize;delete t.invokeResize,e.renderWindow=rE.newInstance(),e.rendererMap={},e.openGLRenderWindow=ZR.newInstance(),e.renderWindow.addView(e.openGLRenderWindow),e.interactor=xD.newInstance(),e.interactor.setView(e.openGLRenderWindow),e.interactor.initialize(),t.addRenderer=({viewport:r,id:a,background:i})=>{const o=hD.newInstance({viewport:r,background:i||e.background});e.renderWindow.addRenderer(o),e.rendererMap[a]=o},t.removeRenderer=r=>{const a=t.getRenderer(r);e.renderWindow.removeRenderer(a),delete e.rendererMap[r]},t.getRenderer=r=>e.rendererMap[r],t.getRenderers=()=>{const{rendererMap:r}=e;return Object.keys(r).map(i=>({id:i,renderer:r[i]}))},t.resize=()=>{if(e.container){const{width:r,height:a}=e.container;e.openGLRenderWindow.setSize(Math.floor(r),Math.floor(a)),n(),e.renderWindow.render()}},t.setContainer=r=>{e.container=r,e.openGLRenderWindow.setContainer(e.container)},t.delete=E.chain(t.setContainer,e.openGLRenderWindow.delete,t.delete),t.resize()}const FV={background:[0,0,0],container:null};function $h(t,e,n={}){Object.assign(e,FV,n),E.obj(t,e),E.get(t,e,["renderWindow","openGLRenderWindow","interactor","container"]),E.event(t,e,"resize"),NV(t,e)}const _V=E.newInstance($h),bV={newInstance:_V,extend:$h};var Qn=M0.BlendMode,Ma=M0.FilterMode;function kV(t,e){e.classHierarchy.push("vtkVolumeMapper"),t.getBounds=function(){var n=t.getInputData();return n?(e.static||t.update(),e.bounds=n.getBounds()):e.bounds=Zr(),e.bounds},t.update=function(){t.getInputData()},t.setBlendModeToComposite=function(){t.setBlendMode(Qn.COMPOSITE_BLEND)},t.setBlendModeToMaximumIntensity=function(){t.setBlendMode(Qn.MAXIMUM_INTENSITY_BLEND)},t.setBlendModeToMinimumIntensity=function(){t.setBlendMode(Qn.MINIMUM_INTENSITY_BLEND)},t.setBlendModeToAverageIntensity=function(){t.setBlendMode(Qn.AVERAGE_INTENSITY_BLEND)},t.setBlendModeToAdditiveIntensity=function(){t.setBlendMode(Qn.ADDITIVE_INTENSITY_BLEND)},t.getBlendModeAsString=function(){return E.enumToString(Qn,e.blendMode)},t.setAverageIPScalarRange=function(n,r){console.warn("setAverageIPScalarRange is deprecated use setIpScalarRange"),t.setIpScalarRange(n,r)},t.getFilterModeAsString=function(){return E.enumToString(Ma,e.filterMode)},t.setFilterModeToOff=function(){t.setFilterMode(Ma.OFF)},t.setFilterModeToNormalized=function(){t.setFilterMode(Ma.NORMALIZED)},t.setFilterModeToRaw=function(){t.setFilterMode(Ma.RAW)},t.setGlobalIlluminationReach=function(n){e.globalIlluminationReach=Yt(n,0,1),t.modified()},t.setVolumetricScatteringBlending=function(n){e.volumetricScatteringBlending=Yt(n,0,1),t.modified()},t.setVolumeShadowSamplingDistFactor=function(n){e.volumeShadowSamplingDistFactor=n>=1?n:1,t.modified()},t.setAnisotropy=function(n){e.anisotropy=Yt(n,-.99,.99),t.modified()}}var UV={bounds:[1,-1,1,-1,1,-1],sampleDistance:1,imageSampleDistance:1,maximumSamplesPerRay:1e3,autoAdjustSampleDistances:!0,blendMode:Qn.COMPOSITE_BLEND,ipScalarRange:[-1e6,1e6],filterMode:Ma.OFF,preferSizeOverAccuracy:!1,computeNormalFromOpacity:!1,volumetricScatteringBlending:0,globalIlluminationReach:0,volumeShadowSamplingDistFactor:5,anisotropy:0};function jh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,UV,n),Du.extend(t,e,n),E.setGet(t,e,["sampleDistance","imageSampleDistance","maximumSamplesPerRay","autoAdjustSampleDistances","blendMode","filterMode","preferSizeOverAccuracy","computeNormalFromOpacity","volumetricScatteringBlending","globalIlluminationReach","volumeShadowSamplingDistFactor","anisotropy"]),E.setGetArray(t,e,["ipScalarRange"],2),E.event(t,e,"lightingActivated"),kV(t,e)}var BV=E.newInstance(jh,"vtkVolumeMapper"),GV={newInstance:BV,extend:jh};function AV(t,e){e.classHierarchy.push("vtkSharedVolumeMapper")}const IV={scalarTexture:null};function Hh(t,e,n={}){Object.assign(e,IV,n),GV.extend(t,e,n),E.setGet(t,e,["scalarTexture"]),AV(t,e)}const PV=E.newInstance(Hh,"vtkSharedVolumeMapper"),WV={newInstance:PV,extend:Hh};function zV(t,e){e.classHierarchy.push("vtkStreamingOpenGLTexture");const n=t.create3DFilterableFromRaw;t.create3DFilterableFromRaw=(r,a,i,o,s,c)=>{e.inputDataType=s,e.inputNumComps=o,n(r,a,i,o,s,c)},t.update3DFromRaw=r=>{const{updatedFrames:a}=e;if(!a.length)return;e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();let i,o;if(r instanceof Uint8Array)i=1,o=Uint8Array;else if(r instanceof Int16Array)i=2,o=Int16Array;else if(r instanceof Float32Array)i=4,o=Float32Array;else throw new Error("No support for given TypedArray.");for(let s=0;s<a.length;s++)a[s]&&e.fillSubImage3D(r,s,i,o);return e.updatedFrames=[],e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0},e.fillSubImage3D=(r,a,i,o)=>{const s=r.buffer,u=e.width*e.height*e.components*i,g=a*u,f=e.width*e.components,l=e.context,v=l.getParameter(l.MAX_TEXTURE_SIZE);let p=Math.floor(i*v/e.width);p=Math.min(p,e.height);const d=f*p,h=d*i,T=Math.floor(e.height/p),C=e.height%p,m=f*C;for(let y=0;y<T;y++){const w=y*p,S=new o(s,g+y*h,d);l.texSubImage3D(e.target,0,0,w,a,e.width,p,1,e.format,e.openGLDataType,S)}if(C!==0){const y=T*p,w=new o(s,g+T*h,m);l.texSubImage3D(e.target,0,0,y,a,e.width,C,1,e.format,e.openGLDataType,w)}},t.getTextureParameters=()=>({width:e.width,height:e.height,depth:e.depth,numComps:e.inputNumComps,dataType:e.inputDataType}),t.setUpdatedFrame=r=>{e.updatedFrames[r]=!0}}const $V={updatedFrames:[]};function Kh(t,e,n={}){Object.assign(e,$V,n),st.extend(t,e,n),zV(t,e)}const jV=E.newInstance(Kh,"vtkStreamingOpenGLTexture"),HV={newInstance:jV,extend:Kh};function KV(t,e){e.classHierarchy.push("vtkSlabCamera");const n=ie(new Float64Array(16)),r=new Float64Array(3);t.getProjectionMatrix=(a,i,o)=>{const s=ta();if(e.projectionMatrix){const l=1/e.physicalScale;return te(r,l,l,l),Ke(s,e.projectionMatrix),Pn(s,s,r),Oe(s,s),s}ie(n);let c=e.clippingRange[0],u=e.clippingRange[1];e.isPerformingCoordinateTransformation&&(c=e.distance,u=e.distance+.1);const g=u-c,f=[c+(i+1)*g/2,c+(o+1)*g/2];if(e.parallelProjection){const l=e.parallelScale*a,v=e.parallelScale,p=(e.windowCenter[0]-1)*l,d=(e.windowCenter[0]+1)*l,h=(e.windowCenter[1]-1)*v,T=(e.windowCenter[1]+1)*v;nu(n,p,d,h,T,f[0],f[1]),Oe(n,n)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const l=Math.tan(Pr.radiansFromDegrees(e.viewAngle)/2);let v,p;e.useHorizontalViewAngle===!0?(v=c*l,p=c*l/a):(v=c*l*a,p=c*l);const d=(e.windowCenter[0]-1)*v,h=(e.windowCenter[0]+1)*v,T=(e.windowCenter[1]-1)*p,C=(e.windowCenter[1]+1)*p,m=f[0],y=f[1];n[0]=2*m/(h-d),n[5]=2*m/(C-T),n[2]=(d+h)/(h-d),n[6]=(T+C)/(C-T),n[10]=-(m+y)/(y-m),n[14]=-1,n[11]=-2*m*y/(y-m),n[15]=0}}return Ke(s,n),s}}const qV={isPerformingCoordinateTransformation:!1};function qh(t,e,n={}){Object.assign(e,qV,n),Gu.extend(t,e,n),E.setGet(t,e,["isPerformingCoordinateTransformation"]),KV(t,e)}const XV=E.newInstance(qh,"vtkSlabCamera"),YV={newInstance:XV,extend:qh};class ZV{constructor(e){this.isPrescaled=!1,this.volumeId=e.volumeId,this.metadata=e.metadata,this.dimensions=e.dimensions,this.spacing=e.spacing,this.origin=e.origin,this.direction=e.direction,this.imageData=e.imageData,this.scalarData=e.scalarData,this.sizeInBytes=e.sizeInBytes,this.vtkOpenGLTexture=HV.newInstance(),this.numVoxels=this.dimensions[0]*this.dimensions[1]*this.dimensions[2],e.scaling&&(this.scaling=e.scaling),e.referencedVolumeId&&(this.referencedVolumeId=e.referencedVolumeId)}}const JV=ZV;var Gc={exports:{}};(function(t,e){var n=200,r="__lodash_hash_undefined__",a=9007199254740991,i="[object Arguments]",o="[object Array]",s="[object Boolean]",c="[object Date]",u="[object Error]",g="[object Function]",f="[object GeneratorFunction]",l="[object Map]",v="[object Number]",p="[object Object]",d="[object Promise]",h="[object RegExp]",T="[object Set]",C="[object String]",m="[object Symbol]",y="[object WeakMap]",w="[object ArrayBuffer]",S="[object DataView]",O="[object Float32Array]",M="[object Float64Array]",R="[object Int8Array]",D="[object Int16Array]",L="[object Int32Array]",N="[object Uint8Array]",U="[object Uint8ClampedArray]",b="[object Uint16Array]",G="[object Uint32Array]",P=/[\\^$.*+?()[\]{}|]/g,z=/\w*$/,F=/^\[object .+?Constructor\]$/,V=/^(?:0|[1-9]\d*)$/,B={};B[i]=B[o]=B[w]=B[S]=B[s]=B[c]=B[O]=B[M]=B[R]=B[D]=B[L]=B[l]=B[v]=B[p]=B[h]=B[T]=B[C]=B[m]=B[N]=B[U]=B[b]=B[G]=!0,B[u]=B[g]=B[y]=!1;var W=typeof qe=="object"&&qe&&qe.Object===Object&&qe,I=typeof self=="object"&&self&&self.Object===Object&&self,$=W||I||Function("return this")(),Q=e&&!e.nodeType&&e,H=Q&&!0&&t&&!t.nodeType&&t,he=H&&H.exports===Q;function j(x,k){return x.set(k[0],k[1]),x}function Ee(x,k){return x.add(k),x}function de(x,k){for(var A=-1,K=x?x.length:0;++A<K&&k(x[A],A,x)!==!1;);return x}function oe(x,k){for(var A=-1,K=k.length,rt=x.length;++A<K;)x[rt+A]=k[A];return x}function Z(x,k,A,K){var rt=-1,lt=x?x.length:0;for(K&&lt&&(A=x[++rt]);++rt<lt;)A=k(A,x[rt],rt,x);return A}function se(x,k){for(var A=-1,K=Array(x);++A<x;)K[A]=k(A);return K}function X(x,k){return x==null?void 0:x[k]}function ae(x){var k=!1;if(x!=null&&typeof x.toString!="function")try{k=!!(x+"")}catch{}return k}function ge(x){var k=-1,A=Array(x.size);return x.forEach(function(K,rt){A[++k]=[rt,K]}),A}function J(x,k){return function(A){return x(k(A))}}function et(x){var k=-1,A=Array(x.size);return x.forEach(function(K){A[++k]=K}),A}var tt=Array.prototype,Ie=Function.prototype,gt=Object.prototype,_t=$["__core-js_shared__"],zt=function(){var x=/[^.]+$/.exec(_t&&_t.keys&&_t.keys.IE_PROTO||"");return x?"Symbol(src)_1."+x:""}(),ga=Ie.toString,nt=gt.hasOwnProperty,Tr=gt.toString,ly=RegExp("^"+ga.call(nt).replace(P,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),cf=he?$.Buffer:void 0,uf=$.Symbol,ff=$.Uint8Array,vy=J(Object.getPrototypeOf,Object),py=Object.create,hy=gt.propertyIsEnumerable,dy=tt.splice,gf=Object.getOwnPropertySymbols,yy=cf?cf.isBuffer:void 0,Ty=J(Object.keys,Object),ts=wr($,"DataView"),la=wr($,"Map"),ns=wr($,"Promise"),rs=wr($,"Set"),as=wr($,"WeakMap"),va=wr(Object,"create"),my=jn(ts),Cy=jn(la),wy=jn(ns),Sy=jn(rs),Ey=jn(as),lf=uf?uf.prototype:void 0,vf=lf?lf.valueOf:void 0;function zn(x){var k=-1,A=x?x.length:0;for(this.clear();++k<A;){var K=x[k];this.set(K[0],K[1])}}function xy(){this.__data__=va?va(null):{}}function Oy(x){return this.has(x)&&delete this.__data__[x]}function My(x){var k=this.__data__;if(va){var A=k[x];return A===r?void 0:A}return nt.call(k,x)?k[x]:void 0}function Ry(x){var k=this.__data__;return va?k[x]!==void 0:nt.call(k,x)}function Dy(x,k){var A=this.__data__;return A[x]=va&&k===void 0?r:k,this}zn.prototype.clear=xy,zn.prototype.delete=Oy,zn.prototype.get=My,zn.prototype.has=Ry,zn.prototype.set=Dy;function tn(x){var k=-1,A=x?x.length:0;for(this.clear();++k<A;){var K=x[k];this.set(K[0],K[1])}}function Vy(){this.__data__=[]}function Ly(x){var k=this.__data__,A=ai(k,x);if(A<0)return!1;var K=k.length-1;return A==K?k.pop():dy.call(k,A,1),!0}function Ny(x){var k=this.__data__,A=ai(k,x);return A<0?void 0:k[A][1]}function Fy(x){return ai(this.__data__,x)>-1}function _y(x,k){var A=this.__data__,K=ai(A,x);return K<0?A.push([x,k]):A[K][1]=k,this}tn.prototype.clear=Vy,tn.prototype.delete=Ly,tn.prototype.get=Ny,tn.prototype.has=Fy,tn.prototype.set=_y;function mr(x){var k=-1,A=x?x.length:0;for(this.clear();++k<A;){var K=x[k];this.set(K[0],K[1])}}function by(){this.__data__={hash:new zn,map:new(la||tn),string:new zn}}function ky(x){return ii(this,x).delete(x)}function Uy(x){return ii(this,x).get(x)}function By(x){return ii(this,x).has(x)}function Gy(x,k){return ii(this,x).set(x,k),this}mr.prototype.clear=by,mr.prototype.delete=ky,mr.prototype.get=Uy,mr.prototype.has=By,mr.prototype.set=Gy;function Cr(x){this.__data__=new tn(x)}function Ay(){this.__data__=new tn}function Iy(x){return this.__data__.delete(x)}function Py(x){return this.__data__.get(x)}function Wy(x){return this.__data__.has(x)}function zy(x,k){var A=this.__data__;if(A instanceof tn){var K=A.__data__;if(!la||K.length<n-1)return K.push([x,k]),this;A=this.__data__=new mr(K)}return A.set(x,k),this}Cr.prototype.clear=Ay,Cr.prototype.delete=Iy,Cr.prototype.get=Py,Cr.prototype.has=Wy,Cr.prototype.set=zy;function $y(x,k){var A=ss(x)||p5(x)?se(x.length,String):[],K=A.length,rt=!!K;for(var lt in x)(k||nt.call(x,lt))&&!(rt&&(lt=="length"||f5(lt,K)))&&A.push(lt);return A}function pf(x,k,A){var K=x[k];(!(nt.call(x,k)&&Tf(K,A))||A===void 0&&!(k in x))&&(x[k]=A)}function ai(x,k){for(var A=x.length;A--;)if(Tf(x[A][0],k))return A;return-1}function jy(x,k){return x&&hf(k,cs(k),x)}function is(x,k,A,K,rt,lt,Ot){var Tt;if(K&&(Tt=lt?K(x,rt,lt,Ot):K(x)),Tt!==void 0)return Tt;if(!oi(x))return x;var wf=ss(x);if(wf){if(Tt=s5(x),!k)return a5(x,Tt)}else{var Sr=$n(x),Sf=Sr==g||Sr==f;if(d5(x))return Zy(x,k);if(Sr==p||Sr==i||Sf&&!lt){if(ae(x))return lt?x:{};if(Tt=c5(Sf?{}:x),!k)return i5(x,jy(Tt,x))}else{if(!B[Sr])return lt?x:{};Tt=u5(x,Sr,is,k)}}Ot||(Ot=new Cr);var Ef=Ot.get(x);if(Ef)return Ef;if(Ot.set(x,Tt),!wf)var xf=A?o5(x):cs(x);return de(xf||x,function(us,si){xf&&(si=us,us=x[si]),pf(Tt,si,is(us,k,A,K,si,x,Ot))}),Tt}function Hy(x){return oi(x)?py(x):{}}function Ky(x,k,A){var K=k(x);return ss(x)?K:oe(K,A(x))}function qy(x){return Tr.call(x)}function Xy(x){if(!oi(x)||l5(x))return!1;var k=Cf(x)||ae(x)?ly:F;return k.test(jn(x))}function Yy(x){if(!yf(x))return Ty(x);var k=[];for(var A in Object(x))nt.call(x,A)&&A!="constructor"&&k.push(A);return k}function Zy(x,k){if(k)return x.slice();var A=new x.constructor(x.length);return x.copy(A),A}function os(x){var k=new x.constructor(x.byteLength);return new ff(k).set(new ff(x)),k}function Jy(x,k){var A=k?os(x.buffer):x.buffer;return new x.constructor(A,x.byteOffset,x.byteLength)}function Qy(x,k,A){var K=k?A(ge(x),!0):ge(x);return Z(K,j,new x.constructor)}function e5(x){var k=new x.constructor(x.source,z.exec(x));return k.lastIndex=x.lastIndex,k}function t5(x,k,A){var K=k?A(et(x),!0):et(x);return Z(K,Ee,new x.constructor)}function n5(x){return vf?Object(vf.call(x)):{}}function r5(x,k){var A=k?os(x.buffer):x.buffer;return new x.constructor(A,x.byteOffset,x.length)}function a5(x,k){var A=-1,K=x.length;for(k||(k=Array(K));++A<K;)k[A]=x[A];return k}function hf(x,k,A,K){A||(A={});for(var rt=-1,lt=k.length;++rt<lt;){var Ot=k[rt],Tt=K?K(A[Ot],x[Ot],Ot,A,x):void 0;pf(A,Ot,Tt===void 0?x[Ot]:Tt)}return A}function i5(x,k){return hf(x,df(x),k)}function o5(x){return Ky(x,cs,df)}function ii(x,k){var A=x.__data__;return g5(k)?A[typeof k=="string"?"string":"hash"]:A.map}function wr(x,k){var A=X(x,k);return Xy(A)?A:void 0}var df=gf?J(gf,Object):m5,$n=qy;(ts&&$n(new ts(new ArrayBuffer(1)))!=S||la&&$n(new la)!=l||ns&&$n(ns.resolve())!=d||rs&&$n(new rs)!=T||as&&$n(new as)!=y)&&($n=function(x){var k=Tr.call(x),A=k==p?x.constructor:void 0,K=A?jn(A):void 0;if(K)switch(K){case my:return S;case Cy:return l;case wy:return d;case Sy:return T;case Ey:return y}return k});function s5(x){var k=x.length,A=x.constructor(k);return k&&typeof x[0]=="string"&&nt.call(x,"index")&&(A.index=x.index,A.input=x.input),A}function c5(x){return typeof x.constructor=="function"&&!yf(x)?Hy(vy(x)):{}}function u5(x,k,A,K){var rt=x.constructor;switch(k){case w:return os(x);case s:case c:return new rt(+x);case S:return Jy(x,K);case O:case M:case R:case D:case L:case N:case U:case b:case G:return r5(x,K);case l:return Qy(x,K,A);case v:case C:return new rt(x);case h:return e5(x);case T:return t5(x,K,A);case m:return n5(x)}}function f5(x,k){return k=k==null?a:k,!!k&&(typeof x=="number"||V.test(x))&&x>-1&&x%1==0&&x<k}function g5(x){var k=typeof x;return k=="string"||k=="number"||k=="symbol"||k=="boolean"?x!=="__proto__":x===null}function l5(x){return!!zt&&zt in x}function yf(x){var k=x&&x.constructor,A=typeof k=="function"&&k.prototype||gt;return x===A}function jn(x){if(x!=null){try{return ga.call(x)}catch{}try{return x+""}catch{}}return""}function v5(x){return is(x,!0,!0)}function Tf(x,k){return x===k||x!==x&&k!==k}function p5(x){return h5(x)&&nt.call(x,"callee")&&(!hy.call(x,"callee")||Tr.call(x)==i)}var ss=Array.isArray;function mf(x){return x!=null&&y5(x.length)&&!Cf(x)}function h5(x){return T5(x)&&mf(x)}var d5=yy||C5;function Cf(x){var k=oi(x)?Tr.call(x):"";return k==g||k==f}function y5(x){return typeof x=="number"&&x>-1&&x%1==0&&x<=a}function oi(x){var k=typeof x;return!!x&&(k=="object"||k=="function")}function T5(x){return!!x&&typeof x=="object"}function cs(x){return mf(x)?$y(x):Yy(x)}function m5(){return[]}function C5(){return!1}t.exports=v5})(Gc,Gc.exports);const ht=Gc.exports;class QV{constructor(e){this.flipHorizontal=!1,this.flipVertical=!1,this.rotation=0,this._suppressCameraModifiedEvents=!1,this.hasPixelSpacing=!0,this.applyFlipTx=n=>{const r=this.getDefaultActor();if(!r)return n;const i=r.actor.getMatrix(),o=Ue(),s=ta();return Oe(s,i),ue(o,n,s),[o[0],o[1],o[2]]},this.id=e.id,this.renderingEngineId=e.renderingEngineId,this.type=e.type,this.element=e.element,this.canvas=e.canvas,this.sx=e.sx,this.sy=e.sy,this.sWidth=e.sWidth,this.sHeight=e.sHeight,this._actors=new Map,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.defaultOptions=ht(e.defaultOptions),this.suppressEvents=e.defaultOptions.suppressEvents?e.defaultOptions.suppressEvents:!1,this.options=ht(e.defaultOptions)}static get useCustomRenderingPipeline(){return!1}getRenderingEngine(){return Ba.get(this.renderingEngineId)}getRenderer(){const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return e.offscreenMultiRenderWindow.getRenderer(this.id)}render(){this.getRenderingEngine().renderViewport(this.id)}setOptions(e,n=!1){this.options=ht(e),n&&this.render()}reset(e=!1){this.options=ht(this.defaultOptions),e&&this.render()}flip({flipHorizontal:e,flipVertical:n}){const r=this.getDefaultImageData();if(!r)return;let a=!1,i=!1;if(typeof e<"u"&&(e&&!this.flipHorizontal||!e&&this.flipHorizontal)&&(a=!0),typeof n<"u"&&(n&&!this.flipVertical||!n&&this.flipVertical)&&(i=!0),!a&&!i)return;const o=r.getOrigin(),s=r.getDirection(),c=r.getSpacing(),u=r.getDimensions(),g=s.slice(0,3),f=s.slice(3,6),l=s.slice(6,9),v=Ue();Lt(v,o,g,u[0]/2*c[0]),Lt(v,v,f,u[1]/2*c[1]),Lt(v,v,l,u[2]/2*c[2]);let p,d;const h=Zn.buildFromRadian().identity().translate(v[0],v[1],v[2]).rotateFromDirections(f,[0,1,0]).rotateFromDirections(g,[1,0,0]),T=Zn.buildFromRadian().identity().rotateFromDirections([1,0,0],g).rotateFromDirections([0,1,0],f).translate(-v[0],-v[1],-v[2]);a&&(this.flipHorizontal=e,p=Zn.buildFromRadian().multiply(h.getMatrix()).scale(-1,1,1).multiply(T.getMatrix())),i&&(this.flipVertical=n,d=Zn.buildFromRadian().multiply(h.getMatrix()).scale(1,-1,1).multiply(T.getMatrix())),this.getActors().forEach(m=>{const y=m.actor,w=y.getUserMatrix();p&&Me(w,w,p.getMatrix()),d&&Me(w,w,d.getMatrix()),y.setUserMatrix(w)}),this.getRenderingEngine().render()}getDefaultImageData(){const e=this.getDefaultActor();if(e&&ir(e.actor))return e.actor.getMapper().getInputData()}getDefaultActor(){return this.getActors()[0]}getActors(){return Array.from(this._actors.values())}getActor(e){return this._actors.get(e)}getActorUIDByIndex(e){const n=this.getActors()[e];if(n)return n.uid}getActorByIndex(e){return this.getActors()[e]}setActors(e){this.removeAllActors();const n=!0;this.addActors(e,n)}removeActor(e){const n=this.getActor(e);if(!n){console.warn(`Actor ${e} does not exist for this viewport`);return}this.getRenderer().removeViewProp(n.actor),this._actors.delete(e)}removeActors(e){e.forEach(n=>{this.removeActor(n)})}addActors(e,n=!1){const r=this.getRenderingEngine();if(!r||r.hasBeenDestroyed){console.warn("Viewport::addActors::Rendering engine has not been initialized or has been destroyed");return}e.forEach(a=>this.addActor(a)),this.resetCamera(n,n)}addActor(e){const{uid:n,actor:r}=e,a=this.getRenderingEngine();if(!a||a.hasBeenDestroyed){console.warn(`Cannot add actor UID of ${n} Rendering Engine has been destroyed`);return}if(!n||!r)throw new Error("Actors should have uid and vtk Actor properties");if(this.getActor(n)){console.warn(`Actor ${n} already exists for this viewport`);return}this.getRenderer().addActor(r),this._actors.set(n,Object.assign({},e))}removeAllActors(){this.getRenderer().removeAllViewProps(),this._actors=new Map}resetCameraNoEvent(){this._suppressCameraModifiedEvents=!0,this.resetCamera(),this._suppressCameraModifiedEvents=!1}setCameraNoEvent(e){this._suppressCameraModifiedEvents=!0,this.setCamera(e),this._suppressCameraModifiedEvents=!1}_getViewImageDataIntersections(e,n,r){const a=r[0],i=r[1],o=r[2],s=a*n[0]+i*n[1]+o*n[2],c=e.getBounds(),u=this._getEdges(c),g=[];for(const f of u){const[[l,v,p],[d,h,T]]=f;if(a*(d-l)+i*(h-v)+o*(T-p)===0)continue;const C=lp([l,v,p],[d,h,T],[a,i,o,s]);this._isInBounds(C,c)&&g.push(C)}return g}resetCamera(e=!0,n=!0,r=!0){const a=this.getRenderer(),i=ht(this.getCamera()),o=a.computeVisiblePropBounds(),s=[0,0,0],c=this.getDefaultImageData();if(c){const R=c.getSpacing();o[0]=o[0]+R[0]/2,o[1]=o[1]-R[0]/2,o[2]=o[2]+R[1]/2,o[3]=o[3]-R[1]/2,o[4]=o[4]+R[2]/2,o[5]=o[5]-R[2]/2}const u=this.getVtkActiveCamera(),g=u.getViewPlaneNormal(),f=u.getViewUp();if(u.setViewAngle(90),s[0]=(o[0]+o[1])/2,s[1]=(o[2]+o[3])/2,s[2]=(o[4]+o[5])/2,c){const D=c.getDimensions().map(N=>Math.floor(N/2)),L=[D[0],D[1],D[2]];c.indexToWorld(L,s)}const{widthWorld:l,heightWorld:v}=this._getWorldDistanceViewUpAndViewRight(o,f,g),p=[this.sWidth,this.sHeight],d=l/v,h=p[0]/p[1];let T;if(d<h)T=v/2;else{const R=d/h;T=v*R/2}const C=1.1*T;let m=o[1]-o[0],y=o[3]-o[2],w=o[5]-o[4];m*=m,y*=y,w*=w,T=m+y+w,T=T===0?1:T,T=Math.sqrt(T)*.5;const S=1.1*T;Math.abs(Pr.dot(f,g))>.999&&u.setViewUp(-f[2],f[0],f[1]);const O=e?s:i.focalPoint;u.setFocalPoint(O[0],O[1],O[2]),u.setPosition(O[0]+S*g[0],O[1]+S*g[1],O[2]+S*g[2]),a.resetCameraClippingRange(o),n&&u.setParallelScale(C),u.setPhysicalScale(T),u.setPhysicalTranslation(-O[0],-O[1],-O[2]),u.setClippingRange(-cn.MAXIMUM_RAY_DISTANCE,cn.MAXIMUM_RAY_DISTANCE),(this.flipHorizontal||this.flipVertical)&&this.flip({flipHorizontal:!1,flipVertical:!1}),r&&this.setInitialCamera(this.getCamera());const M={type:"ResetCameraEvent",renderer:a};return a.invokeEvent(M),this.triggerCameraModifiedEventIfNecessary(i,this.getCamera()),!0}setInitialCamera(e){this.initialCamera=e}getPan(){const n=this.getVtkActiveCamera().getFocalPoint(),r=this.canvasToWorld([0,0]),a=this.worldToCanvas(Kt(Ue(),this.initialCamera.focalPoint,r)),i=this.worldToCanvas(Kt(Ue(),n,r));return lc(Ki(),a,i)}setPan(e,n=!1){const r=this.getCamera(),{focalPoint:a,position:i}=r,o=this.canvasToWorld([0,0]),s=lc(Ki(),e,this.getPan());if(Math.abs(s[0])<1&&Math.abs(s[1])<1&&!n)return;const c=Kt(Ue(),this.canvasToWorld(s),o),u=Kt(Ue(),a,c),g=Kt(Ue(),i,c);this.setCamera({...r,focalPoint:u,position:g},n)}getZoom(){const e=this.getVtkActiveCamera(),{parallelScale:n}=this.initialCamera;return n/e.getParallelScale()}setZoom(e,n=!1){const r=this.getCamera(),{parallelScale:a}=this.initialCamera,i=a/e;r.parallelScale===i&&!n||this.setCamera({...r,parallelScale:i},n)}_getFocalPointForViewPlaneReset(e){const{focalPoint:n,viewPlaneNormal:r}=this.getCamera(),a=this._getViewImageDataIntersections(e,n,r);let i=0,o=0,s=0;return a.forEach(([u,g,f])=>{i+=u,o+=g,s+=f}),[i/a.length,o/a.length,s/a.length]}getCanvas(){return this.canvas}getVtkActiveCamera(){return this.getRenderer().getActiveCamera()}getCamera(){const e=this.getVtkActiveCamera();return{viewUp:e.getViewUp(),viewPlaneNormal:e.getViewPlaneNormal(),position:this.applyFlipTx(e.getPosition()),focalPoint:this.applyFlipTx(e.getFocalPoint()),parallelProjection:e.getParallelProjection(),parallelScale:e.getParallelScale(),viewAngle:e.getViewAngle(),flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}setCamera(e,n=!1){var d,h;const r=this.getVtkActiveCamera(),a=ht(this.getCamera()),i=Object.assign({},a,e),{viewUp:o,viewPlaneNormal:s,position:c,focalPoint:u,parallelScale:g,viewAngle:f,flipHorizontal:l,flipVertical:v}=e;(l!==void 0||v!==void 0)&&this.flip({flipHorizontal:l,flipVertical:v}),o!==void 0&&r.setViewUp(o),s!==void 0&&r.setDirectionOfProjection(-s[0],-s[1],-s[2]),c!==void 0&&r.setPosition(...this.applyFlipTx(c)),u!==void 0&&r.setFocalPoint(...this.applyFlipTx(u)),g!==void 0&&r.setParallelScale(g),f!==void 0&&r.setViewAngle(f);const p=this.getDefaultActor();(d=p==null?void 0:p.actor)!=null&&d.isA("vtkVolume")&&this.updateClippingPlanesForActors(i),(h=p==null?void 0:p.actor)!=null&&h.isA("vtkImageSlice")&&this.getRenderer().resetCameraClippingRange(),n&&this.setInitialCamera(i),this.triggerCameraModifiedEventIfNecessary(a,this.getCamera())}triggerCameraModifiedEventIfNecessary(e,n){if(!this._suppressCameraModifiedEvents&&!this.suppressEvents){const r={previousCamera:e,camera:n,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,rotation:this.rotation};Y(this.element,q.CAMERA_MODIFIED,r)}}updateClippingPlanesForActors(e){this.getActors().forEach(r=>{if(!r.actor||!ir(r.actor))return;const i=r.actor.getMapper().getClippingPlanes();let o=cn.MINIMUM_SLAB_THICKNESS;r.slabThickness&&(o=r.slabThickness);const{viewPlaneNormal:s,focalPoint:c}=e;this.setOrientationOfClippingPlanes(i,o,s,c)})}setOrientationOfClippingPlanes(e,n,r,a){if(e.length<2)return;const i=[r[0],r[1],r[2]];Pr.multiplyScalar(i,n),e[0].setNormal(r);const o=[0,0,0];Pr.subtract(a,i,o),e[0].setOrigin(o),e[1].setNormal(-r[0],-r[1],-r[2]);const s=[0,0,0];Pr.add(a,i,s),e[1].setOrigin(s)}_getWorldDistanceViewUpAndViewRight(e,n,r){const a=this._getCorners(e),i=this._getCorners(e);let o=Ue();pn(o,n,r),o=[-o[0],-o[1],-o[2]];let s=Zn.buildFromDegree().identity().rotateFromDirections(n,[1,0,0]);a.forEach(l=>s.apply(l));let c=1/0,u=-1/0;for(let l=0;l<8;l++){const v=a[l][0];v>u&&(u=v),v<c&&(c=v)}s=Zn.buildFromDegree().identity().rotateFromDirections(o,[1,0,0]),i.forEach(l=>s.apply(l));let g=1/0,f=-1/0;for(let l=0;l<8;l++){const v=i[l][0];v>f&&(f=v),v<g&&(g=v)}return{widthWorld:f-g,heightWorld:u-c}}_getCorners(e){return[[e[0],e[2],e[4]],[e[0],e[2],e[5]],[e[0],e[3],e[4]],[e[0],e[3],e[5]],[e[1],e[2],e[4]],[e[1],e[2],e[5]],[e[1],e[3],e[4]],[e[1],e[3],e[5]]]}_isInBounds(e,n){const[r,a,i,o,s,c]=n,[u,g,f]=e;return!(u<r||u>a||g<i||g>o||f<s||f>c)}_getEdges(e){const[n,r,a,i,o,s,c,u]=this._getCorners(e);return[[n,r],[n,o],[n,a],[r,i],[r,s],[a,i],[a,c],[i,u],[o,c],[o,s],[s,u],[c,u]]}}const Xh=QV;var e4={RGB:0,HSV:1,LAB:2,DIVERGING:3},t4={LINEAR:0,LOG10:1},zu={ColorSpace:e4,Scale:t4};function Yg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function n4(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Yg(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Yg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Ut=zu.ColorSpace,Yh=zu.Scale,Si=bu.ScalarMappingTarget,r4=E.vtkDebugMacro,rn=E.vtkErrorMacro,a4=E.vtkWarningMacro;function Zg(t,e){var n=t[0],r=t[1],a=t[2],i=Math.sqrt(n*n+r*r+a*a),o=i>.001?Math.acos(n/i):0,s=o>.001?Math.atan2(a,r):0;e[0]=i,e[1]=o,e[2]=s}function i4(t,e){var n=t[0],r=t[1],a=t[2];e[0]=n*Math.cos(r),e[1]=n*Math.sin(r)*Math.cos(a),e[2]=n*Math.sin(r)*Math.sin(a)}function Jg(t,e){if(t[0]>=e-.1)return t[2];var n=t[1]*Math.sqrt(e*e-t[0]*t[0])/(t[0]*Math.sin(t[1]));return t[2]>-.3*Math.PI?t[2]+n:t[2]-n}function o4(t,e){var n=t-e;for(n<0&&(n=-n);n>=2*Math.PI;)n-=2*Math.PI;return n>Math.PI&&(n=2*Math.PI-n),n}function Qg(t,e,n,r){var a=[],i=[];ar(e,a),ar(n,i);var o=[],s=[];Zg(a,o),Zg(i,s);var c=t;if(o[1]>.05&&s[1]>.05&&o4(o[2],s[2])>.33*Math.PI){var u=Math.max(o[0],s[0]);u=Math.max(88,u),t<.5?(s[0]=u,s[1]=0,s[2]=0,c*=2):(o[0]=u,o[1]=0,o[2]=0,c=2*c-1)}o[1]<.05&&s[1]>.05?o[2]=Jg(s,o[0]):s[1]<.05&&o[1]>.05&&(s[2]=Jg(o,s[0]));var g=[];g[0]=(1-c)*o[0]+c*s[0],g[1]=(1-c)*o[1]+c*s[1],g[2]=(1-c)*o[2]+c*s[2];var f=[];i4(g,f),to(f,r)}function s4(t,e){e.classHierarchy.push("vtkColorTransferFunction"),t.getSize=function(){return e.nodes.length},t.addRGBPoint=function(n,r,a,i){return t.addRGBPointLong(n,r,a,i,.5,0)},t.addRGBPointLong=function(n,r,a,i){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;if(o<0||o>1)return rn("Midpoint outside range [0.0, 1.0]"),-1;if(s<0||s>1)return rn("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(n);var c={x:n,r,g:a,b:i,midpoint:o,sharpness:s};e.nodes.push(c),t.sortAndUpdateRange();for(var u=0;u<e.nodes.length&&e.nodes[u].x!==n;u++);return u<e.nodes.length?u:-1},t.addHSVPoint=function(n,r,a,i){return t.addHSVPointLong(n,r,a,i,.5,0)},t.addHSVPointLong=function(n,r,a,i){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,c=[],u=[r,a,i];return tr(u,c),t.addRGBPoint(n,c[0],c[1],c[2],o,s)},t.setNodes=function(n){if(e.nodes!==n){var r=JSON.stringify(e.nodes);e.nodes=n;var a=JSON.stringify(e.nodes);if(t.sortAndUpdateRange()||r!==a)return t.modified(),!0}return!1},t.sortAndUpdateRange=function(){var n=JSON.stringify(e.nodes);e.nodes.sort(function(i,o){return i.x-o.x});var r=JSON.stringify(e.nodes),a=t.updateRange();return!a&&n!==r?(t.modified(),!0):a},t.updateRange=function(){var n=[2];n[0]=e.mappingRange[0],n[1]=e.mappingRange[1];var r=e.nodes.length;return r?(e.mappingRange[0]=e.nodes[0].x,e.mappingRange[1]=e.nodes[r-1].x):(e.mappingRange[0]=0,e.mappingRange[1]=0),n[0]===e.mappingRange[0]&&n[1]===e.mappingRange[1]?!1:(t.modified(),!0)},t.removePoint=function(n){for(var r=0;r<e.nodes.length&&e.nodes[r].x!==n;r++);var a=r;if(r>=e.nodes.length)return-1;var i=!1;return e.nodes.splice(r,1),(r===0||r===e.nodes.length)&&(i=t.updateRange()),i||t.modified(),a},t.movePoint=function(n,r){if(n!==r){t.removePoint(r);for(var a=0;a<e.nodes.length;a++)if(e.nodes[a].x===n){e.nodes[a].x=r,t.sortAndUpdateRange();break}}},t.removeAllPoints=function(){e.nodes=[],t.sortAndUpdateRange()},t.addRGBSegment=function(n,r,a,i,o,s,c,u){t.sortAndUpdateRange();for(var g=0;g<e.nodes.length;)e.nodes[g].x>=n&&e.nodes[g].x<=o?e.nodes.splice(g,1):g++;t.addRGBPointLong(n,r,a,i,.5,0),t.addRGBPointLong(o,s,c,u,.5,0),t.modified()},t.addHSVSegment=function(n,r,a,i,o,s,c,u){var g=[r,a,i],f=[s,c,u],l=[],v=[];tr(g,l),tr(f,v),t.addRGBSegment(n,l[0],l[1],l[2],o,v[0],v[1],v[2])},t.mapValue=function(n){var r=[];return t.getColor(n,r),[Math.floor(255*r[0]+.5),Math.floor(255*r[1]+.5),Math.floor(255*r[2]+.5),255]},t.getColor=function(n,r){if(e.indexedLookup){var a=t.getSize(),i=t.getAnnotatedValueIndexInternal(n);if(i<0||a===0)t.getNanColor(r);else{var o=[];t.getNodeValue(i%a,o),r[0]=o.r,r[1]=o.g,r[2]=o.b}return}t.getTable(n,n,1,r)},t.getRedValue=function(n){var r=[];return t.getColor(n,r),r[0]},t.getGreenValue=function(n){var r=[];return t.getColor(n,r),r[1]},t.getBlueValue=function(n){var r=[];return t.getColor(n,r),r[2]},t.getTable=function(n,r,a,i){if(no(n)||no(r)){for(var o=0;o<a;o++)i[o*3+0]=e.nanColor[0],i[o*3+1]=e.nanColor[1],i[o*3+2]=e.nanColor[2];return}var s=0,c=e.nodes.length,u=0,g=0,f=0;c!==0&&(u=e.nodes[c-1].r,g=e.nodes[c-1].g,f=e.nodes[c-1].b);var l=0,v=0,p=0,d=[0,0,0],h=[0,0,0],T=0,C=0,m=[],y=e.scale===Yh.LOG10;y&&(y=e.mappingRange[0]>0);var w=0,S=0,O=0;y&&(w=Math.log10(n),S=Math.log10(r));for(var M=0;M<a;M++){var R=3*M;if(a>1?y?(O=w+M/(a-1)*(S-w),l=Math.pow(10,O)):l=n+M/(a-1)*(r-n):y?(O=.5*(w+S),l=Math.pow(10,O)):l=.5*(n+r),e.discretize){var D=e.mappingRange;if(l>=D[0]&&l<=D[1]){var L=e.numberOfValues,N=D[1]-D[0];if(L<=1)l=D[0]+N/2;else{var U=(l-D[0])/N,b=Pv(L*U);l=D[0]+b/(L-1)*N}}}for(;s<c&&l>e.nodes[s].x;)s++,s<c&&(v=e.nodes[s-1].x,p=e.nodes[s].x,y&&(v=Math.log10(v),p=Math.log10(p)),d[0]=e.nodes[s-1].r,h[0]=e.nodes[s].r,d[1]=e.nodes[s-1].g,h[1]=e.nodes[s].g,d[2]=e.nodes[s-1].b,h[2]=e.nodes[s].b,T=e.nodes[s-1].midpoint,C=e.nodes[s-1].sharpness,T<1e-5&&(T=1e-5),T>.99999&&(T=.99999));if(l>e.mappingRange[1])i[R]=0,i[R+1]=0,i[R+2]=0,e.clamping&&(t.getUseAboveRangeColor()?(i[R]=e.aboveRangeColor[0],i[R+1]=e.aboveRangeColor[1],i[R+2]=e.aboveRangeColor[2]):(i[R]=u,i[R+1]=g,i[R+2]=f));else if(l<e.mappingRange[0]||op(l)&&l<0)i[R]=0,i[R+1]=0,i[R+2]=0,e.clamping&&(t.getUseBelowRangeColor()?(i[R]=e.belowRangeColor[0],i[R+1]=e.belowRangeColor[1],i[R+2]=e.belowRangeColor[2]):c>0&&(i[R]=e.nodes[0].r,i[R+1]=e.nodes[0].g,i[R+2]=e.nodes[0].b));else if(s===0&&(Math.abs(l-n)<1e-6||e.discretize))c>0?(i[R]=e.nodes[0].r,i[R+1]=e.nodes[0].g,i[R+2]=e.nodes[0].b):(i[R]=0,i[R+1]=0,i[R+2]=0);else{var G=0;if(y?G=(O-v)/(p-v):G=(l-v)/(p-v),G<T?G=.5*G/T:G=.5+.5*(G-T)/(1-T),C>.99)if(G<.5){i[R]=d[0],i[R+1]=d[1],i[R+2]=d[2];continue}else{i[R]=h[0],i[R+1]=h[1],i[R+2]=h[2];continue}if(C<.01){if(e.colorSpace===Ut.RGB)i[R]=(1-G)*d[0]+G*h[0],i[R+1]=(1-G)*d[1]+G*h[1],i[R+2]=(1-G)*d[2]+G*h[2];else if(e.colorSpace===Ut.HSV){var P=[],z=[];Ea(d,P),Ea(h,z),e.hSVWrap&&(P[0]-z[0]>.5||z[0]-P[0]>.5)&&(P[0]>z[0]?P[0]-=1:z[0]-=1);var F=[];F[0]=(1-G)*P[0]+G*z[0],F[0]<0&&(F[0]+=1),F[1]=(1-G)*P[1]+G*z[1],F[2]=(1-G)*P[2]+G*z[2],tr(F,m),i[R]=m[0],i[R+1]=m[1],i[R+2]=m[2]}else if(e.colorSpace===Ut.LAB){var V=[],B=[];ar(d,V),ar(h,B);var W=[];W[0]=(1-G)*V[0]+G*B[0],W[1]=(1-G)*V[1]+G*B[1],W[2]=(1-G)*V[2]+G*B[2],to(W,m),i[R]=m[0],i[R+1]=m[1],i[R+2]=m[2]}else e.colorSpace===Ut.DIVERGING?(Qg(G,d,h,m),i[R]=m[0],i[R+1]=m[1],i[R+2]=m[2]):rn("ColorSpace set to invalid value.",e.colorSpace);continue}G<.5?G=.5*Math.pow(G*2,1+10*C):G>.5&&(G=1-.5*Math.pow((1-G)*2,1+10*C));var I=G*G,$=I*G,Q=2*$-3*I+1,H=-2*$+3*I,he=$-2*I+G,j=$-I,Ee=void 0,de=void 0;if(e.colorSpace===Ut.RGB)for(var oe=0;oe<3;oe++)Ee=h[oe]-d[oe],de=(1-C)*Ee,i[R+oe]=Q*d[oe]+H*h[oe]+he*de+j*de;else if(e.colorSpace===Ut.HSV){var Z=[],se=[];Ea(d,Z),Ea(h,se),e.hSVWrap&&(Z[0]-se[0]>.5||se[0]-Z[0]>.5)&&(Z[0]>se[0]?Z[0]-=1:se[0]-=1);for(var X=[],ae=0;ae<3;ae++)Ee=se[ae]-Z[ae],de=(1-C)*Ee,X[ae]=Q*Z[ae]+H*se[ae]+he*de+j*de,ae===0&&X[ae]<0&&(X[ae]+=1);tr(X,m),i[R]=m[0],i[R+1]=m[1],i[R+2]=m[2]}else if(e.colorSpace===Ut.LAB){var ge=[],J=[];ar(d,ge),ar(h,J);for(var et=[],tt=0;tt<3;tt++)Ee=J[tt]-ge[tt],de=(1-C)*Ee,et[tt]=Q*ge[tt]+H*J[tt]+he*de+j*de;to(et,m),i[R]=m[0],i[R+1]=m[1],i[R+2]=m[2]}else e.colorSpace===Ut.DIVERGING?(Qg(G,d,h,m),i[R]=m[0],i[R+1]=m[1],i[R+2]=m[2]):rn("ColorSpace set to invalid value.");for(var Ie=0;Ie<3;Ie++)i[R+Ie]=i[R+Ie]<0?0:i[R+Ie],i[R+Ie]=i[R+Ie]>1?1:i[R+Ie]}}},t.getUint8Table=function(n,r,a){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t.getMTime()<=e.buildTime&&e.tableSize===a&&e.tableWithAlpha!==i)return e.table;if(e.nodes.length===0)return rn("Attempting to lookup a value with no points in the function"),e.table;var o=i?4:3;(e.tableSize!==a||e.tableWithAlpha!==i)&&(e.table=new Uint8Array(a*o),e.tableSize=a,e.tableWithAlpha=i);var s=[];t.getTable(n,r,a,s);for(var c=0;c<a;c++)e.table[c*o+0]=Math.floor(s[c*3+0]*255+.5),e.table[c*o+1]=Math.floor(s[c*3+1]*255+.5),e.table[c*o+2]=Math.floor(s[c*3+2]*255+.5),i&&(e.table[c*o+3]=255);return e.buildTime.modified(),e.table},t.buildFunctionFromTable=function(n,r,a,i){var o=0;t.removeAllPoints(),a>1&&(o=(r-n)/(a-1));for(var s=0;s<a;s++){var c={x:n+o*s,r:i[s*3],g:i[s*3+1],b:i[s*3+2],sharpness:0,midpoint:.5};e.nodes.push(c)}t.sortAndUpdateRange()},t.getNodeValue=function(n,r){return n<0||n>=e.nodes.length?(rn("Index out of range!"),-1):(r[0]=e.nodes[n].x,r[1]=e.nodes[n].r,r[2]=e.nodes[n].g,r[3]=e.nodes[n].b,r[4]=e.nodes[n].midpoint,r[5]=e.nodes[n].sharpness,1)},t.setNodeValue=function(n,r){if(n<0||n>=e.nodes.length)return rn("Index out of range!"),-1;var a=e.nodes[n].x;return e.nodes[n].x=r[0],e.nodes[n].r=r[1],e.nodes[n].g=r[2],e.nodes[n].b=r[3],e.nodes[n].midpoint=r[4],e.nodes[n].sharpness=r[5],a!==r[0]?t.sortAndUpdateRange():t.modified(),1},t.getNumberOfAvailableColors=function(){return e.indexedLookup&&t.getSize()?t.getSize():e.tableSize?e.tableSize:16777216},t.getIndexedColor=function(n,r){var a=t.getSize();if(a>0&&n>=0){var i=[];t.getNodeValue(n%a,i);for(var o=0;o<3;++o)r[o]=i[o+1];r[3]=1;return}t.getNanColor(r),r[3]=1},t.fillFromDataPointer=function(n,r){if(!(n<=0||!r)){t.removeAllPoints();for(var a=0;a<n;a++)t.addRGBPoint(r[a*4],r[a*4+1],r[a*4+2],r[a*4+3])}},t.setMappingRange=function(n,r){var a=[n,r],i=t.getRange();if(!(i[1]===a[1]&&i[0]===a[0])){if(a[1]===a[0]){rn("attempt to set zero width color range");return}for(var o=(a[1]-a[0])/(i[1]-i[0]),s=a[0]-i[0]*o,c=0;c<e.nodes.length;++c)e.nodes[c].x=e.nodes[c].x*o+s;e.mappingRange[0]=a[0],e.mappingRange[1]=a[1],t.modified()}},t.adjustRange=function(n){var r=t.getRange(),a=[];r[0]<n[0]?(t.getColor(n[0],a),t.addRGBPoint(n[0],a[0],a[1],a[2])):(t.getColor(r[0],a),t.addRGBPoint(n[0],a[0],a[1],a[2])),r[1]>n[1]?(t.getColor(n[1],a),t.addRGBPoint(n[1],a[0],a[1],a[2])):(t.getColor(r[1],a),t.addRGBPoint(n[1],a[0],a[1],a[2])),t.sortAndUpdateRange();for(var i=0;i<e.nodes.length;)e.nodes[i].x>=n[0]&&e.nodes[i].x<=n[1]?e.nodes.splice(i,1):++i;return 1},t.estimateMinNumberOfSamples=function(n,r){var a=t.findMinimumXDistance();return Math.ceil((r-n)/a)},t.findMinimumXDistance=function(){if(e.nodes.length<2)return-1;for(var n=Number.MAX_VALUE,r=0;r<e.nodes.length-1;r++){var a=e.nodes[r+1].x-e.nodes[r].x;a<n&&(n=a)}return n},t.mapScalarsThroughTable=function(n,r,a,i){if(t.getSize()===0){r4("Transfer Function Has No Points!");return}e.indexedLookup?t.mapDataIndexed(n,r,a,i):t.mapData(n,r,a,i)},t.mapData=function(n,r,a,i){if(t.getSize()===0){a4("Transfer Function Has No Points!");return}var o=Math.floor(t.getAlpha()*255+.5),s=n.getNumberOfTuples(),c=n.getNumberOfComponents(),u=r.getData(),g=n.getData(),f=[];if(a===Si.RGBA)for(var l=0;l<s;l++){var v=g[l*c+i];t.getColor(v,f),u[l*4]=Math.floor(f[0]*255+.5),u[l*4+1]=Math.floor(f[1]*255+.5),u[l*4+2]=Math.floor(f[2]*255+.5),u[l*4+3]=o}if(a===Si.RGB)for(var p=0;p<s;p++){var d=g[p*c+i];t.getColor(d,f),u[p*3]=Math.floor(f[0]*255+.5),u[p*3+1]=Math.floor(f[1]*255+.5),u[p*3+2]=Math.floor(f[2]*255+.5)}if(a===Si.LUMINANCE)for(var h=0;h<s;h++){var T=g[h*c+i];t.getColor(T,f),u[h]=Math.floor(f[0]*76.5+f[1]*150.45+f[2]*28.05+.5)}if(a===Si.LUMINANCE_ALPHA)for(var C=0;C<s;C++){var m=g[C*c+i];t.getColor(m,f),u[C*2]=Math.floor(f[0]*76.5+f[1]*150.45+f[2]*28.05+.5),u[C*2+1]=o}},t.applyColorMap=function(n){if(n.ColorSpace&&(e.colorSpace=Ut[n.ColorSpace.toUpperCase()],e.colorSpace===void 0&&(rn("ColorSpace ".concat(n.ColorSpace," not supported, using RGB instead")),e.colorSpace=Ut.RGB)),n.NanColor)for(e.nanColor=[].concat(n.NanColor);e.nanColor.length<4;)e.nanColor.push(1);if(n.RGBPoints){var r=n.RGBPoints.length;e.nodes=[];for(var a=.5,i=0,o=0;o<r;o+=4)e.nodes.push({x:n.RGBPoints[o],r:n.RGBPoints[o+1],g:n.RGBPoints[o+2],b:n.RGBPoints[o+3],midpoint:a,sharpness:i})}t.sortAndUpdateRange()}}var c4={clamping:!0,colorSpace:Ut.RGB,hSVWrap:!0,scale:Yh.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function Zh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,c4,n),bu.extend(t,e,n),e.table=[],e.nodes=[],e.nanColor=[.5,0,0,1],e.belowRangeColor=[0,0,0,1],e.aboveRangeColor=[1,1,1,1],e.buildTime={},E.obj(e.buildTime),E.get(t,e,["buildTime","mappingRange"]),E.setGet(t,e,["useAboveRangeColor","useBelowRangeColor","colorSpace","discretize","numberOfValues"]),E.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),E.getArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"]),s4(t,e)}var u4=E.newInstance(Zh,"vtkColorTransferFunction"),$u=n4({newInstance:u4,extend:Zh},zu),Ei=E.vtkErrorMacro;function f4(t,e){e.classHierarchy.push("vtkPiecewiseFunction"),t.getSize=function(){return e.nodes.length},t.getType=function(){var n,r=0,a=0;e.nodes.length>0&&(r=e.nodes[0].y);for(var i=1;i<e.nodes.length;i++){if(n=e.nodes[i].y,n!==r)if(n>r)switch(a){case 0:case 1:a=1;break;case 2:default:a=3;break}else switch(a){case 0:case 2:a=2;break;case 1:default:a=3;break}if(r=n,a===3)break}switch(a){case 0:return"Constant";case 1:return"NonDecreasing";case 2:return"NonIncreasing";case 3:default:return"Varied"}},t.getDataPointer=function(){var n=e.nodes.length;if(e.function=null,n>0){e.function=[];for(var r=0;r<n;r++)e.function[2*r]=e.nodes[r].x,e.function[2*r+1]=e.nodes[r].y}return e.function},t.getFirstNonZeroValue=function(){if(e.nodes.length===0)return 0;for(var n=1,r=0,a=0;a<e.nodes.length;a++)if(e.nodes[a].y!==0){n=0;break}return n?r=Number.MAX_VALUE:a>0?r=e.nodes[a-1].x:e.clamping?r=-Number.MAX_VALUE:r=e.nodes[0].x,r},t.getNodeValue=function(n,r){var a=e.nodes.length;return n<0||n>=a?(Ei("Index out of range!"),-1):(r[0]=e.nodes[n].x,r[1]=e.nodes[n].y,r[2]=e.nodes[n].midpoint,r[3]=e.nodes[n].sharpness,1)},t.setNodeValue=function(n,r){var a=e.nodes.length;if(n<0||n>=a)return Ei("Index out of range!"),-1;var i=e.nodes[n].x;return e.nodes[n].x=r[0],e.nodes[n].y=r[1],e.nodes[n].midpoint=r[2],e.nodes[n].sharpness=r[3],i!==r[0]?t.sortAndUpdateRange():t.modified(),1},t.addPoint=function(n,r){return t.addPointLong(n,r,.5,0)},t.addPointLong=function(n,r,a,i){if(a<0||a>1)return Ei("Midpoint outside range [0.0, 1.0]"),-1;if(i<0||i>1)return Ei("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(n);var o={x:n,y:r,midpoint:a,sharpness:i};e.nodes.push(o),t.sortAndUpdateRange();var s;for(s=0;s<e.nodes.length&&e.nodes[s].x!==n;s++);return s<e.nodes.length?s:-1},t.setNodes=function(n){e.nodes!==n&&(e.nodes=n,t.sortAndUpdateRange())},t.sortAndUpdateRange=function(){e.nodes.sort(function(r,a){return r.x-a.x});var n=t.updateRange();n||t.modified()},t.updateRange=function(){var n=e.range.slice(),r=e.nodes.length;return r?(e.range[0]=e.nodes[0].x,e.range[1]=e.nodes[r-1].x):(e.range[0]=0,e.range[1]=0),n[0]===e.range[0]&&n[1]===e.range[1]?!1:(t.modified(),!0)},t.removePoint=function(n){var r;for(r=0;r<e.nodes.length&&e.nodes[r].x!==n;r++);if(r>=e.nodes.length)return-1;var a=r,i=!1;return e.nodes.splice(r,1),(r===0||r===e.nodes.length)&&(i=t.updateRange()),i||t.modified(),a},t.removeAllPoints=function(){e.nodes=[],t.sortAndUpdateRange()},t.addSegment=function(n,r,a,i){t.sortAndUpdateRange();for(var o=0;o<e.nodes.length;)e.nodes[o].x>=n&&e.nodes[o].x<=a?e.nodes.splice(o,1):o++;t.addPoint(n,r,.5,0),t.addPoint(a,i,.5,0)},t.getValue=function(n){var r=[];return t.getTable(n,n,1,r),r[0]},t.adjustRange=function(n){if(n.length<2)return 0;var r=t.getRange();r[0]<n[0]?t.addPoint(n[0],t.getValue(n[0])):t.addPoint(n[0],t.getValue(r[0])),r[1]>n[1]?t.addPoint(n[1],t.getValue(n[1])):t.addPoint(n[1],t.getValue(r[1])),t.sortAndUpdateRange();for(var a=0;a<e.nodes.length;)e.nodes[a].x>=n[0]&&e.nodes[a].x<=n[1]?e.nodes.splice(a,1):++a;return t.sortAndUpdateRange(),1},t.estimateMinNumberOfSamples=function(n,r){var a=t.findMinimumXDistance();return Math.ceil((r-n)/a)},t.findMinimumXDistance=function(){var n=e.nodes.length;if(n<2)return-1;for(var r=e.nodes[1].x-e.nodes[0].x,a=0;a<n-1;a++){var i=e.nodes[a+1].x-e.nodes[a].x;i<r&&(r=i)}return r},t.getTable=function(n,r,a,i){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,s,c=0,u=e.nodes.length,g=0;u!==0&&(g=e.nodes[u-1].y);var f=0,l=0,v=0,p=0,d=0,h=0,T=0;for(s=0;s<a;s++){var C=o*s;for(a>1?f=n+s/(a-1)*(r-n):f=.5*(n+r);c<u&&f>e.nodes[c].x;)c++,c<u&&(l=e.nodes[c-1].x,v=e.nodes[c].x,p=e.nodes[c-1].y,d=e.nodes[c].y,h=e.nodes[c-1].midpoint,T=e.nodes[c-1].sharpness,h<1e-5&&(h=1e-5),h>.99999&&(h=.99999));if(c>=u)i[C]=e.clamping?g:0;else if(c===0)i[C]=e.clamping?e.nodes[0].y:0;else{var m=(f-l)/(v-l);if(m<h?m=.5*m/h:m=.5+.5*(m-h)/(1-h),T>.99)if(m<.5){i[C]=p;continue}else{i[C]=d;continue}if(T<.01){i[C]=(1-m)*p+m*d;continue}m<.5?m=.5*Math.pow(m*2,1+10*T):m>.5&&(m=1-.5*Math.pow((1-m)*2,1+10*T));var y=m*m,w=y*m,S=2*w-3*y+1,O=-2*w+3*y,M=w-2*y+m,R=w-y,D=d-p,L=(1-T)*D;i[C]=S*p+O*d+M*L+R*L;var N=p<d?p:d,U=p>d?p:d;i[C]=i[C]<N?N:i[C],i[C]=i[C]>U?U:i[C]}}}}var g4={range:[0,0],clamping:!0,allowDuplicateScalars:!1};function Jh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,g4,n),E.obj(t,e),e.nodes=[],E.setGet(t,e,["allowDuplicateScalars","clamping"]),E.setArray(t,e,["range"],2),E.getArray(t,e,["range"]),f4(t,e)}var l4=E.newInstance(Jh,"vtkPiecewiseFunction"),Ac={newInstance:l4,extend:Jh};function el(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function v4(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?el(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):el(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Ra=Bu.InterpolationType,p4=Bu.OpacityMode,Rs=E.vtkErrorMacro,Ai=4;function h4(t,e){e.classHierarchy.push("vtkVolumeProperty"),t.getMTime=function(){for(var a=e.mtime,i,o=0;o<Ai;o++)e.componentData[o].colorChannels===1?e.componentData[o].grayTransferFunction&&(i=e.componentData[o].grayTransferFunction.getMTime(),a=a>i?a:i):e.componentData[o].colorChannels===3&&e.componentData[o].rGBTransferFunction&&(i=e.componentData[o].rGBTransferFunction.getMTime(),a=a>i?a:i),e.componentData[o].scalarOpacity&&(i=e.componentData[o].scalarOpacity.getMTime(),a=a>i?a:i),e.componentData[o].gradientOpacity&&(e.componentData[o].disableGradientOpacity||(i=e.componentData[o].gradientOpacity.getMTime(),a=a>i?a:i));return a},t.getColorChannels=function(a){return a<0||a>3?(Rs("Bad index - must be between 0 and 3"),0):e.componentData[a].colorChannels},t.setGrayTransferFunction=function(a,i){var o=!1;return e.componentData[a].grayTransferFunction!==i&&(e.componentData[a].grayTransferFunction=i,o=!0),e.componentData[a].colorChannels!==1&&(e.componentData[a].colorChannels=1,o=!0),o&&t.modified(),o},t.getGrayTransferFunction=function(a){return e.componentData[a].grayTransferFunction===null&&(e.componentData[a].grayTransferFunction=Ac.newInstance(),e.componentData[a].grayTransferFunction.addPoint(0,0),e.componentData[a].grayTransferFunction.addPoint(1024,1),e.componentData[a].colorChannels!==1&&(e.componentData[a].colorChannels=1),t.modified()),e.componentData[a].grayTransferFunction},t.setRGBTransferFunction=function(a,i){var o=!1;return e.componentData[a].rGBTransferFunction!==i&&(e.componentData[a].rGBTransferFunction=i,o=!0),e.componentData[a].colorChannels!==3&&(e.componentData[a].colorChannels=3,o=!0),o&&t.modified(),o},t.getRGBTransferFunction=function(a){return e.componentData[a].rGBTransferFunction===null&&(e.componentData[a].rGBTransferFunction=$u.newInstance(),e.componentData[a].rGBTransferFunction.addRGBPoint(0,0,0,0),e.componentData[a].rGBTransferFunction.addRGBPoint(1024,1,1,1),e.componentData[a].colorChannels!==3&&(e.componentData[a].colorChannels=3),t.modified()),e.componentData[a].rGBTransferFunction},t.setScalarOpacity=function(a,i){return e.componentData[a].scalarOpacity!==i?(e.componentData[a].scalarOpacity=i,t.modified(),!0):!1},t.getScalarOpacity=function(a){return e.componentData[a].scalarOpacity===null&&(e.componentData[a].scalarOpacity=Ac.newInstance(),e.componentData[a].scalarOpacity.addPoint(0,1),e.componentData[a].scalarOpacity.addPoint(1024,1),t.modified()),e.componentData[a].scalarOpacity},t.setComponentWeight=function(a,i){if(a<0||a>=Ai)return Rs("Invalid index"),!1;var o=Math.min(1,Math.max(0,i));return e.componentData[a].componentWeight!==o?(e.componentData[a].componentWeight=o,t.modified(),!0):!1},t.getComponentWeight=function(a){return a<0||a>=Ai?(Rs("Invalid index"),0):e.componentData[a].componentWeight},t.setInterpolationTypeToNearest=function(){return t.setInterpolationType(Ra.NEAREST)},t.setInterpolationTypeToLinear=function(){return t.setInterpolationType(Ra.LINEAR)},t.setInterpolationTypeToFastLinear=function(){return t.setInterpolationType(Ra.FAST_LINEAR)},t.getInterpolationTypeAsString=function(){return E.enumToString(Ra,e.interpolationType)};var n=["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode"];n.forEach(function(a){var i=E.capitalize(a);t["set".concat(i)]=function(o,s){return e.componentData[o]["".concat(a)]!==s?(e.componentData[o]["".concat(a)]=s,t.modified(),!0):!1}});var r=["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode"];r.forEach(function(a){var i=E.capitalize(a);t["get".concat(i)]=function(o){return e.componentData[o]["".concat(a)]}})}var d4={independentComponents:!0,interpolationType:Ra.FAST_LINEAR,shade:0,ambient:.1,diffuse:.7,specular:.2,specularPower:10,useLabelOutline:!1,labelOutlineThickness:1};function Qh(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,d4,n),E.obj(t,e),!e.componentData){e.componentData=[];for(var r=0;r<Ai;++r)e.componentData.push({colorChannels:1,grayTransferFunction:null,rGBTransferFunction:null,scalarOpacity:null,scalarOpacityUnitDistance:1,opacityMode:p4.FRACTIONAL,gradientOpacityMinimumValue:0,gradientOpacityMinimumOpacity:0,gradientOpacityMaximumValue:1,gradientOpacityMaximumOpacity:1,useGradientOpacity:!1,componentWeight:1})}E.setGet(t,e,["independentComponents","interpolationType","shade","ambient","diffuse","specular","specularPower","useLabelOutline","labelOutlineThickness"]),h4(t,e)}var y4=E.newInstance(Qh,"vtkVolumeProperty"),T4=v4({newInstance:y4,extend:Qh},Bu),m4=E.vtkDebugMacro;function C4(t,e){e.classHierarchy.push("vtkVolume"),t.getVolumes=function(){return t},t.makeProperty=T4.newInstance,t.getProperty=function(){return e.property===null&&(e.property=t.makeProperty()),e.property},t.getBounds=function(){if(e.mapper===null)return e.bounds;var n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;var r=function(s){return s[0].map(function(c,u){return s.map(function(g){return g[u]})})};if(!e.mapperBounds||!r([n,e.mapperBounds]).reduce(function(o,s){return o&&s[0]===s[1]},!0)||t.getMTime()>e.boundsMTime.getMTime()){m4("Recomputing bounds..."),e.mapperBounds=n.map(function(o){return o});var a=[];Je.getCorners(n,a),t.computeMatrix();var i=new Float64Array(16);Oe(i,e.matrix),a.forEach(function(o){return ue(o,o,i)}),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map(function(o,s){return s%2===0?a.reduce(function(c,u){return c>u[s/2]?u[s/2]:c},o):a.reduce(function(c,u){return c<u[(s-1)/2]?u[(s-1)/2]:c},o)}),e.boundsMTime.modified()}return e.bounds},t.getMTime=function(){var n=e.mtime;if(e.property!==null){var r=e.property.getMTime();n=r>n?r:n}return n},t.getRedrawMTime=function(){var n=e.mtime;if(e.mapper!==null){var r=e.mapper.getMTime();n=r>n?r:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),r=e.mapper.getInput().getMTime(),n=r>n?r:n)}return n}}var w4={mapper:null,property:null,bounds:[1,-1,1,-1,1,-1]};function ed(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,w4,n),Wu.extend(t,e,n),e.boundsMTime={},E.obj(e.boundsMTime),E.set(t,e,["property"]),E.setGet(t,e,["mapper"]),E.getArray(t,e,["bounds"],6),C4(t,e)}var S4=E.newInstance(ed,"vtkVolume"),E4={newInstance:S4,extend:ed},td=Object.create(null);function ca(t,e){td[t]=e}function x4(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}var O4={};function M4(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,O4,n),e.overrides=td,Cu.extend(t,e,n),x4(t,e)}E.newInstance(M4,"vtkWebGPUViewNodeFactory");function R4(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=function(n,r,a,i){if(ie(n),e.renderable.getParallelProjection()){var o=e.renderable.getParallelScale(),s=o*r,c=o,u=(i[0]-1)*s,g=(i[0]+1)*s,f=(i[1]-1)*c,l=(i[1]+1)*c,v=1/(g-u),p=1/(l-f);n[0]=2*v,n[5]=2*p,n[10]=1/(a[1]-a[0]),n[12]=(g+u)*v,n[13]=(l+f)*p,n[14]=a[1]/(a[1]-a[0])}else{var d=Math.tan(Math.PI*e.renderable.getViewAngle()/360),h,T;e.renderable.getUseHorizontalViewAngle()===!0?(h=a[0]*d,T=a[0]*d/r):(h=a[0]*d*r,T=a[0]*d);var C=(i[0]-1)*h,m=(i[0]+1)*h,y=(i[1]-1)*T,w=(i[1]+1)*T;n[0]=2*a[0]/(m-C),n[5]=2*a[0]/(w-y),n[12]=(C+m)/(m-C),n[13]=(y+w)/(w-y),n[10]=0,n[14]=a[0],n[11]=-1,n[15]=0}},t.convertToOpenGLDepth=function(n){if(e.renderable.getParallelProjection())return 1-n;var r=e.renderable.getClippingRangeByReference(),a=-r[0]/n;return a=(r[0]+r[1])/(r[1]-r[0])+2*r[0]*r[1]/(a*(r[1]-r[0])),.5*a+.5},t.getKeyMatrices=function(n){var r=n.getRenderable(),a=n.getParent();if(Math.max(a.getMTime(),t.getMTime(),r.getMTime(),e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatrixTime.getMTime()){var i=e.renderable.getViewMatrix();Ke(e.keyMatrices.normalMatrix,i),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,ct(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Oe(e.keyMatrices.wcvc,i);var o=n.getStabilizedCenterByReference();je(e.keyMatrices.scvc,e.keyMatrices.wcvc,o);var s=n.getAspectRatio(),c=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,s,c,e.renderable.getWindowCenterByReference()),Me(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),ct(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}var D4={keyMatrixTime:null,keyMatrices:null};function V4(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,D4,n),Qe.extend(t,e,n),e.keyMatrixTime={},E.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},E.setGet(t,e,["keyMatrixTime"]),R4(t,e)}var L4=E.newInstance(V4);ca("vtkCamera",L4);function N4(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=function(n){if(e.bindables.length===n.length){for(var r=!0,a=0;a<e.bindables.length;a++)e.bindables[a]!==n[a]&&(r=!1);if(r)return}e.bindables=n,t.modified()},t.getBindGroupLayout=function(n){for(var r=[],a=0;a<e.bindables.length;a++){var i=e.bindables[a].getBindGroupLayoutEntry();i.binding=a,r.push(i)}return n.getBindGroupLayout({entries:r})},t.getBindGroup=function(n){for(var r=t.getMTime(),a=0;a<e.bindables.length;a++){var i=e.bindables[a].getBindGroupTime().getMTime();r=i>r?i:r}if(r<e.bindGroupTime.getMTime())return e.bindGroup;for(var o=[],s=0;s<e.bindables.length;s++){var c=e.bindables[s].getBindGroupEntry();c.binding=s,o.push(c)}return e.bindGroup=n.getHandle().createBindGroup({layout:t.getBindGroupLayout(n),entries:o,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=function(n){for(var r=[],a=n.getBindGroupLayoutCount(e.label),i=0;i<e.bindables.length;i++)r.push(e.bindables[i].getShaderCode(i,a));return r.join(`
`)}}var F4={device:null,handle:null,label:null};function nd(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,F4,n),E.obj(t,e),e.bindables=[],e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),E.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),E.setGet(t,e,["label","device","arrayInformation"]),N4(t,e)}var _4=E.newInstance(nd),rd={newInstance:_4,extend:nd};function b4(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=function(n,r){e.device=n,e.handle=e.device.getHandle().createShaderModule({code:r.getCode()})}}var k4={device:null,handle:null};function ad(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,k4,n),E.obj(t,e),E.get(t,e,["lastCameraMTime"]),E.setGet(t,e,["device","handle"]),b4(t,e)}var U4=E.newInstance(ad,"vtkWebGPUShaderModule"),B4={newInstance:U4,extend:ad};function G4(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=Array.isArray(n)?n.join(`
`):n,i=!1;t.search(e)!==-1&&(i=!0);var o="";r&&(o="g");var s=new RegExp(e,o),c=t.replace(s,a);return{replace:i,result:c}}function A4(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=function(n){for(var r=n.getType(),a=n.getHash(),i=e._shaderModules.keys(),o=0;o<i.length;o++){var s=i[o];if(s.getHash()===a&&s.getType()===r)return e._shaderModules.get(s)}var c=B4.newInstance();return c.initialize(e.device,n),e._shaderModules.set(n,c),c}}var I4={shaderModules:null,device:null,window:null};function id(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,I4,n),e._shaderModules=new Map,E.obj(t,e),E.setGet(t,e,["device","window"]),A4(t,e)}var P4=E.newInstance(id,"vtkWebGPUShaderCache"),wt={newInstance:P4,extend:id,substitute:G4};function W4(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=function(){return e.shaderDescriptions},t.initialize=function(n,r){e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=r;for(var a=[],i=0;i<e.layouts.length;i++)a.push(e.layouts[i].layout);e.pipelineLayout=n.getHandle().createPipelineLayout({bindGroupLayouts:a}),e.pipelineDescription.layout=e.pipelineLayout;for(var o=0;o<e.shaderDescriptions.length;o++){var s=e.shaderDescriptions[o],c=n.getShaderModule(s);s.getType()==="vertex"&&(e.pipelineDescription.vertex.module=c.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),s.getType()==="fragment"&&(e.pipelineDescription.fragment.module=c.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=n.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=function(n){for(var r=0;r<e.shaderDescriptions.length;r++)if(e.shaderDescriptions[r].getType()===n)return e.shaderDescriptions[r];return null},t.addBindGroupLayout=function(n){!n||e.layouts.push({layout:n.getBindGroupLayout(e.device),label:n.getLabel()})},t.getBindGroupLayout=function(n){return e.layouts[n].layout},t.getBindGroupLayoutCount=function(n){for(var r=0;r<e.layouts.length;r++)if(e.layouts[r].label===n)return r;return 0},t.bindVertexInput=function(n,r){r.bindBuffers(n)},t.addDrawCallback=function(n){e._drawCallbacks.push(n)},t.draw=function(n){for(var r=0;r<e._drawCallbacks.length;r++)e._drawCallbacks[r](n,t)}}var z4={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function od(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,z4,n),Ge(t,e),e.layouts=[],e.shaderDescriptions=[],e._drawCallbacks=[],Et(t,e,["handle","pipelineDescription"]),at(t,e,["device","renderEncoder","topology","vertexState"]),W4(t,e)}var $4=ke(od,"vtkWebGPUPipeline"),j4={newInstance:$4,extend:od};function H4(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=function(n){return e.outputNames.includes(n)},t.addOutput=function(n,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(n),e.outputNames.push(r),e.outputInterpolations.push(a)},t.addBuiltinOutput=function(n,r){e.builtinOutputTypes.push(n),e.builtinOutputNames.push(r)},t.addBuiltinInput=function(n,r){e.builtinInputTypes.push(n),e.builtinInputNames.push(r)},t.replaceShaderCode=function(n,r){var a=[],i=[];if(r&&a.push(r.getShaderCode()),n||e.builtinInputNames.length){var o=[];if(o.push("struct ".concat(e.type,`Input
{`)),n)for(var s=n.getOutputNamesByReference(),c=n.getOutputTypesByReference(),u=n.getOutputInterpolationsByReference(),g=0;g<s.length;g++)u[g]!==void 0?o.push("  @location(".concat(g,") @interpolate(").concat(u[g],") ").concat(s[g]," : ").concat(c[g],",")):o.push("  @location(".concat(g,") ").concat(s[g]," : ").concat(c[g],","));for(var f=0;f<e.builtinInputNames.length;f++)o.push("  ".concat(e.builtinInputNames[f]," : ").concat(e.builtinInputTypes[f],","));o.length>1&&(o.push("};"),i=o,a[a.length-1]+=",",a.push("input: ".concat(e.type,"Input")))}if(a.length&&(e.code=wt.substitute(e.code,"//VTK::IOStructs::Input",a).result),e.outputNames.length+e.builtinOutputNames.length){for(var l=["struct ".concat(e.type,`Output
{`)],v=0;v<e.outputNames.length;v++)e.outputInterpolations[v]!==void 0?l.push("  @location(".concat(v,") @interpolate(").concat(e.outputInterpolations[v],") ").concat(e.outputNames[v]," : ").concat(e.outputTypes[v],",")):l.push("  @location(".concat(v,") ").concat(e.outputNames[v]," : ").concat(e.outputTypes[v],","));for(var p=0;p<e.builtinOutputNames.length;p++)l.push("  ".concat(e.builtinOutputNames[p]," : ").concat(e.builtinOutputTypes[p],","));l.push("};"),i=i.concat(l),e.code=wt.substitute(e.code,"//VTK::IOStructs::Output",["-> ".concat(e.type,"Output")]).result}e.code=wt.substitute(e.code,"//VTK::IOStructs::Dec",i).result}}var K4={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function sd(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,K4,n),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],E.obj(t,e),E.setGet(t,e,["type","hash","code"]),E.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),H4(t,e)}var q4=E.newInstance(sd,"vtkWebGPUShaderDescription"),tl={newInstance:q4,extend:sd},nl={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function X4(t){return!t||t.length<6?0:t in nl?nl[t]:(re("unknown format ".concat(t)),null)}function Y4(t){if(!t||t.length<5)return 0;var e=1;t[t.length-2]==="x"&&(e=t[t.length-1]);var n=e===1?t.length-1:t.length-3,r=Number(t[n]);if(Number.isNaN(r))return re("unknown format ".concat(t)),0;var a=5-r/2;return e*a}function Z4(t){if(!t||t.length<5)return 0;var e=1;return t[t.length-2]==="x"&&(e=t[t.length-1]),e}function J4(t){if(!t||t.length<5)return 0;var e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{re("unknown format ".concat(t));return}var n=t.split("x")[0],r=Number(n[n.length-1]);if(Number.isNaN(r)){re("unknown format ".concat(t));return}return e+=8*(5-r/2),e+="Array",e}function Q4(t){var e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{re("unknown format ".concat(t));return}var n=1;return t[t.length-2]==="x"&&(n=Number(t[t.length-1])),n===4?"vec4<".concat(e,">"):n===3?"vec3<".concat(e,">"):n===2?"vec2<".concat(e,">"):e}function eL(t){if(!t)return 0;var e=1;t.substring(0,3)==="vec"?e=t[3]:t.substring(0,3)==="mat"&&(e=t[3]*t[5]);var n=4;return e*n}function tL(t){if(!!t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";re("unknown format ".concat(t))}}var Un={getDetailsFromTextureFormat:X4,getByteStrideFromBufferFormat:Y4,getNumberOfComponentsFromBufferFormat:Z4,getNativeTypeFromBufferFormat:J4,getShaderTypeFromBufferFormat:Q4,getByteStrideFromShaderFormat:eL,getNativeTypeFromShaderFormat:tL};function nL(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(!e.includes(t[n]))return!1;return!0}function rL(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(n,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",i=r;Array.isArray(i)||(i=[i]);for(var o=0;o<e.inputs.length;o++)if(nL(e.inputs[o].names,i)){if(e.inputs[o].buffer===n)return;e.inputs[o].buffer=n;return}e.inputs.push({buffer:n,stepMode:a,names:i}),e.inputs=e.inputs.sort(function(s,c){return s.names[0]<c.names[0]?-1:s.names[0]>c.names[0]?1:0})},t.removeBufferIfPresent=function(n){for(var r=0;r<e.inputs.length;r++)e.inputs[r].names.includes(n)&&e.inputs.splice(r,1)},t.getBuffer=function(n){for(var r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer;return null},t.hasAttribute=function(n){for(var r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return!0;return!1},t.getAttributeTime=function(n){for(var r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer.getSourceTime();return 0},t.getShaderCode=function(){for(var n="",r=0,a=0;a<e.inputs.length;a++)for(var i=0;i<e.inputs[a].names.length;i++){var o=e.inputs[a].buffer.getArrayInformation()[i],s=Un.getShaderTypeFromBufferFormat(o.format);r>0&&(n+=`,
`),n="".concat(n,"  @location(").concat(r,") ").concat(e.inputs[a].names[i]," : ").concat(s),r++}return n},t.getVertexInputInformation=function(){var n={};if(e.inputs.length){for(var r=[],a=0,i=0;i<e.inputs.length;i++){for(var o=e.inputs[i].buffer,s={arrayStride:o.getStrideInBytes(),stepMode:e.inputs[i].stepMode,attributes:[]},c=o.getArrayInformation(),u=0;u<e.inputs[i].names.length;u++)s.attributes.push({shaderLocation:a,offset:c[u].offset,format:c[u].format}),a++;r.push(s)}n.buffers=r}return n},t.bindBuffers=function(n){for(var r=0;r<e.inputs.length;r++)n.setVertexBuffer(r,e.inputs[r].buffer.getHandle());e.indexBuffer&&n.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=function(){},t.releaseGraphicsResources=function(){e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}var aL={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function cd(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aL,n),Ge(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],at(t,e,["created","device","handle","indexBuffer"]),rL(t,e)}var iL=ke(cd,"vtkWebGPUVertexInput"),oL={newInstance:iL,extend:cd},sL=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,cL=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function uL(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=function(n,r,a){var i=tl.newInstance({type:"vertex",hash:n,code:e.vertexShaderTemplate}),o=tl.newInstance({type:"fragment",hash:n,code:e.fragmentShaderTemplate}),s=r.getShaderDescriptions();s.push(i),s.push(o);for(var c=e.vertexShaderTemplate+e.fragmentShaderTemplate,u=new RegExp("//VTK::[^:]*::","g"),g=c.match(u).filter(function(p,d,h){return h.indexOf(p)===d}),f=g.map(function(p){return"replaceShader".concat(p.substring(7,p.length-2))}),l=0;l<f.length;l++){var v=f[l];v!=="replaceShaderIOStructs"&&e.shaderReplacements.has(v)&&e.shaderReplacements.get(v)(n,r,a)}t.replaceShaderIOStructs(n,r,a)},t.replaceShaderIOStructs=function(n,r,a){var i=r.getShaderDescription("vertex");i.replaceShaderCode(null,a);var o=r.getShaderDescription("fragment");o.replaceShaderCode(i)},t.replaceShaderRenderEncoder=function(n,r,a){e.renderEncoder.replaceShaderCode(r)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=function(n,r,a){if(!!e.WebGPURenderer){var i=e.WebGPURenderer.getBindGroup().getShaderCode(r),o=r.getShaderDescription("vertex"),s=o.getCode();s=wt.substitute(s,"//VTK::Renderer::Dec",[i]).result,o.setCode(s);var c=r.getShaderDescription("fragment");s=c.getCode(),s=wt.substitute(s,"//VTK::Renderer::Dec",[i]).result,c.setCode(s)}},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=function(n,r,a){var i=e.bindGroup.getShaderCode(r),o=r.getShaderDescription("vertex"),s=o.getCode();s=wt.substitute(s,"//VTK::Mapper::Dec",[i]).result,o.setCode(s);var c=r.getShaderDescription("fragment");c.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),s=c.getCode(),s=wt.substitute(s,"//VTK::Mapper::Dec",[i]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=function(n,r,a){var i=r.getShaderDescription("vertex");i.addBuiltinOutput("vec4<f32>","@builtin(position) Position");var o=i.getCode();o=wt.substitute(o,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,i.setCode(o)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=function(n,r,a){var i=r.getShaderDescription("vertex");i.addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=function(n){e.textureViews.includes(n)||e.textureViews.push(n)},t.prepareToDraw=function(n){e.renderEncoder=n,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=function(){},t.updateBuffers=function(){},t.updateBindings=function(){e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=function(){},t.registerDrawCallback=function(n){n.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=function(n){t.prepareToDraw(n),n.setPipeline(e.pipeline),t.draw(n)},t.draw=function(n){var r=n.getBoundPipeline();n.activateBindGroup(e.bindGroup),r.bindVertexInput(n,e.vertexInput);var a=e.vertexInput.getIndexBuffer();a?n.drawIndexed(a.getIndexCount(),e.numberOfInstances,0,0,0):n.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=function(){var n=Ne(e.additionalBindables);e.UBO&&n.push(e.UBO),e.SSBO&&n.push(e.SSBO);for(var r=0;r<e.textureViews.length;r++){n.push(e.textureViews[r]);var a=e.textureViews[r].getSampler();a&&n.push(a)}return n},t.updatePipeline=function(){t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=j4.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&(e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addDrawCallback(e.WebGPURenderer.bindUBO)),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}var fL={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function ud(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fL,n),Qe.extend(t,e,n),e.textureViews=[],e.vertexInput=oL.newInstance(),e.bindGroup=rd.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||cL,e.vertexShaderTemplate=e.vertexShaderTemplate||sL,e.shaderReplacements=new Map,E.get(t,e,["pipeline","vertexInput"]),E.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),uL(t,e)}var gL=E.newInstance(ud,"vtkWebGPUSimpleMapper"),lL={newInstance:gL,extend:ud};function vL(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=function(n,r,a){var i=r.getShaderDescription("vertex");i.addBuiltinOutput("vec4<f32>","@builtin(position) Position");var o=i.getCode();o=wt.substitute(o,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);"]).result,i.setCode(o)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=function(){var n=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(n,["vertexBC"]),e.numberOfVertices=6}}var pL={};function fd(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pL,n),lL.extend(t,e,n),vL(t,e)}var hL=E.newInstance(fd,"vtkWebGPUFullScreenQuad"),gd={newInstance:hL,extend:fd},dL={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},yL={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6},ei={BufferUsage:dL,PrimitiveTypes:yL};function rl(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function TL(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?rl(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rl(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Ds=["getMappedRange","mapAsync","unmap"];function mL(t,e,n,r){var a=r.byteLength,i=t.createBuffer({size:a,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),o=i.getMappedRange(0,a);new Uint8Array(o).set(new Uint8Array(r)),i.unmap();var s=t.createCommandEncoder();s.copyBufferToBuffer(i,0,e,n,a);var c=s.finish(),u=t.queue;u.submit([c]),i.destroy()}function CL(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=function(a,i){e.handle=e.device.getHandle().createBuffer({size:a,usage:i,label:e.label}),e.sizeInBytes=a,e.usage=i},t.write=function(a){mL(e.device.getHandle(),e.handle,0,a.buffer)},t.createAndWrite=function(a,i){e.handle=e.device.getHandle().createBuffer({size:a.byteLength,usage:i,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=a.byteLength,e.usage=i,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(a.buffer)),e.handle.unmap()};for(var n=function(i){t[Ds[i]]=function(){var o;return(o=e.handle)[Ds[i]].apply(o,arguments)}},r=0;r<Ds.length;r++)n(r)}var wL={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function ld(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wL,n),E.obj(t,e),E.get(t,e,["handle","sizeInBytes","usage"]),E.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),CL(t,e)}var SL=E.newInstance(ld),Ic=TL({newInstance:SL,extend:ld},ei);function al(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function EL(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?al(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):al(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var il=ia.Representation,_n=ei.PrimitiveTypes,xL=function(){function t(){Do(this,t),this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}return Vo(t,[{key:"clear",value:function(){this.count=0}},{key:"has",value:function(n){for(var r=0;r<this.count;r++)if(this.keys[r]===n)return!0}},{key:"get",value:function(n){for(var r=0;r<this.count;r++)if(this.keys[r]===n)return this.values[r]}},{key:"set",value:function(n,r){this.count<9&&(this.keys[this.count]=n,this.values[this.count++]=r)}}]),t}();function OL(t){switch(t){case _n.Points:return"points";case _n.Lines:return"lines";case _n.Triangles:case _n.TriangleEdges:return"polys";case _n.TriangleStripEdges:case _n.TriangleStrips:return"strips";default:return""}}function xi(t,e,n){var r=t.pointIdToFlatId[e];return r<0&&(r=t.flatId,t.pointIdToFlatId[e]=r,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=n,t.flatId++),r}function ML(t,e,n){for(var r=t.length,a=0;a<r;a++){var i=t[a];if(n.cellProvokedMap.has(i)){n.ibo[n.iboId++]=n.cellProvokedMap.get(i);for(var o=a+1;o<a+r;o++){i=t[o%r];var s=xi(n,i,e);n.ibo[n.iboId++]=s}return}}for(var c=0;c<r;c++){var u=t[c];if(!n.provokedPointIds[u]){var g=xi(n,u,e);n.provokedPointIds[u]=1,n.cellProvokedMap.set(u,g),n.flatIdToCellId[g]=e,n.ibo[n.iboId++]=g;for(var f=c+1;f<c+r;f++)u=t[f%r],g=xi(n,u,e),n.ibo[n.iboId++]=g;return}}var l=t[0],v=n.flatId;n.cellProvokedMap.set(l,v),n.flatIdToPointId[n.flatId]=l,n.flatIdToCellId[n.flatId]=e,n.flatId++,n.ibo[n.iboId++]=v;for(var p=1;p<r;p++)l=t[p],v=xi(n,l,e),n.ibo[n.iboId++]=v}function RL(t,e,n){var r=t.length;n.iboSize+=r;for(var a=0;a<r;a++){var i=t[a];if(n.cellProvokedMap.has(i))return}for(var o=0;o<r;o++){var s=t[o];if(!n.provokedPointIds[s]){n.provokedPointIds[s]=1,n.cellProvokedMap.set(s,1);return}}n.cellProvokedMap.set(t[0],1),n.extraPoints++}var sn,ol=new Uint32Array(1),Mt=new Uint32Array(2),On=new Uint32Array(3),Vs={anythingToPoints:function(e,n,r,a,i){for(var o=0;o<e;++o)ol[0]=n[r+o],sn(ol,a,i)},linesToWireframe:function(e,n,r,a,i){for(var o=0;o<e-1;++o)Mt[0]=n[r+o],Mt[1]=n[r+o+1],sn(Mt,a,i)},polysToWireframe:function(e,n,r,a,i){if(e>2)for(var o=0;o<e;++o)Mt[0]=n[r+o],Mt[1]=n[r+(o+1)%e],sn(Mt,a,i)},stripsToWireframe:function(e,n,r,a,i){if(e>2){for(var o=0;o<e-1;++o)Mt[0]=n[r+o],Mt[1]=n[r+o+1],sn(Mt,a,i);for(var s=0;s<e-2;s++)Mt[0]=n[r+s],Mt[1]=n[r+s+2],sn(Mt,a,i)}},polysToSurface:function(e,n,r,a,i){for(var o=0;o<e-2;o++)On[0]=n[r],On[1]=n[r+o+1],On[2]=n[r+o+2],sn(On,a,i)},stripsToSurface:function(e,n,r,a,i){for(var o=0;o<e-2;o++)On[0]=n[r+o],On[1]=n[r+o+1+o%2],On[2]=n[r+o+1+(o+1)%2],sn(On,a,i)}};function DL(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=function(n){var r=n.cells,a=n.primitiveType,i=n.representation,o=n.cellOffset,s=r.getData(),c=s.length,u=OL(a),g=n.numberOfPoints,f={provokedPointIds:new Uint8Array(g),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new xL},l=null;i===il.POINTS||a===_n.Points?l=Vs.anythingToPoints:i===il.WIREFRAME||a===_n.Lines?l=Vs["".concat(u,"ToWireframe")]:l=Vs["".concat(u,"ToSurface")],sn=RL;for(var v=o||0,p=0;p<c;)f.cellProvokedMap.clear(),l(s[p],s,p+1,v,f),p+=s[p]+1,v++;g<=65535?f.flatIdToPointId=new Uint16Array(g+f.extraPoints):f.flatIdToPointId=new Uint32Array(g+f.extraPoints),g+f.extraPoints<36863?f.pointIdToFlatId=new Int16Array(g):f.pointIdToFlatId=new Int32Array(g),g+f.extraPoints<=65535?(f.ibo=new Uint16Array(f.iboSize),n.format="uint16"):(f.ibo=new Uint32Array(f.iboSize),n.format="uint32"),v<=65535?f.flatIdToCellId=new Uint16Array(g+f.extraPoints):f.flatIdToCellId=new Uint32Array(g+f.extraPoints),f.pointIdToFlatId.fill(-1),f.provokedPointIds.fill(0),sn=ML,v=o||0;for(var d=0;d<c;)f.cellProvokedMap.clear(),l(s[d],s,d+1,v,f),d+=s[d]+1,v++;delete f.provokedPointIds,delete f.pointIdToFlatId,n.nativeArray=f.ibo,e.flatIdToPointId=f.flatIdToPointId,e.flatIdToCellId=f.flatIdToCellId,e.flatSize=f.flatId,e.indexCount=f.iboId}}var VL={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function vd(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VL,n),Ic.extend(t,e,n),E.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),DL(t,e)}var LL=E.newInstance(vd),NL=EL({newInstance:LL,extend:vd},ei);function sl(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function cl(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?sl(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):sl(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Mn=ei.BufferUsage,FL=re,Xn=Ve.VtkDataTypes,_L={};function bL(t){var e;switch(t.getDataType()){case Xn.UNSIGNED_CHAR:e="uint8";break;case Xn.FLOAT:e="float32";break;case Xn.UNSIGNED_INT:e="uint32";break;case Xn.INT:e="sint32";break;case Xn.DOUBLE:e="float32";break;case Xn.UNSIGNED_SHORT:e="uint16";break;case Xn.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.contains("32")||FL("unsupported x3 type for ".concat(e)),e+="x3";break;case 4:e+="x4";break}return e}function ul(t,e,n,r,a){var i={},o=t.getFlatSize();if(!o)return i;var s=[0,0,0,0];a.shift&&(a.shift.length?s=a.shift:s.fill(a.shift));var c=[1,1,1,1];a.scale&&(a.scale.length?c=a.scale:c.fill(a.scale));var u=Object.prototype.hasOwnProperty.call(a,"packExtra")?a.packExtra:!1,g,f=0,l=n+(u?1:0),v=Lo(r,o*l),p=t.getFlatIdToPointId();a.cellData&&(p=t.getFlatIdToCellId()),n===1?g=function(C){v[f++]=c[0]*e[C]+s[0]}:n===2?g=function(C){v[f++]=c[0]*e[C]+s[0],v[f++]=c[1]*e[C+1]+s[1]}:n===3&&!u?g=function(C){v[f++]=c[0]*e[C]+s[0],v[f++]=c[1]*e[C+1]+s[1],v[f++]=c[2]*e[C+2]+s[2]}:n===3&&u?g=function(C){v[f++]=c[0]*e[C]+s[0],v[f++]=c[1]*e[C+1]+s[1],v[f++]=c[2]*e[C+2]+s[2],v[f++]=c[3]*1+s[3]}:n===4&&(g=function(C){v[f++]=c[0]*e[C]+s[0],v[f++]=c[1]*e[C+1]+s[1],v[f++]=c[2]*e[C+2]+s[2],v[f++]=c[3]*e[C+3]+s[3]});for(var d=0;d<o;d++){var h=n*p[d];g(h)}return i.nativeArray=v,i}function kL(t,e,n,r){var a=[t[r*3]-t[n*3],t[r*3+1]-t[n*3+1],t[r*3+2]-t[n*3+2]],i=[t[e*3]-t[n*3],t[e*3+1]-t[n*3+1],t[e*3+2]-t[n*3+2]],o=[];return Qt(a,i,o),lr(o),o}function UL(t,e){var n=e.getData(),r=t.getData();if(!r||!n)return null;for(var a=new Int8Array(t.getNumberOfCells()*4),i=r.length,o=0,s=0;s<i;){var c=kL(n,r[s+1],r[s+2],r[s+3]);a[o++]=127*c[0],a[o++]=127*c[1],a[o++]=127*c[2],a[o++]=127,s+=r[s]+1}return a}function BL(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function n(r){r.dataArray&&!r.nativeArray&&(r.nativeArray=r.dataArray.getData());var a,i;if(r.usage===Mn.Index&&(a=NL.newInstance({label:r.label}),a.setDevice(e.device),i=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,a.buildIndexBuffer(r),a.createAndWrite(r.nativeArray,i),a.setArrayInformation([{format:r.format}])),a||(a=Ic.newInstance({label:r.label}),a.setDevice(e.device)),r.usage===Mn.UniformArray&&(i=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a.createAndWrite(r.nativeArray,i)),r.usage===Mn.Storage&&(i=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,a.createAndWrite(r.nativeArray,i)),r.usage===Mn.Texture&&(i=GPUBufferUsage.COPY_SRC,a.createAndWrite(r.nativeArray,i)),r.usage===Mn.PointArray){i=GPUBufferUsage.VERTEX;var o=Un.getNativeTypeFromBufferFormat(r.format),s=ul(r.indexBuffer,r.dataArray.getData(),r.dataArray.getNumberOfComponents(),o,{packExtra:r.packExtra,shift:r.shift,scale:r.scale,cellData:r.cellData,cellOffset:r.cellOffset});a.createAndWrite(s.nativeArray,i),a.setStrideInBytes(Un.getByteStrideFromBufferFormat(r.format)),a.setArrayInformation([{offset:0,format:r.format,interpolation:r.cellData?"flat":"perspective"}])}if(r.usage===Mn.NormalsFromPoints){i=GPUBufferUsage.VERTEX;var c=Un.getNativeTypeFromBufferFormat(r.format),u=UL(r.cells,r.dataArray),g=ul(r.indexBuffer,u,4,c,{cellData:!0});a.createAndWrite(g.nativeArray,i),a.setStrideInBytes(Un.getByteStrideFromBufferFormat(r.format)),a.setArrayInformation([{offset:0,format:r.format,interpolation:"flat"}])}return r.usage===Mn.RawVertex&&(i=GPUBufferUsage.VERTEX,a.createAndWrite(r.nativeArray,i),a.setStrideInBytes(Un.getByteStrideFromBufferFormat(r.format)),a.setArrayInformation([{offset:0,format:r.format}])),a.setSourceTime(r.time),a}t.hasBuffer=function(r){return e.device.hasCachedObject(r)},t.getBuffer=function(r){return r.hash?e.device.getCachedObject(r.hash,n,r):n(r)},t.getBufferForPointArray=function(r,a){var i=bL(r),o={hash:"".concat(r.getMTime(),"I").concat(a.getMTime()).concat(i),usage:Mn.PointArray,format:i,dataArray:r,indexBuffer:a};return t.getBuffer(o)},t.getFullScreenQuadBuffer=function(){if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=Ic.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);var r=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(r,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}var GL={device:null,fullScreenQuadBuffer:null};function pd(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GL,n),Ge(t,e),at(t,e,["device"]),BL(t,e)}var AL=ke(pd),IL=cl(cl({newInstance:AL,extend:pd},_L),ei),PL=IL.BufferUsage,Ls=E.vtkErrorMacro;function WL(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=function(n,r){if(e._bufferEntryNames.has(n)){Ls("entry named ".concat(n," already exists"));return}e.sortDirty=!0,e._bufferEntryNames.set(n,e.bufferEntries.length),e.bufferEntries.push({name:n,type:r,sizeInBytes:Un.getByteStrideFromShaderFormat(r),offset:-1,nativeType:Un.getNativeTypeFromShaderFormat(r),packed:!1})},t.sortBufferEntries=function(){if(!!e.sortDirty){for(var n=0,r=[],a=4,i=0;i<e.bufferEntries.length;i++){var o=e.bufferEntries[i];o.sizeInBytes%16===0&&(a=Math.max(16,a)),o.sizeInBytes%8===0&&(a=Math.max(8,a))}for(var s=0;s<e.bufferEntries.length;s++){var c=e.bufferEntries[s];c.packed===!1&&c.sizeInBytes%16===0&&(c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes)}for(var u=0;u<e.bufferEntries.length;u++){var g=e.bufferEntries[u];if(g.packed===!1&&g.sizeInBytes===12)for(var f=0;f<e.bufferEntries.length;f++){var l=e.bufferEntries[f];if(l.packed===!1&&l.sizeInBytes===4){g.packed=!0,g.offset=n,r.push(g),n+=g.sizeInBytes,l.packed=!0,l.offset=n,r.push(l),n+=l.sizeInBytes;break}}}for(var v=0;v<e.bufferEntries.length;v++){var p=e.bufferEntries[v];if(!p.packed&&p.sizeInBytes%8===0)for(var d=v+1;d<e.bufferEntries.length;d++){var h=e.bufferEntries[d];if(!h.packed&&h.sizeInBytes%8===0){p.packed=!0,p.offset=n,r.push(p),n+=p.sizeInBytes,h.packed=!0,h.offset=n,r.push(h),n+=h.sizeInBytes;break}}}for(var T=0;T<e.bufferEntries.length;T++){var C=e.bufferEntries[T];if(!C.packed&&C.sizeInBytes%8===0)for(var m=!1,y=0;!m&&y<e.bufferEntries.length;y++){var w=e.bufferEntries[y];if(!w.packed&&w.sizeInBytes===4)for(var S=y+1;S<e.bufferEntries.length;S++){var O=e.bufferEntries[S];if(!O.packed&&O.sizeInBytes===4){C.packed=!0,C.offset=n,r.push(C),n+=C.sizeInBytes,w.packed=!0,w.offset=n,r.push(w),n+=w.sizeInBytes,O.packed=!0,O.offset=n,r.push(O),n+=O.sizeInBytes,m=!0;break}}}}for(var M=0;M<e.bufferEntries.length;M++){var R=e.bufferEntries[M];!R.packed&&R.sizeInBytes>4&&(R.packed=!0,R.offset=n,r.push(R),n+=R.sizeInBytes)}for(var D=0;D<e.bufferEntries.length;D++){var L=e.bufferEntries[D];L.packed||(L.packed=!0,L.offset=n,r.push(L),n+=L.sizeInBytes)}e.bufferEntries=r,e._bufferEntryNames.clear();for(var N=0;N<e.bufferEntries.length;N++)e._bufferEntryNames.set(e.bufferEntries[N].name,N);e.sizeInBytes=n,e.sizeInBytes=a*Math.ceil(e.sizeInBytes/a),e.sortDirty=!1}},t.sendIfNeeded=function(n){if(!e.UBO){var r={nativeArray:e.Float32Array,usage:PL.UniformArray,label:e.label};e.UBO=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(n.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=function(n){n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[n]=E.newTypedArray(n,e.arrayBuffer))},t.setValue=function(n,r){t.sortBufferEntries();var a=e._bufferEntryNames.get(n);if(a===void 0){Ls("entry named ".concat(n," not found in UBO"));return}var i=e.bufferEntries[a];t.createView(i.nativeType);var o=e[i.nativeType];i.lastValue!==r&&(o[i.offset/o.BYTES_PER_ELEMENT]=r,e.sendDirty=!0),i.lastValue=r},t.setArray=function(n,r){t.sortBufferEntries();var a=e._bufferEntryNames.get(n);if(a===void 0){Ls("entry named ".concat(n," not found in UBO"));return}var i=e.bufferEntries[a];t.createView(i.nativeType);for(var o=e[i.nativeType],s=!1,c=0;c<r.length;c++)(!i.lastValue||i.lastValue[c]!==r[c])&&(o[i.offset/o.BYTES_PER_ELEMENT+c]=r[c],s=!0);s&&(e.sendDirty=!0,i.lastValue=Ne(r))},t.getBindGroupEntry=function(){var n={resource:{buffer:e.UBO.getHandle()}};return n},t.getSendTime=function(){return e.sendTime.getMTime()},t.getShaderCode=function(n,r){t.sortBufferEntries();for(var a=["struct ".concat(e.label,`Struct
{`)],i=0;i<e.bufferEntries.length;i++){var o=e.bufferEntries[i];a.push("  ".concat(o.name,": ").concat(o.type,","))}return a.push(`};
@binding(`.concat(n,") @group(").concat(r,") var<uniform> ").concat(e.label,": ").concat(e.label,"Struct;")),a.join(`
`)}}var zL={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function hd(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zL,n),E.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},E.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,E.get(t,e,["binding","bindGroupTime"]),E.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),WL(t,e)}var $L=E.newInstance(hd,"vtkWebGPUUniformBuffer"),ju={newInstance:$L,extend:hd},jL=Wn,HL=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`;function KL(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=function(n){if(n){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=function(){var n=e.camera.getClippingRange(),r=e.camera.getPositionByReference(),a=e.camera.getDirectionOfProjectionByReference(),i=[],o=[];xo(o,a,.5*(n[0]+n[1])),j0(i,r,o),na(o,i,e.stabilizedCenter);var s=ru(o);s/(n[1]-n[0])>e.recenterThreshold&&(e.stabilizedCenter=i,e.stabilizedTime.modified())},t.updateLights=function(){for(var n=0,r=e.renderable.getLightsByReference(),a=0;a<r.length;++a)r[a].getSwitch()>0&&n++;return n||(jL("No lights are on, creating one."),e.renderable.createLight()),n},t.updateUBO=function(){var n=e.UBO.getSendTime();if(e._parent.getMTime()>n||t.getMTime()>n||e.camera.getMTime()>n||e.renderable.getMTime()>n){var r=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",r.wcvc),e.UBO.setArray("SCPCMatrix",r.scpc),e.UBO.setArray("PCSCMatrix",r.pcsc),e.UBO.setArray("SCVCMatrix",r.scvc),e.UBO.setArray("VCPCMatrix",r.vcpc),e.UBO.setArray("WCVCNormals",r.normalMatrix);var a=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[a.usize,a.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());var i=e._parent.getDevice();e.UBO.sendIfNeeded(i)}},t.scissorAndViewport=function(n){var r=t.getYInvertedTiledSizeAndOrigin();n.getHandle().setViewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize,0,1),n.getHandle().setScissorRect(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)},t.bindUBO=function(n){n.activateBindGroup(e.bindGroup)},t.opaquePass=function(n){n?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=function(){if(!(e.renderable.getTransparent()||e.suppressClear)){var n=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=gd.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(HL);var r=ju.newInstance({label:"mapperUBO"});r.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(r)}var a=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",a),e.clearFSQ.getUBO().sendIfNeeded(n),e.clearFSQ.prepareAndDraw(e.renderEncoder)}},t.translucentPass=function(n){n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=function(n){n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=function(){var n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.convertToOpenGLDepth=function(n){return e.webgpuCamera.convertToOpenGLDepth(n)},t.getYInvertedTiledSizeAndOrigin=function(){var n=t.getTiledSizeAndOrigin(),r=e._parent.getSizeByReference();return n.lowerLeftV=r[1]-n.vsize-n.lowerLeftV,n},t.getTiledSizeAndOrigin=function(){var n=e.renderable.getViewportByReference(),r=[0,0,1,1],a=n[0]-r[0],i=n[1]-r[1],o=e._parent.normalizedDisplayToDisplay(a,i),s=Math.round(o[0]),c=Math.round(o[1]),u=n[2]-r[0],g=n[3]-r[1],f=e._parent.normalizedDisplayToDisplay(u,g),l=Math.round(f[0])-s,v=Math.round(f[1])-c;return l<0&&(l=0),v<0&&(v=0),{usize:l,vsize:v,lowerLeftU:s,lowerLeftV:c}},t.getPropFromID=function(n){for(var r=0;r<e.children.length;r++){var a=e.children[r].getPropID?e.children[r].getPropID():-1;if(a===n)return e.children[r]}return null},t.getStabilizedTime=function(){return e.stabilizedTime.getMTime()},t.releaseGraphicsResources=function(){e.selector!==null&&e.selector.releaseGraphicsResources()}}var qL={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function XL(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qL,n),Qe.extend(t,e,n),e.UBO=ju.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("cameraParallel","u32"),e.bindGroup=rd.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO]),e.tmpMat4=ie(new Float64Array(16)),e.stabilizedTime={},Ge(e.stabilizedTime,{mtime:0}),Et(t,e,["bindGroup","stabilizedTime"]),Ya(t,e,["stabilizedCenter"]),at(t,e,["renderEncoder","selector","suppressClear","UBO"]),KL(t,e)}var YL=ke(XL,"vtkWebGPURenderer");ca("vtkRenderer",YL);function ZL(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=n,e.options.magFilter=r.magFilter?r.magFilter:"nearest",e.options.minFilter=r.minFilter?r.minFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=function(n,r){var a="@binding(".concat(n,") @group(").concat(r,") var ").concat(e.label,": sampler;");return a},t.getBindGroupEntry=function(){var n={resource:e.handle};return n}}var JL={device:null,handle:null,label:null,options:null};function dd(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JL,n),E.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),E.get(t,e,["bindGroupTime","handle","options"]),E.setGet(t,e,["bindGroupLayoutEntry","device","label"]),ZL(t,e)}var QL=E.newInstance(dd),e3={newInstance:QL,extend:dd},fl=Wo.SlicingMode,t3=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Image::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  //VTK::Image::Sample

  // var computedColor: vec4<f32> = vec4<f32>(1.0,0.7, 0.5, 1.0);

//VTK::RenderEncoder::Impl

  return output;
}
`;function n3(t,e,n){var r=e.apply(t);if(r){var a=t.getIndependentComponents();return"".concat(t.getMTime(),"-").concat(a,"-").concat(n)}return"0"}var kt=new Float64Array(16),Rn=new Float64Array(16),Oi=new Float64Array(16),an=new Float64Array(4),ze=new Float64Array(4);function r3(t,e){e.classHierarchy.push("vtkWebGPUImageMapper"),t.buildPass=function(a){if(a){e.WebGPUImageSlice=t.getFirstAncestorOfType("vtkWebGPUImageSlice"),e.WebGPURenderer=e.WebGPUImageSlice.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice();var i=e.WebGPURenderer.getRenderable();e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(i.getActiveCamera())}},t.translucentPass=function(a){a&&t.render()},t.opaquePass=function(a){a&&t.render()},t.render=function(){e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw)},t.computePipelineHash=function(){var a=e.currentInput.getExtent();a[0]===a[1]||a[2]===a[3]||a[4]===a[5]?(e.dimensions=2,e.pipelineHash="img2"):(e.dimensions=3,e.pipelineHash="img3")},t.updateUBO=function(){var a=e.UBO.getSendTime(),i=e.WebGPUImageSlice.getRenderable(),o=i.getMapper();if(t.getMTime()>a||e.renderable.getMTime()>a||i.getProperty().getMTime()>a){var s=o.getInputData(),c=e.WebGPURenderer.getStabilizedCenterByReference();ie(kt),je(kt,kt,c);var u=i.getMatrix();Oe(Rn,u),ct(Rn,Rn),Me(kt,Rn,kt);var g=s.getWorldToIndex();Me(kt,g,kt),ct(Oi,kt);var f=s.getDimensions();ie(Rn),Pn(Rn,Rn,[1/f[0],1/f[1],1/f[2]]),Me(kt,Rn,kt),e.UBO.setArray("SCTCMatrix",kt);var l=e.currentInput.getExtent(),v=e.renderable.getClosestIJKAxis(),p=v.ijkMode,d=e.renderable.getSlice();p!==e.renderable.getSlicingMode()&&(d=e.renderable.getSliceAtPosition(d));var h=2,T=0,C=1;p===fl.I?(h=0,T=1,C=2):p===fl.J&&(h=1,T=2,C=0),an[h]=d,an[T]=l[T*2],an[C]=l[C*2],an[3]=1,rr(an,an,Oi),e.UBO.setArray("Origin",an),ze[h]=d,ze[T]=l[T*2+1],ze[C]=l[C*2],ze[3]=1,rr(ze,ze,Oi),Df(ze,ze,an),ze[3]=1,e.UBO.setArray("Axis1",ze),ze[h]=d,ze[T]=l[T*2],ze[C]=l[C*2+1],ze[3]=1,rr(ze,ze,Oi),Df(ze,ze,an),ze[3]=1,e.UBO.setArray("Axis2",ze);for(var m=[1,1,1,1],y=[0,0,0,0],w=e.textureViews[0],S=w.getTexture().getScale(),O=w.getTexture().getNumberOfComponents(),M=!1,R=0;R<O;R++){var D=i.getProperty().getColorWindow(),L=i.getProperty().getColorLevel(),N=M?R:0,U=i.getProperty().getRGBTransferFunction(N);if(U&&i.getProperty().getUseLookupTableScalarRange()){var b=U.getRange();D=b[1]-b[0],L=.5*(b[1]+b[0])}m[R]=S/D,y[R]=-L/D+.5}e.UBO.setArray("cScale",m),e.UBO.setArray("cShift",y),e.UBO.sendIfNeeded(e.device)}},t.updateLUTImage=function(){var a=e.WebGPUImageSlice.getRenderable().getProperty(),i=t.getTextureViews()[0];i.getTexture().getNumberOfComponents();var o=1,s=n3(a,a.getRGBTransferFunction,o);if(e.colorTextureString!==s){e.numRows=o;var c=new Uint8Array(e.numRows*2*e.rowLength*4),u=a.getRGBTransferFunction();if(u)for(var g=new Float32Array(e.rowLength*3),f=0;f<o;f++){u=a.getRGBTransferFunction(f);var l=u.getRange();u.getTable(l[0],l[1],e.rowLength,g,1);for(var v=0;v<e.rowLength;v++){var p=f*e.rowLength*8+v*4;c[p]=255*g[v*3],c[p+1]=255*g[v*3+1],c[p+2]=255*g[v*3+2],c[p+3]=255;for(var d=0;d<4;d++)c[p+e.rowLength*4+d]=c[p+d]}}else for(var h=0;h<e.rowLength;++h){var T=255*h/(e.rowLength-1);c[h*4]=T,c[h*4+1]=T,c[h*4+2]=T,c[h*4+3]=255;for(var C=0;C<4;C++)c[h*4+e.rowLength*4+C]=c[h*4+C]}{var m={nativeArray:c,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},y=e.device.getTextureManager().getTexture(m),w=y.createView("tfunTexture");e.textureViews[1]=w}e.colorTextureString=s}};var n=t.updateBuffers;t.updateBuffers=function(){n();var a=e.device.getTextureManager().getTextureForImageData(e.currentInput),i=e.textureViews;if(!i[0]||i[0].getTexture()!==a){var o=a.createView("imgTexture");i[0]=o}t.updateLUTImage(),t.updateUBO();var s=e.WebGPUImageSlice.getRenderable().getProperty(),c=s.getInterpolationType()===uo.NEAREST?"nearest":"linear";(!e.clampSampler||c!==e.clampSampler.getOptions().minFilter)&&(e.clampSampler=e3.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:c,magFilter:c}),e.additionalBindables=[e.clampSampler])};var r=t.getShaderReplacements();t.replaceShaderPosition=function(a,i,o){var s=i.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position");var c=s.getCode(),u=["var pos: vec4<f32> = mapperUBO.Origin +","   (vertexBC.x * 0.5 + 0.5) * mapperUBO.Axis1 + (vertexBC.y * 0.5 + 0.5) * mapperUBO.Axis2;","pos.w = 1.0;"];e.dimensions===2?u.push("var tcoord : vec2<f32> = (mapperUBO.SCTCMatrix * pos).xy;"):u.push("var tcoord : vec3<f32> = (mapperUBO.SCTCMatrix * pos).xyz;"),u.push("output.tcoordVS = tcoord;","output.Position = rendererUBO.SCPCMatrix * pos;"),c=wt.substitute(c,"//VTK::Position::Impl",u).result,s.setCode(c)},r.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=function(a,i,o){var s=i.getShaderDescription("vertex");e.dimensions===2?s.addOutput("vec2<f32>","tcoordVS"):s.addOutput("vec3<f32>","tcoordVS")},r.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderImage=function(a,i,o){var s=i.getShaderDescription("fragment"),c=s.getCode();e.dimensions===3?c=wt.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result:c=wt.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result,c=wt.substitute(c,"//VTK::Image::Sample",["    var coord: vec2<f32> =","      vec2<f32>(computedColor.r * mapperUBO.cScale.r + mapperUBO.cShift.r, 0.5);","    computedColor = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);"]).result,s.setCode(c)},r.set("replaceShaderImage",t.replaceShaderImage)}var a3={rowLength:1024};function i3(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,a3,n),gd.extend(t,e,n),t.setFragmentShaderTemplate(t3),e.UBO=ju.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.UBO.addEntry("Origin","vec4<f32>"),e.UBO.addEntry("Axis2","vec4<f32>"),e.UBO.addEntry("Axis1","vec4<f32>"),e.UBO.addEntry("cScale","vec4<f32>"),e.UBO.addEntry("cShift","vec4<f32>"),e.lutBuildTime={},Ge(e.lutBuildTime,{mtime:0}),e.imagemat=ie(new Float64Array(16)),e.imagematinv=ie(new Float64Array(16)),e.VBOBuildTime={},Ge(e.VBOBuildTime),r3(t,e)}var o3=ke(i3,"vtkWebGPUImageMapper");ca("vtkImageMapper",o3);function s3(t,e){e.classHierarchy.push("vtkWebGPUImageSlice"),t.buildPass=function(n){if(!(!e.renderable||!e.renderable.getVisibility())&&n){if(!e.renderable)return;e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseOpaquePass=function(n){!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(function(r){r.traverse(n)}),t.apply(n,!1))},t.traverseTranslucentPass=function(n){!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(function(r){r.traverse(n)}),t.apply(n,!1))},t.queryPass=function(n,r){if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=function(n){return t.getKeyMatrices(n),e.bufferShift},t.getKeyMatrices=function(n){if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();var r=e.renderable.getMatrix(),a=n.getStabilizedCenterByReference();e.bufferShift[0]=r[3]-a[0],e.bufferShift[1]=r[7]-a[1],e.bufferShift[2]=r[11]-a[2],Oe(e.keyMatrices.bcwc,r),e.renderable.getIsIdentity()?ie(e.keyMatrices.normalMatrix):(Ke(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,ct(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Oe(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),je(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),je(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-a[0],-a[1],-a[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}var c3={bufferShift:void 0,keyMatrixTime:null,keyMatrices:null,propID:void 0};function u3(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,c3,n),Qe.extend(t,e,n),e.keyMatricesTime={},Ge(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},e.keyMatrixTime={},Ge(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:ie(new Float64Array(16))},e.bufferShift=[0,0,0,0],Et(t,e,["propID","keyMatricesTime"]),s3(t,e)}var f3=ke(u3,"vtkWebGPUImageSlice");ca("vtkImageSlice",f3);function g3(t,e){e.classHierarchy.push("vtkWebGPUVolume"),t.buildPass=function(a){!e.renderable||!e.renderable.getVisibility()||a&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),e.renderable.getMapper().update())},t.queryPass=function(a,i){if(a){if(!e.renderable||!e.renderable.getVisibility())return;var o=e.renderable.getMapper().getBounds();if(!o||o.length!==6||o[0]>o[1])return;i.addVolume(t)}};var n=new Float64Array(3),r=new Float64Array(3);t.getBoundingCubePoints=function(a,i){var o=e.renderable.getMapper().getInputData();if(!!o)for(var s=o.getExtent(),c=e.renderable.getMatrix(),u=0,g=4;g<6;g++){n[2]=s[g];for(var f=2;f<4;f++){n[1]=s[f];for(var l=0;l<2;l++){n[0]=s[l],o.indexToWorld(n,r);var v=i+u*3;a[v++]=c[0]*r[0]+c[1]*r[1]+c[2]*r[2]+c[3],a[v++]=c[4]*r[0]+c[5]*r[1]+c[6]*r[2]+c[7],a[v++]=c[8]*r[0]+c[9]*r[1]+c[10]*r[2]+c[11],u++}}}},t.getKeyMatrices=function(a){if(Math.max(e.renderable.getMTime(),a.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();var i=e.renderable.getMatrix(),o=a.getStabilizedCenterByReference();Oe(e.keyMatrices.bcwc,i),je(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-o[0],-o[1],-o[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}var l3={propID:void 0,keyMatricesTime:null};function v3(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,l3,n),Qe.extend(t,e,n),e.keyMatricesTime={},E.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={bcwc:new Float64Array(16),bcsc:new Float64Array(16)},E.get(t,e,["propID","keyMatricesTime"]),g3(t,e)}var p3=E.newInstance(v3,"vtkWebGPUVolume");ca("vtkVolume",p3);function h3(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=function(n,r){e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();var a=e.WebGPURenderer.getAspectRatio(),i=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,o=e.WebGPURenderer.getTiledSizeAndOrigin(),s=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),i,a,o,s)}}var d3={};function y3(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,d3,n),Qe.extend(t,e,n),h3(t,e)}var T3=E.newInstance(y3,"vtkWebGPUPixelSpaceCallbackMapper");ca("vtkPixelSpaceCallbackMapper",T3);function yd({dimensions:t,metadata:e,spacing:n,direction:r,origin:a,scalarData:i}){const{PhotometricInterpretation:o}=e;let s=1;o==="RGB"&&(s=3);const c=Ve.newInstance({name:"Pixels",numberOfComponents:s,values:i}),u=Bo.newInstance();return u.setDimensions(t),u.setSpacing(n),u.setDirection(r),u.setOrigin(a),u.getPointData().setScalars(c),u}const Td={};function md(t,e){const n=t.indexOf(":"),r=t.substring(0,n),a=Td[r];if(a==null)throw new Error("loadVolumeFromVolumeLoader: no volume loader for volumeId");const i=a(t,e);return i.promise.then(function(o){Y(ee,q.VOLUME_LOADED,{volume:o})},function(o){const s={volumeId:t,error:o};Y(ee,q.VOLUME_LOADED_FAILED,s)}),i}function Cd(t,e={imageIds:[]}){if(t===void 0)throw new Error("loadVolume: parameter volumeId must not be undefined");let n=be.getVolumeLoadObject(t);return n!==void 0?n.promise:(n=md(t,e),n.promise.then(r=>(r.imageData=yd(r),r)))}async function m3(t,e){if(t===void 0)throw new Error("createAndCacheVolume: parameter volumeId must not be undefined");let n=be.getVolumeLoadObject(t);return n!==void 0||(n=md(t,e),n.promise.then(r=>{r.imageData=yd(r)}),be.putVolumeLoadObject(t,n).catch(r=>{throw r})),n.promise}function C3(t,e){Td[t]=e}function w3(t,e){const n=WV.newInstance();n.setInputData(t);const r=t.getSpacing(),a=(r[0]+r[1]+r[2])/6;return n.setMaximumSamplesPerRay(4e3),n.setSampleDistance(a),n.setScalarTexture(e),n}const S3=0,E3=qt.Prefetch;async function x3(t,e){let n=M3(e);if(n||(n=await R3(e)),!n||n.lower===void 0||n.upper===void 0)throw new Error("Could not get VOI from metadata, nor from the min max of the image middle slice");n=O3(e,n);const{lower:r,upper:a}=n;t.getProperty().getRGBTransferFunction(0).setMappingRange(r,a)}function O3(t,e){const n=t.imageIds,r=Math.floor(n.length/2),a=n[r];return(He("generalSeriesModule",a)||{}).modality==="PT"&&t.isPrescaled?{lower:0,upper:5}:e}function M3(t){const{imageIds:e}=t,n=Math.floor(e.length/2),r=e[n],a=He("voiLutModule",r);if(a&&a.windowWidth&&a.windowCenter){const{windowWidth:i,windowCenter:o}=a,s={windowWidth:Array.isArray(i)?i[0]:i,windowCenter:Array.isArray(o)?o[0]:o},{lower:c,upper:u}=Pa(Number(s.windowWidth),Number(s.windowCenter));return{lower:c,upper:u}}}async function R3(t){const{scalarData:e,imageIds:n}=t,r=Math.floor(n.length/2),a=t.imageIds[r],i=He("generalSeriesModule",a)||{},{modality:o}=i,s=He("modalityLutModule",a)||{},c=n.length,u=e.byteLength/c,g=e.length/c,f=e.BYTES_PER_ELEMENT;let l;if(e instanceof Uint8Array)l="Uint8Array";else if(e instanceof Float32Array)l="Float32Array";else throw new Error("Unsupported array type");const v={rescaleSlope:s.rescaleSlope,rescaleIntercept:s.rescaleIntercept,modality:o};let p;if(o==="PT"){const w=He("scalingModule",a);w&&(p={...v,suvbw:w.suvbw})}const d=r*u,h={targetBuffer:{arrayBuffer:e.buffer,offset:d,length:g,type:l},priority:S3,requestType:E3,preScale:{enabled:!0,scalingParameters:p}},T=await Xi(a,h);let C;T?C=T.getPixelData():C=D3(t,d,f,g);const{min:m,max:y}=L0(C);return{lower:m,upper:y}}function D3(t,e,n,r){const{scalarData:a}=t,{volumeBuffer:i}=a;a.BYTES_PER_ELEMENT!==n&&(e*=a.BYTES_PER_ELEMENT/n);const o=a.constructor,s=new o(r),c=new o(i,e,r);return s.set(c),s}async function gl(t,e,n,r=!1){const{volumeId:a,callback:i,blendMode:o}=t,s=await Cd(a);if(!s)throw new Error(`imageVolume with id: ${s.volumeId} does not exist`);const{imageData:c,vtkOpenGLTexture:u}=s,g=w3(c,u);o&&g.setBlendMode(o);const f=E4.newInstance();return f.setMapper(g),s.imageIds&&await x3(f,s),i&&i({volumeActor:f,volumeId:a}),r||V3(e,n,f,a),f}function V3(t,e,n,r){const a=n.getProperty().getRGBTransferFunction(0).getRange(),i={viewportId:e,range:{lower:a[0],upper:a[1]},volumeId:r};Y(t,q.VOI_MODIFIED,i)}const wd="viewport-element",Sd="cornerstone-canvas";function L3(t){const e=document.createElement("canvas");return e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.classList.add(Sd),t.appendChild(e),e}function N3(t){const e=document.createElement("div");return e.style.position="relative",e.style.width="100%",e.style.height="100%",e.classList.add(wd),t.appendChild(e),e}function Mi(t){const e=`canvas.${Sd}`,n=`div.${wd}`,r=t.querySelector(n)||N3(t);return r.querySelector(e)||L3(r)}async function Ed(t,e,n,r=!1,a=!1){n.forEach(o=>{const s=t.getViewport(o);if(!s)throw new Error(`Viewport with Id ${o} does not exist`);if(!(s instanceof Cn))throw new Error("addVolumesToViewports only supports VolumeViewport")});const i=n.map(async o=>{await t.getViewport(o).addVolumes(e,r,a)});await Promise.all(i)}const zr={};function F3(t){zr[t]!==void 0&&delete zr[t]}function _3(t){const{renderingEngineId:e,viewportId:n}=t.detail,a=wn(e).getViewport(n);if(!(a instanceof Cn))throw new Error("volumeNewImageEventDispatcher: viewport is not a VolumeViewport");zr[a.id]===void 0&&(zr[a.id]=0);const{numberOfSlices:i,imageIndex:o}=fp(a);if(zr[a.id]===o)return;zr[a.id]=o;const s={imageIndex:o,viewportId:n,renderingEngineId:e,numberOfSlices:i};Y(a.element,q.VOLUME_NEW_IMAGE,s)}function Ns(t,e,n,r){return new(n||(n=Promise))(function(a,i){function o(u){try{c(r.next(u))}catch(g){i(g)}}function s(u){try{c(r.throw(u))}catch(g){i(g)}}function c(u){var g;u.done?a(u.value):(g=u.value,g instanceof n?g:new n(function(f){f(g)})).then(o,s)}c((r=r.apply(t,e||[])).next())})}const b3=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function ll(t){return t=t.toLowerCase().replace(/^angle ?\((.+)\)*$/,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const xd=typeof window>"u",bn=(()=>{if(xd)return;const{userAgent:t,platform:e,maxTouchPoints:n}=window.navigator,r=/(iphone|ipod|ipad)/i.test(t),a=e==="iPad"||e==="MacIntel"&&n>0&&!window.MSStream;return{isIpad:a,isMobile:/android/i.test(t)||r||a,isSafari12:/Version\/12.+Safari/.test(t)}})();function k3(t,e,n){if(!n)return[e];const r=function(u){const g=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,f=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,l=u.createShader(35633),v=u.createShader(35632),p=u.createProgram();if(!(v&&l&&p))return;u.shaderSource(l,g),u.shaderSource(v,f),u.compileShader(l),u.compileShader(v),u.attachShader(p,l),u.attachShader(p,v),u.linkProgram(p),u.detachShader(p,l),u.detachShader(p,v),u.deleteShader(l),u.deleteShader(v),u.useProgram(p);const d=u.createBuffer();u.bindBuffer(34962,d),u.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const h=u.getAttribLocation(p,"aPosition");u.vertexAttribPointer(h,3,5126,!1,0,0),u.enableVertexAttribArray(h),u.clearColor(1,1,1,1),u.clear(16384),u.viewport(0,0,1,1),u.drawArrays(4,0,3);const T=new Uint8Array(4);return u.readPixels(0,0,1,1,6408,5121,T),u.deleteProgram(p),u.deleteBuffer(d),T.join("")}(t),a="801621810",i="8016218135",o="80162181161",s=bn!=null&&bn.isIpad?[["a7",o,12],["a8",i,15],["a8x",i,15],["a9",i,15],["a9x",i,15],["a10",i,15],["a10x",i,15],["a12",a,15],["a12x",a,15],["a12z",a,15],["a14",a,15],["m1",a,15]]:[["a7",o,12],["a8",i,12],["a9",i,15],["a10",i,15],["a11",a,15],["a12",a,15],["a13",a,15],["a14",a,15]];let c;return r==="80162181255"?c=s.filter(([,,u])=>u>=14):(c=s.filter(([,u])=>u===r),c.length||(c=s)),c.map(([u])=>`apple ${u} gpu`)}const Fs=[],vl=[];function U3(t,e){if(t===e)return 0;const n=t;t.length>e.length&&(t=e,e=n);let r=t.length,a=e.length;for(;r>0&&t.charCodeAt(~-r)===e.charCodeAt(~-a);)r--,a--;let i,o=0;for(;o<r&&t.charCodeAt(o)===e.charCodeAt(o);)o++;if(r-=o,a-=o,r===0)return a;let s,c,u=0,g=0,f=0;for(;g<r;)vl[g]=t.charCodeAt(o+g),Fs[g]=++g;for(;f<a;)for(i=e.charCodeAt(o+f),s=f++,u=f,g=0;g<r;g++)c=i===vl[g]?s:s+1,s=Fs[g],u=Fs[g]=s>u?c>u?u+1:c:c>s?s+1:c;return u}function B3(t){return t!=null}class pl extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}const G3=({mobileTiers:t=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:n={},glContext:r,failIfMajorPerformanceCaveat:a=!1,benchmarksURL:i="https://unpkg.com/detect-gpu@4.0.39/dist/benchmarks"}={})=>Ns(void 0,void 0,void 0,function*(){const o={};if(xd)return{tier:0,type:"SSR"};const{isIpad:s=!!(bn!=null&&bn.isIpad),isMobile:c=!!(bn!=null&&bn.isMobile),screenSize:u=window.screen,loadBenchmarks:g=w=>Ns(void 0,void 0,void 0,function*(){const S=yield fetch(`${i}/${w}`).then(O=>O.json());if(parseInt(S.shift().split(".")[0],10)<4)throw new pl("Detect GPU benchmark data is out of date. Please update to version 4x");return S})}=n;let{renderer:f}=n;const l=(w,S,O,M,R)=>({device:R,fps:M,gpu:O,isMobile:c,tier:w,type:S});let v,p="";if(f)f=ll(f),v=[f];else{const w=r||function(O,M=!1){const R={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:M,powerPreference:"high-performance",stencil:!1};O&&delete R.powerPreference;const D=window.document.createElement("canvas"),L=D.getContext("webgl",R)||D.getContext("experimental-webgl",R);return L!=null?L:void 0}(bn==null?void 0:bn.isSafari12,a);if(!w)return l(0,"WEBGL_UNSUPPORTED");const S=w.getExtension("WEBGL_debug_renderer_info");if(S&&(f=w.getParameter(S.UNMASKED_RENDERER_WEBGL)),!f)return l(1,"FALLBACK");p=f,f=ll(f),v=function(O,M,R){return M==="apple gpu"?k3(O,M,R):[M]}(w,f,c)}const d=(yield Promise.all(v.map(function(w){var S;return Ns(this,void 0,void 0,function*(){const O=(I=>{const $=c?["adreno","apple","mali-t","mali","nvidia","powervr"]:["intel","apple","amd","radeon","nvidia","geforce"];for(const Q of $)if(I.includes(Q))return Q})(w);if(!O)return;const M=`${c?"m":"d"}-${O}${s?"-ipad":""}.json`,R=o[M]=(S=o[M])!==null&&S!==void 0?S:g(M);let D;try{D=yield R}catch(I){if(I instanceof pl)throw I;return}const L=function(I){var $;const Q=(I=I.replace(/\([^)]+\)/,"")).match(/\d+/)||I.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return($=Q==null?void 0:Q.join("").replace(/\W|amd/g,""))!==null&&$!==void 0?$:""}(w);let N=D.filter(([,I])=>I===L);N.length||(N=D.filter(([I])=>I.includes(w)));const U=N.length;if(U===0)return;let b,[G,,,P]=U>1?N.map(I=>[I,U3(w,I[0])]).sort(([,I],[,$])=>I-$)[0][0]:N[0],z=Number.MAX_VALUE;const{devicePixelRatio:F}=window,V=u.width*F*u.height*F;for(const I of P){const[$,Q]=I,H=$*Q,he=Math.abs(V-H);he<z&&(z=he,b=I)}if(!b)return;const[,,B,W]=b;return[z,B,G,W]})}))).filter(B3).sort(([w=Number.MAX_VALUE,S],[O=Number.MAX_VALUE,M])=>w===O?S-M:w-O);if(!d.length){const w=b3.find(S=>f.includes(S));return w?l(0,"BLOCKLISTED",w):l(1,"FALLBACK",`${f} (${p})`)}const[,h,T,C]=d[0];if(h===-1)return l(0,"BLOCKLISTED",T,h,C);const m=c?t:e;let y=0;for(let w=0;w<m.length;w++)h>=m[w]&&(y=w);return l(y,"BENCHMARK",T,h,C)});let Da=!1,Pc=!1;function A3(){const t=document.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl");return!!(e&&e instanceof WebGLRenderingContext)}async function I3(t={}){if(Da)return Da;if(!A3())Pc=!0,console.log("CornerstoneRender: GPU not detected, using CPU rendering");else{const n=await G3();console.log("CornerstoneRender: Using detect-gpu to get the GPU benchmark:",n),n.tier<1?(console.log("CornerstoneRender: GPU is not powerful enough, using CPU rendering"),Pc=!0):console.log("CornerstoneRender: using GPU rendering")}return Da=!0,Da}function lo(){return Pc}function P3(){return Da}function Od(t){const e=Object.getOwnPropertyNames(t);for(const n of e){const r=t[n];r&&typeof r=="object"&&Od(r)}return Object.freeze(t)}const W3=.001,Ir={axial:{viewPlaneNormal:[0,0,-1],viewUp:[0,-1,0]},sagittal:{viewPlaneNormal:[1,0,0],viewUp:[0,0,1]},coronal:{viewPlaneNormal:[0,1,0],viewUp:[0,0,1]}};Od(Ir);class z3 extends Xh{constructor(e){if(super(e),this.useCPURendering=!1,this._useAcquisitionPlaneForViewPlane=!1,this.getFrameOfReferenceUID=()=>this._FrameOfReferenceUID,this.canvasToWorld=i=>{const o=this.getVtkActiveCamera();o.setIsPerformingCoordinateTransformation(!0);const s=this.getRenderer(),u=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),g=u.getSize(),f=window.devicePixelRatio||1,l=[i[0]*f,i[1]*f],v=[l[0]+this.sx,l[1]+this.sy];v[1]=g[1]-v[1];let p=u.displayToWorld(v[0],v[1],0,s);return o.setIsPerformingCoordinateTransformation(!1),p=this.applyFlipTx(p),p},this.worldToCanvas=i=>{const o=this.getVtkActiveCamera();o.setIsPerformingCoordinateTransformation(!0);const s=this.getRenderer(),u=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),g=u.getSize(),f=u.worldToDisplay(...this.applyFlipTx(i),s);f[1]=g[1]-f[1];const l=[f[0]-this.sx,f[1]-this.sy],v=window.devicePixelRatio||1,p=[l[0]/v,l[1]/v];return o.setIsPerformingCoordinateTransformation(!1),p},this.getCurrentImageIdIndex=()=>this._getImageIdIndex(),this.hasImageURI=i=>this.getActors().filter(({actor:s})=>s.isA("vtkVolume")).some(({uid:s})=>{const c=be.getVolume(s);return!c||!c.imageIds?!1:c.imageIds.map(Xt).includes(i)}),this.getCurrentImageId=()=>{const i=this._getImageIdIndex();if(!i)return;const{uid:o,actor:s}=this.getDefaultActor();if(!s.isA("vtkVolume"))return;const c=be.getVolume(o);return c?c.imageIds[i]:void 0},this._getImageIdIndex=()=>{const{viewPlaneNormal:i,focalPoint:o}=this.getCamera(),{direction:s,origin:c,spacing:u}=this.getImageData(),g=s.slice(s.length-3);if(Math.abs(g[0]*i[0]+g[1]*i[1]+g[2]*i[2])-1>W3)return;const l=u[2],v=Ue();na(v,o,c);const p=ut(v,i);return Math.round(Math.abs(p)/l)},this.useCPURendering=lo(),this.useCPURendering)throw new Error("VolumeViewports cannot be used whilst CPU Fallback Rendering is enabled.");const n=this.getRenderer(),r=YV.newInstance();switch(n.setActiveCamera(r),this.type){case It.ORTHOGRAPHIC:r.setParallelProjection(!0);break;case It.PERSPECTIVE:r.setParallelProjection(!1);break;default:throw new Error(`Unrecognized viewport type: ${this.type}`)}this.initializeVolumeNewImageEventDispatcher();const{orientation:a}=this.options;if(a){const{viewPlaneNormal:i,viewUp:o}=this._getOrientationVectors(a);r.setDirectionOfProjection(-i[0],-i[1],-i[2]),r.setViewUpFrom(o),this.resetCamera();return}this._useAcquisitionPlaneForViewPlane=!0}static get useCustomRenderingPipeline(){return!1}initializeVolumeNewImageEventDispatcher(){const e=r.bind(this),n=a.bind(this);function r(i){!this.getImageData()||_3(i)}function a(i){const{viewportId:o}=i.detail;o===this.id&&(this.element.removeEventListener(q.CAMERA_MODIFIED,e),ee.removeEventListener(q.ELEMENT_DISABLED,n),F3(o))}this.element.removeEventListener(q.CAMERA_MODIFIED,e),this.element.addEventListener(q.CAMERA_MODIFIED,e),ee.addEventListener(q.ELEMENT_DISABLED,n)}setProperties({voiRange:e}={},n,r=!1){if(n!==void 0&&!this.getActor(n))return;const a=this.getActors();if(!a.length)return;let i;if(n){const c=a.find(u=>u.uid===n);i=c==null?void 0:c.actor}if(i||(i=a[0].actor,n=a[0].uid),!e)return;const{lower:o,upper:s}=e;if(i.getProperty().getRGBTransferFunction(0).setRange(o,s),!r){const c={viewportId:this.id,range:e,volumeId:n};Y(this.element,q.VOI_MODIFIED,c)}}async setVolumes(e,n=!1,r=!1){const a=be.getVolume(e[0].volumeId);if(!a)throw new Error(`imageVolume with id: ${a.volumeId} does not exist`);this._useAcquisitionPlaneForViewPlane&&(this._setViewPlaneToAcquisitionPlane(a),this._useAcquisitionPlaneForViewPlane=!1);const i=a.metadata.FrameOfReferenceUID;await this._isValidVolumeInputArray(e,i),this._FrameOfReferenceUID=i;const o=[];for(let s=0;s<e.length;s++){const{volumeId:c,actorUID:u,slabThickness:g}=e[s],f=await gl(e[s],this.element,this.id,r),l=u||c;o.push({uid:l,actor:f,slabThickness:g})}this._setVolumeActors(o),n&&this.render()}async addVolumes(e,n=!1,r=!1){const a=be.getVolume(e[0].volumeId);if(!a)throw new Error(`imageVolume with id: ${a.volumeId} does not exist`);this._useAcquisitionPlaneForViewPlane&&(this._setViewPlaneToAcquisitionPlane(a),this._useAcquisitionPlaneForViewPlane=!1);const i=[];await this._isValidVolumeInputArray(e,this._FrameOfReferenceUID);for(let o=0;o<e.length;o++){const{volumeId:s,visibility:c,actorUID:u,slabThickness:g}=e[o],f=await gl(e[o],this.element,this.id,r);c===!1&&f.setVisibility(!1);const l=u||s;i.push({uid:l,actor:f,slabThickness:g})}this.addActors(i),n&&this.render()}removeVolumeActors(e,n=!1){this.removeActors(e),n&&this.render()}setOrientation(e,n=!0){let r,a;if(Object.keys(Ir).includes(e))({viewPlaneNormal:r,viewUp:a}=Ir[e]);else if(e==="acquisition")({viewPlaneNormal:r,viewUp:a}=this._getAcquisitionPlaneOrientation());else throw new Error(`Invalid orientation: ${e}. Use Enums.OrientationAxis instead.`);this.setCamera({viewPlaneNormal:r,viewUp:a}),this.resetCamera(),n&&this.render()}_getOrientationVectors(e){if(typeof e=="object"){if(e.viewPlaneNormal&&e.viewUp)return e;throw new Error("Invalid orientation object. It must contain viewPlaneNormal and viewUp")}else{if(typeof e=="string"&&Object.keys(Ir).includes(e))return Ir[e];if(e==="acquisition")return this._getAcquisitionPlaneOrientation();throw new Error(`Invalid orientation: ${e}. Valid orientations are: ${Object.keys(Ir).join(", ")}`)}}_getAcquisitionPlaneOrientation(){const e=this.getDefaultActor();if(!e)throw new Error("Cannot get acquisition plane orientation, no actor in viewport");const n=e.uid,r=be.getVolume(n);if(!r)throw new Error(`imageVolume with id: ${n} does not exist in cache`);const{direction:a}=r,i=a.slice(6,9).map(s=>-s),o=a.slice(3,6).map(s=>-s);return{viewPlaneNormal:i,viewUp:o}}_setViewPlaneToAcquisitionPlane(e){let n,r;if(e){const{direction:a}=e;n=a.slice(6,9).map(i=>-i),r=a.slice(3,6).map(i=>-i)}else({viewPlaneNormal:n,viewUp:r}=this._getAcquisitionPlaneOrientation());this.setCamera({viewPlaneNormal:n,viewUp:r}),this.resetCamera()}async _isValidVolumeInputArray(e,n){const r=e.length;for(let a=1;a<r;a++){const i=e[a],o=await Cd(i.volumeId);if(!o)throw new Error(`imageVolume with id: ${o.volumeId} does not exist`);if(n!==o.metadata.FrameOfReferenceUID)throw new Error(`Volumes being added to viewport ${this.id} do not share the same FrameOfReferenceUID. This is not yet supported`)}return!0}getIntensityFromWorld(e){const{actor:n,uid:r}=this.getDefaultActor();if(!n.isA("vtkVolume"))return;const a=n.getMapper().getInputData(),i=be.getVolume(r),{dimensions:o}=i,s=J0(a,e),c=s[2]*o[0]*o[1]+s[1]*o[0]+s[0];return i.scalarData[c]}getBounds(){return this.getRenderer().computeVisiblePropBounds()}flip(e){super.flip(e)}resetCamera(e=!0,n=!0){super.resetCamera(e,n);const r=this.getVtkActiveCamera();r.getParallelProjection()?r.setClippingRange(-cn.MAXIMUM_RAY_DISTANCE,cn.MAXIMUM_RAY_DISTANCE):r.setClippingRange(cn.MINIMUM_SLAB_THICKNESS,cn.MAXIMUM_RAY_DISTANCE);const a=r.getViewPlaneNormal(),i=r.getFocalPoint();return this.getActors().forEach(s=>{if(!s.actor||!s.actor.isA("vtkVolume"))return;const c=s.actor.getMapper();if(c.getClippingPlanes().length===0){const g=Tn.newInstance(),f=Tn.newInstance(),l=[g,f];let v=cn.MINIMUM_SLAB_THICKNESS;s.slabThickness&&(v=s.slabThickness),this.setOrientationOfClippingPlanes(l,v,a,i),c.addClippingPlane(g),c.addClippingPlane(f)}}),!0}setBlendMode(e,n=[],r=!1){let a=this.getActors();n&&n.length>0&&(a=a.filter(i=>n.includes(i.uid))),a.forEach(i=>{const{actor:o}=i;o.getMapper().setBlendMode(e)}),r&&this.render()}setSlabThickness(e,n=[]){let r=this.getActors();n&&n.length>0&&(r=r.filter(i=>n.includes(i.uid))),r.forEach(i=>{const{actor:o}=i;o.isA("vtkVolume")&&(i.slabThickness=e)});const a=this.getCamera();this.updateClippingPlanesForActors(a),this.triggerCameraModifiedEventIfNecessary(a,a)}getSlabThickness(){const e=this.getActors();let n=cn.MINIMUM_SLAB_THICKNESS;return e.forEach(r=>{r.slabThickness>n&&(n=r.slabThickness)}),n}hasVolumeId(e){return this.getActors().some(r=>r.uid===e)}getImageData(e){const n=this.getDefaultActor();if(!n)return;const{uid:r}=n;e=e!=null?e:r;const{actor:a}=this.getActor(e);if(!a.isA("vtkVolume"))return;const i=be.getVolume(e),o=a.getMapper().getInputData();return{dimensions:o.getDimensions(),spacing:o.getSpacing(),origin:o.getOrigin(),direction:o.getDirection(),scalarData:o.getPointData().getScalars().getData(),imageData:a.getMapper().getInputData(),metadata:{Modality:i.metadata.Modality},scaling:void 0,hasPixelSpacing:!0}}_setVolumeActors(e){this.setActors(e)}}const Cn=z3;function hl(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function _s(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?hl(Object(n),!0).forEach(function(r){Te(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):hl(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var $3=sa.staticOffsetAPI,j3=sa.otherStaticMethods,H3=E.vtkWarningMacro,ye=Wo.SlicingMode;function K3(t,e){e.classHierarchy.push("vtkImageMapper"),t.getSliceAtPosition=function(a){var i=t.getInputData(),o;if(a.length===3)o=a;else if(Number.isFinite(a)){var s=i.getBounds();switch(e.slicingMode){case ye.X:o=[a,(s[3]+s[2])/2,(s[5]+s[4])/2];break;case ye.Y:o=[(s[1]+s[0])/2,a,(s[5]+s[4])/2];break;case ye.Z:o=[(s[1]+s[0])/2,(s[3]+s[2])/2,a];break}}var c=[0,0,0];i.worldToIndex(o,c);var u=i.getExtent(),g=t.getClosestIJKAxis(),f=g.ijkMode,l=0;switch(f){case ye.I:l=Yt(c[0],u[0],u[1]);break;case ye.J:l=Yt(c[1],u[2],u[3]);break;case ye.K:l=Yt(c[2],u[4],u[5]);break;default:return 0}return l},t.setSliceFromCamera=function(a){var i=a.getFocalPoint();switch(e.slicingMode){case ye.I:case ye.J:case ye.K:{var o=t.getSliceAtPosition(i);t.setSlice(o)}break;case ye.X:t.setSlice(i[0]);break;case ye.Y:t.setSlice(i[1]);break;case ye.Z:t.setSlice(i[2]);break}},t.setXSlice=function(a){t.setSlicingMode(ye.X),t.setSlice(a)},t.setYSlice=function(a){t.setSlicingMode(ye.Y),t.setSlice(a)},t.setZSlice=function(a){t.setSlicingMode(ye.Z),t.setSlice(a)},t.setISlice=function(a){t.setSlicingMode(ye.I),t.setSlice(a)},t.setJSlice=function(a){t.setSlicingMode(ye.J),t.setSlice(a)},t.setKSlice=function(a){t.setSlicingMode(ye.K),t.setSlice(a)},t.getSlicingModeNormal=function(){var a=[0,0,0],i=t.getInputData().getDirection(),o=[[i[0],i[1],i[2]],[i[3],i[4],i[5]],[i[6],i[7],i[8]]];switch(e.slicingMode){case ye.X:a[0]=1;break;case ye.Y:a[1]=1;break;case ye.Z:a[2]=1;break;case ye.I:Sa(o,[1,0,0],a);break;case ye.J:Sa(o,[0,1,0],a);break;case ye.K:Sa(o,[0,0,1],a);break}return a};function n(){var a;switch(e.slicingMode){case ye.X:a=[1,0,0];break;case ye.Y:a=[0,1,0];break;case ye.Z:a=[0,0,1];break;default:e.closestIJKAxis={ijkMode:e.slicingMode,flip:!1};return}var i=[0,0,0],o=t.getInputData().getDirection(),s=[[o[0],o[1],o[2]],[o[3],o[4],o[5]],[o[6],o[7],o[8]]];Sa(s,a,i);for(var c=0,u=-1,g=!1,f=0;f<i.length;++f){var l=Math.abs(i[f]);l>c&&(c=l,g=i[f]<0,u=f)}if(c!==1){var v="IJKXYZ"[e.slicingMode],p="IJKXYZ"[u];H3("Unaccurate slicing along ".concat(v," axis which ")+"is not aligned with any IJK axis of the image data. "+"Using ".concat(p," axis  as a fallback (").concat(c,"% aligned). ")+"Necessitates slice reformat that is not yet implemented.  You can switch the slicing mode on your mapper to do IJK slicing instead.")}e.closestIJKAxis={ijkMode:u,flip:g}}t.setSlicingMode=function(a){e.slicingMode!==a&&(e.slicingMode=a,t.getInputData()&&n(),t.modified())},t.getClosestIJKAxis=function(){return(e.closestIJKAxis===void 0||e.closestIJKAxis.ijkMode===ye.NONE)&&t.getInputData()&&n(),e.closestIJKAxis},t.getBounds=function(){var a=t.getInputData();if(!a)return Zr();if(!e.useCustomExtents)return a.getBounds();var i=e.customDisplayExtent.slice(),o=t.getClosestIJKAxis(),s=o.ijkMode,c=e.slice;switch(s!==e.slicingMode&&(c=t.getSliceAtPosition(e.slice)),s){case ye.I:i[0]=c,i[1]=c;break;case ye.J:i[2]=c,i[3]=c;break;case ye.K:i[4]=c,i[5]=c;break}return a.extentToBounds(i)},t.getBoundsForSlice=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.slice,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=t.getInputData();if(!o)return Zr();var s=o.getSpatialExtent(),c=t.getClosestIJKAxis(),u=c.ijkMode,g=a;switch(u!==e.slicingMode&&(g=t.getSliceAtPosition(a)),u){case ye.I:s[0]=g-i,s[1]=g+i;break;case ye.J:s[2]=g-i,s[3]=g+i;break;case ye.K:s[4]=g-i,s[5]=g+i;break}return o.extentToBounds(s)},t.getIsOpaque=function(){return!0};function r(a,i){var o=t.getInputData(),s=o.getExtent(),c=[s[0],s[2],s[4]],u=t.getClosestIJKAxis(),g=u.ijkMode,f=e.slice;g!==e.slicingMode&&(f=t.getSliceAtPosition(f)),c[g]+=f;var l=[0,0,0];o.indexToWorld(c,l),c[g]+=1;var v=[0,0,0];o.indexToWorld(c,v),v[0]-=l[0],v[1]-=l[1],v[2]-=l[2],Nt(v,v);var p=Tn.intersectWithLine(a,i,l,v);if(p.intersection){var d=p.x,h=[0,0,0];return o.worldToIndex(d,h),{t:p.t,absoluteIJK:h}}return null}t.intersectWithLineForPointPicking=function(a,i){var o=r(a,i);if(o){var s=t.getInputData(),c=s.getExtent(),u=[Math.round(o.absoluteIJK[0]),Math.round(o.absoluteIJK[1]),Math.round(o.absoluteIJK[2])];return u[0]<c[0]||u[0]>c[1]||u[1]<c[2]||u[1]>c[3]||u[2]<c[4]||u[2]>c[5]?null:{t:o.t,ijk:u}}return null},t.intersectWithLineForCellPicking=function(a,i){var o=r(a,i);if(o){var s=t.getInputData(),c=s.getExtent(),u=o.absoluteIJK,g=[Math.floor(u[0]),Math.floor(u[1]),Math.floor(u[2])];if(g[0]<c[0]||g[0]>c[1]-1||g[1]<c[2]||g[1]>c[3]-1||g[2]<c[4]||g[2]>c[5]-1)return null;var f=[u[0]-g[0],u[1]-g[1],u[2]-g[2]];return{t:o.t,ijk:g,pCoords:f}}return null}}var q3={displayExtent:[0,0,0,0,0,0],customDisplayExtent:[0,0,0,0],useCustomExtents:!1,slice:0,slicingMode:ye.NONE,closestIJKAxis:{ijkMode:ye.NONE,flip:!1},renderToRectangle:!1,sliceAtFocalPoint:!1};function Md(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,q3,n),Du.extend(t,e,n),E.get(t,e,["slicingMode"]),E.setGet(t,e,["slice","closestIJKAxis","useCustomExtents","renderToRectangle","sliceAtFocalPoint"]),E.setGetArray(t,e,["customDisplayExtent"],4),sa.implementCoincidentTopologyMethods(t,e),K3(t,e)}var X3=E.newInstance(Md,"vtkImageMapper"),Y3=_s(_s(_s({newInstance:X3,extend:Md},$3),j3),Wo),Ii=nR.InterpolationType,dl=E.vtkErrorMacro,Pi=4;function Z3(t,e){e.classHierarchy.push("vtkImageProperty"),t.getMTime=function(){for(var n=e.mtime,r,a=0;a<Pi;a++)e.componentData[a].rGBTransferFunction&&(r=e.componentData[a].rGBTransferFunction.getMTime(),n=n>r?n:r),e.componentData[a].piecewiseFunction&&(r=e.componentData[a].piecewiseFunction.getMTime(),n=n>r?n:r);return n},t.setRGBTransferFunction=function(n,r){var a=n,i=r;return Number.isInteger(n)||(i=n,a=0),e.componentData[a].rGBTransferFunction!==i?(e.componentData[a].rGBTransferFunction=i,t.modified(),!0):!1},t.getRGBTransferFunction=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[n].rGBTransferFunction},t.setPiecewiseFunction=function(n,r){var a=n,i=r;return Number.isInteger(n)||(i=n,a=0),e.componentData[a].piecewiseFunction!==i?(e.componentData[a].piecewiseFunction=i,t.modified(),!0):!1},t.getPiecewiseFunction=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[n].piecewiseFunction},t.setScalarOpacity=function(n,r){var a=n,i=r;return Number.isInteger(n)||(i=n,a=0),t.setPiecewiseFunction(a,i)},t.getScalarOpacity=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.getPiecewiseFunction(n)},t.setComponentWeight=function(n,r){if(n<0||n>=Pi)return dl("Invalid index"),!1;var a=Math.min(1,Math.max(0,r));return e.componentData[n].componentWeight!==a?(e.componentData[n].componentWeight=a,t.modified(),!0):!1},t.getComponentWeight=function(n){return n<0||n>=Pi?(dl("Invalid index"),0):e.componentData[n].componentWeight},t.setInterpolationTypeToNearest=function(){return t.setInterpolationType(Ii.NEAREST)},t.setInterpolationTypeToLinear=function(){return t.setInterpolationType(Ii.LINEAR)},t.getInterpolationTypeAsString=function(){return E.enumToString(Ii,e.interpolationType)}}var J3={independentComponents:!1,interpolationType:Ii.LINEAR,colorWindow:255,colorLevel:127.5,ambient:1,diffuse:0,opacity:1,useLookupTableScalarRange:!1};function Rd(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,J3,n),E.obj(t,e),!e.componentData){e.componentData=[];for(var r=0;r<Pi;r++)e.componentData.push({rGBTransferFunction:null,piecewiseFunction:null,componentWeight:1})}E.setGet(t,e,["independentComponents","interpolationType","colorWindow","colorLevel","ambient","diffuse","opacity","useLookupTableScalarRange"]),Z3(t,e)}var Q3=E.newInstance(Rd,"vtkImageProperty"),eN={newInstance:Q3,extend:Rd},tN=E.vtkDebugMacro;function nN(t,e){e.classHierarchy.push("vtkImageSlice"),t.getActors=function(){return t},t.getImages=function(){return t},t.getIsOpaque=function(){if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();var n=e.property.getOpacity()>=1;return n=n&&(!e.mapper||e.mapper.getIsOpaque()),n},t.hasTranslucentPolygonalGeometry=function(){return!1},t.makeProperty=eN.newInstance,t.getProperty=function(){return e.property===null&&(e.property=t.makeProperty()),e.property},t.getBounds=function(){if(e.mapper===null)return e.bounds;var n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;var r=function(s){return s[0].map(function(c,u){return s.map(function(g){return g[u]})})};if(!e.mapperBounds||!r([n,e.mapperBounds]).reduce(function(o,s){return o&&s[0]===s[1]},!0)||t.getMTime()>e.boundsMTime.getMTime()){tN("Recomputing bounds..."),e.mapperBounds=n.map(function(o){return o});var a=[];Je.getCorners(n,a),t.computeMatrix();var i=new Float64Array(16);Oe(i,e.matrix),a.forEach(function(o){return ue(o,o,i)}),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map(function(o,s){return s%2===0?a.reduce(function(c,u){return c>u[s/2]?u[s/2]:c},o):a.reduce(function(c,u){return c<u[(s-1)/2]?u[(s-1)/2]:c},o)}),e.boundsMTime.modified()}return e.bounds},t.getBoundsForSlice=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=e.mapper.getBoundsForSlice(n,r);if(!a||a.length!==6||a[0]>a[1])return a;var i=[];Je.getCorners(a,i),t.computeMatrix();var o=new Float64Array(16);Oe(o,e.matrix),i.forEach(function(c){return ue(c,c,o)});var s=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];return s=s.map(function(c,u){return u%2===0?i.reduce(function(g,f){return g>f[u/2]?f[u/2]:g},c):i.reduce(function(g,f){return g<f[(u-1)/2]?f[(u-1)/2]:g},c)}),s},t.getMinXBound=function(){return t.getBounds(),e.bounds[0]},t.getMaxXBound=function(){return t.getBounds(),e.bounds[1]},t.getMinYBound=function(){return t.getBounds(),e.bounds[2]},t.getMaxYBound=function(){return t.getBounds(),e.bounds[3]},t.getMinZBound=function(){return t.getBounds(),e.bounds[4]},t.getMaxZBound=function(){return t.getBounds(),e.bounds[5]},t.getMTime=function(){var n=e.mtime;if(e.property!==null){var r=e.property.getMTime();n=r>n?r:n}return n},t.getRedrawMTime=function(){var n=e.mtime;if(e.mapper!==null){var r=e.mapper.getMTime();n=r>n?r:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),r=e.mapper.getInput().getMTime(),n=r>n?r:n)}if(e.property!==null){var a=e.property.getMTime();n=a>n?a:n,e.property.getRGBTransferFunction()!==null&&(a=e.property.getRGBTransferFunction().getMTime(),n=a>n?a:n)}return n},t.getSupportsSelection=function(){return e.mapper?e.mapper.getSupportsSelection():!1}}var rN={mapper:null,property:null,bounds:[1,-1,1,-1,1,-1]};function Dd(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rN,n),Wu.extend(t,e,n),e.boundsMTime={},E.obj(e.boundsMTime),E.set(t,e,["property"]),E.setGet(t,e,["mapper"]),E.getArray(t,e,["bounds"],6),nN(t,e)}var aN=E.newInstance(Dd,"vtkImageSlice"),iN={newInstance:aN,extend:Dd};function Vd(t){return Aa(t)}function Ri(t,e){const n=Vd(t);return n.invert(),n.transformPoint(e)}function yl(t,e){return Vd(t).transformPoint(e)}function oN(t){const{image:e}=t;t.viewport.scale=su(t.canvas,e,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0}function sN(t){const{canvas:e}=t,{clientWidth:n,clientHeight:r}=e;(e.width!==n||e.height!==r)&&(e.width=n,e.height=r)}function cN(t,e,n){const r=t.viewport.scale,a=tv(t.image,t.viewport.rotation),i=Math.round(a.width*r),o=Math.round(a.height*r),s=t.viewport.translation.x,c=t.viewport.translation.y;return i===e&&o<=n||i<=e&&o===n&&s===0&&c===0}function uN(t,e,n){const r=t.viewport.scale,a=t.canvas.width,i=t.canvas.height,o=a/e,s=i/n,c=Math.sqrt(o*s);t.viewport.scale=c*r}function fN(t,e=!1){const n=t.canvas.width,r=t.canvas.height;sN(t),t.image!==void 0&&(e||cN(t,n,r)?oN(t):uN(t,n,r))}function gN(t,e=!0,n=!0){const{canvas:r,image:a,viewport:i}=t,o=su(r,a,0).scaleFactor;i.vflip=!1,i.hflip=!1,e&&(i.translation.x=0,i.translation.y=0),n&&(i.displayedArea.tlhc.x=1,i.displayedArea.tlhc.y=1,i.displayedArea.brhc.x=a.columns,i.displayedArea.brhc.y=a.rows,i.scale=o)}function lN(t,e){const{hflip:n,vflip:r,rotation:a}=e;if(t.x*=n?-1:1,t.y*=r?-1:1,a!==0){const i=a*Math.PI/180,o=Math.cos(i),s=Math.sin(i),c=t.x*o-t.y*s,u=t.x*s+t.y*o;t.x=c,t.y=u}return t}const vN=1;class pN extends Xh{constructor(e){if(super(e),this.invert=!1,this.stackInvalidated=!1,this.voiApplied=!1,this.rotationCache=0,this._publishCalibratedEvent=!1,this.resize=()=>{this.useCPURendering&&this._resizeCPU()},this._resizeCPU=()=>{this._cpuFallbackEnabledElement.viewport&&fN(this._cpuFallbackEnabledElement)},this.getFrameOfReferenceUID=()=>{const n=this.getCurrentImageId();if(!n)return;const r=He("imagePlaneModule",n);if(!!r)return r.frameOfReferenceUID},this.createActorMapper=n=>{const r=Y3.newInstance();r.setInputData(n);const a=iN.newInstance();return a.setMapper(r),n.getPointData().getNumberOfComponents()>1&&a.getProperty().setIndependentComponents(!1),a},this.getProperties=()=>({voiRange:this.voiRange,rotation:this.rotationCache,interpolationType:this.interpolationType,invert:this.invert}),this.canvasToWorld=n=>this.useCPURendering?this.canvasToWorldCPU(n):this.canvasToWorldGPU(n),this.worldToCanvas=n=>this.useCPURendering?this.worldToCanvasCPU(n):this.worldToCanvasGPU(n),this.canvasToWorldCPU=n=>{if(!this._cpuFallbackEnabledElement.image)return;const[r,a]=Ri(this._cpuFallbackEnabledElement,n),{origin:i,spacing:o,direction:s}=this.getImageData(),c=or(0,0,0),u=s.slice(0,3),g=s.slice(3,6);return Lt(c,i,u,r*o[0]),Lt(c,c,g,a*o[1]),c},this.worldToCanvasCPU=n=>{const{spacing:r,direction:a,origin:i}=this.getImageData(),o=a.slice(0,3),s=a.slice(3,6),c=Kt(Ue(),n,i),u=[ut(c,o)/r[0],ut(c,s)/r[1]];return yl(this._cpuFallbackEnabledElement,u)},this.canvasToWorldGPU=n=>{const r=this.getRenderer(),a=this.getVtkActiveCamera(),i=a.getClippingRange(),o=a.getDistance();a.setClippingRange(o,o+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),u=c.getSize(),g=window.devicePixelRatio||1,f=[n[0]*g,n[1]*g],l=[f[0]+this.sx,f[1]+this.sy];l[1]=u[1]-l[1];let v=c.displayToWorld(l[0],l[1],0,r);return a.setClippingRange(i[0],i[1]),v=this.applyFlipTx(v),v},this.worldToCanvasGPU=n=>{const r=this.getRenderer(),a=this.getVtkActiveCamera(),i=a.getClippingRange(),o=a.getDistance();a.setClippingRange(o,o+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),u=c.getSize(),g=c.worldToDisplay(...this.applyFlipTx(n),r);g[1]=u[1]-g[1];const f=[g[0]-this.sx,g[1]-this.sy];a.setClippingRange(i[0],i[1]);const l=window.devicePixelRatio||1;return[f[0]/l,f[1]/l]},this.getCurrentImageIdIndex=()=>this.currentImageIdIndex,this.getTargetImageIdIndex=()=>this.targetImageIdIndex,this.getImageIds=()=>this.imageIds,this.getCurrentImageId=()=>this.imageIds[this.currentImageIdIndex],this.hasImageId=n=>this.imageIds.includes(n),this.hasImageURI=n=>{const r=this.imageIds;for(let a=0;a<r.length;a++)if(Xt(r[a])===n)return!0;return!1},this.customRenderViewportToCanvas=()=>{if(!this.useCPURendering)throw new Error("Custom cpu rendering pipeline should only be hit in CPU rendering mode");return this._cpuFallbackEnabledElement.image?(ov(this._cpuFallbackEnabledElement,this.cpuRenderingInvalidated),this.cpuRenderingInvalidated=!1):this.fillWithBackgroundColor(),{canvas:this.canvas,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId}},this.scaling={},this.modality=null,this.useCPURendering=lo(),this.useCPURendering)this._cpuFallbackEnabledElement={canvas:this.canvas,renderingTools:{},transform:new Ro,viewport:{}};else{const n=this.getRenderer(),r=Gu.newInstance();n.setActiveCamera(r);const a=[0,0,-1],i=[0,-1,0];r.setDirectionOfProjection(-a[0],-a[1],-a[2]),r.setViewUp(...i),r.setParallelProjection(!0),r.setThicknessFromFocalPoint(.1),r.setFreezeFocalPoint(!0)}this.imageIds=[],this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.panCache=[0,0,0],this.cameraPosOnRender=[0,0,0],this.resetCamera(),this.initializeElementDisabledHandler()}static get useCustomRenderingPipeline(){return lo()}initializeElementDisabledHandler(){ee.addEventListener(q.ELEMENT_DISABLED,function e(){clearTimeout(this.debouncedTimeout),ee.removeEventListener(q.ELEMENT_DISABLED,e)})}getImageData(){return this.useCPURendering?this.getImageDataCPU():this.getImageDataGPU()}getImageDataGPU(){const e=this.getDefaultActor();if(!e)return;const{actor:n}=e;if(!ir(n))return;const r=n.getMapper().getInputData();return{dimensions:r.getDimensions(),spacing:r.getSpacing(),origin:r.getOrigin(),direction:r.getDirection(),scalarData:r.getPointData().getScalars().getData(),imageData:n.getMapper().getInputData(),metadata:{Modality:this.modality},scaling:this.scaling,hasPixelSpacing:this.hasPixelSpacing,preScale:{...this.csImage.preScale}}}getImageDataCPU(){const{metadata:e}=this._cpuFallbackEnabledElement,n=e.spacing;return{dimensions:e.dimensions,spacing:n,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality},scaling:this.scaling,imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getScalarData:()=>this.cpuImagePixelData,getSpacing:()=>n,worldToIndex:r=>{const a=this.worldToCanvasCPU(r),i=Ri(this._cpuFallbackEnabledElement,a);return[i[0],i[1],0]},indexToWorld:r=>{const a=yl(this._cpuFallbackEnabledElement,[r[0],r[1]]);return this.canvasToWorldCPU(a)}},scalarData:this.cpuImagePixelData,hasPixelSpacing:this.hasPixelSpacing,preScale:{...this.csImage.preScale}}}buildMetadata(e){const{pixelRepresentation:n,bitsAllocated:r,bitsStored:a,highBit:i,photometricInterpretation:o,samplesPerPixel:s}=He("imagePixelModule",e),c=He("voiLutModule",e);let u,g;c&&({windowWidth:u,windowCenter:g}=c,Array.isArray(u)&&(u=u[0]),Array.isArray(g)&&(g=g[0]));const{modality:f}=He("generalSeriesModule",e),l=He("scalingModule",e);f==="PT"&&l&&this._addScalingToViewport(l),this.modality=f;let v=this._getImagePlaneModule(e);return this.useCPURendering||(v=this.calibrateIfNecessary(e,v)),{imagePlaneModule:v,imagePixelModule:{bitsAllocated:r,bitsStored:a,samplesPerPixel:s,highBit:i,photometricInterpretation:o,pixelRepresentation:n,windowWidth:u,windowCenter:g,modality:f}}}calibrateIfNecessary(e,n){const r=He("calibratedPixelSpacing",e);if(!r)return n;const[a,i]=r;if(n.rowPixelSpacing===a&&n.columnPixelSpacing===i)return n;const o=this.getImageData();if(!o&&n.rowPixelSpacing===a&&n.columnPixelSpacing===i)return n;if(!o&&(n.rowPixelSpacing!==a||n.columnPixelSpacing!==i))return this._publishCalibratedEvent=!0,this._calibrationEvent={rowScale:a/n.rowPixelSpacing,columnScale:i/n.columnPixelSpacing},n.rowPixelSpacing=a,n.columnPixelSpacing=i,n;const{imageData:s}=o,[c,u]=s.getSpacing();return n.rowPixelSpacing=a,n.columnPixelSpacing=i,u===a&&c===r||(this._publishCalibratedEvent=!0,this._calibrationEvent={rowScale:a/u,columnScale:i/c}),n}setProperties({voiRange:e,invert:n,interpolationType:r,rotation:a}={},i=!1){(typeof e<"u"||!this.voiApplied)&&this.setVOI(e,i),typeof n<"u"&&this.setInvertColor(n),typeof r<"u"&&this.setInterpolationType(r),typeof a<"u"&&this.rotationCache!==a&&this.setRotation(this.rotationCache,a)}resetProperties(){this.cpuRenderingInvalidated=!0,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={}),this._resetProperties(),this.render()}getCamera(){return this.useCPURendering?this.getCameraCPU():super.getCamera()}setCamera(e){this.useCPURendering?this.setCameraCPU(e):super.setCamera(e)}_resetProperties(){this.voiApplied=!1,this.setProperties({voiRange:this.initialVOIRange,rotation:0,interpolationType:oc.LINEAR,invert:!1})}_setPropertiesFromCache(){this.setProperties({voiRange:this.voiRange,rotation:this.rotation,interpolationType:this.interpolationType,invert:this.invert},!0)}getCameraCPU(){const{metadata:e,viewport:n}=this._cpuFallbackEnabledElement,{direction:r}=e,a=r.slice(6,9).map(f=>-f);let i=r.slice(3,6).map(f=>-f);if(this.rotation){const f=eu(ta(),this.rotation*Math.PI/180,a);i=ue(Ue(),i,f)}const o=[this.element.clientWidth/2,this.element.clientHeight/2],s=this.canvasToWorld(o),c=this.canvasToWorld([0,0]),u=this.canvasToWorld([0,this.element.clientHeight]),g=Oo(c,u)/2;return{parallelProjection:!0,focalPoint:s,position:[0,0,0],parallelScale:g,scale:n.scale,viewPlaneNormal:[a[0],a[1],a[2]],viewUp:[i[0],i[1],i[2]],flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}setCameraCPU(e){const{viewport:n,image:r}=this._cpuFallbackEnabledElement,a=this.getCameraCPU(),{focalPoint:i,parallelScale:o,scale:s,flipHorizontal:c,flipVertical:u}=e,{clientHeight:g}=this.element;if(i){const l=this.worldToCanvasCPU(i),v=Ri(this._cpuFallbackEnabledElement,l),p=this.worldToCanvasCPU(a.focalPoint),d=Ri(this._cpuFallbackEnabledElement,p),h=Ki();lc(h,Nf(v[0],v[1]),Nf(d[0],d[1]));const T=lN({x:h[0],y:h[1]},n);n.translation.x-=T.x,n.translation.y-=T.y}if(o){const{rowPixelSpacing:l}=r,v=g*l*.5/o;n.scale=v,n.parallelScale=o}if(s){const{rowPixelSpacing:l}=r;n.scale=s,n.parallelScale=g*l*.5/s}(c!==void 0||u!==void 0)&&this.setFlipCPU({flipHorizontal:c,flipVertical:u}),this._cpuFallbackEnabledElement.transform=Aa(this._cpuFallbackEnabledElement);const f={previousCamera:a,camera:this.getCamera(),element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,rotation:this.rotation};Y(this.element,q.CAMERA_MODIFIED,f)}setFlipCPU({flipHorizontal:e,flipVertical:n}){const{viewport:r}=this._cpuFallbackEnabledElement;e!==void 0&&(r.hflip=e,this.flipHorizontal=r.hflip),n!==void 0&&(r.vflip=n,this.flipVertical=r.vflip)}setVOI(e,n){if(this.useCPURendering){this.setVOICPU(e,n);return}this.setVOIGPU(e,n)}setRotation(e,n){const r=this.getCamera();this.useCPURendering?this.setRotationCPU(e,n):this.setRotationGPU(e,n);const a=this.getCamera(),i={previousCamera:r,camera:a,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,rotation:this.rotation};Y(this.element,q.CAMERA_MODIFIED,i)}setInterpolationType(e){if(this.useCPURendering){this.setInterpolationTypeCPU(e);return}this.setInterpolationTypeGPU(e)}setInvertColor(e){if(this.useCPURendering){this.setInvertColorCPU(e);return}this.setInvertColorGPU(e)}setRotationCPU(e,n){const{viewport:r}=this._cpuFallbackEnabledElement;r.rotation=n,this.rotationCache=n,this.rotation=n}setRotationGPU(e,n){this.getVtkActiveCamera().roll(e),this.getVtkActiveCamera().roll(-n),this.rotationCache=n,this.rotation=n}setInterpolationTypeGPU(e){const n=this.getDefaultActor();if(!n)return;const{actor:r}=n;if(!ir(r))return;r.getProperty().setInterpolationType(e),this.interpolationType=e}setInterpolationTypeCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;e===oc.LINEAR?n.pixelReplication=!1:n.pixelReplication=!0,this.interpolationType=e}setInvertColorCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;!n||(n.invert=e,this.invert=e)}setInvertColorGPU(e){const n=this.getDefaultActor();if(!n)return;const{actor:r}=n;if(!!ir(r)){if(r.isA("vtkVolume")){const i=r.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&Hi(i),this.invert=e}else if(r.isA("vtkImageSlice")){const i=r.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&Hi(i),this.invert=e}}}setVOICPU(e,n){const{viewport:r,image:a}=this._cpuFallbackEnabledElement;if(!r||!a)return;if(typeof e>"u"){const{windowWidth:o,windowCenter:s}=a,c=Array.isArray(o)?o[0]:o,u=Array.isArray(s)?s[0]:s;r.voi={windowWidth:c,windowCenter:u};const{lower:g,upper:f}=Pa(c,u);e={lower:g,upper:f}}else{const{lower:o,upper:s}=e,{windowCenter:c,windowWidth:u}=ro(o,s);r.voi||(r.voi={windowWidth:0,windowCenter:0}),r.voi.windowWidth=u,r.voi.windowCenter=c}this.voiApplied=!0,this.voiRange=e;const i={viewportId:this.id,range:e};n||Y(this.element,q.VOI_MODIFIED,i)}setVOIGPU(e,n){const r=this.getDefaultActor();if(!r)return;const{actor:a}=r;if(!ir(a))return;const i=a;let o=e;if(typeof o>"u"){const g=i.getMapper().getInputData().getPointData().getScalars().getRange();o={lower:g[0],upper:g[1]}}const{windowWidth:s,windowCenter:c}=ro(o.lower,o.upper);if(i.getProperty().setColorWindow(s),i.getProperty().setColorLevel(c),this.voiApplied=!0,this.voiRange=o,!n){const u={viewportId:this.id,range:o};Y(this.element,q.VOI_MODIFIED,u)}}_addScalingToViewport(e){if(!this.scaling.PET){const{suvbw:n,suvlbm:r,suvbsa:a}=e,i={};r&&(i.suvbwToSuvlbm=r/n),a&&(i.suvbwToSuvbsa=a/n),this.scaling.PET=i}}_getNumCompsFromPhotometricInterpretation(e){let n=1;return(e==="RGB"||e.indexOf("YBR")!==-1||e==="PALETTE COLOR")&&(n=3),n}_getImageDataMetadata(e){const{imagePlaneModule:n,imagePixelModule:r}=this.buildMetadata(e.imageId);let a,i;a=n.rowCosines,i=n.columnCosines,(a==null||i==null)&&(a=[1,0,0],i=[0,1,0]);const o=or(a[0],a[1],a[2]),s=or(i[0],i[1],i[2]),c=Ue();pn(c,o,s);let u=n.imagePositionPatient;u==null&&(u=[0,0,0]);const g=n.columnPixelSpacing||e.columnPixelSpacing,f=n.rowPixelSpacing||e.rowPixelSpacing,l=e.columns,v=e.rows,p=vN,d=1,h=e.numComps||this._getNumCompsFromPhotometricInterpretation(r.photometricInterpretation);return{bitsAllocated:r.bitsAllocated,numComps:h,origin:u,direction:[...o,...s,...c],dimensions:[l,v,d],spacing:[g,f,p],numVoxels:l*v*d,imagePlaneModule:n,imagePixelModule:r}}_getCameraOrientation(e){const n=e.slice(6,9).map(a=>-a),r=e.slice(3,6).map(a=>-a);return{viewPlaneNormal:[n[0],n[1],n[2]],viewUp:[r[0],r[1],r[2]]}}_createVTKImageData({origin:e,direction:n,dimensions:r,spacing:a,bitsAllocated:i,numComps:o,numVoxels:s}){let c;switch(i){case 8:c=new Uint8Array(s*o);break;case 16:c=new Float32Array(s*o);break;case 24:c=new Uint8Array(s*3*o);break;default:console.debug("bit allocation not implemented")}const u=Ve.newInstance({name:"Pixels",numberOfComponents:o,values:c});this._imageData=Bo.newInstance(),this._imageData.setDimensions(r),this._imageData.setSpacing(a),this._imageData.setDirection(n),this._imageData.setOrigin(e),this._imageData.getPointData().setScalars(u)}async setStack(e,n=0){this.imageIds=e,this.currentImageIdIndex=n,this.targetImageIdIndex=n,this.stackInvalidated=!0,this.rotationCache=0,this.flipVertical=!1,this.flipHorizontal=!1,this.voiApplied=!1,this._resetProperties(),this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={},delete this._cpuFallbackEnabledElement.viewport.colormap);const r=await this._setImageIdIndex(n),a={imageIds:e,viewportId:this.id,element:this.element,currentImageIdIndex:n};return Y(ee,q.STACK_VIEWPORT_NEW_STACK,a),r}_checkVTKImageDataMatchesCornerstoneImage(e,n){if(!n)return!1;const[r,a]=n.getSpacing(),[i,o]=n.getDimensions(),s=this._getImagePlaneModule(e.imageId),c=n.getDirection(),u=c.slice(0,3),g=c.slice(3,6);return!(r!==e.rowPixelSpacing||a!==e.columnPixelSpacing||i!==e.columns||o!==e.rows||!uc(s.rowCosines,u)||!uc(s.columnCosines,g))}_updateVTKImageDataFromCornerstoneImage(e){let r=this._getImagePlaneModule(e.imageId).imagePositionPatient;r==null&&(r=[0,0,0]),this._imageData.setOrigin(r);const a=e.getPixelData(),o=this._imageData.getPointData().getScalars().getData();if(e.rgba){const s=a.length/4;let c=0,u=0;for(let g=0;g<s;g++)o[u++]=a[c++],o[u++]=a[c++],o[u++]=a[c++],c++}else o.set(a);this._imageData.modified()}async _loadAndDisplayImage(e,n){return this.useCPURendering?await this._loadAndDisplayImageCPU(e,n):await this._loadAndDisplayImageGPU(e,n),e}_loadAndDisplayImageCPU(e,n){return new Promise((r,a)=>{function i(v,p,d){var y;if(this.currentImageIdIndex!==p)return;this.csImage=v;const h={image:v,imageId:d,imageIdIndex:p,viewportId:this.id,renderingEngineId:this.renderingEngineId};Y(this.element,q.STACK_NEW_IMAGE,h);const T=this._getImageDataMetadata(v);v.isPreScaled=(y=v.preScale)==null?void 0:y.scaled;const C=nv(this.canvas,v,this.modality,this._cpuFallbackEnabledElement.viewport.colormap);this._cpuFallbackEnabledElement.image=v,this._cpuFallbackEnabledElement.metadata={...T},this.cpuImagePixelData=v.getPixelData();const m=Object.assign({},C,this._cpuFallbackEnabledElement.viewport);this._cpuFallbackEnabledElement.viewport=this.stackInvalidated?C:m,this.stackInvalidated=!1,this.cpuRenderingInvalidated=!0,this._cpuFallbackEnabledElement.transform=Aa(this._cpuFallbackEnabledElement),this.render(),this.currentImageIdIndex=p,r(d)}function o(v,p,d){const h={error:v,imageIdIndex:p,imageId:d};this.suppressEvents||Y(ee,q.IMAGE_LOAD_ERROR,h),a(v)}function s(v,p,d){return Xi(v,d).then(h=>{i.call(this,h,p,v)},h=>{o.call(this,h,p,v)})}const c="Float32Array",u=-5,g=qt.Interaction,f={imageId:e},l={targetBuffer:{type:c,offset:null,length:null},preScale:{enabled:!0},useRGBA:!1};Ga.addRequest(s.bind(this,e,n,l),g,f,u)})}_loadAndDisplayImageGPU(e,n){return new Promise((r,a)=>{function i(p,d,h){if(this.currentImageIdIndex!==d)return;this.csImage=p;const T={image:p,imageId:h,imageIdIndex:d,viewportId:this.id,renderingEngineId:this.renderingEngineId};Y(this.element,q.STACK_NEW_IMAGE,T),this._updateActorToDisplayImageId(p),this.render(),this.currentImageIdIndex=d,r(h)}function o(p,d,h){const T={error:p,imageIdIndex:d,imageId:h};Y(ee,q.IMAGE_LOAD_ERROR,T),a(p)}function s(p,d,h){return Xi(p,h).then(T=>{i.call(this,T,d,p)},T=>{o.call(this,T,d,p)})}const c="Float32Array",u=-5,g=qt.Interaction,f={imageId:e},l={targetBuffer:{type:c,offset:null,length:null},preScale:{enabled:!0},useRGBA:!1},v={imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};Y(this.element,q.PRE_STACK_NEW_IMAGE,v),Ga.addRequest(s.bind(this,e,n,l),g,f,u)})}_updateActorToDisplayImageId(e){var R;const n=this._checkVTKImageDataMatchesCornerstoneImage(e,this._imageData),r=this.getRenderer().getActiveCamera(),a=ht(this.getCamera());if(n&&!this.stackInvalidated){this._updateVTKImageDataFromCornerstoneImage(e);const D=this.getCamera();this.panCache[0]=this.cameraPosOnRender[0]-D.position[0],this.panCache[1]=this.cameraPosOnRender[1]-D.position[1],this.panCache[2]=this.cameraPosOnRender[2]-D.position[2],this.resetCameraNoEvent();const{position:L}=this.getCamera();this.cameraPosOnRender=L,r.setFreezeFocalPoint(!0),this._restoreCameraProps(D,a),this.rotationCache=0,this._setPropertiesFromCache();return}const{origin:i,direction:o,dimensions:s,spacing:c,bitsAllocated:u,numComps:g,numVoxels:f,imagePixelModule:l}=this._getImageDataMetadata(e);this._createVTKImageData({origin:i,direction:o,dimensions:s,spacing:c,bitsAllocated:u,numComps:g,numVoxels:f}),this._updateVTKImageDataFromCornerstoneImage(e);const v=this.createActorMapper(this._imageData),p=[];p.push({uid:this.id,actor:v}),this.setActors(p);const{viewPlaneNormal:d,viewUp:h}=this._getCameraOrientation(o);this.setCameraNoEvent({viewUp:h,viewPlaneNormal:d}),this.resetCameraNoEvent(),this.triggerCameraEvent(this.getCamera(),a),r.setFreezeFocalPoint(!0);const{windowCenter:T,windowWidth:C}=l;let m=typeof T=="number"&&typeof C=="number"?Pa(C,T):void 0;const y=this.csImage.isPreScaled||((R=this.csImage.preScale)==null?void 0:R.scaled);l.modality==="PT"&&y&&(m={lower:0,upper:5}),this.initialVOIRange=m,this.setProperties({voiRange:m});const w=$u.newInstance();let S=0,O=1024;m&&m.lower!==void 0&&m.upper!==void 0&&(S=m.lower,O=m.upper),w.addRGBPoint(S,0,0,0),w.addRGBPoint(O,1,1,1),v.getProperty().setRGBTransferFunction(0,w);const{position:M}=this.getCamera();this.cameraPosOnRender=M,this.stackInvalidated=!1,this._publishCalibratedEvent&&this.triggerCalibrationEvent()}async _setImageIdIndex(e){if(e>=this.imageIds.length)throw new Error(`ImageIdIndex provided ${e} is invalid, the stack only has ${this.imageIds.length} elements`);return this.currentImageIdIndex=e,this.hasPixelSpacing=!0,await this._loadAndDisplayImage(this.imageIds[e],e)}resetCamera(e=!0,n=!0){return this.useCPURendering?this.resetCameraCPU(e,n):this.resetCameraGPU(e,n),this.rotation=0,this.rotationCache=0,!0}resetCameraCPU(e,n){const{image:r}=this._cpuFallbackEnabledElement;if(!r)return;gN(this._cpuFallbackEnabledElement,e,n);const{scale:a}=this._cpuFallbackEnabledElement.viewport,{clientWidth:i,clientHeight:o}=this.element,s=[i/2,o/2],c=this.canvasToWorldCPU(s);this.setCameraCPU({focalPoint:c,scale:a})}resetCameraGPU(e,n){return super.resetCamera(e,n)}scroll(e,n=!0,r=!1){const a=this.imageIds,i=this.targetImageIdIndex,o=a.length;let s=i+e;s=Math.max(0,s),r?s=s%o:s=Math.min(o-1,s),this.targetImageIdIndex=s;const c=a[s];be.isImageIdCached(c)||!n?this.setImageIdIndex(s):(clearTimeout(this.debouncedTimeout),this.debouncedTimeout=window.setTimeout(()=>{this.setImageIdIndex(s)},40));const g={newImageIdIndex:s,imageId:c,direction:e};s!==i&&Y(this.element,q.STACK_VIEWPORT_SCROLL,g)}async setImageIdIndex(e){return this.currentImageIdIndex===e?this.getCurrentImageId():this._setImageIdIndex(e)}calibrateSpacing(e){const n=this.getImageIds().indexOf(e);this.stackInvalidated=!0,this._loadAndDisplayImage(e,n)}_restoreCameraProps({parallelScale:e},n){const r=this.getRenderer(),{position:a,focalPoint:i}=this.getCamera(),o=[a[0]-this.panCache[0],a[1]-this.panCache[1],a[2]-this.panCache[2]],s=[i[0]-this.panCache[0],i[1]-this.panCache[1],i[2]-this.panCache[2]];this.setCameraNoEvent({parallelScale:e,position:o,focalPoint:s});const c=this.getCamera();this.triggerCameraEvent(c,n);const u={type:"ResetCameraEvent",renderer:r};r.invokeEvent(u)}triggerCameraEvent(e,n){const r={previousCamera:n,camera:e,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};this.suppressEvents||Y(this.element,q.CAMERA_MODIFIED,r)}triggerCalibrationEvent(){const{imageData:e}=this.getImageData(),n={element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,imageId:this.getCurrentImageId(),imageData:e,worldToIndex:e.getWorldToIndex(),...this._calibrationEvent};this.suppressEvents||Y(this.element,q.IMAGE_SPACING_CALIBRATED,n),this._publishCalibratedEvent=!1}getRenderer(){if(this.useCPURendering)throw this.getCPUFallbackError("getRenderer");return super.getRenderer()}getDefaultActor(){if(this.useCPURendering)throw this.getCPUFallbackError("getDefaultActor");return super.getDefaultActor()}getActors(){if(this.useCPURendering)throw this.getCPUFallbackError("getActors");return super.getActors()}getActor(e){if(this.useCPURendering)throw this.getCPUFallbackError("getActor");return super.getActor(e)}setActors(e){if(this.useCPURendering)throw this.getCPUFallbackError("setActors");return super.setActors(e)}addActors(e){if(this.useCPURendering)throw this.getCPUFallbackError("addActors");return super.addActors(e)}addActor(e){if(this.useCPURendering)throw this.getCPUFallbackError("addActor");return super.addActor(e)}removeAllActors(){if(this.useCPURendering)throw this.getCPUFallbackError("removeAllActors");return super.removeAllActors()}getCPUFallbackError(e){return new Error(`method ${e} cannot be used during CPU Fallback mode`)}fillWithBackgroundColor(){const e=this.getRenderingEngine();e&&e.fillCanvasWithBackgroundColor(this.canvas,this.options.background)}setColormap(e){this.useCPURendering?this.setColormapCPU(e):this.setColormapGPU(e)}unsetColormap(){this.useCPURendering?this.unsetColormapCPU():this.unsetColormapGPU()}unsetColormapCPU(){delete this._cpuFallbackEnabledElement.viewport.colormap,this._cpuFallbackEnabledElement.renderingTools={},this.cpuRenderingInvalidated=!0,this.fillWithBackgroundColor(),this.render()}setColormapCPU(e){const n=iv(e.name,e);this._cpuFallbackEnabledElement.viewport.colormap=n,this._cpuFallbackEnabledElement.renderingTools={},this.fillWithBackgroundColor(),this.cpuRenderingInvalidated=!0,this.render()}setColormapGPU(e){throw new Error("setColorMapGPU not implemented.")}unsetColormapGPU(){throw new Error("unsetColormapGPU not implemented.")}_getImagePlaneModule(e){const r={...He("imagePlaneModule",e)};return r.columnPixelSpacing||(r.columnPixelSpacing=1,this.hasPixelSpacing=!1),r.rowPixelSpacing||(r.rowPixelSpacing=1,this.hasPixelSpacing=!1),r.columnCosines||(r.columnCosines=[0,1,0]),r.rowCosines||(r.rowCosines=[1,0,0]),r.imagePositionPatient||(r.imagePositionPatient=[0,0,0]),r.imageOrientationPatient||(r.imageOrientationPatient=new Float32Array([1,0,0,0,1,0])),r}}const An=pN,hN={[It.ORTHOGRAPHIC]:Cn,[It.PERSPECTIVE]:Cn,[It.STACK]:An},dN=hN;function Fr(t){return dN[t].useCustomRenderingPipeline}class yN{constructor(e){if(this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this.renderFrameOfReference=n=>{const a=this._getViewportsAsArray().map(i=>{if(i.getFrameOfReferenceUID()===n)return i.id});return this.renderViewports(a)},this._renderFlaggedViewports=()=>{this._throwIfDestroyed(),this.useCPURendering||this.performVtkDrawCall();const n=this._getViewportsAsArray(),r=[];for(let a=0;a<n.length;a++){const i=n[a];if(this._needsRender.has(i.id)){const o=this.renderViewportUsingCustomOrVtkPipeline(i);if(r.push(o),this._needsRender.delete(i.id),this._needsRender.size===0)break}}this._animationFrameSet=!1,this._animationFrameHandle=null,r.forEach(a=>{Y(a.element,q.IMAGE_RENDERED,a)})},this.id=e||ea(),this.useCPURendering=lo(),Ba.set(this),!P3())throw new Error("@cornerstonejs/core is not initialized, run init() first");this.useCPURendering||(this.offscreenMultiRenderWindow=bV.newInstance(),this.offScreenCanvasContainer=document.createElement("div"),this.offscreenMultiRenderWindow.setContainer(this.offScreenCanvasContainer)),this._viewports=new Map,this.hasBeenDestroyed=!1}enableElement(e){const n=this._normalizeViewportInputEntry(e);this._throwIfDestroyed();const{element:r,viewportId:a}=n;if(!r)throw new Error("No element provided");this.getViewport(a)&&this.disableElement(a);const{type:o}=n,s=Fr(o);!this.useCPURendering&&!s?this.enableVTKjsDrivenViewport(n):this.addCustomViewport(n);const c=Mi(r),{background:u}=n.defaultOptions;this.fillCanvasWithBackgroundColor(c,u)}disableElement(e){this._throwIfDestroyed();const n=this.getViewport(e);if(!n){console.warn(`viewport ${e} does not exist`);return}this._resetViewport(n),!Fr(n.type)&&!this.useCPURendering&&this.offscreenMultiRenderWindow.removeRenderer(e),this._removeViewport(e),this._needsRender.delete(e),this.getViewports().length||this._clearAnimationFrame();const a=!0,i=!1,o=!1;this.resize(a,i,o)}setViewports(e){const n=this._normalizeViewportInputEntries(e);this._throwIfDestroyed(),this._reset();const r=[],a=[];n.forEach(i=>{!this.useCPURendering&&!Fr(i.type)?r.push(i):a.push(i)}),this.setVtkjsDrivenViewports(r),this.setCustomViewports(a)}resize(e=!0,n=!0,r=!0){this._throwIfDestroyed();const a=this._getViewportsAsArray(),i=[],o=[];a.forEach(s=>{Fr(s.type)?o.push(s):i.push(s)}),this._resizeVTKViewports(i,n,r,e),this._resizeUsingCustomResizeHandler(o,n,r,e)}getViewport(e){return this._viewports.get(e)}getViewports(){return this._throwIfDestroyed(),this._getViewportsAsArray()}getStackViewports(){this._throwIfDestroyed();const e=this.getViewports(),n=r=>r instanceof An;return e.filter(n)}getVolumeViewports(){this._throwIfDestroyed();const e=this.getViewports(),n=r=>r instanceof Cn;return e.filter(n)}render(){const n=this.getViewports().map(r=>r.id);this._setViewportsToBeRenderedNextFrame(n)}renderViewports(e){this._setViewportsToBeRenderedNextFrame(e)}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}destroy(){this.hasBeenDestroyed||(this._reset(),Ba.delete(this.id),this.useCPURendering||(this.offscreenMultiRenderWindow.delete(),delete this.offscreenMultiRenderWindow),this.hasBeenDestroyed=!0)}fillCanvasWithBackgroundColor(e,n){const r=e.getContext("2d");let a;if(n){const i=n.map(o=>Math.floor(255*o));a=`rgb(${i[0]}, ${i[1]}, ${i[2]})`}else a="black";r.fillStyle=a,r.fillRect(0,0,e.width,e.height)}_normalizeViewportInputEntry(e){const{type:n,defaultOptions:r}=e;let a=r;return(!a||Object.keys(a).length===0)&&(a={background:[0,0,0],orientation:null},n===It.ORTHOGRAPHIC&&(a={...a,orientation:R0.AXIAL})),{...e,defaultOptions:a}}_normalizeViewportInputEntries(e){const n=[];return e.forEach(r=>{n.push(this._normalizeViewportInputEntry(r))}),n}_resizeUsingCustomResizeHandler(e,n=!0,r=!0,a=!0){e.forEach(i=>{typeof i.resize=="function"&&i.resize()}),e.forEach(i=>{i.resetCamera(n,r)}),a===!0&&this.render()}_resizeVTKViewports(e,n=!0,r=!0,a=!0){const i=e.map(o=>o.canvas);if(i.length){const{offScreenCanvasWidth:o,offScreenCanvasHeight:s}=this._resizeOffScreenCanvas(i);this._resize(e,o,s)}e.forEach(o=>{o.resetCamera(n,r)}),a===!0&&this.render()}enableVTKjsDrivenViewport(e){const r=this._getViewportsAsArray().filter(l=>Fr(l.type)===!1),a=r.map(l=>l.canvas),i=Mi(e.element);a.push(i);const o=window.devicePixelRatio||1,s=i.getBoundingClientRect();i.width=s.width*o,i.height=s.height*o;const{offScreenCanvasWidth:c,offScreenCanvasHeight:u}=this._resizeOffScreenCanvas(a),g=this._resize(r,c,u),f={...e,canvas:i};this.addVtkjsDrivenViewport(f,{offScreenCanvasWidth:c,offScreenCanvasHeight:u,xOffset:g})}_removeViewport(e){if(!this.getViewport(e)){console.warn(`viewport ${e} does not exist`);return}this._viewports.delete(e)}addVtkjsDrivenViewport(e,n){const{element:r,canvas:a,viewportId:i,type:o,defaultOptions:s}=e;r.tabIndex=-1;const{offScreenCanvasWidth:c,offScreenCanvasHeight:u,xOffset:g}=n,{sxStartDisplayCoords:f,syStartDisplayCoords:l,sxEndDisplayCoords:v,syEndDisplayCoords:p,sx:d,sy:h,sWidth:T,sHeight:C}=this._getViewportCoordsOnOffScreenCanvas(e,c,u,g);this.offscreenMultiRenderWindow.addRenderer({viewport:[f,l,v,p],id:i,background:s.background?s.background:[0,0,0]});const m={id:i,element:r,renderingEngineId:this.id,type:o,canvas:a,sx:d,sy:h,sWidth:T,sHeight:C,defaultOptions:s||{}};let y;if(o===It.STACK)y=new An(m);else if(o===It.ORTHOGRAPHIC||o===It.PERSPECTIVE)y=new Cn(m);else throw new Error(`Viewport Type ${o} is not supported`);this._viewports.set(i,y);const w={element:r,viewportId:i,renderingEngineId:this.id};y.suppressEvents||Y(ee,q.ELEMENT_ENABLED,w)}addCustomViewport(e){const{element:n,viewportId:r,type:a,defaultOptions:i}=e;n.tabIndex=-1;const o=Mi(n),{clientWidth:s,clientHeight:c}=o;(o.width!==s||o.height!==c)&&(o.width=s,o.height=c);const u={id:r,renderingEngineId:this.id,element:n,type:a,canvas:o,sx:0,sy:0,sWidth:s,sHeight:c,defaultOptions:i||{}};if(a!==It.STACK)throw new Error("Support for fully custom viewports not yet implemented");const g=new An(u);this._viewports.set(r,g);const f={element:n,viewportId:r,renderingEngineId:this.id};Y(ee,q.ELEMENT_ENABLED,f)}setCustomViewports(e){e.forEach(n=>this.addCustomViewport(n))}setVtkjsDrivenViewports(e){if(e.length){const n=e.map(o=>Mi(o.element));n.forEach(o=>{const s=window.devicePixelRatio||1,c=o.getBoundingClientRect();o.width=c.width*s,o.height=c.height*s});const{offScreenCanvasWidth:r,offScreenCanvasHeight:a}=this._resizeOffScreenCanvas(n);let i=0;for(let o=0;o<e.length;o++){const s=e[o],c=n[o],u={...s,canvas:c};this.addVtkjsDrivenViewport(u,{offScreenCanvasWidth:r,offScreenCanvasHeight:a,xOffset:i}),i+=c.width}}}_resizeOffScreenCanvas(e){const{offScreenCanvasContainer:n,offscreenMultiRenderWindow:r}=this,a=window.devicePixelRatio||1,i=Math.max(...e.map(s=>s.clientHeight*a));let o=0;return e.forEach(s=>{o+=s.clientWidth*a}),n.width=o,n.height=i,r.resize(),{offScreenCanvasWidth:o,offScreenCanvasHeight:i}}_resize(e,n,r){let a=0;const i=window.devicePixelRatio||1;for(let o=0;o<e.length;o++){const s=e[o],{sxStartDisplayCoords:c,syStartDisplayCoords:u,sxEndDisplayCoords:g,syEndDisplayCoords:f,sx:l,sy:v,sWidth:p,sHeight:d}=this._getViewportCoordsOnOffScreenCanvas(s,n,r,a);a+=s.canvas.clientWidth*i,s.sx=l,s.sy=v,s.sWidth=p,s.sHeight=d,this.offscreenMultiRenderWindow.getRenderer(s.id).setViewport([c,u,g,f])}return a}_getViewportCoordsOnOffScreenCanvas(e,n,r,a){const{canvas:i}=e,{clientWidth:o,clientHeight:s}=i,c=window.devicePixelRatio||1,u=s*c,g=o*c,f=a,l=0,v=g,p=u,d=f/n,h=l+(r-u)/r,T=v/n,C=p/r;return{sxStartDisplayCoords:d,syStartDisplayCoords:h,sxEndDisplayCoords:d+T,syEndDisplayCoords:h+C,sx:f,sy:l,sWidth:v,sHeight:p}}_getViewportsAsArray(){return Array.from(this._viewports.values())}_setViewportsToBeRenderedNextFrame(e){e.forEach(n=>{this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}performVtkDrawCall(){const{offscreenMultiRenderWindow:e}=this,n=e.getRenderWindow(),r=e.getRenderers();if(!!r.length){for(let a=0;a<r.length;a++){const{renderer:i,id:o}=r[a];this._needsRender.has(o)?i.setDraw(!0):i.setDraw(!1)}n.render();for(let a=0;a<r.length;a++)r[a].renderer.setDraw(!1)}}renderViewportUsingCustomOrVtkPipeline(e){let n;if(Fr(e.type)===!0)n=e.customRenderViewportToCanvas();else{if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");const{offscreenMultiRenderWindow:r}=this,o=r.getOpenGLRenderWindow().get3DContext().canvas;n=this._renderViewportFromVtkCanvasToOnscreenCanvas(e,o)}return n}_renderViewportFromVtkCanvasToOnscreenCanvas(e,n){const{element:r,canvas:a,sx:i,sy:o,sWidth:s,sHeight:c,id:u,renderingEngineId:g,suppressEvents:f}=e,{width:l,height:v}=a;return a.getContext("2d").drawImage(n,i,o,s,c,0,0,l,v),{element:r,suppressEvents:f,viewportId:u,renderingEngineId:g}}_resetViewport(e){const n=this.id,{element:r,canvas:a,id:i}=e,o={element:r,viewportId:i,renderingEngineId:n};Y(ee,q.ELEMENT_DISABLED,o),r.removeAttribute("data-viewport-uid"),r.removeAttribute("data-rendering-engine-uid"),a.getContext("2d").clearRect(0,0,a.width,a.height)}_clearAnimationFrame(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}_reset(){this._getViewportsAsArray().forEach(n=>{this._resetViewport(n)}),this._clearAnimationFrame(),this._viewports=new Map}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_downloadOffScreenCanvas(){const e=this._debugRender();mN(e)}_debugRender(){const{offscreenMultiRenderWindow:e}=this,n=e.getRenderWindow(),r=e.getRenderers();for(let c=0;c<r.length;c++)r[c].renderer.setDraw(!0);n.render();const o=e.getOpenGLRenderWindow().get3DContext().canvas,s=o.toDataURL();return this._getViewportsAsArray().forEach(c=>{const{sx:u,sy:g,sWidth:f,sHeight:l}=c,v=c.canvas,{width:p,height:d}=v;v.getContext("2d").drawImage(o,u,g,f,l,0,0,p,d)}),s}}const TN=yN;function mN(t){const e=document.createElement("a");e.download="viewport.png",e.href=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}function Ye(t){if(!t)return;const{viewportUid:e,renderingEngineUid:n}=t.dataset;return ti(e,n)}function ti(t,e){if(!e||!t)return;const n=wn(e);if(!n||n.hasBeenDestroyed)return;const r=n.getViewport(t);if(!r)return;const a=r.getFrameOfReferenceUID();return{viewport:r,renderingEngine:n,viewportId:t,renderingEngineId:e,FrameOfReferenceUID:a}}const Tl=Symbol("DefaultSettings"),ml=Symbol("RuntimeSettings"),Cl=Symbol("ObjectSettingsMap"),on=Symbol("Dictionary");class _e{constructor(e){const n=Object.create(e instanceof _e&&on in e?e[on]:null);Object.seal(Object.defineProperty(this,on,{value:n}))}set(e,n){return vo(this[on],e,n,null)}get(e){return SN(this[on],e)}unset(e){return CN(this[on],e+"")}forEach(e){wl(this[on],e)}extend(){return new _e(this)}import(e){Ld(e)&&Object.keys(e).forEach(n=>{vo(this[on],n,e[n],null)})}dump(){const e={};return wl(this[on],(n,r)=>{typeof r<"u"&&Nd(e,n,r)}),e}static assert(e){return e instanceof _e?e:_e.getRuntimeSettings()}static getDefaultSettings(e=null){let n=_e[Tl];if(n instanceof _e||(n=new _e,_e[Tl]=n),e){const r={};return n.forEach(a=>{if(a.startsWith(e)){const i=a.split(`${e}.`)[1];r[i]=n.get(a)}}),r}return n}static getRuntimeSettings(){let e=_e[ml];return e instanceof _e||(e=new _e(_e.getDefaultSettings()),_e[ml]=e),e}static getObjectSettings(e,n){let r=null;if(e instanceof _e)r=e;else if(typeof e=="object"&&e!==null){let a=_e[Cl];a instanceof WeakMap||(a=new WeakMap,_e[Cl]=a),r=a.get(e),r instanceof _e||(r=new _e(_e.assert(_e.getObjectSettings(n))),a.set(e,r))}return r}static extendRuntimeSettings(){return _e.getRuntimeSettings().extend()}}function CN(t,e){if(e.endsWith(".")){let n=0;const r=e,a=r.slice(0,-1),i=a.length===0;for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(i||o.startsWith(r)||o===a)&&(delete t[o],++n);return n>0}return delete t[e]}function wl(t,e){for(const n in t)e(n,t[n])}function wN(t,e,n,r){let a;if(r.has(n))return vo(t,e,null,r);r.add(n),a=0;for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){const o=i.length===0?e:`${e}.${i}`;vo(t,o,n[i],r)||++a}return r.delete(n),a===0}function vo(t,e,n,r){return EN(e)?Ld(n)?wN(t,e,n,r instanceof WeakSet?r:new WeakSet):(t[e]=n,!0):!1}function SN(t,e){return t[e]}function EN(t){let e,n,r;if(typeof t!="string"||(e=t.length-1)<0)return!1;for(r=-1;(n=t.indexOf(".",r+1))>=0;){if(n-r<2||n===e)return!1;r=n}return!0}function Ld(t){if(typeof t=="object"&&t!==null){const e=Object.getPrototypeOf(t);if(e===Object.prototype||e===null)return!0}return!1}function Nd(t,e,n){const r=e.indexOf(".");if(r>=0){const a=e.slice(0,r);let i=t[a];if(typeof i!="object"||i===null){const o=i;i={},typeof o<"u"&&(i[""]=o),t[a]=i}Nd(i,e.slice(r+1,e.length),n)}else t[e]=n}_e.getDefaultSettings().set("useCursors",!0);const xN=t=>{const e=ON(t);!e||!e.length||e.forEach(({renderingEngine:n,viewportIds:r})=>{n.hasBeenDestroyed||n.renderViewports(r)})};function ON(t){const e=ra(),n=[];for(let r=0;r<e.length;r++){const a=e[r],i=Mo(t,a.id);i.length&&n.push({renderingEngine:a,viewportIds:i.map(o=>o.id)})}return n}const MN=xN;function RN(t,e){const n=t.length,{rescaleSlope:r,rescaleIntercept:a,suvbw:i}=e;if(e.modality==="PT"){if(typeof i!="number")return;for(let o=0;o<n;o++)t[o]=i*(t[o]*r+a)}else for(let o=0;o<n;o++)t[o]=t[o]*r+a;return t}const DN=qt.Prefetch,{getMinMax:VN}=XS;class LN extends JV{constructor(e,n){super(e),this._hasLoaded=()=>{const{loadStatus:r,imageIds:a}=this,i=a.length;for(let o=0;o<i;o++)if(!r.cachedFrames[o])return!1;return!0},this.load=(r,a=5)=>{const{imageIds:i,loadStatus:o}=this;if(o.loading===!0){console.log(`loadVolume: Loading is already in progress for ${this.volumeId}`);return}const{loaded:s}=this.loadStatus,c=i.length;if(s){r&&r({success:!0,framesLoaded:c,numFrames:c,framesProcessed:c});return}r&&this.loadStatus.callbacks.push(r),this._prefetchImageIds(a)},this.getImageLoadRequests=r=>{const{scalarData:a,loadStatus:i}=this,{cachedFrames:o}=i,{imageIds:s,vtkOpenGLTexture:c,imageData:u,metadata:g,volumeId:f}=this,{FrameOfReferenceUID:l}=g;i.loading=!0;const v=a.buffer,p=s.length,d=a.length/p,h=v.byteLength/p;let T;if(a instanceof Uint8Array)T="Uint8Array";else if(a instanceof Float32Array)T="Float32Array";else throw new Error("Unsupported array type");let C=0,m=0;const y=2;let w,S;w=p*(y/100),S=w;function O(N){(N.framesProcessed>S||N.framesProcessed===N.numFrames)&&(S+=w,MN(f)),N.framesProcessed===N.numFrames&&i.callbacks.forEach(U=>U(N))}const M=(N,U,b)=>{const G=be.getCachedImageBasedOnImageURI(U);if(!G||!G.image)return R(this,N,U);const P=this._scaleIfNecessary(G.image,b),{pixelsPerImage:z,bytesPerImage:F}=this._cornerstoneImageMetaData,V=this.scalarData.constructor;let B=F*N;const W=F/z;this.scalarData.BYTES_PER_ELEMENT!==W&&(B*=this.scalarData.BYTES_PER_ELEMENT/W);const I=new V(v,B,z);G.imageLoadObject.promise.then($=>{I.set(P),R(this,N,U)}).catch($=>{D($,N,U)})};function R(N,U,b){o[U]=!0,C++,m++,c.setUpdatedFrame(U),u.modified();const G={FrameOfReferenceUID:l,imageVolume:N};Y(ee,q.IMAGE_VOLUME_MODIFIED,G),m===p?(i.loaded=!0,i.loading=!1,O({success:!0,imageIdIndex:U,imageId:b,framesLoaded:C,framesProcessed:m,numFrames:p}),i.callbacks=[]):O({success:!0,imageIdIndex:U,imageId:b,framesLoaded:C,framesProcessed:m,numFrames:p})}function D(N,U,b){m++,m===p?(i.loaded=!0,i.loading=!1,O({success:!1,imageId:b,imageIdIndex:U,error:N,framesLoaded:C,framesProcessed:m,numFrames:p}),i.callbacks=[]):O({success:!1,imageId:b,imageIdIndex:U,error:N,framesLoaded:C,framesProcessed:m,numFrames:p});const G={error:N,imageIdIndex:U,imageId:b};Y(ee,q.IMAGE_LOAD_ERROR,G)}return s.map((N,U)=>{if(o[U]){C++,m++;return}const b=He("modalityLutModule",N)||{},G=He("generalSeriesModule",N)||{},P={rescaleSlope:b.rescaleSlope,rescaleIntercept:b.rescaleIntercept,modality:G.modality};if(P.modality==="PT"){const V=He("scalingModule",N);V&&(this._addScalingToVolume(V),P.suvbw=V.suvbw)}const z={targetBuffer:{arrayBuffer:v,offset:U*h,length:d,type:T},preScale:{enabled:!0,scalingParameters:P}};function F(V,B,W){return Sm(V,W).then(()=>{M(B,V,P)},I=>{D(I,B,V)})}return{callLoadImage:F,imageId:N,imageIdIndex:U,options:z,priority:r,requestType:DN,additionalDetails:{volumeId:this.volumeId}}})},this.imageIds=n.imageIds,this.loadStatus=n.loadStatus,this._createCornerstoneImageMetaData()}_createCornerstoneImageMetaData(){const e=this.imageIds.length,n=this.sizeInBytes/e,r=this.scalarData.length/this.numVoxels,a=this.dimensions[0]*this.dimensions[1]*r,{PhotometricInterpretation:i,voiLut:o}=this.metadata;let s=[],c=[];o&&o.length&&(s=o.map(g=>g.windowCenter),c=o.map(g=>g.windowWidth));const u=r>1;this._cornerstoneImageMetaData={bytesPerImage:n,numComponents:r,pixelsPerImage:a,windowCenter:s,windowWidth:c,color:u,spacing:this.spacing,dimensions:this.dimensions,PhotometricInterpretation:i,invert:i==="MONOCHROME1"}}cancelLoading(){const{loadStatus:e}=this;if(!e||!e.loading)return;e.loading=!1,this.clearLoadCallbacks();const n=({additionalDetails:r})=>r.volumeId!==this.volumeId;Ga.filterRequests(n)}clearLoadCallbacks(){this.loadStatus.callbacks=[]}_prefetchImageIds(e){this.getImageLoadRequests(e).reverse().forEach(r=>{if(!r)return;const{callLoadImage:a,imageId:i,imageIdIndex:o,options:s,priority:c,requestType:u,additionalDetails:g}=r;Ga.addRequest(a.bind(this,i,o,s),u,g,c)})}_scaleIfNecessary(e,n){const{rescaleSlope:r,rescaleIntercept:a,modality:i}=n;if(typeof r>"u"||typeof a>"u"||typeof i>"u"||r===null||a===null||i===null)return e.getPixelData();let o=n;if(e.preScale&&e.preScale.scalingParameters){const{suvbw:u}=e.preScale.scalingParameters,{suvbw:g}=n;if(typeof u>"u"||typeof g>"u"||u===null||g===null||u===g)return e.getPixelData();o={modality:n.modality,rescaleSlope:1,rescaleIntercept:0,suvbw:g/u}}const s=e.getPixelData().slice(0);return RN(s,o)}_addScalingToVolume(e){if(this.scaling)return;const{suvbw:n,suvlbm:r,suvbsa:a}=e,i={};r&&(i.suvbwToSuvlbm=r/n),a&&(i.suvbwToSuvbsa=a/n),this.scaling={PET:i},this.isPrescaled=!0}_removeFromCache(){be.removeVolumeLoadObject(this.volumeId)}convertToCornerstoneImage(e,n){const{imageIds:r}=this,{bytesPerImage:a,pixelsPerImage:i,windowCenter:o,windowWidth:s,numComponents:c,color:u,dimensions:g,spacing:f,invert:l}=this._cornerstoneImageMetaData,v=this.scalarData.buffer,p=this.scalarData.constructor,d=a/i;let h=a*n;this.scalarData.BYTES_PER_ELEMENT!==d&&(h*=this.scalarData.BYTES_PER_ELEMENT/d);const T=new p(i),C=new p(v,h,i);T.set(C);const m=r[n],y=He("modalityLutModule",m)||{},w=VN(T),S=y.rescaleIntercept?y.rescaleIntercept:0,O={imageId:e,intercept:S,windowCenter:o,windowWidth:s,color:u,numComps:c,rows:g[0],columns:g[1],sizeInBytes:T.byteLength,getPixelData:()=>T,minPixelValue:w.min,maxPixelValue:w.max,slope:y.rescaleSlope?y.rescaleSlope:1,getCanvas:void 0,height:g[0],width:g[1],rgba:void 0,columnPixelSpacing:f[0],rowPixelSpacing:f[1],invert:l};return{promise:Promise.resolve(O)}}_convertToImages(){const e=this.sizeInBytes,n=this.imageIds.length,{bytesPerImage:r}=this._cornerstoneImageMetaData;let a=be.decacheIfNecessaryUntilBytesAvailable(e,this.imageIds);for(let i=0;i<n;i++){const o=this.imageIds[i];a=a-r;const s=this.convertToCornerstoneImage(o,i);if(be.putImageLoadObject(o,s).catch(c=>{console.error(c)}),a<=r)break}this._removeFromCache()}decache(e=!1){e?this._removeFromCache():this._convertToImages()}}var Wc=E.vtkErrorMacro,NN={Unknown:0,Scalar:1,RGB:2,RGBA:3,Offset:4,Vector:5,Point:6,CovariantVector:7,SymmetricSecondRankTensor:8,DiffusionTensor3D:9,Complex:10,FixedArray:11,Array:12,Matrix:13,VariableLengthVector:14,VariableSizeMatrix:15},le={Unknown:"Unknown",Scalar:"Scalar",RGB:"RGB",RGBA:"RGBA",Offset:"Offset",Vector:"Vector",Point:"Point",CovariantVector:"CovariantVector",SymmetricSecondRankTensor:"SymmetricSecondRankTensor",DiffusionTensor3D:"DiffusionTensor3D",Complex:"Complex",FixedArray:"FixedArray",Array:"Array",Matrix:"Matrix",VariableLengthVector:"VariableLengthVector",VariableSizeMatrix:"VariableSizeMatrix"},zc=new Map([["Uint8Array","uint8"],["Int8Array","int8"],["Uint16Array","uint16"],["Int16Array","int16"],["Uint32Array","uint32"],["Int32Array","int32"],["Float32Array","float32"],["Float64Array","float64"]]),Sl=new Map([["uint8","Uint8Array"],["int8","Int8Array"],["uint16","Uint16Array"],["int16","Int16Array"],["uint32","Uint32Array"],["int32","Int32Array"],["float32","Float32Array"],["float64","Float64Array"]]);function FN(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n={origin:[0,0,0],spacing:[1,1,1]},r=[1,1,1],a=[1,0,0,0,1,0,0,0,1],i=t.direction.data===void 0,o=i?le:NN,s=0;s<t.imageType.dimension;++s){n.origin[s]=t.origin[s],n.spacing[s]=t.spacing[s],r[s]=t.size[s];for(var c=0;c<t.imageType.dimension;++c)i?a[c+s*3]=t.direction[s+c*t.imageType.dimension]:a[c+s*3]=t.direction.data[s+c*t.imageType.dimension]}var u=Bo.newInstance(n),g=Ve.newInstance({name:e.scalarArrayName||"Scalars",values:t.data,numberOfComponents:t.imageType.components});switch(u.setDirection(a),u.setDimensions.apply(u,r),u.getPointData().setScalars(g),i?o[t.imageType.pixelType]:t.imageType.pixelType){case o.Scalar:break;case o.RGB:break;case o.RGBA:break;case o.Offset:break;case o.Vector:t.imageType.dimension===3&&t.imageType.components===3&&u.getPointData().setVectors(g);break;case o.Point:break;case o.CovariantVector:t.imageType.dimension===3&&t.imageType.components===3&&u.getPointData().setVectors(g);break;case o.SymmetricSecondRankTensor:t.imageType.dimension===3&&t.imageType.components===6&&u.getPointData().setTensors(g);break;case o.DiffusionTensor3D:t.imageType.dimension===3&&t.imageType.components===6&&u.getPointData().setTensors(g);break;case o.Complex:break;case o.FixedArray:break;case o.Array:break;case o.Matrix:break;case o.VariableLengthVector:break;case o.VariableSizeMatrix:break;default:return Wc("Cannot handle unexpected itk-wasm pixel type ".concat(t.imageType.pixelType)),null}return u}function _N(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=3,r={imageType:{dimension:n,pixelType:le.Scalar,componentType:"",components:1},name:"vtkImageData",origin:t.getOrigin(),spacing:t.getSpacing(),direction:new Float64Array(9),size:t.getDimensions()},a=t.getDirection(),i=0;i<n;++i)for(var o=0;o<n;++o)r.direction[i+o*n]=a[o+i*n];var s=t.getPointData(),c;return s.getTensors()!==null?(r.imageType.pixelType=le.DiffusionTensor3D,c=s.getTensors()):s.getVectors()!=null?(r.imageType.pixelType=le.Vector,c=s.getVectors()):c=s.getScalars(),r.imageType.componentType=zc.get(c.getDataType()),e?r.data=c.getData().slice(0):r.data=c.getData(),r}function bN(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=[];t.pointData.length&&n.push({data:{vtkClass:"vtkDataArray",name:e.pointDataName||"PointData",numberOfComponents:t.polyDataType.pointPixelComponents,size:t.pointData.length,dataType:Sl.get(t.polyDataType.pointPixelComponentType),buffer:t.pointData.buffer,values:t.pointData}});var r=[];t.cellData.length&&r.push({data:{vtkClass:"vtkDataArray",name:e.cellDataName||"CellData",numberOfComponents:t.polyDataType.pointPixelComponents,size:t.cellData.length,dataType:Sl.get(t.polyDataType.pointPixelComponentType),buffer:t.cellData.buffer,values:t.cellData}});var a={points:{vtkClass:"vtkPoints",name:"_points",numberOfComponents:3,size:t.numberOfPoints,dataType:"Float32Array",buffer:t.points.buffer,values:t.points},verts:{vtkClass:"vtkCellArray",name:"_verts",numberOfComponents:1,size:t.verticesBufferSize,dataType:"Uint32Array",buffer:t.vertices.buffer,values:t.vertices},lines:{vtkClass:"vtkCellArray",name:"_lines",numberOfComponents:1,size:t.linesBufferSize,dataType:"Uint32Array",buffer:t.lines.buffer,values:t.lines},polys:{vtkClass:"vtkCellArray",name:"_polys",numberOfComponents:1,size:t.polygonsBufferSize,dataType:"Uint32Array",buffer:t.polygons.buffer,values:t.polygons},strips:{vtkClass:"vtkCellArray",name:"_strips",numberOfComponents:1,size:t.triangleStripsBufferSize,dataType:"Uint32Array",buffer:t.triangleStrips.buffer,values:t.triangleStrips},pointData:{vtkClass:"vtkDataSetAttributes",activeGlobalIds:-1,activeNormals:-1,activePedigreeIds:-1,activeScalars:-1,activeTCoords:-1,activeTensors:-1,activeVectors:-1,copyFieldFlags:[],doCopyAllOff:!1,doCopyAllOn:!0,arrays:n},cellData:{vtkClass:"vtkDataSetAttributes",activeGlobalIds:-1,activeNormals:-1,activePedigreeIds:-1,activeScalars:-1,activeTCoords:-1,activeTensors:-1,activeVectors:-1,copyFieldFlags:[],doCopyAllOff:!1,doCopyAllOn:!0,arrays:r}},i=TV.newInstance(a),o=i.getPointData(),s=i.getCellData();if(t.pointData.length)switch(le[t.polyDataType.pointPixelType]){case le.Scalar:o.setScalars(o.getArrayByIndex(0));break;case le.RGB:break;case le.RGBA:break;case le.Offset:break;case le.Vector:t.polyDataType.pointPixelComponents===3&&o.setVectors(o.getArrayByIndex(0));break;case le.Point:break;case le.CovariantVector:t.polyDataType.pointPixelComponents===3&&o.setVectors(o.getArrayByIndex(0));break;case le.SymmetricSecondRankTensor:t.polyDataType.pointPixelComponents===6&&o.setTensors(o.getArrayByIndex(0));break;case le.DiffusionTensor3D:t.polyDataType.pointPixelComponents===6&&o.setTensors(o.getArrayByIndex(0));break;case le.Complex:break;case le.FixedArray:break;case le.Array:break;case le.Matrix:break;case le.VariableLengthVector:break;case le.VariableSizeMatrix:break;default:return Wc("Cannot handle unexpected itk-wasm pixel type ".concat(t.polyDataType.pointPixelType)),null}if(t.cellData.length)switch(le[t.polyDataType.cellPixelType]){case le.Scalar:s.setScalars(s.getArrayByIndex(0));break;case le.RGB:break;case le.RGBA:break;case le.Offset:break;case le.Vector:t.polyDataType.pointPixelComponents===3&&s.setVectors(s.getArrayByIndex(0));break;case le.Point:break;case le.CovariantVector:t.polyDataType.pointPixelComponents===3&&s.setVectors(s.getArrayByIndex(0));break;case le.SymmetricSecondRankTensor:t.polyDataType.pointPixelComponents===6&&s.setTensors(s.getArrayByIndex(0));break;case le.DiffusionTensor3D:t.polyDataType.pointPixelComponents===6&&s.setTensors(s.getArrayByIndex(0));break;case le.Complex:break;case le.FixedArray:break;case le.Array:break;case le.Matrix:break;case le.VariableLengthVector:break;case le.VariableSizeMatrix:break;default:return Wc("Cannot handle unexpected itk-wasm pixel type ".concat(t.polyDataType.pointPixelType)),null}return i}function kN(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n={polyDataType:{pointPixelComponentType:"float32",pointPixelComponents:1,pointPixelType:"Scalar",cellPixelComponentType:"float32",cellPixelComponents:1,cellPixelType:"Scalar"},numberOfPoints:t.getNumberOfPoints(),points:t.getPoints().getData(),verticesBufferSize:t.getVerts().getNumberOfValues(),vertices:t.getVerts().getData(),linesBufferSize:t.getLines().getNumberOfValues(),lines:t.getLines().getData(),polygonsBufferSize:t.getPolys().getNumberOfValues(),polygons:t.getPolys().getData(),triangleStripsBufferSize:t.getStrips().getNumberOfValues(),triangleStrips:t.getStrips().getData(),numberOfPointPixels:0,pointData:new Float32Array,numberOfCellPixels:0,cellData:new Float32Array},r=t.getPointData();if(r.getNumberOfArrays()){var a=e.pointDataName?r.getArrayByName(e.pointDataName):r.getArrayByIndex(0);n.numberOfPointPixels=a.getNumberOfTuples(),n.pointData=a.getData(),n.polyDataType.pointPixelComponentType=zc.get(a.getDataType()),n.polyDataType.cellPixelComponentType=n.polyDataType.pointPixelComponentType,n.polyDataType.pointPixelComponents=a.getNumberOfComponents(),n.polyDataType.cellPixelComponents=n.polyDataType.pointPixelComponents,r.getTensors()===a?n.polyDataType.pointPixelType=le.SymmetricSecondRankTensor:r.getVectors()===a&&(n.polyDataType.pointPixelType=le.Vector),n.polyDataType.cellPixelType=n.polyDataType.pointPixelType}var i=t.getCellData();if(i.getNumberOfArrays()){var o=e.cellDataName?r.getArrayByName(e.cellDataName):r.getArrayByIndex(0);n.numberOfCellPixels=o.getNumberOfTuples(),n.cellData=o.getData(),n.polyDataType.cellPixelComponentType=zc.get(o.getDataType()),n.polyDataType.cellPixelComponents=o.getNumberOfComponents(),i.getTensors()===o?n.polyDataType.cellPixelType=le.SymmetricSecondRankTensor:i.getVectors()===o?n.polyDataType.cellPixelType=le.Vector:n.polyDataType.cellPixelType=le.Scalar}return n}var UN={convertItkToVtkImage:FN,convertVtkToItkImage:_N,convertItkToVtkPolyData:bN,convertVtkToItkPolyData:kN};const BN={TextFile:"InterfaceTextFile",BinaryFile:"InterfaceBinaryFile",TextStream:"InterfaceTextStream",BinaryStream:"InterfaceBinaryStream",Image:"InterfaceImage",Mesh:"InterfaceMesh",PolyData:"InterfacePolyData"},po=BN,GN={Int8:"int8",UInt8:"uint8",Int16:"int16",UInt16:"uint16",Int32:"int32",UInt32:"uint32",Int64:"int64",UInt64:"uint64",SizeValueType:"uint64",IdentifierType:"uint64",IndexValueType:"int64",OffsetValueType:"int64"},ot=GN,AN={Float32:"float32",Float64:"float64",SpacePrecisionType:"float64"},Jr=AN;function IN(t){let e=t.slice((t.lastIndexOf(".")-1>>>0)+2);if(e.toLowerCase()==="gz"){const n=t.slice(0,-3).lastIndexOf(".");e=t.slice((n-1>>>0)+2)}else if(e.toLowerCase()==="cbor"){const n=t.slice(0,-5).lastIndexOf(".");e=t.slice((n-1>>>0)+2)}else if(e.toLowerCase()==="zstd"){const n=t.slice(0,-10).lastIndexOf(".");e=t.slice((n-1>>>0)+2)}else if(e.toLowerCase()==="zip"){const n=t.slice(0,-4).lastIndexOf(".");e=t.slice((n-1>>>0)+2)}return e}const PN=new Map([["vtk","VTKPolyDataMeshIO"],["VTK","VTKPolyDataMeshIO"],["byu","BYUMeshIO"],["BYU","BYUMeshIO"],["fsa","FreeSurferAsciiMeshIO"],["FSA","FreeSurferAsciiMeshIO"],["fsb","FreeSurferBinaryMeshIO"],["FSB","FreeSurferBinaryMeshIO"],["obj","OBJMeshIO"],["OBJ","OBJMeshIO"],["off","OFFMeshIO"],["OFF","OFFMeshIO"],["stl","STLMeshIO"],["STL","STLMeshIO"],["swc","SWCMeshIO"],["SWC","SWCMeshIO"],["iwm","WASMMeshIO"],["iwm.cbor","WASMMeshIO"],["iwm.cbor.zstd","WASMZstdMeshIO"]]),WN=PN;var Fd={exports:{}},Hu={exports:{}},_d=function(e,n){return function(){for(var a=new Array(arguments.length),i=0;i<a.length;i++)a[i]=arguments[i];return e.apply(n,a)}},zN=_d,dr=Object.prototype.toString;function Ku(t){return dr.call(t)==="[object Array]"}function $c(t){return typeof t>"u"}function $N(t){return t!==null&&!$c(t)&&t.constructor!==null&&!$c(t.constructor)&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}function jN(t){return dr.call(t)==="[object ArrayBuffer]"}function HN(t){return typeof FormData<"u"&&t instanceof FormData}function KN(t){var e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&t.buffer instanceof ArrayBuffer,e}function qN(t){return typeof t=="string"}function XN(t){return typeof t=="number"}function bd(t){return t!==null&&typeof t=="object"}function Wi(t){if(dr.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function YN(t){return dr.call(t)==="[object Date]"}function ZN(t){return dr.call(t)==="[object File]"}function JN(t){return dr.call(t)==="[object Blob]"}function kd(t){return dr.call(t)==="[object Function]"}function QN(t){return bd(t)&&kd(t.pipe)}function e6(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}function t6(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function n6(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function qu(t,e){if(!(t===null||typeof t>"u"))if(typeof t!="object"&&(t=[t]),Ku(t))for(var n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.call(null,t[a],a,t)}function jc(){var t={};function e(a,i){Wi(t[i])&&Wi(a)?t[i]=jc(t[i],a):Wi(a)?t[i]=jc({},a):Ku(a)?t[i]=a.slice():t[i]=a}for(var n=0,r=arguments.length;n<r;n++)qu(arguments[n],e);return t}function r6(t,e,n){return qu(e,function(a,i){n&&typeof a=="function"?t[i]=zN(a,n):t[i]=a}),t}function a6(t){return t.charCodeAt(0)===65279&&(t=t.slice(1)),t}var xt={isArray:Ku,isArrayBuffer:jN,isBuffer:$N,isFormData:HN,isArrayBufferView:KN,isString:qN,isNumber:XN,isObject:bd,isPlainObject:Wi,isUndefined:$c,isDate:YN,isFile:ZN,isBlob:JN,isFunction:kd,isStream:QN,isURLSearchParams:e6,isStandardBrowserEnv:n6,forEach:qu,merge:jc,extend:r6,trim:t6,stripBOM:a6},_r=xt;function El(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Ud=function(e,n,r){if(!n)return e;var a;if(r)a=r(n);else if(_r.isURLSearchParams(n))a=n.toString();else{var i=[];_r.forEach(n,function(c,u){c===null||typeof c>"u"||(_r.isArray(c)?u=u+"[]":c=[c],_r.forEach(c,function(f){_r.isDate(f)?f=f.toISOString():_r.isObject(f)&&(f=JSON.stringify(f)),i.push(El(u)+"="+El(f))}))}),a=i.join("&")}if(a){var o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+a}return e},i6=xt;function zo(){this.handlers=[]}zo.prototype.use=function(e,n,r){return this.handlers.push({fulfilled:e,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1};zo.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)};zo.prototype.forEach=function(e){i6.forEach(this.handlers,function(r){r!==null&&e(r)})};var o6=zo,s6=xt,c6=function(e,n){s6.forEach(e,function(a,i){i!==n&&i.toUpperCase()===n.toUpperCase()&&(e[n]=a,delete e[i])})},Bd=function(e,n,r,a,i){return e.config=n,r&&(e.code=r),e.request=a,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e},bs,xl;function Gd(){if(xl)return bs;xl=1;var t=Bd;return bs=function(n,r,a,i,o){var s=new Error(n);return t(s,r,a,i,o)},bs}var ks,Ol;function u6(){if(Ol)return ks;Ol=1;var t=Gd();return ks=function(n,r,a){var i=a.config.validateStatus;!a.status||!i||i(a.status)?n(a):r(t("Request failed with status code "+a.status,a.config,null,a.request,a))},ks}var Us,Ml;function f6(){if(Ml)return Us;Ml=1;var t=xt;return Us=t.isStandardBrowserEnv()?function(){return{write:function(r,a,i,o,s,c){var u=[];u.push(r+"="+encodeURIComponent(a)),t.isNumber(i)&&u.push("expires="+new Date(i).toGMTString()),t.isString(o)&&u.push("path="+o),t.isString(s)&&u.push("domain="+s),c===!0&&u.push("secure"),document.cookie=u.join("; ")},read:function(r){var a=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return a?decodeURIComponent(a[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Us}var Bs,Rl;function g6(){return Rl||(Rl=1,Bs=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}),Bs}var Gs,Dl;function l6(){return Dl||(Dl=1,Gs=function(e,n){return n?e.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):e}),Gs}var As,Vl;function v6(){if(Vl)return As;Vl=1;var t=g6(),e=l6();return As=function(r,a){return r&&!t(a)?e(r,a):a},As}var Is,Ll;function p6(){if(Ll)return Is;Ll=1;var t=xt,e=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Is=function(r){var a={},i,o,s;return r&&t.forEach(r.split(`
`),function(u){if(s=u.indexOf(":"),i=t.trim(u.substr(0,s)).toLowerCase(),o=t.trim(u.substr(s+1)),i){if(a[i]&&e.indexOf(i)>=0)return;i==="set-cookie"?a[i]=(a[i]?a[i]:[]).concat([o]):a[i]=a[i]?a[i]+", "+o:o}}),a},Is}var Ps,Nl;function h6(){if(Nl)return Ps;Nl=1;var t=xt;return Ps=t.isStandardBrowserEnv()?function(){var n=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),a;function i(o){var s=o;return n&&(r.setAttribute("href",s),s=r.href),r.setAttribute("href",s),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return a=i(window.location.href),function(s){var c=t.isString(s)?i(s):s;return c.protocol===a.protocol&&c.host===a.host}}():function(){return function(){return!0}}(),Ps}var Ws,Fl;function $o(){if(Fl)return Ws;Fl=1;function t(e){this.message=e}return t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,Ws=t,Ws}var zs,_l;function bl(){if(_l)return zs;_l=1;var t=xt,e=u6(),n=f6(),r=Ud,a=v6(),i=p6(),o=h6(),s=Gd(),c=jo(),u=$o();return zs=function(f){return new Promise(function(v,p){var d=f.data,h=f.headers,T=f.responseType,C;function m(){f.cancelToken&&f.cancelToken.unsubscribe(C),f.signal&&f.signal.removeEventListener("abort",C)}t.isFormData(d)&&delete h["Content-Type"];var y=new XMLHttpRequest;if(f.auth){var w=f.auth.username||"",S=f.auth.password?unescape(encodeURIComponent(f.auth.password)):"";h.Authorization="Basic "+btoa(w+":"+S)}var O=a(f.baseURL,f.url);y.open(f.method.toUpperCase(),r(O,f.params,f.paramsSerializer),!0),y.timeout=f.timeout;function M(){if(!!y){var D="getAllResponseHeaders"in y?i(y.getAllResponseHeaders()):null,L=!T||T==="text"||T==="json"?y.responseText:y.response,N={data:L,status:y.status,statusText:y.statusText,headers:D,config:f,request:y};e(function(b){v(b),m()},function(b){p(b),m()},N),y=null}}if("onloadend"in y?y.onloadend=M:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(M)},y.onabort=function(){!y||(p(s("Request aborted",f,"ECONNABORTED",y)),y=null)},y.onerror=function(){p(s("Network Error",f,null,y)),y=null},y.ontimeout=function(){var L=f.timeout?"timeout of "+f.timeout+"ms exceeded":"timeout exceeded",N=f.transitional||c.transitional;f.timeoutErrorMessage&&(L=f.timeoutErrorMessage),p(s(L,f,N.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",y)),y=null},t.isStandardBrowserEnv()){var R=(f.withCredentials||o(O))&&f.xsrfCookieName?n.read(f.xsrfCookieName):void 0;R&&(h[f.xsrfHeaderName]=R)}"setRequestHeader"in y&&t.forEach(h,function(L,N){typeof d>"u"&&N.toLowerCase()==="content-type"?delete h[N]:y.setRequestHeader(N,L)}),t.isUndefined(f.withCredentials)||(y.withCredentials=!!f.withCredentials),T&&T!=="json"&&(y.responseType=f.responseType),typeof f.onDownloadProgress=="function"&&y.addEventListener("progress",f.onDownloadProgress),typeof f.onUploadProgress=="function"&&y.upload&&y.upload.addEventListener("progress",f.onUploadProgress),(f.cancelToken||f.signal)&&(C=function(D){!y||(p(!D||D&&D.type?new u("canceled"):D),y.abort(),y=null)},f.cancelToken&&f.cancelToken.subscribe(C),f.signal&&(f.signal.aborted?C():f.signal.addEventListener("abort",C))),d||(d=null),y.send(d)})},zs}var $s,kl;function jo(){if(kl)return $s;kl=1;var t=xt,e=c6,n=Bd,r={"Content-Type":"application/x-www-form-urlencoded"};function a(c,u){!t.isUndefined(c)&&t.isUndefined(c["Content-Type"])&&(c["Content-Type"]=u)}function i(){var c;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(c=bl()),c}function o(c,u,g){if(t.isString(c))try{return(u||JSON.parse)(c),t.trim(c)}catch(f){if(f.name!=="SyntaxError")throw f}return(g||JSON.stringify)(c)}var s={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:i(),transformRequest:[function(u,g){return e(g,"Accept"),e(g,"Content-Type"),t.isFormData(u)||t.isArrayBuffer(u)||t.isBuffer(u)||t.isStream(u)||t.isFile(u)||t.isBlob(u)?u:t.isArrayBufferView(u)?u.buffer:t.isURLSearchParams(u)?(a(g,"application/x-www-form-urlencoded;charset=utf-8"),u.toString()):t.isObject(u)||g&&g["Content-Type"]==="application/json"?(a(g,"application/json"),o(u)):u}],transformResponse:[function(u){var g=this.transitional||s.transitional,f=g&&g.silentJSONParsing,l=g&&g.forcedJSONParsing,v=!f&&this.responseType==="json";if(v||l&&t.isString(u)&&u.length)try{return JSON.parse(u)}catch(p){if(v)throw p.name==="SyntaxError"?n(p,this,"E_JSON_PARSE"):p}return u}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(u){return u>=200&&u<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};return t.forEach(["delete","get","head"],function(u){s.headers[u]={}}),t.forEach(["post","put","patch"],function(u){s.headers[u]=t.merge(r)}),$s=s,$s}var d6=xt,y6=jo(),T6=function(e,n,r){var a=this||y6;return d6.forEach(r,function(o){e=o.call(a,e,n)}),e},js,Ul;function Ad(){return Ul||(Ul=1,js=function(e){return!!(e&&e.__CANCEL__)}),js}var Bl=xt,Hs=T6,m6=Ad(),C6=jo(),w6=$o();function Ks(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new w6("canceled")}var S6=function(e){Ks(e),e.headers=e.headers||{},e.data=Hs.call(e,e.data,e.headers,e.transformRequest),e.headers=Bl.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),Bl.forEach(["delete","get","head","post","put","patch","common"],function(a){delete e.headers[a]});var n=e.adapter||C6.adapter;return n(e).then(function(a){return Ks(e),a.data=Hs.call(e,a.data,a.headers,e.transformResponse),a},function(a){return m6(a)||(Ks(e),a&&a.response&&(a.response.data=Hs.call(e,a.response.data,a.response.headers,e.transformResponse))),Promise.reject(a)})},Ct=xt,Id=function(e,n){n=n||{};var r={};function a(g,f){return Ct.isPlainObject(g)&&Ct.isPlainObject(f)?Ct.merge(g,f):Ct.isPlainObject(f)?Ct.merge({},f):Ct.isArray(f)?f.slice():f}function i(g){if(Ct.isUndefined(n[g])){if(!Ct.isUndefined(e[g]))return a(void 0,e[g])}else return a(e[g],n[g])}function o(g){if(!Ct.isUndefined(n[g]))return a(void 0,n[g])}function s(g){if(Ct.isUndefined(n[g])){if(!Ct.isUndefined(e[g]))return a(void 0,e[g])}else return a(void 0,n[g])}function c(g){if(g in n)return a(e[g],n[g]);if(g in e)return a(void 0,e[g])}var u={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:c};return Ct.forEach(Object.keys(e).concat(Object.keys(n)),function(f){var l=u[f]||i,v=l(f);Ct.isUndefined(v)&&l!==c||(r[f]=v)}),r},qs,Gl;function Pd(){return Gl||(Gl=1,qs={version:"0.23.0"}),qs}var E6=Pd().version,Xu={};["object","boolean","number","function","string","symbol"].forEach(function(t,e){Xu[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});var Al={};Xu.transitional=function(e,n,r){function a(i,o){return"[Axios v"+E6+"] Transitional option '"+i+"'"+o+(r?". "+r:"")}return function(i,o,s){if(e===!1)throw new Error(a(o," has been removed"+(n?" in "+n:"")));return n&&!Al[o]&&(Al[o]=!0,console.warn(a(o," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(i,o,s):!0}};function x6(t,e,n){if(typeof t!="object")throw new TypeError("options must be an object");for(var r=Object.keys(t),a=r.length;a-- >0;){var i=r[a],o=e[i];if(o){var s=t[i],c=s===void 0||o(s,i,t);if(c!==!0)throw new TypeError("option "+i+" must be "+c);continue}if(n!==!0)throw Error("Unknown option "+i)}}var O6={assertOptions:x6,validators:Xu},Wd=xt,M6=Ud,Il=o6,Pl=S6,Ho=Id,zd=O6,br=zd.validators;function ni(t){this.defaults=t,this.interceptors={request:new Il,response:new Il}}ni.prototype.request=function(e){typeof e=="string"?(e=arguments[1]||{},e.url=arguments[0]):e=e||{},e=Ho(this.defaults,e),e.method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var n=e.transitional;n!==void 0&&zd.assertOptions(n,{silentJSONParsing:br.transitional(br.boolean),forcedJSONParsing:br.transitional(br.boolean),clarifyTimeoutError:br.transitional(br.boolean)},!1);var r=[],a=!0;this.interceptors.request.forEach(function(l){typeof l.runWhen=="function"&&l.runWhen(e)===!1||(a=a&&l.synchronous,r.unshift(l.fulfilled,l.rejected))});var i=[];this.interceptors.response.forEach(function(l){i.push(l.fulfilled,l.rejected)});var o;if(!a){var s=[Pl,void 0];for(Array.prototype.unshift.apply(s,r),s=s.concat(i),o=Promise.resolve(e);s.length;)o=o.then(s.shift(),s.shift());return o}for(var c=e;r.length;){var u=r.shift(),g=r.shift();try{c=u(c)}catch(f){g(f);break}}try{o=Pl(c)}catch(f){return Promise.reject(f)}for(;i.length;)o=o.then(i.shift(),i.shift());return o};ni.prototype.getUri=function(e){return e=Ho(this.defaults,e),M6(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")};Wd.forEach(["delete","get","head","options"],function(e){ni.prototype[e]=function(n,r){return this.request(Ho(r||{},{method:e,url:n,data:(r||{}).data}))}});Wd.forEach(["post","put","patch"],function(e){ni.prototype[e]=function(n,r,a){return this.request(Ho(a||{},{method:e,url:n,data:r}))}});var R6=ni,Xs,Wl;function D6(){if(Wl)return Xs;Wl=1;var t=$o();function e(n){if(typeof n!="function")throw new TypeError("executor must be a function.");var r;this.promise=new Promise(function(o){r=o});var a=this;this.promise.then(function(i){if(!!a._listeners){var o,s=a._listeners.length;for(o=0;o<s;o++)a._listeners[o](i);a._listeners=null}}),this.promise.then=function(i){var o,s=new Promise(function(c){a.subscribe(c),o=c}).then(i);return s.cancel=function(){a.unsubscribe(o)},s},n(function(o){a.reason||(a.reason=new t(o),r(a.reason))})}return e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e.prototype.subscribe=function(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]},e.prototype.unsubscribe=function(r){if(!!this._listeners){var a=this._listeners.indexOf(r);a!==-1&&this._listeners.splice(a,1)}},e.source=function(){var r,a=new e(function(o){r=o});return{token:a,cancel:r}},Xs=e,Xs}var Ys,zl;function V6(){return zl||(zl=1,Ys=function(e){return function(r){return e.apply(null,r)}}),Ys}var Zs,$l;function L6(){return $l||($l=1,Zs=function(e){return typeof e=="object"&&e.isAxiosError===!0}),Zs}var jl=xt,N6=_d,zi=R6,F6=Id,_6=jo();function $d(t){var e=new zi(t),n=N6(zi.prototype.request,e);return jl.extend(n,zi.prototype,e),jl.extend(n,e),n.create=function(a){return $d(F6(t,a))},n}var en=$d(_6);en.Axios=zi;en.Cancel=$o();en.CancelToken=D6();en.isCancel=Ad();en.VERSION=Pd().version;en.all=function(e){return Promise.all(e)};en.spread=V6();en.isAxiosError=L6();Hu.exports=en;Hu.exports.default=en;(function(t){t.exports=Hu.exports})(Fd);const Hl=uv(Fd.exports);class b6{constructor(){Object.defineProperty(this,"__listeners",{value:{},enumerable:!1,writable:!1})}emit(e,...n){if(!this.__listeners[e])return this;for(const r of this.__listeners[e])r(...n);return this}once(e,n){const r=(...a)=>{this.off(e,r),n(...a)};return this.on(e,r)}on(e,n){return this.__listeners[e]||(this.__listeners[e]=[]),this.__listeners[e].push(n),this}off(e,n){return n?this.__listeners[e]=this.__listeners[e].filter(r=>r!==n):this.__listeners[e]=[],this}}var k6=b6;const U6=k6,B6=0,G6=1,A6=1;class I6 extends U6{constructor(e){super(),this._messageId=1,this._messages=new Map,this._worker=e,this._worker.onmessage=this._onMessage.bind(this),this._id=Math.ceil(Math.random()*1e7)}terminate(){this._worker.terminate()}isFree(){return this._messages.size===0}jobsLength(){return this._messages.size}exec(e,n=null,r=[],a){return new Promise((i,o)=>{const s=this._messageId++;this._messages.set(s,[i,o,a]),this._worker.postMessage([s,n,e],r||[])})}postMessage(e=null,n=[],r){return new Promise((a,i)=>{const o=this._messageId++;this._messages.set(o,[a,i,r]),this._worker.postMessage([o,e],n||[])})}emit(e,...n){this._worker.postMessage({eventName:e,args:n})}_onMessage(e){if(!Array.isArray(e.data)&&e.data.eventName)return super.emit(e.data.eventName,...e.data.args);const[n,...r]=e.data;if(n===G6)this._onEvent(...r);else if(n===B6)this._onResult(...r);else throw new Error(`Wrong message type '${n}'`)}_onResult(e,n,r){const[a,i]=this._messages.get(e);return this._messages.delete(e),n===A6?a(r):i(r)}_onEvent(e,n,r){const[,,a]=this._messages.get(e);a&&a(n,r)}}var Kl=I6;const Di="1.0.0-b.18",P6={webWorkersUrl:void 0,pipelineWorkerUrl:`https://cdn.jsdelivr.net/npm/itk-wasm@${Di}/dist/web-workers/min-bundles/pipeline.worker.js`,imageIOUrl:`https://cdn.jsdelivr.net/npm/itk-image-io@${Di}`,meshIOUrl:`https://cdn.jsdelivr.net/npm/itk-mesh-io@${Di}`,pipelinesUrl:`https://cdn.jsdelivr.net/npm/itk-wasm@${Di}/dist/pipeline`},ka=P6;async function jd(t){if(t!=null){const a=new Kl(t);return await Promise.resolve({webworkerPromise:a,worker:t})}let e=null;const n=ka.webWorkersUrl;if(typeof n<"u"){console.warn("itkConfig webWorkersUrl is deprecated. Please use pipelineWorkerUrl with the full path to the pipeline worker.");const a="min-",i=n;if(i.startsWith("http")){const o=await Hl.get(`${i}/${a}bundles/pipeline.worker.js`,{responseType:"blob"});e=new Worker(URL.createObjectURL(o.data))}else e=new Worker(`${i}/${a}bundles/pipeline.worker.js`)}else if(ka.pipelineWorkerUrl===null)e=new Worker("/assets/pipeline.worker.ddca5667.js");else{const a=ka.pipelineWorkerUrl;if(a.startsWith("http")){const i=await Hl.get(a,{responseType:"blob"});e=new Worker(URL.createObjectURL(i.data))}else e=new Worker(a)}return{webworkerPromise:new Kl(e),worker:e}}async function W6(t,e,n,r){let a=t;const{webworkerPromise:i,worker:o}=await jd(a);a=o;const s=`./${n}`,c=[s,"0","--memory-io","--quiet"],u=[{type:po.Image}],g=[{type:po.BinaryFile,data:{path:s,data:new Uint8Array(e)}}],f=[e];return{image:(await i.postMessage({operation:"readImage",config:ka,mimeType:r,fileName:n,pipelinePath:"ReadImage",args:c,outputs:u,inputs:g},f)).outputs[0].data,webWorker:a}}async function z6(t,e,n,r){let a=t;const{webworkerPromise:i,worker:o}=await jd(a);a=o;const s=`./${n}`,c=[s,"0","--memory-io","--quiet"],u=[{type:po.Mesh}],g=[{type:po.BinaryFile,data:{path:s,data:new Uint8Array(e)}}],f=[e];return{mesh:(await i.postMessage({operation:"readMesh",config:ka,mimeType:r,fileName:n,pipelinePath:"ReadMesh",args:c,outputs:u,inputs:g},f)).outputs[0].data,webWorker:a}}const $6=new Map([]),j6=$6;function Yu(t,e){if(!(t instanceof Blob))throw new TypeError("Must be a File or Blob");return new Promise(function(n,r){var a=new FileReader;a.onload=function(i){n(i.target.result)},a.onerror=function(i){r(new Error("Error reading"+t.name+": "+i.target.result))},a["readAs"+e](t)})}function H6(t){return Yu(t,"DataURL")}function K6(t){return Yu(t,"Text")}function q6(t){return Yu(t,"ArrayBuffer")}var Hd={readAsDataURL:H6,readAsText:K6,readAsArrayBuffer:q6};async function ql(t,e,n,r){const a=await Hd.readAsArrayBuffer(e);return await W6(t,a,n,r)}async function X6(t,e,n,r){const a=await Hd.readAsArrayBuffer(e);return await z6(t,a,n,r)}async function Y6(t,e,n,r){const a=IN(n);return!!WN.has(a)||!!j6.has(r)?await X6(t,e,n,r).catch(async function(){return t!==null&&t.terminate(),await ql(null,e,n,r)}):await ql(t,e,n,r)}async function Xl(t,e){const n=location.hostname.toLowerCase().includes("localhost")?"https://gc.localhost":"https://grand-challenge.org",r=new URL(t,n),a=new Headers,i=await fetch(r,{headers:a,redirect:"follow",credentials:"include"});if(i.status===400&&i.redirected&&i.headers.get("Server")==="MinIO")return fetch(i.url);if(i.status!==200){const o=await i.text();e(new Error(`Fetch error: ${i.statusText}, ${o}`))}return i}const Z6=new Map([[ot.UInt8,8],[ot.Int8,8],[ot.UInt16,16],[ot.Int16,16],[ot.UInt32,32],[ot.Int32,32],[ot.UInt64,64],[ot.Int64,64],[Jr.Float32,32],[Jr.Float64,64]]),Yl=new Map([[ot.UInt8,0],[ot.Int8,1],[ot.UInt16,0],[ot.Int16,1],[ot.UInt32,0],[ot.Int32,1],[ot.UInt64,0],[ot.Int64,1],[Jr.Float32,0],[Jr.Float64,0]]),Zl=new Map([["GRAY","MONOCHROME2"],["RGB","RGB"],["YCBCR","YBR_FULL"]]);async function J6(t,e,n){var C,m;const{image:r,webWorker:a}=await Y6(null,e,"image.mha","image/mha");if(r.data===null)throw Error("Image data is empty");if(!Z6.has(r.imageType.componentType)||!Yl.has(r.imageType.componentType))throw Error("Unsupported ITK image type: "+r.imageType.componentType);if(!Zl.has(n.color_space))throw Error(`Unsupported color space: ${n.color_space}`);const i=r.size,o=r.spacing,s=r.origin;let c=r.direction;i.length===2&&(i.push(1),o.push(1),s.push(0),c=[c[0],c[1],0,c[2],c[3],0,0,0,1]);let u;if(r.imageType.componentType!==Jr.Float32&&r.imageType.componentType!==ot.UInt8)if(console.warn(`Cornerstone3D only supports uint8 or float32 datatypes. This image has a datatype of ${r.imageType.componentType} which will be converted with loss of resolution.`),r.imageType.componentType===Jr.Float64)u=new Float32Array(r.data);else{const y=new Worker(window.convertWorkerPath);u=await new Promise(S=>{y.addEventListener("message",O=>{S(O.data)}),y.postMessage(r.data)})}else u=r.data;const g=u.BYTES_PER_ELEMENT*8;let f=0,l=1;u.constructor.name.startsWith("Float")||u.constructor.name.startsWith("U");const v=r.data.length*g/8,p=(C=n.window_width)!=null?C:l-f,d=(m=n.window_center)!=null?m:f+p/2,h={BitsAllocated:n.color_space==="GRAY"?g:g*3,BitsStored:n.color_space==="GRAY"?g:g*3,SamplesPerPixel:n.color_space==="GRAY"?1:3,HighBit:n.color_space==="GRAY"?g-1:g*3-1,PhotometricInterpretation:Zl.get(n.color_space),PixelRepresentation:Yl.get(r.imageType.componentType),Modality:n.modality!==null?n.modality.modality:"",ImageOrientationPatient:[1,1],PixelSpacing:o,FrameOfReferenceUID:"",Columns:i[0],Rows:i[1],voiLut:[{windowWidth:p,windowCenter:d}]},T={volumeId:t,dimensions:i,spacing:o,origin:s,direction:c,scalarData:u,imageData:UN.convertItkToVtkImage(r),sizeInBytes:v,metadata:h};return a.terminate(),T}const Q6={imageIds:["empty"],loadStatus:{loaded:!0,loading:!1,cachedFrames:[],callbacks:[]}};function eF(t){const[e,n]=t.split(":"),r=`/api/v1/cases/images/${n}/`;return{promise:new Promise(async(i,o)=>{const c=await(await Xl(r,o)).json(),u=c.files.filter(p=>["MHD","MHA"].includes(p.image_type));u.length<1&&o(new Error("No MHD/MHA files found for image.")),c.color_space!=="GRAY"&&o(new Error("Color images are currently not supported."));const f=await(await Xl(u[0].file,o)).blob(),l=await J6(t,f,c),v=new LN(l,Q6);i(v)})}}var yn;(function(t){t[t.Primary=1]="Primary",t[t.Secondary=2]="Secondary",t[t.Primary_And_Secondary=3]="Primary_And_Secondary",t[t.Auxiliary=4]="Auxiliary",t[t.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",t[t.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",t[t.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",t[t.Fourth_Button=8]="Fourth_Button",t[t.Fifth_Button=16]="Fifth_Button"})(yn||(yn={}));var Jl;(function(t){t[t.Shift=16]="Shift",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt"})(Jl||(Jl={}));var Hc;(function(t){t.Active="Active",t.Passive="Passive",t.Enabled="Enabled",t.Disabled="Disabled"})(Hc||(Hc={}));const Wt=Hc;var Kc;(function(t){t.Default="",t.Highlighted="Highlighted",t.Selected="Selected",t.Locked="Locked"})(Kc||(Kc={}));const tF=Kc;var qc;(function(t){t.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",t.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",t.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",t.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",t.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",t.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",t.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",t.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",t.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",t.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",t.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",t.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",t.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",t.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",t.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",t.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",t.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",t.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",t.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",t.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",t.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",t.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",t.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",t.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL"})(qc||(qc={}));const ne=qc;var Xc;(function(t){t.Labelmap="LABELMAP"})(Xc||(Xc={}));const Qr=Xc,$i=new Set;function Kd(t,e=!0){const n=rF();t&&(e?aF(t,$i,n):iF(t,$i,n)),oF(n,$i)}function qd(t){return $i.has(t)}function nF(t){if(t){const e=!!t.isLocked;sF(t)&&Object.defineProperty(t,"isLocked",{configurable:!1,enumerable:!0,set:Xd,get:Yd}),Kd(t,e)}}function rF(){return Object.freeze({added:[],removed:[],locked:[]})}function aF(t,e,n){e.has(t)||(e.add(t),n.added.push(t))}function iF(t,e,n){e.delete(t)&&n.removed.push(t)}function oF(t,e){(t.added.length>0||t.removed.length>0)&&(e.forEach(n=>void t.locked.push(n)),Y(ee,ne.ANNOTATION_LOCK_CHANGE,t))}function sF(t){const e=Object.getOwnPropertyDescriptor(t,"isLocked");return e?e.configurable&&(e.set!==Xd||e.get!==Yd):Object.isExtensible(t)}function Xd(t){Kd(this,t)}function Yd(){return qd(this)}const Gn=new Set;function ji(t,e=!0,n=!1){e?cF(t,n):Zd(t)}function cF(t,e=!1){const n=Qd();e||e2(Gn,n),t&&!Gn.has(t)&&(Gn.add(t),n.added.push(t)),t2(n,Gn)}function Zd(t){const e=Qd();t?Gn.delete(t)&&e.removed.push(t):e2(Gn,e),t2(e,Gn)}function Jd(t){return Gn.has(t)}function Qd(){return Object.freeze({added:[],removed:[],selection:[]})}function e2(t,e){t.forEach(n=>{t.delete(n)&&e.removed.push(n)})}function t2(t,e){(t.added.length>0||t.removed.length>0)&&(e.forEach(n=>void t.selection.push(n)),Y(ee,ne.ANNOTATION_SELECTION_CHANGE,t))}const ho=new Set;function n2(t,e=!0){const n=fF();t&&(e?gF(t,ho,n):lF(t,ho,n)),vF(n)}function r2(t){if(TF(t))return!ho.has(t)}function uF(t){var e;if(t){const n=(e=t.isVisible)!=null?e:!0;pF(t)&&Object.defineProperty(t,"isVisible",{configurable:!1,enumerable:!0,set:a2,get:i2}),n2(t.annotationUID,n)}}function fF(){return Object.freeze({lastVisible:[],lastHidden:[],hidden:[]})}function gF(t,e,n){e.delete(t)&&n.lastVisible.push(t)}function lF(t,e,n){e.has(t)||(e.add(t),Jd(t)&&Zd(t),n.lastHidden.push(t))}function vF(t){(t.lastHidden.length>0||t.lastVisible.length>0)&&(ho.forEach(e=>void t.hidden.push(e)),Y(ee,ne.ANNOTATION_VISIBILITY_CHANGE,t))}function pF(t){const e=Object.getOwnPropertyDescriptor(t,"isVisible");return e?e.configurable&&(e.set!==a2||e.get!==i2):Object.isExtensible(t)}function a2(t){n2(this.annotationUID,t)}function i2(){return r2(this.annotationUID)}class hF{constructor(e){this._imageVolumeModifiedHandler=n=>{const r=n.detail,{FrameOfReferenceUID:a}=r,o=this.annotations[a];!o||Object.keys(o).forEach(s=>{o[s].forEach(u=>{u.invalidated!==void 0&&(u.invalidated=!0)})})},this.getFramesOfReference=()=>Object.keys(this.annotations),this.getFrameOfReferenceAnnotations=n=>this.annotations[n],this.get=(n,r)=>{const a=this.annotations[n];if(!!a)return a[r]},this.getAnnotation=(n,r={})=>{const a=this._getToolSpecificAnnotationsAndIndex(n,r);if(!a)return;const{toolSpecificAnnotations:i,index:o}=a;return i[o]},this.addAnnotation=n=>{const{metadata:r}=n,{FrameOfReferenceUID:a,toolName:i}=r,o=this.annotations;let s=o[a];s||(o[a]={},s=o[a]);let c=s[i];c||(s[i]=[],c=s[i]),c.push(n),nF(n),uF(n)},this.removeAnnotation=(n,r={})=>{const a=this._getToolSpecificAnnotationsAndIndex(n,r);if(!a)return;const{toolSpecificAnnotations:i,index:o}=a,{metadata:s}=i[0];if(i.splice(o,1),!i.length){const{toolName:c}=s;delete this.annotations[s.FrameOfReferenceUID][c]}},this.saveAnnotations=(n,r)=>{const a=this.annotations;if(n&&r){const i=a[n];if(!i)return;const o=i[r];return ht(o)}else if(n){const i=a[n];return ht(i)}return ht(a)},this.restoreAnnotations=(n,r,a)=>{const i=this.annotations;if(r&&a){let o=i[r];o||(i[r]={},o=i[r]),o[a]=n}else r?i[r]=n:this.annotations=ht(n)},this.removeAllAnnotations=()=>{this.annotations={}},e||(e=ea()),this.annotations={},this.uid=e,ee.addEventListener(q.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedHandler)}_getToolSpecificAnnotationsAndIndex(e,n){const{toolName:r,FrameOfReferenceUID:a}=n,i=this.annotations;let o;a?o=[a]:o=Object.keys(i);const s=o.length;for(let c=0;c<s;c++){const u=o[c],g=i[u];let f;r?f=[r]:f=Object.keys(g);const l=f.length;for(let v=0;v<l;v++){const p=f[v],d=g[p],h=d.findIndex(T=>T.annotationUID===e);if(h!==-1)return{toolSpecificAnnotations:d,index:h}}}}}const dF=new hF("DEFAULT");function o2(t){return dF}function yF(t,e){const n=Ye(t),r=o2(),{FrameOfReferenceUID:a}=n;return r.get(a,e)}function TF(t,e){return o2().getAnnotation(t)}const mF=[[0,0,0,0],[221,84,84,255],[77,228,121,255],[166,70,235,255],[189,180,116,255],[109,182,196,255],[204,101,157,255],[123,211,94,255],[93,87,218,255],[225,128,80,255],[73,232,172,255],[181,119,186,255],[176,193,112,255],[105,153,200,255],[208,97,120,255],[90,215,101,255],[135,83,222,255],[229,178,76,255],[122,183,181,255],[190,115,171,255],[149,197,108,255],[100,118,205,255],[212,108,93,255],[86,219,141,255],[183,79,226,255],[233,233,72,255],[118,167,187,255],[194,111,146,255],[116,201,104,255],[115,96,209,255],[216,147,89,255],[82,223,188,255],[230,75,224,255],[163,184,121,255],[114,143,191,255],[198,107,114,255],[99,206,122,255],[153,92,213,255],[220,192,85,255],[78,215,227,255],[234,71,173,255],[141,188,117,255],[110,113,195,255],[202,128,103,255],[95,210,157,255],[195,88,217,255],[206,224,81,255],[74,166,231,255],[185,120,139,255],[113,192,113,255],[133,106,199,255],[207,162,98,255],[91,214,198,255],[221,84,198,255],[159,228,77,255],[70,111,235,255],[189,119,116,255],[109,196,138,255],[165,101,204,255],[211,201,94,255],[87,191,218,255],[225,80,153,255],[106,232,73,255],[124,119,186,255],[193,142,112,255],[105,200,168,255],[203,97,208,255],[184,215,90,255],[83,147,222,255],[229,76,101,255],[122,183,130,255],[146,115,190,255],[197,171,108,255],[100,205,205,255],[212,93,177,255],[141,219,86,255],[79,97,226,255],[233,99,72,255],[118,187,150,255],[173,111,194,255],[197,201,104,255],[96,171,209,255],[216,89,137,255],[94,223,82,255],[107,75,230,255],[184,153,121,255],[114,191,175,255],[198,107,191,255],[166,206,99,255],[92,132,213,255],[220,85,91,255],[78,227,115,255],[159,71,234,255],[188,176,117,255],[110,185,195,255],[202,103,161,255],[129,210,95,255],[88,88,217,255],[224,123,81,255],[74,231,166,255],[177,120,185,255],[179,192,113,255],[106,156,199,255],[207,98,125,255],[91,214,96,255],[130,84,221,255],[228,171,77,255],[70,235,221,255],[189,116,174,255],[153,196,109,255],[101,123,204,255],[211,104,94,255],[87,218,136,255],[177,80,225,255],[232,225,73,255],[119,169,186,255],[193,112,149,255],[121,200,105,255],[111,97,208,255],[215,142,90,255],[83,222,181,255],[229,76,229,255],[165,183,122,255],[115,146,190,255],[197,108,119,255],[100,205,118,255],[148,93,212,255],[219,186,86,255],[79,220,226,255],[233,72,179,255],[144,187,118,255],[111,118,194,255],[201,124,104,255],[96,209,153,255],[189,89,216,255],[211,223,82,255],[75,172,230,255],[184,121,142,255],[117,191,114,255],[130,107,198,255],[206,157,99,255],[92,213,193,255],[220,85,203,255],[165,227,78,255],[71,118,234,255],[188,117,117,255],[110,195,135,255],[161,103,202,255],[210,195,95,255],[88,195,217,255],[224,81,158,255],[113,231,74,255],[123,120,185,255],[192,139,113,255],[106,199,164,255],[198,98,207,255],[188,214,91,255],[84,153,221,255],[228,77,108,255],[70,235,84,255],[143,116,189,255],[196,167,109,255],[101,204,199,255],[211,94,182,255],[147,218,87,255],[80,104,225,255],[232,93,73,255],[119,186,147,255],[170,112,193,255],[200,200,105,255],[97,175,208,255],[215,90,142,255],[100,222,83,255],[101,76,229,255],[183,150,122,255],[115,190,171,255],[197,108,194,255],[170,205,100,255],[93,138,212,255],[219,86,97,255],[79,226,110,255],[153,72,233,255],[187,173,118,255],[111,187,194,255],[201,104,165,255],[134,209,96,255],[89,95,216,255],[223,117,82,255],[75,230,159,255],[174,121,184,255],[182,191,114,255],[107,160,198,255],[206,99,130,255],[92,213,92,255],[124,85,220,255],[227,165,78,255],[71,234,214,255],[188,117,176,255],[156,195,110,255],[103,128,202,255],[210,100,95,255],[88,217,131,255],[170,81,224,255],[231,218,74,255],[120,172,185,255],[192,113,153,255],[125,199,106,255],[107,98,207,255],[214,137,91,255],[84,221,175,255],[222,77,228,255],[194,235,70,255],[116,149,189,255],[196,109,123,255],[101,204,114,255],[143,94,211,255],[218,180,87,255],[80,225,225,255],[232,73,186,255],[147,186,119,255],[112,122,193,255],[200,121,105,255],[97,208,148,255],[184,90,215,255],[216,222,83,255],[76,178,229,255],[183,122,145,255],[121,190,115,255],[126,108,197,255],[205,153,100,255],[93,212,187,255],[219,86,208,255],[171,226,79,255],[72,126,233,255],[187,118,121,255],[111,194,132,255],[157,104,201,255],[209,190,96,255],[89,200,216,255],[223,82,164,255],[120,230,75,255],[121,121,184,255],[191,136,114,255],[107,198,160,255],[192,99,206,255],[193,213,92,255],[85,158,220,255],[227,78,115,255],[71,234,78,255],[141,117,188,255],[195,163,110,255],[103,202,194,255],[210,95,186,255],[153,217,88,255],[81,111,224,255]],CF=mF,Ql={colorLUT:[],segmentations:[],globalConfig:{renderInactiveSegmentations:!0,representations:{}},toolGroups:{}};class wF{constructor(e){e||(e=ea()),this.state=ht(Ql),this.uid=e}getState(){return this.state}getToolGroups(){return Object.keys(this.state.toolGroups)}getColorLUT(e){return this.state.colorLUT[e]}resetState(){this.state=ht(Ql)}getSegmentation(e){return this.state.segmentations.find(n=>n.segmentationId===e)}addSegmentation(e){if(this._initDefaultColorLUTIfNecessary(),this.getSegmentation(e.segmentationId))throw new Error(`Segmentation with id ${e.segmentationId} already exists`);this.state.segmentations.push(e)}getSegmentationRepresentations(e){const n=this.state.toolGroups[e];if(!!n)return n.segmentationRepresentations}addSegmentationRepresentation(e,n){this.state.toolGroups[e]||(this.state.toolGroups[e]={segmentationRepresentations:[],config:{}}),this.state.toolGroups[e].segmentationRepresentations.push(n),this._handleActiveSegmentation(e,n)}getGlobalConfig(){return this.state.globalConfig}setGlobalConfig(e){this.state.globalConfig=e}getSegmentationRepresentationByUID(e,n){return this.getSegmentationRepresentations(e).find(i=>i.segmentationRepresentationUID===n)}removeSegmentation(e){this.state.segmentations=this.state.segmentations.filter(n=>n.segmentationId!==e)}removeSegmentationRepresentation(e,n){const r=this.getSegmentationRepresentations(e);if(!r||!r.length)throw new Error(`No viewport specific segmentation state found for viewport ${e}`);const i=r.findIndex(s=>s.segmentationRepresentationUID===n);i===-1&&console.warn(`No viewport specific segmentation state data found for viewport ${e} and segmentation data UID ${n}`);const o=r[i];r.splice(i,1),this._handleActiveSegmentation(e,o)}setActiveSegmentationRepresentation(e,n){const r=this.getSegmentationRepresentations(e);if(!r||!r.length)throw new Error(`No segmentation data found for toolGroupId: ${e}`);const a=r.find(i=>i.segmentationRepresentationUID===n);if(!a)throw new Error(`No segmentation data found for segmentation data UID ${n}`);a.active=!0,this._handleActiveSegmentation(e,a)}getToolGroupSpecificConfig(e){const n=this.state.toolGroups[e];if(!!n)return n.config}setSegmentationRepresentationConfig(e,n){let r=this.state.toolGroups[e];r||(this.state.toolGroups[e]={segmentationRepresentations:[],config:{renderInactiveSegmentations:!0,representations:{}}},r=this.state.toolGroups[e]),r.config={...r.config,...n}}addColorLUT(e,n){this.state.colorLUT[n]&&console.log("Color LUT table already exists, overwriting"),this.state.colorLUT[n]=e}_handleActiveSegmentation(e,n){const r=this.getSegmentationRepresentations(e);if(r.length===0)return;if(r.length===1){r[0].active=!0;return}if(r.filter(i=>i.active).length===0){r[0].active=!0;return}n.active&&r.forEach(i=>{i.segmentationRepresentationUID!==n.segmentationRepresentationUID&&(i.active=!1)})}_initDefaultColorLUTIfNecessary(){(this.state.colorLUT.length===0||!this.state.colorLUT[0])&&this.addColorLUT(CF,0)}}const SF=new wF("DEFAULT");function EF(t,e){const n={toolGroupId:t,segmentationRepresentationUID:e};Y(ee,ne.SEGMENTATION_REPRESENTATION_REMOVED,n)}function za(t,e){const n={toolGroupId:t,segmentationRepresentationUID:e};if(e){Y(ee,ne.SEGMENTATION_REPRESENTATION_MODIFIED,n);return}(Ua(t)||[]).forEach(a=>{const{segmentationRepresentationUID:i}=a,o={toolGroupId:t,segmentationRepresentationUID:i};Y(ee,ne.SEGMENTATION_REPRESENTATION_MODIFIED,o)})}let xF={};const OF=xF;let Re={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:OF,enabledElements:[],handleRadius:6};function MF(t){const e=t.toolName,n=Re.tools[e]!==void 0;if(!e)throw new Error(`No Tool Found for the ToolClass ${t.name}`);if(n)throw new Error(`${e} has already been added globally`);Re.tools[e]={toolClass:t}}function ua(t,e){const n=e||t.currentTarget,{viewport:r}=Ye(n),a=VF(t),i=DF(t),o=RF(n,i),s=r.canvasToWorld(o);return{page:i,client:a,canvas:o,world:s}}function RF(t,e){const n=t.getBoundingClientRect();return[e[0]-n.left-window.pageXOffset,e[1]-n.top-window.pageYOffset]}function DF(t){return[t.pageX,t.pageY]}function VF(t){return[t.clientX,t.clientY]}function s2(t){const e=t.currentTarget,{viewportId:n,renderingEngineId:r}=Ye(e),a=ua(t,e),i={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},o={event:t,eventName:ne.MOUSE_DOUBLE_CLICK,viewportId:n,renderingEngineId:r,camera:{},element:e,startPoints:a,lastPoints:a,currentPoints:a,deltaPoints:i};Y(e,ne.MOUSE_DOUBLE_CLICK,o)}const e0=ne.MOUSE_MOVE;function Ko(t){const e=t.currentTarget,n=Ye(e),{renderingEngineId:r,viewportId:a}=n,i=ua(t);Y(e,e0,{renderingEngineId:r,viewportId:a,camera:{},element:e,currentPoints:i,eventName:e0,event:t})}const{MOUSE_DOWN:t0,MOUSE_DOWN_ACTIVATE:LF,MOUSE_CLICK:NF,MOUSE_UP:FF,MOUSE_DRAG:n0}=ne,_F={mouseButton:void 0,element:null,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};let ve={mouseButton:void 0,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,element:null,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};function c2(t){ve.element=t.currentTarget,ve.mouseButton=t.button;const e=Ye(ve.element),{renderingEngineId:n,viewportId:r}=e;ve.renderingEngineId=n,ve.viewportId=r,ve.preventClickTimeout=setTimeout(bF,ve.clickDelay),ve.element.removeEventListener("mousemove",Ko);const a=ua(t,ve.element),i=Zu(a,a),o={event:t,eventName:t0,element:ve.element,mouseButton:ve.mouseButton,renderingEngineId:ve.renderingEngineId,viewportId:ve.viewportId,camera:{},startPoints:a,lastPoints:a,currentPoints:a,deltaPoints:i};ve.startPoints=cr(o.startPoints),ve.lastPoints=cr(o.lastPoints),Y(o.element,t0,o)&&Y(o.element,LF,o),document.addEventListener("mousemove",u2),document.addEventListener("mouseup",f2)}function u2(t){const e=ua(t,ve.element),n=kF(ve.element,ve.lastPoints),r=Zu(e,n),a={event:t,eventName:n0,mouseButton:ve.mouseButton,renderingEngineId:ve.renderingEngineId,viewportId:ve.viewportId,camera:{},element:ve.element,startPoints:cr(ve.startPoints),lastPoints:cr(n),currentPoints:e,deltaPoints:r};Y(ve.element,n0,a),ve.lastPoints=cr(e)}function f2(t){clearTimeout(ve.preventClickTimeout);const e=ve.isClickEvent?NF:FF,n=ua(t,ve.element),r=Zu(n,ve.lastPoints),a={event:t,eventName:e,mouseButton:ve.mouseButton,element:ve.element,renderingEngineId:ve.renderingEngineId,viewportId:ve.viewportId,camera:{},startPoints:cr(ve.startPoints),lastPoints:cr(ve.lastPoints),currentPoints:n,deltaPoints:r};Y(a.element,e,a),document.removeEventListener("mousemove",u2),document.removeEventListener("mouseup",f2),ve.element.addEventListener("mousemove",Ko),ve=JSON.parse(JSON.stringify(_F))}function bF(){ve.isClickEvent=!1}function cr(t){return JSON.parse(JSON.stringify(t))}function kF(t,e){const{viewport:n}=Ye(t),r=n.canvasToWorld(e.canvas);return{page:e.page,client:e.client,canvas:e.canvas,world:r}}function Zu(t,e){return{page:Js(t.page,e.page),client:Js(t.client,e.client),canvas:Js(t.canvas,e.canvas),world:UF(t.world,e.world)}}function Js(t,e){return[t[0]-e[0],t[1]-e[1]]}function UF(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function BF(){return ve.mouseButton}function g2(t){t.removeEventListener("dblclick",s2),t.removeEventListener("mousedown",c2),t.removeEventListener("mousemove",Ko)}function GF(t){g2(t),t.addEventListener("dblclick",s2),t.addEventListener("mousedown",c2),t.addEventListener("mousemove",Ko)}const l2={enable:GF,disable:g2},r0=10,a0=40,i0=800;function AF(t){let e=0,n=0,r=0,a=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),r=e*r0,a=n*r0,"deltaY"in t&&(a=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||a)&&t.deltaMode&&(t.deltaMode===1?(r*=a0,a*=a0):(r*=i0,a*=i0)),r&&!e&&(e=r<1?-1:1),a&&!n&&(n=a<1?-1:1),{spinX:e,spinY:n,pixelX:r,pixelY:a}}function v2(t){const e=t.currentTarget,n=Ye(e),{renderingEngineId:r,viewportId:a}=n;if(t.deltaY>-1&&t.deltaY<1)return;t.preventDefault();const{spinX:i,spinY:o,pixelX:s,pixelY:c}=AF(t),u=o<0?-1:1,g={event:t,eventName:ne.MOUSE_WHEEL,renderingEngineId:r,viewportId:a,element:e,camera:{},detail:t,wheel:{spinX:i,spinY:o,pixelX:s,pixelY:c,direction:u},points:ua(t)};Y(e,ne.MOUSE_WHEEL,g)}function IF(t){p2(t),t.addEventListener("wheel",v2,{passive:!1})}function p2(t){t.removeEventListener("wheel",v2)}const h2={enable:IF,disable:p2},PF={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};let Pe={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};function qo(t){Pe.element=t.currentTarget;const e=Ye(Pe.element),{renderingEngineId:n,viewportId:r}=e;Pe.renderingEngineId=n,Pe.viewportId=r,Pe.key=t.key,Pe.keyCode=t.keyCode,t.preventDefault();const a={renderingEngineId:Pe.renderingEngineId,viewportId:Pe.viewportId,element:Pe.element,key:Pe.key,keyCode:Pe.keyCode};Y(a.element,ne.KEY_DOWN,a),document.addEventListener("keyup",d2),Pe.element.removeEventListener("keydown",qo)}function d2(t){const e={renderingEngineId:Pe.renderingEngineId,viewportId:Pe.viewportId,element:Pe.element,key:Pe.key,keyCode:Pe.keyCode};document.removeEventListener("keyup",d2),Pe.element.addEventListener("keydown",qo),Pe=ht(PF),Y(e.element,ne.KEY_UP,e)}function WF(){return Pe.keyCode}function zF(){Pe.keyCode=void 0}function $F(t){y2(t),t.addEventListener("keydown",qo)}function y2(t){t.removeEventListener("keydown",qo)}const Xo={enable:$F,disable:y2,getModifierKey:WF},yo=t=>t&&typeof t=="object"&&Object.prototype.toString.call(t)!=="[object RegExp]"&&Object.prototype.toString.call(t)!=="[object Date]",jF=t=>Array.isArray(t)?[]:{},$a=(t,e)=>e&&e.clone===!0&&yo(t)?Yo(jF(t),t,e):t,o0=(t,e,n)=>{const r=t.slice();return e.forEach(function(a,i){typeof r[i]>"u"?r[i]=$a(a,n):yo(a)?r[i]=Yo(t[i],a,n):t.indexOf(a)===-1&&r.push($a(a,n))}),r},HF=(t,e,n)=>{const r={};return yo(t)&&Object.keys(t).forEach(function(a){r[a]=$a(t[a],n)}),Object.keys(e).forEach(function(a){!yo(e[a])||!t[a]?r[a]=$a(e[a],n):r[a]=Yo(t[a],e[a],n)}),r},Yo=(t={},e={},n=void 0)=>{const r=Array.isArray(e),i=(n||{arrayMerge:o0}).arrayMerge||o0;return r?Array.isArray(t)?i(t,e,n):$a(e,n):HF(t,e,n)},ja=Yo;class T2{constructor(e,n){const r=ja(n,e),{configuration:a={},supportedInteractionTypes:i,toolGroupId:o}=r;a.strategies||(a.strategies={},a.defaultStrategy=void 0,a.activeStrategy=void 0,a.strategyOptions={}),this.toolGroupId=o,this.supportedInteractionTypes=i||[],this.configuration=Object.assign({},a),this.mode=Wt.Disabled}getToolName(){return this.constructor.toolName}applyActiveStrategy(e,n){const{strategies:r,activeStrategy:a}=this.configuration;return r[a].call(this,e,n)}setConfiguration(e){this.configuration=ja(this.configuration,e)}setActiveStrategy(e){this.setConfiguration({activeStrategy:e})}getTargetVolumeId(e){if(this.configuration.volumeId)return this.configuration.volumeId;const n=e.getActors();if(!(!n&&!n.length))return n[0].uid}getTargetIdImage(e,n){if(e.startsWith("imageId:")){const r=e.split("imageId:")[1],a=Xt(r),i=gp(a,n.id);return!i||!i.length?void 0:i[0].getImageData()}else if(e.startsWith("volumeId:")){const r=e.split("volumeId:")[1],a=Mo(r,n.id);return!a||!a.length?void 0:a[0].getImageData()}else throw new Error('getTargetIdImage: targetId must start with "imageId:" or "volumeId:"')}getTargetId(e){if(e instanceof An)return`imageId:${e.getCurrentImageId()}`;if(e instanceof Cn)return`volumeId:${this.getTargetVolumeId(e)}`;throw new Error("getTargetId: viewport must be a StackViewport or VolumeViewport")}}T2.toolName="BaseTool";const ri=T2;function KF(t){const e=Ye(t),{viewportId:n,renderingEngineId:r}=e,a=`${n}:${r}`,i=qF(t);return Object.keys(Re.svgNodeCache[a]).forEach(o=>{Re.svgNodeCache[a][o].touched=!1}),{svgLayerElement:i,svgNodeCacheForCanvas:Re.svgNodeCache,getSvgNode:XF.bind(this,a),appendNode:YF.bind(this,i,a),setNodeTouched:ZF.bind(this,a),clearUntouched:JF.bind(this,i,a)}}function qF(t){return t.firstChild.querySelector(".svg-layer")}function XF(t,e){if(!!Re.svgNodeCache[t]&&Re.svgNodeCache[t][e])return Re.svgNodeCache[t][e].domRef}function YF(t,e,n,r){if(!Re.svgNodeCache[e])return null;Re.svgNodeCache[e][r]={touched:!0,domRef:n},t.appendChild(n)}function ZF(t,e){!Re.svgNodeCache[t]||Re.svgNodeCache[t][e]&&(Re.svgNodeCache[t][e].touched=!0)}function JF(t,e){!Re.svgNodeCache[e]||Object.keys(Re.svgNodeCache[e]).forEach(n=>{const r=Re.svgNodeCache[e][n];!r.touched&&r.domRef&&(t.removeChild(r.domRef),delete Re.svgNodeCache[e][n])})}function QF(t,e){const n=KF(t);e(n),n.clearUntouched()}function e_(t,e){const n=Ye(t),{renderingEngineId:r,viewportId:a}=n,i=Sn(a,r);if(!i)return[];const o=[],s=Object.keys(i.toolOptions);for(let c=0;c<s.length;c++){const u=s[c],g=i.toolOptions[u];if(!!g&&e.includes(g.mode)){const f=i.getToolInstance(u);o.push(f)}}return o}const{Active:t_,Passive:n_,Enabled:r_}=Wt;class a_{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._renderFlaggedViewports=()=>{this._throwIfDestroyed();const e=Array.from(this._viewportElements.values());for(let n=0;n<e.length;n++){const r=e[n];if(this._needsRender.has(r)&&(this._triggerRender(r),this._needsRender.delete(r),this._needsRender.size===0)){this._animationFrameSet=!1,this._animationFrameHandle=null;return}}},this._viewportElements=new Map}addViewportElement(e,n){this._viewportElements.set(e,n)}removeViewportElement(e){this._viewportElements.delete(e),this._viewportElements.size===0&&this._reset()}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setViewportsToBeRenderedNextFrame(e){e.forEach(n=>{this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}_triggerRender(e){const n=Ye(e);if(!n){console.warn("Element has been disabled");return}if(!wn(n.renderingEngineId)){console.warn("rendering Engine has been destroyed");return}const a=e_(e,[t_,n_,r_]),{renderingEngineId:i,viewportId:o}=n,s={element:e,renderingEngineId:i,viewportId:o};QF(e,c=>{let u=!1;const g=f=>{if(f.renderAnnotation){const l=f.renderAnnotation(n,c);u=u||l}};a.forEach(g),u&&Y(e,ne.ANNOTATION_RENDERED,{...s})})}_reset(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}}const Ju=new a_;function Qu(t){Ju.renderViewport(t)}class i_{constructor(){const e={color:"rgb(255, 255, 0)",colorHighlighted:"rgb(0, 255, 0)",colorSelected:"rgb(0, 220, 0)",colorLocked:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"",shadow:!0,textBoxFontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",textBoxFontSize:"14px",textBoxColor:"rgb(255, 255, 0)",textBoxColorHighlighted:"rgb(0, 255, 0)",textBoxColorSelected:"rgb(0, 255, 0)",textBoxColorLocked:"rgb(255, 255, 0)",textBoxBackground:"",textBoxLinkLineWidth:"1",textBoxLinkLineDash:"2,3",textBoxShadow:!0};this._initializeConfig(e)}getAnnotationToolStyles(e){return this.config.annotations&&this.config.annotations[e]}getViewportToolStyles(e){return this.config.viewports&&this.config.viewports[e]}getToolGroupToolStyles(e){return this.config.toolGroups&&this.config.toolGroups[e]}getDefaultToolStyles(){return this.config.default}setAnnotationStyles(e,n){let r=this.config.annotations;r||(this.config={...this.config,annotations:{}},r=this.config.annotations),r[e]&&console.warn("overriding annotation styles for annotationUID:",e),r[e]=n}setViewportToolStyles(e,n){let r=this.config.viewports;r||(this.config={...this.config,viewports:{}},r=this.config.viewports),r[e]&&console.warn("overriding viewport styles for viewportId:",e),r[e]=n}setToolGroupToolStyles(e,n){let r=this.config.toolGroups;r||(this.config={...this.config,toolGroups:{}},r=this.config.toolGroups),r[e]&&console.warn("overriding toolGroup styles for toolGroupId:",e),r[e]=n}setDefaultToolStyles(e){this.config.default=e}getStyleProperty(e,n){const{annotationUID:r,viewportId:a,toolGroupId:i,toolName:o}=n;return this._getToolStyle(e,r,a,i,o)}_getToolStyle(e,n,r,a,i){if(n){const s=this.getAnnotationToolStyles(n);if(s&&s[e])return s[e]}if(r){const s=this.getViewportToolStyles(r);if(s){if(s[i]&&s[i][e])return s[i][e];if(s.global&&s.global[e])return s.global[e]}}if(a){const s=this.getToolGroupToolStyles(a);if(s){if(s[i]&&s[i][e])return s[i][e];if(s.global&&s.global[e])return s.global[e]}}const o=this.getDefaultToolStyles();if(o[i]&&o[i][e])return o[i][e];if(o.global&&o.global[e])return o.global[e]}_initializeConfig(e){const n={};for(const r in e)n[r]=e[r];this.config={default:{global:n}}}}const o_=new i_,s_=o_;function c_(t,e,n){const r=[`${t}`];return e&&r.push(`${r[0]}${e}`),n&&r.push(`${r[r.length-1]}${n}`),r}function u_(t,e,n,r){const a=c_(t,n,r);for(let i=a.length-1;i>=0;--i){const o=s_.getStyleProperty(a[i],e);if(o!==void 0)return o}}function f_(){return I8()}function m2(t){return B8(t)}function g_(t,e){G8(t,e)}async function l_(t,e,n){const r=Ye(t),{renderingEngine:a,viewport:i}=r,{id:o}=i;await Ed(a,[{volumeId:e,actorUID:n,visibility:!0}],[o],!1,!0)}function v_(t,e,n=!1){const r=Ye(t),{viewport:a}=r;a.removeVolumeActors([e])}const Qs=255,s0=new Map;async function p_(t,e,n){const{segmentationId:r}=e,a=sf(r),{volumeId:i}=a.representationData[Qr.Labelmap],o=ea();await C_(t,i,o);const s=new Set,c=!0,u=0,g=!0,f=$u.newInstance(),l=Ac.newInstance(),v={segmentationId:r,segmentationRepresentationUID:o,type:Qr.Labelmap,segmentsHidden:s,visibility:c,colorLUTIndex:u,active:g,config:{cfun:f,ofun:l}};if(n){const p=m2(t),d=ja(p,n);g_(t,{renderInactiveSegmentations:d.renderInactiveSegmentations||!0,representations:{...d.representations}})}return A8(t,v),o}function h_(t,e){m_(t,e),P8(t,e)}function d_(t,e,n){const{colorLUTIndex:r,active:a,segmentationId:i,segmentationRepresentationUID:o,visibility:s,config:c}=e,g=sf(i).representationData[Qr.Labelmap],{volumeId:f}=g;if(!be.getVolume(f))throw new Error(`No Labelmap found for volumeId: ${f}`);const v=t.getActor(o);if(!v){console.warn("No actor found for actorUID: ",o);return}const{cfun:p,ofun:d}=c,h=n.representations[Qr.Labelmap],T=n.renderInactiveSegmentations;y_(t.id,v,p,d,r,h,a,T,s)}function y_(t,e,n,r,a,i,o,s,c=!0){r.addPoint(0,0);const u=o?i.fillAlpha:i.fillAlphaInactive,g=o?i.outlineWidthActive:i.outlineWidthInactive,f=o?i.renderFill:i.renderFillInactive,l=W8(a),v=Math.min(256,l.length),{uid:p}=e,d=e.actor,{needColorUpdate:h,needOpacityUpdate:T}=T_(t,p,u,a,f);if(h){for(let m=0;m<v;m++){const y=l[m];n.addRGBPoint(m,y[0]/Qs,y[1]/Qs,y[2]/Qs)}d.getProperty().setRGBTransferFunction(0,n)}if(T){if(i.renderFill)for(let m=0;m<v;m++){const w=l[m][3]/255*u;r.addPoint(m,w)}else for(let m=0;m<v;m++)r.addPoint(m,.01);r.setClamping(!1),d.getProperty().setScalarOpacity(0,r)}d.getProperty().setInterpolationTypeToNearest(),d.getProperty().setUseLabelOutline(i.renderOutline),d.getProperty().setLabelOutlineThickness(g);const C=c&&(o||s);d.setVisibility(C)}function T_(t,e,n,r,a){const i=`${t}-${e}`,o=s0.get(i);let s=!1,c=!1;return s0.set(i,{fillAlpha:n,colorLUTIndex:r}),o||(s=!0,c=!0),o&&o.fillAlpha!==n&&(c=!0),o&&o.colorLUTIndex!==r&&(s=!0),o&&o.renderFill!==a&&(c=!0),{needColorUpdate:s,needOpacityUpdate:c}}function m_(t,e){const n=es(t);if(n===void 0)throw new Error(`ToolGroup with ToolGroupId ${t} does not exist`);const{viewportsInfo:r}=n;for(const a of r){const{viewportId:i,renderingEngineId:o}=a,s=ti(i,o);v_(s.viewport.element,e)}}async function C_(t,e,n){const r=es(t),{viewportsInfo:a}=r;for(const i of a){const{viewportId:o,renderingEngineId:s}=i,c=ti(o,s);if(!c)throw new Error(`No enabled element found for rendering engine: ${s} and viewport: ${o}`);const{viewport:u}=c;l_(u.element,e,n)}}const w_={render:d_,addSegmentationRepresentation:p_,removeSegmentationRepresentation:h_};class C2 extends ri{constructor(e={},n={configuration:{}}){super(e,n),this.renderSegmentation=r=>{const a=es(r);if(!a)return;const i=Ua(r),o=a.viewportsInfo.map(({renderingEngineId:s,viewportId:c})=>{const u=ti(c,s);if(u)return u.viewport});i.forEach(s=>{const c=this._getMergedRepresentationsConfig(r);o.forEach(u=>{if(s.type==Qr.Labelmap)w_.render(u,s,c);else throw new Error(`Render for ${s.type} is not supported yet`)})}),o.forEach(s=>{s.render()})}}onSetToolEnabled(){const e=this.toolGroupId,n=Ua(e);if(!(!n||n.length===0))for(const r of n)r.visibility=!0,za(e,r.segmentationRepresentationUID)}onSetToolDisabled(){const e=this.toolGroupId,n=Ua(e);if(!(!n||n.length===0))for(const r of n)r.visibility=!1,za(e,r.segmentationRepresentationUID)}_getMergedRepresentationsConfig(e){const n=m2(e),r=f_();return ja(r,n)}}C2.toolName="SegmentationDisplay";const S_=C2;class E_{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._renderFlaggedToolGroups=()=>{this._throwIfDestroyed();const e=Array.from(this._needsRender.values());for(const n of e)if(this._triggerRender(n),this._needsRender.delete(n),this._needsRender.size===0){this._animationFrameSet=!1,this._animationFrameHandle=null;return}}}renderToolGroupSegmentations(e){this._setToolGroupSegmentationToBeRenderedNextFrame([e])}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setToolGroupSegmentationToBeRenderedNextFrame(e){e.forEach(n=>{this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedToolGroups),this._animationFrameSet=!0)}_triggerRender(e){const n=es(e);if(!n){console.warn(`No tool group found with toolGroupId: ${e}`);return}const{viewportsInfo:r}=n,a=[];r.forEach(({viewportId:s,renderingEngineId:c})=>{const u=wn(c);if(!u){console.warn("rendering Engine has been destroyed");return}a.push(u.getViewport(s))});const i=n.getToolInstance(S_.toolName);function o(s){const{element:c,viewportId:u,renderingEngineId:g}=s.detail;c.removeEventListener(q.IMAGE_RENDERED,o);const l={toolGroupId:Sn(u,g).id,viewportId:u};Y(ee,ne.SEGMENTATION_RENDERED,{...l})}a.forEach(({element:s})=>{s.addEventListener(q.IMAGE_RENDERED,o)}),i.renderSegmentation(e)}_reset(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}}const x_=new E_;function ef(t){x_.renderToolGroupSegmentations(t)}const O_=function(t){const{toolGroupId:e}=t.detail;ef(e)},w2=O_,M_=function(t){const{segmentationId:e,modifiedSlicesToUse:n}=t.detail,{representationData:r,type:a}=sf(e);let i;if(a===Qr.Labelmap){const o=be.getVolume(r[a].volumeId);if(!o){console.warn("segmentation not found in cache");return}const{imageData:s,vtkOpenGLTexture:c}=o;let u;if(n&&Array.isArray(n))u=n;else{const g=s.getDimensions()[2];u=[...Array(g).keys()]}u.forEach(g=>{c.setUpdatedFrame(g)}),s.modified(),i=fy(e)}else throw new Error(`onSegmentationDataModified: representationType ${a} not supported yet`);i.forEach(o=>{ef(o)})},S2=M_,R_=function(t){const{toolGroupId:e,segmentationRepresentationUID:n}=t.detail;ef(e)},E2=R_,D_=function(t){const{segmentationId:e}=t.detail;fy(e).forEach(r=>{Ua(r).forEach(i=>{i.segmentationId===e&&za(r,i.segmentationRepresentationUID)})})},x2=D_;function To(t){if(!t.detail.removed.length)return;ra().forEach(r=>{const i=r.getViewports().map(o=>o.id);O2(r,i)})}function O2(t,e){!e.length||e.forEach(n=>{const{element:r}=t.getViewport(n);Qu(r)})}function M2(t){const{viewportId:e,renderingEngineId:n}=t.detail,r=wn(n);O2(r,[e])}const R2=function(t){Qu(t.detail.element)},V_=function(t){t.addEventListener(q.IMAGE_RENDERED,R2)},L_=function(t){t.removeEventListener(q.IMAGE_RENDERED,R2)},D2={enable:V_,disable:L_},{Active:N_}=Wt;function Zo(t,e,n){const{renderingEngineId:r,viewportId:a}=n.detail,i=Sn(a,r);if(!i)return!1;let o;const s=Object.keys(i.toolOptions);for(let c=0;c<s.length;c++){const u=s[c],g=i.toolOptions[u],f=i.getToolInstance(u);if(g.mode===N_&&typeof f[e]=="function"){o=i.getToolInstance(u);break}}!o||o[e](n)}const F_=Zo.bind(null,"Mouse","mouseClickCallback"),V2=F_,__=Zo.bind(null,"Mouse","doubleClickCallback"),L2=__;function b_(t,e,n,r="mouse"){const i=[];return e.forEach(({tool:o,annotations:s})=>{for(const c of s){if(c.isLocked||!c.isVisible)continue;const u=o.getHandleNearImagePoint(t,c,n,6);if(u){i.push({tool:o,annotation:c,handle:u});break}}}),i}function N2(t,e){const n=[];for(let r=0;r<e.length;r++){const a=e[r];if(!a){console.warn("undefined tool in filterToolsWithAnnotationsForElement");continue}let i=yF(t,a.constructor.toolName);!i||(typeof a.filterInteractableAnnotationsForElement=="function"&&(i=a.filterInteractableAnnotationsForElement(t,i)),i.length>0&&n.push({tool:a,annotations:i}))}return n}function k_(t,e,n,r="mouse"){const i=[];return e.forEach(({tool:o,annotations:s})=>{for(const c of s){if(c.isLocked||!c.isVisible)continue;if(o.isPointNearTool(t,c,n,6,r)){i.push({tool:o,annotation:c});break}}}),i}const{Active:U_}=Wt;function tf(t){const{renderingEngineId:e,viewportId:n}=t.detail,r=t.detail.event,a=Xo.getModifierKey(),i=Sn(n,e);if(!i)return null;const o=Object.keys(i.toolOptions);for(let s=0;s<o.length;s++){const c=o[s],u=i.toolOptions[c],g=u.bindings.length&&u.bindings.some(f=>f.mouseButton===(r?r.buttons:yn.Primary)&&f.modifierKey===a);if(u.mode===U_&&g)return i.getToolInstance(c)}}function Ha(t,e,n){const{renderingEngineId:r,viewportId:a}=t.detail,i=Sn(a,r);if(!i)return[];const o=[],s=Object.keys(i.toolOptions);for(let c=0;c<s.length;c++){const u=s[c],g=i.toolOptions[u],f=n!=null&&g.bindings.length&&g.bindings.some(l=>l.mouseButton===n);if(e.includes(g.mode)&&(!n||f)){const l=i.getToolInstance(u);o.push(l)}}return o}const{Active:B_,Passive:G_}=Wt;function F2(t){const e=tf(t);if(e&&typeof e.preMouseDownCallback=="function"&&e.preMouseDownCallback(t))return;const n=t.detail.event.buttons===1,r=Ha(t,[B_],t.detail.event.buttons),a=n?Ha(t,[G_]):void 0,i=[...r||[],...a||[]],o=t.detail,{element:s}=o,c=N2(s,i),u=o.currentPoints.canvas,g=b_(s,c,u,"mouse"),f=!!t.detail.event.shiftKey;if(g.length>0){const{tool:v,annotation:p,handle:d}=c0(g);u0(p.annotationUID,f),v.handleSelectedCallback(t,p,d,"Mouse");return}const l=k_(s,c,u,"mouse");if(l.length>0){const{tool:v,annotation:p}=c0(l);u0(p.annotationUID,f),v.toolSelectedCallback(t,p,"Mouse");return}e&&typeof e.postMouseDownCallback=="function"&&e.postMouseDownCallback(t)}function c0(t){return t.length>1&&t.find(e=>!qd(e.annotation)&&r2(e.annotation.annotationUID))||t[0]}function u0(t,e=!1){e?Jd(t)?ji(t,!1):ji(t,!0,!0):ji(t,!0,!1)}function _2(t){const e=tf(t);if(!!e&&e.addNewAnnotation){const n=e.addNewAnnotation(t,"mouse");ji(n.annotationUID)}}function b2(t){const e=tf(t);!e||typeof e.mouseDragCallback!="function"||e.mouseDragCallback(t)}const{Active:A_,Passive:I_}=Wt;function k2(t){const e=Ha(t,[A_,I_]),n=t.detail,{element:r}=n,a=N2(r,e),i=e.filter(s=>!a.some(u=>u.tool.getToolName()===s.getToolName()));let o=!1;for(const{tool:s,annotations:c}of a)typeof s.mouseMoveCallback=="function"&&(o=s.mouseMoveCallback(t,c)||o);i.forEach(s=>{typeof s.mouseMoveCallback=="function"&&s.mouseMoveCallback(t)}),o===!0&&Qu(r)}const P_=Zo.bind(null,"Mouse","mouseUpCallback"),U2=P_,W_=Zo.bind(null,"MouseWheel","mouseWheelCallback"),B2=W_,z_=function(t){t.addEventListener(ne.MOUSE_CLICK,V2),t.addEventListener(ne.MOUSE_DOWN,F2),t.addEventListener(ne.MOUSE_DOWN_ACTIVATE,_2),t.addEventListener(ne.MOUSE_DOUBLE_CLICK,L2),t.addEventListener(ne.MOUSE_DRAG,b2),t.addEventListener(ne.MOUSE_MOVE,k2),t.addEventListener(ne.MOUSE_UP,U2),t.addEventListener(ne.MOUSE_WHEEL,B2)},$_=function(t){t.removeEventListener(ne.MOUSE_CLICK,V2),t.removeEventListener(ne.MOUSE_DOWN,F2),t.removeEventListener(ne.MOUSE_DOWN_ACTIVATE,_2),t.removeEventListener(ne.MOUSE_DOUBLE_CLICK,L2),t.removeEventListener(ne.MOUSE_DRAG,b2),t.removeEventListener(ne.MOUSE_MOVE,k2),t.removeEventListener(ne.MOUSE_UP,U2),t.removeEventListener(ne.MOUSE_WHEEL,B2)},j_={enable:z_,disable:$_},G2=j_,{Active:H_}=Wt;function A2(t){const{renderingEngineId:e,viewportId:n}=t.detail,r=BF(),a=Xo.getModifierKey(),i=Sn(n,e);if(!i)return null;const o=Object.keys(i.toolOptions);for(let s=0;s<o.length;s++){const c=o[s],u=i.toolOptions[c],g=u.bindings.length&&u.bindings.some(f=>f.mouseButton===(r!=null?r:yn.Primary)&&f.modifierKey===a);if(u.mode===H_&&g)return i.getToolInstance(c)}}function I2(t){const e=A2(t);if(!e)return;const{renderingEngineId:n,viewportId:r}=t.detail,a=Sn(r,n),i=e.getToolName();Object.keys(a.toolOptions).includes(i)&&a.setViewportsCursorByToolName(i)}function P2(t){const e=A2(t);if(!e)return;const{renderingEngineId:n,viewportId:r}=t.detail,a=Sn(r,n);zF();const i=e.getToolName();Object.keys(a.toolOptions).includes(i)&&a.setViewportsCursorByToolName(i)}const K_=function(t){t.addEventListener(ne.KEY_DOWN,I2),t.addEventListener(ne.KEY_UP,P2)},q_=function(t){t.removeEventListener(ne.KEY_DOWN,I2),t.removeEventListener(ne.KEY_UP,P2)},X_={enable:K_,disable:q_},W2=X_,{Active:Y_,Passive:Z_,Enabled:J_}=Wt,z2=function(t){Ha(t,[Y_,Z_,J_]).forEach(n=>{n.onCameraModified&&n.onCameraModified(t)})},Q_=function(t){t.addEventListener(q.CAMERA_MODIFIED,z2)},eb=function(t){t.removeEventListener(q.CAMERA_MODIFIED,z2)},$2={enable:Q_,disable:eb},{Active:tb,Passive:nb,Enabled:rb}=Wt,j2=function(t){Ha(t,[tb,nb,rb]).forEach(n=>{n.onImageSpacingCalibrated&&n.onImageSpacingCalibrated(t)})},ab=function(t){t.addEventListener(q.IMAGE_SPACING_CALIBRATED,j2)},ib=function(t){t.removeEventListener(q.IMAGE_SPACING_CALIBRATED,j2)},H2={enable:ab,disable:ib};function K2(t){const{element:e,viewportId:n}=t.detail,r=ob();sb(e),cb(r,e),Ju.addViewportElement(n,e),l2.enable(e),h2.enable(e),Xo.enable(e),D2.enable(e),$2.enable(e),H2.enable(e),G2.enable(e),W2.enable(e),Re.enabledElements.push(e)}function ob(){const t="http://www.w3.org/2000/svg",e=document.createElementNS(t,"svg");e.classList.add("svg-layer"),e.setAttribute("id","svg-layer"),e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.style.width="100%",e.style.height="100%",e.style.pointerEvents="none",e.style.position="absolute";const n=document.createElementNS(t,"defs"),r=document.createElementNS(t,"filter"),a=document.createElementNS(t,"feOffset"),i=document.createElementNS(t,"feColorMatrix"),o=document.createElementNS(t,"feGaussianBlur"),s=document.createElementNS(t,"feBlend");return r.setAttribute("id","shadow"),r.setAttribute("width","110%"),r.setAttribute("height","110%"),a.setAttribute("result","offOut"),a.setAttribute("in","SourceGraphic"),a.setAttribute("dx","0.5"),a.setAttribute("dy","0.5"),i.setAttribute("result","matrixOut"),i.setAttribute("in","offOut"),i.setAttribute("type","matrix"),i.setAttribute("values","0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 1 0"),o.setAttribute("result","blurOut"),o.setAttribute("in","matrixOut"),o.setAttribute("stdDeviation","0.25"),s.setAttribute("in","SourceGraphic"),s.setAttribute("in2","blurOut"),s.setAttribute("mode","normal"),r.appendChild(a),r.appendChild(i),r.appendChild(o),r.appendChild(s),n.appendChild(r),e.appendChild(n),e}function sb(t){const{viewportUid:e,renderingEngineUid:n}=t.dataset,r=`${e}:${n}`;Re.svgNodeCache[r]={}}function cb(t,e){e.querySelector("div.viewport-element").appendChild(t)}function ub(t,e){const n=[];if(!e&&!t)throw new Error("At least one of renderingEngineId or viewportId should be given");for(let r=0;r<Re.synchronizers.length;r++){const a=Re.synchronizers[r],i=!a.isDisabled(),o=a.hasSourceViewport(e,t),s=a.hasTargetViewport(e,t);i&&(o||s)&&n.push(a)}return n}function Sn(t,e){const n=Re.toolGroups.filter(r=>r.viewportsInfo.some(a=>a.renderingEngineId===e&&(!a.viewportId||a.viewportId===t)));if(!!n.length){if(n.length>1)throw new Error(`Multiple tool groups found for renderingEngineId: ${e} and viewportId: ${t}. You should only
      have one tool group per viewport in a renderingEngine.`);return n[0]}}const fb="viewport-element";function q2(t){const{element:e,viewportId:n}=t.detail;vb(e);const a=e.querySelector("svg"),i=e.querySelector(`div.${fb}`);a&&i.removeChild(a),Ju.removeViewportElement(n),l2.disable(e),h2.disable(e),Xo.disable(e),D2.disable(e),$2.disable(e),H2.disable(e),G2.disable(e),W2.disable(e),gb(e),lb(e),pb(e)}const gb=t=>{const e=Ye(t);ub(e.viewportId,e.renderingEngineId).forEach(r=>{r.remove(e)})},lb=t=>{const{renderingEngineId:e,viewportId:n}=Ye(t),r=Sn(n,e);r&&r.removeViewports(e,n)};function vb(t){const{viewportUid:e,renderingEngineUid:n}=t.dataset,r=`${e}:${n}`;delete Re.svgNodeCache[r]}const pb=function(t){const e=Re.enabledElements.findIndex(n=>n===t);e>-1&&Re.enabledElements.splice(e,1)};var hb="Expected a function",X2="__lodash_hash_undefined__",Y2=1/0,db="[object Function]",yb="[object GeneratorFunction]",Tb="[object Symbol]",mb=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Cb=/^\w*$/,wb=/^\./,Sb=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Eb=/[\\^$.*+?()[\]{}|]/g,xb=/\\(\\)?/g,Ob=/^\[object .+?Constructor\]$/,Mb=typeof qe=="object"&&qe&&qe.Object===Object&&qe,Rb=typeof self=="object"&&self&&self.Object===Object&&self,nf=Mb||Rb||Function("return this")();function Db(t,e){return t==null?void 0:t[e]}function Vb(t){var e=!1;if(t!=null&&typeof t.toString!="function")try{e=!!(t+"")}catch{}return e}var Lb=Array.prototype,Nb=Function.prototype,Z2=Object.prototype,ec=nf["__core-js_shared__"],f0=function(){var t=/[^.]+$/.exec(ec&&ec.keys&&ec.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),J2=Nb.toString,rf=Z2.hasOwnProperty,Q2=Z2.toString,Fb=RegExp("^"+J2.call(rf).replace(Eb,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),g0=nf.Symbol,_b=Lb.splice,bb=ey(nf,"Map"),Ka=ey(Object,"create"),l0=g0?g0.prototype:void 0,v0=l0?l0.toString:void 0;function vr(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function kb(){this.__data__=Ka?Ka(null):{}}function Ub(t){return this.has(t)&&delete this.__data__[t]}function Bb(t){var e=this.__data__;if(Ka){var n=e[t];return n===X2?void 0:n}return rf.call(e,t)?e[t]:void 0}function Gb(t){var e=this.__data__;return Ka?e[t]!==void 0:rf.call(e,t)}function Ab(t,e){var n=this.__data__;return n[t]=Ka&&e===void 0?X2:e,this}vr.prototype.clear=kb;vr.prototype.delete=Ub;vr.prototype.get=Bb;vr.prototype.has=Gb;vr.prototype.set=Ab;function fa(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Ib(){this.__data__=[]}function Pb(t){var e=this.__data__,n=Jo(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():_b.call(e,n,1),!0}function Wb(t){var e=this.__data__,n=Jo(e,t);return n<0?void 0:e[n][1]}function zb(t){return Jo(this.__data__,t)>-1}function $b(t,e){var n=this.__data__,r=Jo(n,t);return r<0?n.push([t,e]):n[r][1]=e,this}fa.prototype.clear=Ib;fa.prototype.delete=Pb;fa.prototype.get=Wb;fa.prototype.has=zb;fa.prototype.set=$b;function yr(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function jb(){this.__data__={hash:new vr,map:new(bb||fa),string:new vr}}function Hb(t){return Qo(this,t).delete(t)}function Kb(t){return Qo(this,t).get(t)}function qb(t){return Qo(this,t).has(t)}function Xb(t,e){return Qo(this,t).set(t,e),this}yr.prototype.clear=jb;yr.prototype.delete=Hb;yr.prototype.get=Kb;yr.prototype.has=qb;yr.prototype.set=Xb;function Jo(t,e){for(var n=t.length;n--;)if(o8(t[n][0],e))return n;return-1}function Yb(t,e){e=e8(e,t)?[e]:Qb(e);for(var n=0,r=e.length;t!=null&&n<r;)t=t[a8(e[n++])];return n&&n==r?t:void 0}function Zb(t){if(!ny(t)||n8(t))return!1;var e=s8(t)||Vb(t)?Fb:Ob;return e.test(i8(t))}function Jb(t){if(typeof t=="string")return t;if(of(t))return v0?v0.call(t):"";var e=t+"";return e=="0"&&1/t==-Y2?"-0":e}function Qb(t){return ty(t)?t:r8(t)}function Qo(t,e){var n=t.__data__;return t8(e)?n[typeof e=="string"?"string":"hash"]:n.map}function ey(t,e){var n=Db(t,e);return Zb(n)?n:void 0}function e8(t,e){if(ty(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||of(t)?!0:Cb.test(t)||!mb.test(t)||e!=null&&t in Object(e)}function t8(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function n8(t){return!!f0&&f0 in t}var r8=af(function(t){t=u8(t);var e=[];return wb.test(t)&&e.push(""),t.replace(Sb,function(n,r,a,i){e.push(a?i.replace(xb,"$1"):r||n)}),e});function a8(t){if(typeof t=="string"||of(t))return t;var e=t+"";return e=="0"&&1/t==-Y2?"-0":e}function i8(t){if(t!=null){try{return J2.call(t)}catch{}try{return t+""}catch{}}return""}function af(t,e){if(typeof t!="function"||e&&typeof e!="function")throw new TypeError(hb);var n=function(){var r=arguments,a=e?e.apply(this,r):r[0],i=n.cache;if(i.has(a))return i.get(a);var o=t.apply(this,r);return n.cache=i.set(a,o),o};return n.cache=new(af.Cache||yr),n}af.Cache=yr;function o8(t,e){return t===e||t!==t&&e!==e}var ty=Array.isArray;function s8(t){var e=ny(t)?Q2.call(t):"";return e==db||e==yb}function ny(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function c8(t){return!!t&&typeof t=="object"}function of(t){return typeof t=="symbol"||c8(t)&&Q2.call(t)==Tb}function u8(t){return t==null?"":Jb(t)}function f8(t,e,n){var r=t==null?void 0:Yb(t,e);return r===void 0?n:r}var g8=f8;const l8=g8,p0=Symbol("DefinedCursors"),ry=new Set(["alias","all-scroll","auto","cell","col-resize","context-menu","copy","crosshair","default","e-resize","ew-resize","grab","grabbing","help","move","ne-resize","nesw-resize","no-drop","none","not-allowed","n-resize","ns-resize","nw-resize","nwse-resize","pointer","progress","row-resize","se-resize","s-resize","sw-resize","text","vertical-text","wait","w-resize","zoom-in","zoom-out"]);class Vt{constructor(e,n){this.name=e+"",this.fallback=n}getName(){return this.name+""}addFallbackStyleProperty(e){const{fallback:n}=this;return n instanceof Vt?`${e}, ${n.getStyleProperty()}`:e+""}getStyleProperty(){return this.addFallbackStyleProperty(this.name)+""}static getDefinedCursor(e){const n=h0(Vt,p0);let r=n.get(e);if(r instanceof Vt)return r;if(ry.has(e))return r=new Vt(e),n.set(e,r),r}static setDefinedCursor(e,n){return n instanceof Vt?(h0(Vt,p0).set(e,n),!0):!1}}function h0(t,e){let n=t[e];return n instanceof Map||(n=new Map,Object.defineProperty(t,e,{value:n})),n}const v8=ry.values(),p8="image-cursor";class mo extends Vt{constructor(e,n,r,a,i){super(a||mo.getUniqueInstanceName(p8),i),this.url=e,this.x=Number(n)||0,this.y=Number(r)||0}getStyleProperty(){const{url:e,x:n,y:r}=this;let a=`url('${e}')`;return n>=0&&r>=0&&(n>0||r>0)&&(a+=` ${n} ${r}`),this.addFallbackStyleProperty(a)}static getUniqueInstanceName(e){return`${e}-${N0(mo)}`}}const me={iconContent:"",iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:`
    <path stroke="{{color}}" d="M8 16L8 0"></path>
    <path stroke="{{color}}" d="M16 8L0 8"></path>
  `},mt={x:127,y:60},kr=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
`,Dn=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
<rect fill="{{color}}" x="95.84" y="9.38" width="15.85" height="47.14"/>
`,Vi='<path fill="{{color}}" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',Ur='<path fill="{{color}}" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',Li='<path fill="{{color}}" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',Yc={Angle:Ce(me,{iconContent:`<path fill="{{color}}" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50
    50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23
    10l50 50q10 10 10 23z" />`,viewBox:{x:1792,y:1792}}),ArrowAnnotate:Ce(me,{iconContent:`<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />
  </g>`,viewBox:{x:24,y:24}}),Bidirectional:Ce(me,{iconContent:`<g fill="{{color}}" stroke-width="3" stroke="{{color}}">
    <path d="M27.63 3.21L3.12 28.81"></path>
    <path d="M27.63 15.75L15.27 4.43"></path>
    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>
    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>
    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>
    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>
  </g>`,viewBox:{x:48,y:48}}),CobbAngle:Ce(me,{iconContent:`<g stroke="{{color}}" stroke-width="3">
    <path d="M28.59 2.34L3.82 12.32"></path>
    <path d="M28.59 29.66L3.82 19.68"></path>
    <path stroke-dasharray="2" fill-opacity="0" d="M12.37
      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15
      9.33C13.11 9.24 13.02 9 12.88 8.63">
    </path>
  </g>`,viewBox:{x:32,y:32}}),CircleROI:Ce(me,{iconContent:'<circle stroke="{{color}}" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',viewBox:{x:32,y:32}}),EllipticalROI:Ce(me,{iconContent:`<path stroke="{{color}}" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16
    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14
    6.3 30.74 10.54 30.74 15.76Z" />`,viewBox:{x:32,y:32}}),FreehandROI:Ce(me,{iconContent:`<g fill="{{color}}" stroke="{{color}}" stroke-width="2">
    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>
    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>
    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>
    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>
    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>
    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>
    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>
    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>
    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>
    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>
    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>
    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>
    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>
    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>
    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>
    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>
    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>
    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>
    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>
    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>
    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>
    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>
    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>
    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>
    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>
    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>
    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>
    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>
    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>
    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>
  </g>`,viewBox:{x:18,y:18}}),FreehandROISculptor:Ce(me,{iconContent:`<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>
    <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>
    <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>
    <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>
    <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>
    <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>
    <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>
    <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>
    <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>
    <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>
    <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>
    <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>
    <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>
    <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>
    <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>
    <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>
    <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>
    <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>
    <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>
    <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>
    <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>
    <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>
    <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>
    <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>
    <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>
    <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>
    <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>
    <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>
    <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>
    <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>
    <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>
    <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>
  </g>`,viewBox:{x:18,y:18}}),Length:Ce(me,{iconContent:`<g id="length-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />
  </g>`,viewBox:{x:24,y:24}}),Probe:Ce(me,{iconContent:`<path fill="{{color}}" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75
    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73
    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5
    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5
    385.5-103 385.5 103 279.5 279.5 103 385.5z" />`,viewBox:{x:1792,y:1792}}),RectangleROI:Ce(me,{iconContent:`<path fill="{{color}}" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47
    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0
    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119
    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),TextMarker:Ce(me,{iconContent:`<path fill="{{color}}" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0
    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29
    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15
    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5
    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0
    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11
    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0
    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58
    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z" />`,viewBox:{x:1792,y:1792}}),Crosshairs:Ce(me,{iconContent:`<path fill="{{color}}" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26
    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45
    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26
    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5
    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32
    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5
    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26
    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26
    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161
    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161
    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z" />`,viewBox:{x:1792,y:1792}}),Eraser:Ce(me,{iconContent:`<path transform="translate(0,1792) scale(1,-1)" fill="{{color}}" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15
    34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38
    0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38
    0 69.5 20.5t47.5 54.5z" />`,viewBox:{x:2048,y:1792}}),Magnify:Ce(me,{iconContent:`<path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />`,viewBox:{x:512,y:512}}),Pan:Ce(me,{iconContent:`<path fill="{{color}}" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17
    39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355
    355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59
    39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12
    0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144
    144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19
    45v448q0 42-39 59-13 5-25 5-26 0-45-19z" />`,viewBox:{x:1792,y:1792}}),Rotate:Ce(me,{iconContent:`<path fill="{{color}}" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39
    14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5
    163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0
    225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109
    132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298
    164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14
    39 17 39 59z" />`,viewBox:{x:1792,y:1792}}),StackScroll:Ce(me,{iconContent:`<path fill="{{color}}" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0
    0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547
    0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z" />`,viewBox:{x:24,y:28}}),WindowLevelRegion:Ce(me,{iconContent:`<path fill="{{color}}" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119
    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5
    84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),WindowLevel:Ce(me,{iconContent:`
    <path fill="{{color}}" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />
    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="{{color}}" />`,viewBox:{x:18,y:18}}),Zoom:Ce(me,{iconContent:`
  <path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />
  <path fill="{{color}}" transform="scale(0.22,0.22) translate(1400,0)" d="M1216
    320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19
    19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26
    0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z" />`,viewBox:{x:640,y:512}}),SegmentationFreeHandEraseInside:Ce(me,{iconContent:`${Vi} ${kr}`,viewBox:mt}),SegmentationFreeHandFillInside:Ce(me,{iconContent:`${Vi} ${Dn}`,viewBox:mt}),SegmentationFreeHandEraseOutside:Ce(me,{iconContent:`${Vi} ${kr}`,viewBox:mt}),SegmentationFreeHandFillOutside:Ce(me,{iconContent:`${Vi} ${Dn}`,viewBox:mt}),SegmentationRectangleEraseInside:Ce(me,{iconContent:`${Ur} ${kr}`,viewBox:mt}),RectangleScissor:Ce(me,{iconContent:`${Ur} ${Dn}`,viewBox:mt}),"RectangleScissor.FILL_INSIDE":Ce(me,{iconContent:`${Ur} ${Dn}`,viewBox:mt}),"RectangleScissor.FILL_OUTSIDE":Ce(me,{iconContent:`${Ur} ${Dn}`,viewBox:mt}),"RectangleScissor.ERASE_OUTSIDE":Ce(me,{iconContent:`${Ur} ${kr}`,viewBox:mt}),"RectangleScissor.ERASE_INSIDE":Ce(me,{iconContent:`${Ur} ${kr}`,viewBox:mt}),CircleScissor:Ce(me,{iconContent:`${Li} ${Dn}`,viewBox:mt}),"CircleScissor.FILL_INSIDE":Ce(me,{iconContent:`${Li} ${Dn}`,viewBox:mt}),"CircleScissor.ERASE_OUTSIDE":Ce(me,{iconContent:`${Li} ${kr}`,viewBox:mt}),"CircleScissor.FILL_OUTSIDE":Ce(me,{iconContent:`${Li} ${Dn}`,viewBox:mt})};function Ce(t,e){return Object.assign(Object.create(t),e)}function h8(t){if(Object.prototype.hasOwnProperty.call(Yc,t))return Yc[t]}const d8=Object.keys(Yc),y8="color",T8=tF.Highlighted,m8=Wt.Active;class ay extends mo{constructor(e,n,r,a,i){super(e,n,r,a,i)}static getDefinedCursor(e,n=!1,r){r||(r=u_(y8,{},T8,m8));const a=C8(e,n,r);let i=super.getDefinedCursor(a);if(!i){const o=h8(e);o&&(i=w8(o,a,n,r,super.getDefinedCursor("default")),super.setDefinedCursor(a,i))}return i}}function iy(t,e){const n=Object(e),r=Object.prototype.hasOwnProperty.bind(n);return(t+"").replace(/\{\{(\w+)\}\}/g,(a,i)=>r(i)?n[i]+"":"")}function C8(t,e,n){return`${e?"pointer":"cursor"}:${t}/${n}`}function w8(t,e,n,r,a){const{x:i,y:o}=t.mousePoint;return new ay(S8(t,n,{color:r}),i,o,e,a)}function S8(t,e,n){return URL.createObjectURL(E8(t,e,n))}function E8(t,e,n){const r=(e?O8:x8)(t,n);return new Blob([r],{type:"image/svg+xml"})}function x8(t,e){const{iconContent:n,iconSize:r,viewBox:a}=t,i=`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="${r}" height="${r}" viewBox="0 0
      ${a.x} ${a.y}">
      ${n}
    </svg>`;return iy(i,e)}function O8(t,e){const{iconContent:n,iconSize:r,viewBox:a,mousePointerGroupString:i}=t,o=r/Math.max(a.x,a.y,1),s=16+r,c=`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="${s}" height="${s}" viewBox="0 0 ${s} ${s}">
      <g>${i}</g>
      <g transform="translate(16, 16) scale(${o})">${n}</g>
    </svg>`;return iy(c,e)}const d0=Symbol("ElementCursorsMap");function M8(t,e){Co(t)[0]=e,R8(t,e)}function R8(t,e){const n=Co(t);n[1]=n[0],n[0]=e,t.style.cursor=(e instanceof Vt?e:Vt.getDefinedCursor("auto")).getStyleProperty()}function Co(t){let e=Co[d0];e instanceof WeakMap||(e=new WeakMap,Object.defineProperty(Co,d0,{value:e}));let n=e.get(t);return n||(n=[null,null],e.set(t,n)),n}[...d8,...v8];const{Active:Ni,Passive:y0,Enabled:T0,Disabled:m0}=Wt;class D8{constructor(e){this.viewportsInfo=[],this.toolOptions={},this._toolInstances={},this.id=e}getViewportIds(){return this.viewportsInfo.map(({viewportId:e})=>e)}getViewportsInfo(){return Object.assign({},this.viewportsInfo)}getToolInstance(e){const n=this._toolInstances[e];if(!n){console.warn(`'${e}' is not registered with this toolGroup.`);return}return n}addTool(e,n={}){const r=Re.tools[e],a=typeof e<"u"&&e!=="",i=this.toolOptions[e];if(!a){console.warn("Tool with configuration did not produce a toolName: ",n);return}if(!r){console.warn(`'${e}' is not registered with the library.`);return}if(i){console.warn(`'${e}' is already registered for ToolGroup ${this.id}.`);return}const{toolClass:o}=r,s={name:e,toolGroupId:this.id,configuration:n},c=new o(s);this._toolInstances[e]=c}addViewport(e,n){const r=ra();if(!n&&r.length>1)throw new Error("You must specify a renderingEngineId when there are multiple rendering engines.");const a=n||r[0].id;this.viewportsInfo.push({viewportId:e,renderingEngineId:a});const i=this.getActivePrimaryMouseButtonTool();_e.getRuntimeSettings().get("useCursors")&&this.setViewportsCursorByToolName(i)}removeViewports(e,n){const r=[];if(this.viewportsInfo.forEach((a,i)=>{let o=!1;a.renderingEngineId===e&&(o=!0,n&&a.viewportId!==n&&(o=!1)),o&&r.push(i)}),r.length)for(let a=r.length-1;a>=0;a--)this.viewportsInfo.splice(r[a],1)}setToolActive(e,n={}){if(this._toolInstances[e]===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const r=this.toolOptions[e]?this.toolOptions[e].bindings:[],a=n.bindings?n.bindings:[],i={bindings:[...r,...a],mode:Ni};this.toolOptions[e]=i,this._toolInstances[e].mode=Ni;const s=_e.getRuntimeSettings().get("useCursors");if(this._hasMousePrimaryButtonBinding(n)&&s)this.setViewportsCursorByToolName(e);else{const c=Vt.getDefinedCursor("default");this._setCursorForViewports(c)}typeof this._toolInstances[e].onSetToolActive=="function"&&this._toolInstances[e].onSetToolActive(),this._renderViewports()}setToolPassive(e){if(this._toolInstances[e]===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const n=this.getToolOptions(e),r=Object.assign({bindings:n?n.bindings:[]},n,{mode:y0});r.bindings=r.bindings.filter(i=>i.mouseButton!==yn.Primary);let a=y0;r.bindings.length!==0&&(a=Ni,r.mode=a),this.toolOptions[e]=r,this._toolInstances[e].mode=a,typeof this._toolInstances[e].onSetToolPassive=="function"&&this._toolInstances[e].onSetToolPassive(),this._renderViewports()}setToolEnabled(e){if(this._toolInstances[e]===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const n={bindings:[],mode:T0};this.toolOptions[e]=n,this._toolInstances[e].mode=T0,typeof this._toolInstances[e].onSetToolEnabled=="function"&&this._toolInstances[e].onSetToolEnabled(),this._renderViewports()}setToolDisabled(e){if(this._toolInstances[e]===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const n={bindings:[],mode:m0};this.toolOptions[e]=n,this._toolInstances[e].mode=m0,typeof this._toolInstances[e].onSetToolDisabled=="function"&&this._toolInstances[e].onSetToolDisabled(),this._renderViewports()}getToolOptions(e){return this.toolOptions[e]}getActivePrimaryMouseButtonTool(){return Object.keys(this.toolOptions).find(e=>{const n=this.toolOptions[e];return n.mode===Ni&&this._hasMousePrimaryButtonBinding(n)})}setViewportsCursorByToolName(e,n){const r=n?`${e}.${n}`:e;let a=ay.getDefinedCursor(r,!0);a||(a=Vt.getDefinedCursor("default")),this._setCursorForViewports(a)}_setCursorForViewports(e){this.viewportsInfo.forEach(({renderingEngineId:n,viewportId:r})=>{const a=ti(r,n);if(!a)return;const{viewport:i}=a;M8(i.element,e)})}setToolConfiguration(e,n,r){if(this._toolInstances[e]===void 0)return console.warn(`Tool ${e} not present, can't set tool configuration.`),!1;let a;return r?a=n:a=ja(this._toolInstances[e].configuration,n),this._toolInstances[e].configuration=a,this._renderViewports(),!0}getToolConfiguration(e,n){if(this._toolInstances[e]===void 0){console.warn(`Tool ${e} not present, can't set tool configuration.`);return}const r=l8(this._toolInstances[e].configuration,n);return ht(r)}_hasMousePrimaryButtonBinding(e){var n;return(n=e==null?void 0:e.bindings)==null?void 0:n.some(r=>r.mouseButton===yn.Primary&&r.modifierKey===void 0)}_renderViewports(){this.viewportsInfo.forEach(({renderingEngineId:e,viewportId:n})=>{wn(e).renderViewport(n)})}}function V8(t){if(Re.toolGroups.some(r=>r.id===t)){console.warn(`'${t}' already exists.`);return}const n=new D8(t);return Re.toolGroups.push(n),n}function es(t){return Re.toolGroups.find(e=>e.id===t)}function L8(t,e,n){const r=t.getCamera(),{focalPoint:a,viewPlaneNormal:i,position:o}=r,{spacingInNormalDirection:s,imageVolume:c}=iu(t,r,e);if(!c)throw new Error(`Could not find image volume with id ${e} in the viewport`);const u=t.getActor(c.volumeId);u||console.warn("No actor found for with actorUID of",c.volumeId);const g=u.actor,f=yu(g,i,a),{newFocalPoint:l,newPosition:v}=up(a,o,f,i,s,n);t.setCamera({focalPoint:l,position:v}),t.render()}class oy extends ri{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"]}){super(e,n),this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(e){const{element:n,deltaPoints:r}=e.detail,a=Ye(n),i=r.world,o=a.viewport.getCamera(),{focalPoint:s,position:c}=o,u=[c[0]-i[0],c[1]-i[1],c[2]-i[2]],g=[s[0]-i[0],s[1]-i[1],s[2]-i[2]];a.viewport.setCamera({focalPoint:g,position:u}),a.viewport.render()}}oy.toolName="Pan";const N8=oy,C0=4,F8=1024,_8="PT";class sy extends ri{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"]}){super(e,n),this._getImageDynamicRangeFromMiddleSlice=(r,a)=>{const i=Math.floor(a[2]/2),o=a[0]*a[1];let s,c;r instanceof Float32Array?(s=4,c=Float32Array):r instanceof Uint8Array&&(s=1,c=Uint8Array);const u=r.buffer,g=i*o*s,f=new c(u,g,o),{max:l,min:v}=this._getMinMax(f,o);return l-v},this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(e){const{element:n,deltaPoints:r}=e.detail,a=Ye(n),{renderingEngine:i,viewportId:o,viewport:s}=a;let c,u,g,f,l,v,p,d,h=!1;if(s instanceof Cn){c=this.getTargetId(s).split("volumeId:")[1],u=s.getActor(c).actor,l=u.getProperty().getRGBTransferFunction(0),d=Mo(c,i.id),[g,f]=l.getRange();const y=be.getVolume(c);v=y.metadata.Modality,h=y.scaling&&Object.keys(y.scaling).length>0}else if(s instanceof An){const C=s.getProperties();v=s.modality,{lower:g,upper:f}=C.voiRange;const{preScale:m}=s.getImageData();h=m.scaled}else throw new Error("Viewport is not a valid type");v===_8&&h?p=this.getPTNewRange({deltaPointsCanvas:r.canvas,lower:g,upper:f,clientHeight:n.clientHeight}):p=this.getNewRange({viewport:s,deltaPointsCanvas:r.canvas,volumeId:c,lower:g,upper:f});const T={volumeId:c,viewportId:o,range:p};if(s instanceof An){s.setProperties({voiRange:p}),s.render();return}Y(n,q.VOI_MODIFIED,T),l.setRange(p.lower,p.upper),d.forEach(C=>{C.render()})}getPTNewRange({deltaPointsCanvas:e,lower:n,upper:r,clientHeight:a}){const i=e[1],o=5/a;return r-=i*o,r=Math.max(r,.1),{lower:n,upper:r}}getNewRange({viewport:e,deltaPointsCanvas:n,volumeId:r,lower:a,upper:i}){const o=this._getMultiplierFromDynamicRange(e,r)||C0,s=n[0]*o,c=n[1]*o;let{windowWidth:u,windowCenter:g}=ro(a,i);return u+=s,g+=c,u=Math.max(u,1),Pa(u,g)}_getMultiplierFromDynamicRange(e,n){let r;if(n){const o=be.getVolume(n),{dimensions:s,scalarData:c}=o;r=this._getImageDynamicRangeFromMiddleSlice(c,s)}else r=this._getImageDynamicRangeFromViewport(e);const a=r/F8;let i=C0;return a>1&&(i=Math.round(a)),i}_getImageDynamicRangeFromViewport(e){const{imageData:n}=e.getImageData(),r=n.getDimensions();let a;if(n.getScalarData?a=n.getScalarData():a=n.getPointData().getScalars(),r[2]!==1)return this._getImageDynamicRangeFromMiddleSlice(a,r);let i;if(a.getRange)i=a.getRange();else{const{min:o,max:s}=this._getMinMax(a,a.length);i=[o,s]}return i[1]-i[0]}_getMinMax(e,n){let r=1/0,a=-1/0;for(let i=0;i<n;i++){const o=e[i];o<r&&(r=o),o>a&&(a=o)}return{max:a,min:r}}}sy.toolName="WindowLevel";const b8=sy;class cy extends ri{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,debounceIfNotLoaded:!0}}){super(e,n)}mouseWheelCallback(e){const{wheel:n,element:r}=e.detail,{direction:a}=n,{invert:i}=this.configuration,{viewport:o}=Ye(r),s=a*(i?-1:1);if(o instanceof An)o.scroll(s,this.configuration.debounceIfNotLoaded);else if(o instanceof Cn){const u=this.getTargetId(o).split("volumeId:")[1];L8(o,u,s)}else throw new Error("StackScrollMouseWheelTool: Unsupported viewport type")}}cy.toolName="StackScrollMouseWheel";const k8=cy;class uy extends ri{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"],configuration:{zoomToCenter:!1,minZoomScale:.1,maxZoomScale:30}}){super(e,n),this.preMouseDownCallback=r=>{const a=r.detail,{currentPoints:i,element:o}=a,s=i.world,u=Ye(o).viewport.getCamera(),{focalPoint:g}=u;this.initialMousePosWorld=s;let f=or(g[0]-s[0],g[1]-s[1],g[2]-s[2]);return f=Nt(Ue(),f),this.dirVec=f,!1},this._dragParallelProjection=(r,a,i)=>{const{element:o,deltaPoints:s}=r.detail,c=[o.clientWidth,o.clientHeight],{parallelScale:u,focalPoint:g,position:f}=i,l=1.5/c[1],v=s.canvas[1],p=v*l;let d=(1-p)*u,h=g,T=f;if(!this.configuration.zoomToCenter){const D=Oo(g,this.initialMousePosWorld),L=5/c[1],N=v*L;d=(1-N)*u,T=Lt(Ue(),f,this.dirVec,-D*N),h=Lt(Ue(),g,this.dirVec,-D*N)}const C=a.getImageData(),{spacing:m}=C,{minZoomScale:y,maxZoomScale:w}=this.configuration,S=o.clientHeight*m[1]*.5,O=S/d;let M=d,R=!1;O<y?(M=S/y,R=!0):O>=w&&(M=S/w,R=!0),a.setCamera({parallelScale:M,focalPoint:R?g:h,position:R?f:T})},this._dragPerspectiveProjection=(r,a,i)=>{const{element:o,deltaPoints:s}=r.detail,c=[o.clientWidth,o.clientHeight],{position:u,focalPoint:g,viewPlaneNormal:f}=i,l=Pr.distance2BetweenPoints(u,g),v=Math.sqrt(l)/c[1],p=[-f[0],-f[1],-f[2]],h=s.canvas[1]*v;let T=h*p[0];u[0]+=T,g[0]+=T,T=h*p[1],u[1]+=T,g[1]+=T,T=h*p[2],u[2]+=T,g[2]+=T,a.setCamera({position:u,focalPoint:g})},this.initialMousePosWorld=[0,0,0],this.dirVec=[0,0,0],this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(e){const{element:n}=e.detail,r=Ye(n),{viewport:a}=r,i=a.getCamera();i.parallelProjection?this._dragParallelProjection(e,a,i):this._dragPerspectiveProjection(e,a,i),a.render()}}uy.toolName="Zoom";const U8=uy;function En(){return SF}function sf(t){return En().getSegmentation(t)}function Ua(t){return En().getSegmentationRepresentations(t)}function fy(t){const e=En(),n=e.getState(),r=Object.keys(n.toolGroups),a=[];return r.forEach(i=>{e.getSegmentationRepresentations(i).forEach(s=>{s.segmentationId===t&&a.push(i)})}),a}function B8(t){return En().getToolGroupSpecificConfig(t)}function G8(t,e,n){En().setSegmentationRepresentationConfig(t,e),n||za(t)}function A8(t,e,n){En().addSegmentationRepresentation(t,e),n||za(t,e.segmentationRepresentationUID)}function I8(){return En().getGlobalConfig()}function P8(t,e){En().removeSegmentationRepresentation(t,e),EF(t,e)}function W8(t){return En().getColorLUT(t)}let w0=!1;function z8(t={}){w0||($8(),H8(),w0=!0)}function $8(){j8();const t=q.ELEMENT_ENABLED,e=q.ELEMENT_DISABLED;ee.addEventListener(t,K2),ee.addEventListener(e,q2)}function j8(){const t=q.ELEMENT_ENABLED,e=q.ELEMENT_DISABLED;ee.removeEventListener(t,K2),ee.removeEventListener(e,q2)}function H8(){K8(),ee.addEventListener(ne.ANNOTATION_MODIFIED,M2),ee.addEventListener(ne.ANNOTATION_SELECTION_CHANGE,To),ee.addEventListener(ne.ANNOTATION_SELECTION_CHANGE,To),ee.addEventListener(ne.SEGMENTATION_MODIFIED,x2),ee.addEventListener(ne.SEGMENTATION_DATA_MODIFIED,S2),ee.addEventListener(ne.SEGMENTATION_REPRESENTATION_MODIFIED,w2),ee.addEventListener(ne.SEGMENTATION_REPRESENTATION_REMOVED,E2)}function K8(){ee.removeEventListener(ne.ANNOTATION_MODIFIED,M2),ee.removeEventListener(ne.ANNOTATION_SELECTION_CHANGE,To),ee.removeEventListener(ne.ANNOTATION_SELECTION_CHANGE,To),ee.removeEventListener(ne.SEGMENTATION_MODIFIED,x2),ee.removeEventListener(ne.SEGMENTATION_DATA_MODIFIED,S2),ee.removeEventListener(ne.SEGMENTATION_REPRESENTATION_MODIFIED,w2),ee.removeEventListener(ne.SEGMENTATION_REPRESENTATION_REMOVED,E2)}function q8(t,e,n){const a=V8("myToolGroup");return n.forEach(([i,o])=>{X8(a,i,o)}),a.addViewport(t,e),a}function X8(t,e,n){MF(e),t.addTool(e.toolName);const r=n!==null?[{mouseButton:n}]:[];t.setToolActive(e.toolName,{bindings:r})}function S0(t,e,n){return r=>{const a=t.getBoundingClientRect(),i=[Math.floor(r.clientX-a.left),Math.floor(r.clientY-a.top)],o=e.canvasToWorld(i);n.innerText=`(${o.map(s=>s.toPrecision(4)).join(", ")})`}}const{OrientationAxis:tc}=D0;function Va(t,e){const n=document.createElement("button");return n.classList.add("btn","btn-primary"),n.innerText=t,n.onclick=e,n}function Y8(t,e,n){const r=Va("Vertical flip",()=>{const{flipVertical:s}=e.getCamera();e.setCamera({flipVertical:!s}),e.render()});t.appendChild(r);const a=Va("Horizontal flip",()=>{const{flipHorizontal:s}=e.getCamera();e.setCamera({flipHorizontal:!s}),e.render()});t.appendChild(a);const i=Va("Invert",()=>{const u=e.getActor(n).actor.getProperty().getRGBTransferFunction(0);Hi(u),e.render()});t.appendChild(i);const o=Va("Reset",()=>{e.resetCamera()});t.appendChild(o)}function Z8(t,e){[tc.AXIAL,tc.CORONAL,tc.SAGITTAL].forEach(n=>{const r=Va(n[0].toUpperCase()+n.slice(1),()=>{e.setOrientation(n)});t.appendChild(r)})}const{ViewportType:J8,OrientationAxis:Q8}=D0,Br=document.getElementById("cornerstone-element"),E0=document.getElementById("coordinates"),x0=document.querySelector(".toolbar"),gy=document.querySelector("#loading"),ek=document.querySelector("#errorModal");async function tk(t){const e="myRenderingEngine",n="main",r="grandChallengeImageVolume",a=`${r}:${t}`,o=["grandChallengeImage:imageId1"];await I3(),await z8(),C3(r,eF);const s=new TN(e),c=await m3(a,{imageIds:o});c.load();const u={viewportId:n,type:J8.ORTHOGRAPHIC,element:Br,defaultOptions:{orientation:Q8.AXIAL,background:[0,0,0]}};s.enableElement(u);const g=s.getViewport(n);Ed(s,[{volumeId:a}],[n],!0);const l=[[N8,yn.Primary],[U8,yn.Secondary],[b8,yn.Auxiliary],[k8,null]];q8(n,e,l),Br.addEventListener("mousemove",S0(Br,g,E0)),Br.addEventListener("wheel",S0(Br,g,E0)),new ResizeObserver(()=>s.resize()).observe(Br),Y8(x0.querySelector("#manipulation"),g,a),c.dimensions[2]>1&&Z8(x0.querySelector("#orientation"),g),gy.style.display="none"}tk(window.imagePk).catch(t=>{ek.querySelector(".modal-body").innerText=t.toString(),document.querySelector("#error-modal-btn").click()}).finally(()=>{gy.style.display="none"});
