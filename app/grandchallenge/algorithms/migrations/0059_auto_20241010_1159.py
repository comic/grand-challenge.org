# Generated by Django 4.2.16 on 2024-10-10 11:59

from django.db import migrations


def set_requirements_from_active_image(apps, schema_editor):
    Algorithm = apps.get_model("algorithms", "Algorithm")  # noqa: N806

    for algorithm in Algorithm.objects.all():
        if algorithm.active_image:
            algorithm.job_requires_memory_gb = (
                algorithm.active_image.requires_memory_gb
            )

            if algorithm.active_image.requires_gpu:
                algorithm.job_requires_gpu_type = (
                    algorithm.active_image.desired_gpu_type
                )
            else:
                algorithm.job_requires_gpu_type = ""

            algorithm.save()


class Migration(migrations.Migration):

    dependencies = [
        ("algorithms", "0058_algorithm_job_requires_gpu_type_and_more"),
    ]

    operations = [
        migrations.RunPython(
            set_requirements_from_active_image, elidable=True
        ),
    ]
