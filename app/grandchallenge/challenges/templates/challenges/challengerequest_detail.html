{% extends "base.html" %}
{% load url %}
{% load crispy_forms_tags %}
{% load static %}
{% load bleach %}
{% load user_profile_link from profiles %}

{% block title %}Challenge request: {{ object.title }}{% endblock %}

{% block breadcrumbs %}
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'challenges:list' %}">Challenges</a></li>
        <li class="breadcrumb-item"><a href="{% url 'challenges:requests-list' %}">Requests</a></li>
        <li class="breadcrumb-item active">{{ object.title }}</li>
    </ol>
{% endblock %}

{% block content %}
    <h2>{{ object.title }}</h2>
    <br>
    <div class="row">
        <p class="col-6">{% if object.status == object.ChallengeRequestStatusChoices.ACCEPTED %}<span class="badge badge-success">Accepted</span>{% elif object.status == object.ChallengeRequestStatusChoices.REJECTED %}<span class="badge badge-danger">Rejected</span>{% endif %} Challenge request by {{ object.creator|user_profile_link }}, created on {{ object.created }}</p>
        <div class="col-6 text-right">
            {% if object.structured_challenge_submission_form %}
                <a class="btn btn-primary mb-3" href="{{ object.structured_challenge_submission_form.url }}">Download Miccai submission PDF</a>
            {% endif %}
            <a class="btn btn-primary mb-3" href="mailto:{{ object.contact_email }}"><i class="fa fa-envelope"></i> &nbsp;Contact requester</a>
        </div>
    </div>
    <div class="table-responsive">
        <table class="table table-hover">
        {% for field, value in fields.items %}
            {% if value %}
                <tr><td class="col-3 font-weight-bold">{{ field|title }}</td> <td class="col-9">{{ value|linebreaks }}</td></tr>
            {% endif %}
        {% endfor %}
        {% if object.long_term_commitment %}
            <tr><td class="col-3 font-weight-bold">Long-term support</td> <td class="col-9"><i class="fas fa-check-circle text-success pr-2"></i> The organizers agree to support this challenge for up to 5 years.</td></tr>
        {% elif object.long_term_commitment == None %}
            <tr><td class="col-3 font-weight-bold">Long-term support</td> <td class="col-9">Unknown</td></tr>
        {% else %}
            <tr><td class="col-3 font-weight-bold">Long-term support</td> <td class="col-9"><i class="fas fa-exclamation-circle text-danger pr-2"></i>  The organizers do not agree to support this challenge for up to 5 years for the following reason: <br><span class="ml-4">{{ object.long_term_commitment_extra }}</span></td></tr>
        {% endif %}
        {% if object.data_license %}
            <tr><td class="col-3 font-weight-bold">Public data license</td> <td class="col-9"><i class="fas fa-check-circle text-success pr-2"></i>  The organizers agree to publish their public data set under a CC-BY license.</td></tr>
        {% elif object.data_license == None %}
            <tr><td class="col-3 font-weight-bold">Public data license</td> <td class="col-9">Unknown</td></tr>
        {% else %}
            <tr><td class="col-3 font-weight-bold">Public data license</td> <td class="col-9"><i class="fas fa-exclamation-circle text-danger pr-2"></i> The organizers do not agree to publish their public data set under a CC-BY license for the following reason: <br> <span class="ml-4">{{ object.data_license_extra }}</span></td></tr>
        {% endif %}
        {% if object.comments %}
            <tr><td class="col-3 font-weight-bold">Comments from organizers</td> <td class="col-9"><div class="bg-warning rounded p-3">{{ object.comments|linebreaks }}</div></td></tr>
        {% endif %}
        </table>
    </div>
    <br>
    {% if budget %}
        <div class="mt-3" id="budget">
            <div class="row">
                <div class="col-6">
                    <h2>Budget estimate</h2>
                </div>
                <div class="col-6 text-right">
                    <a class="btn btn-primary" hx-get="{% url 'challenges:requests-update' pk=object.pk %}?budget" hx-swap="innerHTML" hx-target="#budget">Edit budget fields</a>
                </div>
            </div>
            <br>
            Based on the following information provided by the challenge requester:
            <br><br>
            <ul>
                {% for field, value in budget_fields.items %}
                    <li><span class="font-weight-bold">{% if field == "inference time limit in minutes" %}Average algorithm job run time in minutes{% else %}{{ field|capfirst }}{% endif %}</span>: {{ value }}</li>
                {% endfor %}
            </ul>
            <br>
            <div class="table-responsive">
                <table class="table table-hover table-sm">
                {% for field, value in budget.items %}
                    <tr {% if "Total" in field %}class="table-light"{% endif %}><td class="col-5 font-weight-bold">{{ field }}</td> <td class="col-7">{{ value }} €</td></tr>
                {% endfor %}
                <tr><td class="col-5 font-weight-bold">Organizer's budget for hosting challenge</td> <td class="col-7">{{ object.budget_for_hosting_challenge }} €</td></tr>
                </table>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block script %}
    {{ block.super }}
    <script type="text/javascript" src="{% static "js/unsavedform.js" %}"></script>
{% endblock %}
